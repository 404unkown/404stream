var SI=Object.defineProperty;var Ry=r=>{throw TypeError(r)};var EI=(r,e,t)=>e in r?SI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var pt=(r,e,t)=>EI(r,typeof e!="symbol"?e+"":e,t),Fh=(r,e,t)=>e.has(r)||Ry("Cannot "+t);var K=(r,e,t)=>(Fh(r,e,"read from private field"),t?t.call(r):e.get(r)),Se=(r,e,t)=>e.has(r)?Ry("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),ye=(r,e,t,n)=>(Fh(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),Fe=(r,e,t)=>(Fh(r,e,"access private method"),t);var Sc=(r,e,t,n)=>({set _(s){ye(r,e,s,t)},get _(){return K(r,e,n)}});function TI(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in r)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(r,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var Ec=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cg(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function $b(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var Bb={exports:{}},Kd={},Ub={exports:{}},Me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sc=Symbol.for("react.element"),_I=Symbol.for("react.portal"),AI=Symbol.for("react.fragment"),kI=Symbol.for("react.strict_mode"),II=Symbol.for("react.profiler"),RI=Symbol.for("react.provider"),CI=Symbol.for("react.context"),LI=Symbol.for("react.forward_ref"),PI=Symbol.for("react.suspense"),DI=Symbol.for("react.memo"),OI=Symbol.for("react.lazy"),Cy=Symbol.iterator;function NI(r){return r===null||typeof r!="object"?null:(r=Cy&&r[Cy]||r["@@iterator"],typeof r=="function"?r:null)}var zb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Gb=Object.assign,Hb={};function Aa(r,e,t){this.props=r,this.context=e,this.refs=Hb,this.updater=t||zb}Aa.prototype.isReactComponent={};Aa.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};Aa.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Vb(){}Vb.prototype=Aa.prototype;function ug(r,e,t){this.props=r,this.context=e,this.refs=Hb,this.updater=t||zb}var dg=ug.prototype=new Vb;dg.constructor=ug;Gb(dg,Aa.prototype);dg.isPureReactComponent=!0;var Ly=Array.isArray,Wb=Object.prototype.hasOwnProperty,hg={current:null},Kb={key:!0,ref:!0,__self:!0,__source:!0};function qb(r,e,t){var n,s={},i=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Wb.call(e,n)&&!Kb.hasOwnProperty(n)&&(s[n]=e[n]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(r&&r.defaultProps)for(n in a=r.defaultProps,a)s[n]===void 0&&(s[n]=a[n]);return{$$typeof:sc,type:r,key:i,ref:o,props:s,_owner:hg.current}}function MI(r,e){return{$$typeof:sc,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function fg(r){return typeof r=="object"&&r!==null&&r.$$typeof===sc}function FI(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var Py=/\/+/g;function jh(r,e){return typeof r=="object"&&r!==null&&r.key!=null?FI(""+r.key):e.toString(36)}function Eu(r,e,t,n,s){var i=typeof r;(i==="undefined"||i==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case sc:case _I:o=!0}}if(o)return o=r,s=s(o),r=n===""?"."+jh(o,0):n,Ly(s)?(t="",r!=null&&(t=r.replace(Py,"$&/")+"/"),Eu(s,e,t,"",function(c){return c})):s!=null&&(fg(s)&&(s=MI(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Py,"$&/")+"/")+r)),e.push(s)),1;if(o=0,n=n===""?".":n+":",Ly(r))for(var a=0;a<r.length;a++){i=r[a];var l=n+jh(i,a);o+=Eu(i,e,t,l,s)}else if(l=NI(r),typeof l=="function")for(r=l.call(r),a=0;!(i=r.next()).done;)i=i.value,l=n+jh(i,a++),o+=Eu(i,e,t,l,s);else if(i==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Tc(r,e,t){if(r==null)return r;var n=[],s=0;return Eu(r,n,"","",function(i){return e.call(t,i,s++)}),n}function jI(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var rr={current:null},Tu={transition:null},$I={ReactCurrentDispatcher:rr,ReactCurrentBatchConfig:Tu,ReactCurrentOwner:hg};function Yb(){throw Error("act(...) is not supported in production builds of React.")}Me.Children={map:Tc,forEach:function(r,e,t){Tc(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return Tc(r,function(){e++}),e},toArray:function(r){return Tc(r,function(e){return e})||[]},only:function(r){if(!fg(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Me.Component=Aa;Me.Fragment=AI;Me.Profiler=II;Me.PureComponent=ug;Me.StrictMode=kI;Me.Suspense=PI;Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$I;Me.act=Yb;Me.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=Gb({},r.props),s=r.key,i=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=hg.current),e.key!==void 0&&(s=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(l in e)Wb.call(e,l)&&!Kb.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];n.children=a}return{$$typeof:sc,type:r.type,key:s,ref:i,props:n,_owner:o}};Me.createContext=function(r){return r={$$typeof:CI,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:RI,_context:r},r.Consumer=r};Me.createElement=qb;Me.createFactory=function(r){var e=qb.bind(null,r);return e.type=r,e};Me.createRef=function(){return{current:null}};Me.forwardRef=function(r){return{$$typeof:LI,render:r}};Me.isValidElement=fg;Me.lazy=function(r){return{$$typeof:OI,_payload:{_status:-1,_result:r},_init:jI}};Me.memo=function(r,e){return{$$typeof:DI,type:r,compare:e===void 0?null:e}};Me.startTransition=function(r){var e=Tu.transition;Tu.transition={};try{r()}finally{Tu.transition=e}};Me.unstable_act=Yb;Me.useCallback=function(r,e){return rr.current.useCallback(r,e)};Me.useContext=function(r){return rr.current.useContext(r)};Me.useDebugValue=function(){};Me.useDeferredValue=function(r){return rr.current.useDeferredValue(r)};Me.useEffect=function(r,e){return rr.current.useEffect(r,e)};Me.useId=function(){return rr.current.useId()};Me.useImperativeHandle=function(r,e,t){return rr.current.useImperativeHandle(r,e,t)};Me.useInsertionEffect=function(r,e){return rr.current.useInsertionEffect(r,e)};Me.useLayoutEffect=function(r,e){return rr.current.useLayoutEffect(r,e)};Me.useMemo=function(r,e){return rr.current.useMemo(r,e)};Me.useReducer=function(r,e,t){return rr.current.useReducer(r,e,t)};Me.useRef=function(r){return rr.current.useRef(r)};Me.useState=function(r){return rr.current.useState(r)};Me.useSyncExternalStore=function(r,e,t){return rr.current.useSyncExternalStore(r,e,t)};Me.useTransition=function(){return rr.current.useTransition()};Me.version="18.3.1";Ub.exports=Me;var T=Ub.exports;const ue=cg(T),pg=TI({__proto__:null,default:ue},[T]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BI=T,UI=Symbol.for("react.element"),zI=Symbol.for("react.fragment"),GI=Object.prototype.hasOwnProperty,HI=BI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,VI={key:!0,ref:!0,__self:!0,__source:!0};function Qb(r,e,t){var n,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)GI.call(e,n)&&!VI.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:UI,type:r,key:i,ref:o,props:s,_owner:HI.current}}Kd.Fragment=zI;Kd.jsx=Qb;Kd.jsxs=Qb;Bb.exports=Kd;var v=Bb.exports,Xb={exports:{}},Pr={},Jb={exports:{}},Zb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(j,F){var Y=j.length;j.push(F);e:for(;0<Y;){var M=Y-1>>>1,D=j[M];if(0<s(D,F))j[M]=F,j[Y]=D,Y=M;else break e}}function t(j){return j.length===0?null:j[0]}function n(j){if(j.length===0)return null;var F=j[0],Y=j.pop();if(Y!==F){j[0]=Y;e:for(var M=0,D=j.length,ee=D>>>1;M<ee;){var Q=2*(M+1)-1,te=j[Q],oe=Q+1,ce=j[oe];if(0>s(te,Y))oe<D&&0>s(ce,te)?(j[M]=ce,j[oe]=Y,M=oe):(j[M]=te,j[Q]=Y,M=Q);else if(oe<D&&0>s(ce,Y))j[M]=ce,j[oe]=Y,M=oe;else break e}}return F}function s(j,F){var Y=j.sortIndex-F.sortIndex;return Y!==0?Y:j.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,m=!1,p=!1,g=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(j){for(var F=t(c);F!==null;){if(F.callback===null)n(c);else if(F.startTime<=j)n(c),F.sortIndex=F.expirationTime,e(l,F);else break;F=t(c)}}function b(j){if(p=!1,w(j),!m)if(t(l)!==null)m=!0,V(E);else{var F=t(c);F!==null&&G(b,F.startTime-j)}}function E(j,F){m=!1,p&&(p=!1,y(C),C=-1),f=!0;var Y=h;try{for(w(F),d=t(l);d!==null&&(!(d.expirationTime>F)||j&&!$());){var M=d.callback;if(typeof M=="function"){d.callback=null,h=d.priorityLevel;var D=M(d.expirationTime<=F);F=r.unstable_now(),typeof D=="function"?d.callback=D:d===t(l)&&n(l),w(F)}else n(l);d=t(l)}if(d!==null)var ee=!0;else{var Q=t(c);Q!==null&&G(b,Q.startTime-F),ee=!1}return ee}finally{d=null,h=Y,f=!1}}var I=!1,S=null,C=-1,R=5,L=-1;function $(){return!(r.unstable_now()-L<R)}function P(){if(S!==null){var j=r.unstable_now();L=j;var F=!0;try{F=S(!0,j)}finally{F?U():(I=!1,S=null)}}else I=!1}var U;if(typeof x=="function")U=function(){x(P)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,H=_.port2;_.port1.onmessage=P,U=function(){H.postMessage(null)}}else U=function(){g(P,0)};function V(j){S=j,I||(I=!0,U())}function G(j,F){C=g(function(){j(r.unstable_now())},F)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(j){j.callback=null},r.unstable_continueExecution=function(){m||f||(m=!0,V(E))},r.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<j?Math.floor(1e3/j):5},r.unstable_getCurrentPriorityLevel=function(){return h},r.unstable_getFirstCallbackNode=function(){return t(l)},r.unstable_next=function(j){switch(h){case 1:case 2:case 3:var F=3;break;default:F=h}var Y=h;h=F;try{return j()}finally{h=Y}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(j,F){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var Y=h;h=j;try{return F()}finally{h=Y}},r.unstable_scheduleCallback=function(j,F,Y){var M=r.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?M+Y:M):Y=M,j){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=Y+D,j={id:u++,callback:F,priorityLevel:j,startTime:Y,expirationTime:D,sortIndex:-1},Y>M?(j.sortIndex=Y,e(c,j),t(l)===null&&j===t(c)&&(p?(y(C),C=-1):p=!0,G(b,Y-M))):(j.sortIndex=D,e(l,j),m||f||(m=!0,V(E))),j},r.unstable_shouldYield=$,r.unstable_wrapCallback=function(j){var F=h;return function(){var Y=h;h=F;try{return j.apply(this,arguments)}finally{h=Y}}}})(Zb);Jb.exports=Zb;var WI=Jb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KI=T,Lr=WI;function le(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var eS=new Set,yl={};function Ji(r,e){ha(r,e),ha(r+"Capture",e)}function ha(r,e){for(yl[r]=e,r=0;r<e.length;r++)eS.add(e[r])}var ss=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ap=Object.prototype.hasOwnProperty,qI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Dy={},Oy={};function YI(r){return ap.call(Oy,r)?!0:ap.call(Dy,r)?!1:qI.test(r)?Oy[r]=!0:(Dy[r]=!0,!1)}function QI(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function XI(r,e,t,n){if(e===null||typeof e>"u"||QI(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function nr(r,e,t,n,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var zt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){zt[r]=new nr(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];zt[e]=new nr(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){zt[r]=new nr(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){zt[r]=new nr(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){zt[r]=new nr(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){zt[r]=new nr(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){zt[r]=new nr(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){zt[r]=new nr(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){zt[r]=new nr(r,5,!1,r.toLowerCase(),null,!1,!1)});var mg=/[\-:]([a-z])/g;function gg(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(mg,gg);zt[e]=new nr(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(mg,gg);zt[e]=new nr(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(mg,gg);zt[e]=new nr(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){zt[r]=new nr(r,1,!1,r.toLowerCase(),null,!1,!1)});zt.xlinkHref=new nr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){zt[r]=new nr(r,1,!1,r.toLowerCase(),null,!0,!0)});function yg(r,e,t,n){var s=zt.hasOwnProperty(e)?zt[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(XI(e,t,s,n)&&(t=null),n||s===null?YI(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):s.mustUseProperty?r[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,n=s.attributeNamespace,t===null?r.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var us=KI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_c=Symbol.for("react.element"),ko=Symbol.for("react.portal"),Io=Symbol.for("react.fragment"),vg=Symbol.for("react.strict_mode"),lp=Symbol.for("react.profiler"),tS=Symbol.for("react.provider"),rS=Symbol.for("react.context"),xg=Symbol.for("react.forward_ref"),cp=Symbol.for("react.suspense"),up=Symbol.for("react.suspense_list"),wg=Symbol.for("react.memo"),Ts=Symbol.for("react.lazy"),nS=Symbol.for("react.offscreen"),Ny=Symbol.iterator;function Fa(r){return r===null||typeof r!="object"?null:(r=Ny&&r[Ny]||r["@@iterator"],typeof r=="function"?r:null)}var ht=Object.assign,$h;function qa(r){if($h===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);$h=e&&e[1]||""}return`
`+$h+r}var Bh=!1;function Uh(r,e){if(!r||Bh)return"";Bh=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var n=c}Reflect.construct(r,[],e)}else{try{e.call()}catch(c){n=c}r.call(e.prototype)}else{try{throw Error()}catch(c){n=c}r()}}catch(c){if(c&&n&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=n.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return r.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",r.displayName)),l}while(1<=o&&0<=a);break}}}finally{Bh=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?qa(r):""}function JI(r){switch(r.tag){case 5:return qa(r.type);case 16:return qa("Lazy");case 13:return qa("Suspense");case 19:return qa("SuspenseList");case 0:case 2:case 15:return r=Uh(r.type,!1),r;case 11:return r=Uh(r.type.render,!1),r;case 1:return r=Uh(r.type,!0),r;default:return""}}function dp(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Io:return"Fragment";case ko:return"Portal";case lp:return"Profiler";case vg:return"StrictMode";case cp:return"Suspense";case up:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case rS:return(r.displayName||"Context")+".Consumer";case tS:return(r._context.displayName||"Context")+".Provider";case xg:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case wg:return e=r.displayName||null,e!==null?e:dp(r.type)||"Memo";case Ts:e=r._payload,r=r._init;try{return dp(r(e))}catch{}}return null}function ZI(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return dp(e);case 8:return e===vg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Zs(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function sS(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eR(r){var e=sS(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function Ac(r){r._valueTracker||(r._valueTracker=eR(r))}function iS(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=sS(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function Xu(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function hp(r,e){var t=e.checked;return ht({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function My(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Zs(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function oS(r,e){e=e.checked,e!=null&&yg(r,"checked",e,!1)}function fp(r,e){oS(r,e);var t=Zs(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?pp(r,e.type,t):e.hasOwnProperty("defaultValue")&&pp(r,e.type,Zs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function Fy(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function pp(r,e,t){(e!=="number"||Xu(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var Ya=Array.isArray;function Bo(r,e,t,n){if(r=r.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<r.length;t++)s=e.hasOwnProperty("$"+r[t].value),r[t].selected!==s&&(r[t].selected=s),s&&n&&(r[t].defaultSelected=!0)}else{for(t=""+Zs(t),e=null,s=0;s<r.length;s++){if(r[s].value===t){r[s].selected=!0,n&&(r[s].defaultSelected=!0);return}e!==null||r[s].disabled||(e=r[s])}e!==null&&(e.selected=!0)}}function mp(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(le(91));return ht({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function jy(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(le(92));if(Ya(t)){if(1<t.length)throw Error(le(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:Zs(t)}}function aS(r,e){var t=Zs(e.value),n=Zs(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function $y(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function lS(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function gp(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?lS(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var kc,cS=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,s)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(kc=kc||document.createElement("div"),kc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=kc.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function vl(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var tl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tR=["Webkit","ms","Moz","O"];Object.keys(tl).forEach(function(r){tR.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),tl[e]=tl[r]})});function uS(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||tl.hasOwnProperty(r)&&tl[r]?(""+e).trim():e+"px"}function dS(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,s=uS(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,s):r[t]=s}}var rR=ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yp(r,e){if(e){if(rR[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(le(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(le(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(le(61))}if(e.style!=null&&typeof e.style!="object")throw Error(le(62))}}function vp(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xp=null;function bg(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var wp=null,Uo=null,zo=null;function By(r){if(r=ac(r)){if(typeof wp!="function")throw Error(le(280));var e=r.stateNode;e&&(e=Jd(e),wp(r.stateNode,r.type,e))}}function hS(r){Uo?zo?zo.push(r):zo=[r]:Uo=r}function fS(){if(Uo){var r=Uo,e=zo;if(zo=Uo=null,By(r),e)for(r=0;r<e.length;r++)By(e[r])}}function pS(r,e){return r(e)}function mS(){}var zh=!1;function gS(r,e,t){if(zh)return r(e,t);zh=!0;try{return pS(r,e,t)}finally{zh=!1,(Uo!==null||zo!==null)&&(mS(),fS())}}function xl(r,e){var t=r.stateNode;if(t===null)return null;var n=Jd(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(le(231,e,typeof t));return t}var bp=!1;if(ss)try{var ja={};Object.defineProperty(ja,"passive",{get:function(){bp=!0}}),window.addEventListener("test",ja,ja),window.removeEventListener("test",ja,ja)}catch{bp=!1}function nR(r,e,t,n,s,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var rl=!1,Ju=null,Zu=!1,Sp=null,sR={onError:function(r){rl=!0,Ju=r}};function iR(r,e,t,n,s,i,o,a,l){rl=!1,Ju=null,nR.apply(sR,arguments)}function oR(r,e,t,n,s,i,o,a,l){if(iR.apply(this,arguments),rl){if(rl){var c=Ju;rl=!1,Ju=null}else throw Error(le(198));Zu||(Zu=!0,Sp=c)}}function Zi(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function yS(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function Uy(r){if(Zi(r)!==r)throw Error(le(188))}function aR(r){var e=r.alternate;if(!e){if(e=Zi(r),e===null)throw Error(le(188));return e!==r?null:r}for(var t=r,n=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(n=s.return,n!==null){t=n;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return Uy(s),r;if(i===n)return Uy(s),e;i=i.sibling}throw Error(le(188))}if(t.return!==n.return)t=s,n=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,n=i;break}if(a===n){o=!0,n=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,n=s;break}if(a===n){o=!0,n=i,t=s;break}a=a.sibling}if(!o)throw Error(le(189))}}if(t.alternate!==n)throw Error(le(190))}if(t.tag!==3)throw Error(le(188));return t.stateNode.current===t?r:e}function vS(r){return r=aR(r),r!==null?xS(r):null}function xS(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=xS(r);if(e!==null)return e;r=r.sibling}return null}var wS=Lr.unstable_scheduleCallback,zy=Lr.unstable_cancelCallback,lR=Lr.unstable_shouldYield,cR=Lr.unstable_requestPaint,xt=Lr.unstable_now,uR=Lr.unstable_getCurrentPriorityLevel,Sg=Lr.unstable_ImmediatePriority,bS=Lr.unstable_UserBlockingPriority,ed=Lr.unstable_NormalPriority,dR=Lr.unstable_LowPriority,SS=Lr.unstable_IdlePriority,qd=null,On=null;function hR(r){if(On&&typeof On.onCommitFiberRoot=="function")try{On.onCommitFiberRoot(qd,r,void 0,(r.current.flags&128)===128)}catch{}}var hn=Math.clz32?Math.clz32:mR,fR=Math.log,pR=Math.LN2;function mR(r){return r>>>=0,r===0?32:31-(fR(r)/pR|0)|0}var Ic=64,Rc=4194304;function Qa(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function td(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,s=r.suspendedLanes,i=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?n=Qa(a):(i&=o,i!==0&&(n=Qa(i)))}else o=t&~s,o!==0?n=Qa(o):i!==0&&(n=Qa(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&s)&&(s=n&-n,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-hn(e),s=1<<t,n|=r[t],e&=~s;return n}function gR(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yR(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,s=r.expirationTimes,i=r.pendingLanes;0<i;){var o=31-hn(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&n)&&(s[o]=gR(a,e)):l<=e&&(r.expiredLanes|=a),i&=~a}}function Ep(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function ES(){var r=Ic;return Ic<<=1,!(Ic&4194240)&&(Ic=64),r}function Gh(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function ic(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-hn(e),r[e]=t}function vR(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var s=31-hn(t),i=1<<s;e[s]=0,n[s]=-1,r[s]=-1,t&=~i}}function Eg(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-hn(t),s=1<<n;s&e|r[n]&e&&(r[n]|=e),t&=~s}}var Ve=0;function TS(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var _S,Tg,AS,kS,IS,Tp=!1,Cc=[],zs=null,Gs=null,Hs=null,wl=new Map,bl=new Map,Is=[],xR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gy(r,e){switch(r){case"focusin":case"focusout":zs=null;break;case"dragenter":case"dragleave":Gs=null;break;case"mouseover":case"mouseout":Hs=null;break;case"pointerover":case"pointerout":wl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":bl.delete(e.pointerId)}}function $a(r,e,t,n,s,i){return r===null||r.nativeEvent!==i?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:i,targetContainers:[s]},e!==null&&(e=ac(e),e!==null&&Tg(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),r)}function wR(r,e,t,n,s){switch(e){case"focusin":return zs=$a(zs,r,e,t,n,s),!0;case"dragenter":return Gs=$a(Gs,r,e,t,n,s),!0;case"mouseover":return Hs=$a(Hs,r,e,t,n,s),!0;case"pointerover":var i=s.pointerId;return wl.set(i,$a(wl.get(i)||null,r,e,t,n,s)),!0;case"gotpointercapture":return i=s.pointerId,bl.set(i,$a(bl.get(i)||null,r,e,t,n,s)),!0}return!1}function RS(r){var e=_i(r.target);if(e!==null){var t=Zi(e);if(t!==null){if(e=t.tag,e===13){if(e=yS(t),e!==null){r.blockedOn=e,IS(r.priority,function(){AS(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function _u(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=_p(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);xp=n,t.target.dispatchEvent(n),xp=null}else return e=ac(t),e!==null&&Tg(e),r.blockedOn=t,!1;e.shift()}return!0}function Hy(r,e,t){_u(r)&&t.delete(e)}function bR(){Tp=!1,zs!==null&&_u(zs)&&(zs=null),Gs!==null&&_u(Gs)&&(Gs=null),Hs!==null&&_u(Hs)&&(Hs=null),wl.forEach(Hy),bl.forEach(Hy)}function Ba(r,e){r.blockedOn===e&&(r.blockedOn=null,Tp||(Tp=!0,Lr.unstable_scheduleCallback(Lr.unstable_NormalPriority,bR)))}function Sl(r){function e(s){return Ba(s,r)}if(0<Cc.length){Ba(Cc[0],r);for(var t=1;t<Cc.length;t++){var n=Cc[t];n.blockedOn===r&&(n.blockedOn=null)}}for(zs!==null&&Ba(zs,r),Gs!==null&&Ba(Gs,r),Hs!==null&&Ba(Hs,r),wl.forEach(e),bl.forEach(e),t=0;t<Is.length;t++)n=Is[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<Is.length&&(t=Is[0],t.blockedOn===null);)RS(t),t.blockedOn===null&&Is.shift()}var Go=us.ReactCurrentBatchConfig,rd=!0;function SR(r,e,t,n){var s=Ve,i=Go.transition;Go.transition=null;try{Ve=1,_g(r,e,t,n)}finally{Ve=s,Go.transition=i}}function ER(r,e,t,n){var s=Ve,i=Go.transition;Go.transition=null;try{Ve=4,_g(r,e,t,n)}finally{Ve=s,Go.transition=i}}function _g(r,e,t,n){if(rd){var s=_p(r,e,t,n);if(s===null)Zh(r,e,n,nd,t),Gy(r,n);else if(wR(s,r,e,t,n))n.stopPropagation();else if(Gy(r,n),e&4&&-1<xR.indexOf(r)){for(;s!==null;){var i=ac(s);if(i!==null&&_S(i),i=_p(r,e,t,n),i===null&&Zh(r,e,n,nd,t),i===s)break;s=i}s!==null&&n.stopPropagation()}else Zh(r,e,n,null,t)}}var nd=null;function _p(r,e,t,n){if(nd=null,r=bg(n),r=_i(r),r!==null)if(e=Zi(r),e===null)r=null;else if(t=e.tag,t===13){if(r=yS(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return nd=r,null}function CS(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uR()){case Sg:return 1;case bS:return 4;case ed:case dR:return 16;case SS:return 536870912;default:return 16}default:return 16}}var $s=null,Ag=null,Au=null;function LS(){if(Au)return Au;var r,e=Ag,t=e.length,n,s="value"in $s?$s.value:$s.textContent,i=s.length;for(r=0;r<t&&e[r]===s[r];r++);var o=t-r;for(n=1;n<=o&&e[t-n]===s[i-n];n++);return Au=s.slice(r,1<n?1-n:void 0)}function ku(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function Lc(){return!0}function Vy(){return!1}function Dr(r){function e(t,n,s,i,o){this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Lc:Vy,this.isPropagationStopped=Vy,this}return ht(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Lc)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Lc)},persist:function(){},isPersistent:Lc}),e}var ka={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kg=Dr(ka),oc=ht({},ka,{view:0,detail:0}),TR=Dr(oc),Hh,Vh,Ua,Yd=ht({},oc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ig,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ua&&(Ua&&r.type==="mousemove"?(Hh=r.screenX-Ua.screenX,Vh=r.screenY-Ua.screenY):Vh=Hh=0,Ua=r),Hh)},movementY:function(r){return"movementY"in r?r.movementY:Vh}}),Wy=Dr(Yd),_R=ht({},Yd,{dataTransfer:0}),AR=Dr(_R),kR=ht({},oc,{relatedTarget:0}),Wh=Dr(kR),IR=ht({},ka,{animationName:0,elapsedTime:0,pseudoElement:0}),RR=Dr(IR),CR=ht({},ka,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),LR=Dr(CR),PR=ht({},ka,{data:0}),Ky=Dr(PR),DR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},OR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MR(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=NR[r])?!!e[r]:!1}function Ig(){return MR}var FR=ht({},oc,{key:function(r){if(r.key){var e=DR[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=ku(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?OR[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ig,charCode:function(r){return r.type==="keypress"?ku(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ku(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),jR=Dr(FR),$R=ht({},Yd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qy=Dr($R),BR=ht({},oc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ig}),UR=Dr(BR),zR=ht({},ka,{propertyName:0,elapsedTime:0,pseudoElement:0}),GR=Dr(zR),HR=ht({},Yd,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),VR=Dr(HR),WR=[9,13,27,32],Rg=ss&&"CompositionEvent"in window,nl=null;ss&&"documentMode"in document&&(nl=document.documentMode);var KR=ss&&"TextEvent"in window&&!nl,PS=ss&&(!Rg||nl&&8<nl&&11>=nl),Yy=" ",Qy=!1;function DS(r,e){switch(r){case"keyup":return WR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OS(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ro=!1;function qR(r,e){switch(r){case"compositionend":return OS(e);case"keypress":return e.which!==32?null:(Qy=!0,Yy);case"textInput":return r=e.data,r===Yy&&Qy?null:r;default:return null}}function YR(r,e){if(Ro)return r==="compositionend"||!Rg&&DS(r,e)?(r=LS(),Au=Ag=$s=null,Ro=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return PS&&e.locale!=="ko"?null:e.data;default:return null}}var QR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xy(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!QR[r.type]:e==="textarea"}function NS(r,e,t,n){hS(n),e=sd(e,"onChange"),0<e.length&&(t=new kg("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var sl=null,El=null;function XR(r){WS(r,0)}function Qd(r){var e=Po(r);if(iS(e))return r}function JR(r,e){if(r==="change")return e}var MS=!1;if(ss){var Kh;if(ss){var qh="oninput"in document;if(!qh){var Jy=document.createElement("div");Jy.setAttribute("oninput","return;"),qh=typeof Jy.oninput=="function"}Kh=qh}else Kh=!1;MS=Kh&&(!document.documentMode||9<document.documentMode)}function Zy(){sl&&(sl.detachEvent("onpropertychange",FS),El=sl=null)}function FS(r){if(r.propertyName==="value"&&Qd(El)){var e=[];NS(e,El,r,bg(r)),gS(XR,e)}}function ZR(r,e,t){r==="focusin"?(Zy(),sl=e,El=t,sl.attachEvent("onpropertychange",FS)):r==="focusout"&&Zy()}function eC(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Qd(El)}function tC(r,e){if(r==="click")return Qd(e)}function rC(r,e){if(r==="input"||r==="change")return Qd(e)}function nC(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var pn=typeof Object.is=="function"?Object.is:nC;function Tl(r,e){if(pn(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var s=t[n];if(!ap.call(e,s)||!pn(r[s],e[s]))return!1}return!0}function ev(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function tv(r,e){var t=ev(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=ev(t)}}function jS(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?jS(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function $S(){for(var r=window,e=Xu();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=Xu(r.document)}return e}function Cg(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function sC(r){var e=$S(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&jS(t.ownerDocument.documentElement,t)){if(n!==null&&Cg(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var s=t.textContent.length,i=Math.min(n.start,s);n=n.end===void 0?i:Math.min(n.end,s),!r.extend&&i>n&&(s=n,n=i,i=s),s=tv(t,i);var o=tv(t,n);s&&o&&(r.rangeCount!==1||r.anchorNode!==s.node||r.anchorOffset!==s.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),r.removeAllRanges(),i>n?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var iC=ss&&"documentMode"in document&&11>=document.documentMode,Co=null,Ap=null,il=null,kp=!1;function rv(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;kp||Co==null||Co!==Xu(n)||(n=Co,"selectionStart"in n&&Cg(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),il&&Tl(il,n)||(il=n,n=sd(Ap,"onSelect"),0<n.length&&(e=new kg("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=Co)))}function Pc(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var Lo={animationend:Pc("Animation","AnimationEnd"),animationiteration:Pc("Animation","AnimationIteration"),animationstart:Pc("Animation","AnimationStart"),transitionend:Pc("Transition","TransitionEnd")},Yh={},BS={};ss&&(BS=document.createElement("div").style,"AnimationEvent"in window||(delete Lo.animationend.animation,delete Lo.animationiteration.animation,delete Lo.animationstart.animation),"TransitionEvent"in window||delete Lo.transitionend.transition);function Xd(r){if(Yh[r])return Yh[r];if(!Lo[r])return r;var e=Lo[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in BS)return Yh[r]=e[t];return r}var US=Xd("animationend"),zS=Xd("animationiteration"),GS=Xd("animationstart"),HS=Xd("transitionend"),VS=new Map,nv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ai(r,e){VS.set(r,e),Ji(e,[r])}for(var Qh=0;Qh<nv.length;Qh++){var Xh=nv[Qh],oC=Xh.toLowerCase(),aC=Xh[0].toUpperCase()+Xh.slice(1);ai(oC,"on"+aC)}ai(US,"onAnimationEnd");ai(zS,"onAnimationIteration");ai(GS,"onAnimationStart");ai("dblclick","onDoubleClick");ai("focusin","onFocus");ai("focusout","onBlur");ai(HS,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);Ji("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ji("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ji("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ji("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ji("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ji("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lC=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xa));function sv(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,oR(n,e,void 0,r),r.currentTarget=null}function WS(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],s=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;sv(s,a,c),i=l}else for(o=0;o<n.length;o++){if(a=n[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;sv(s,a,c),i=l}}}if(Zu)throw r=Sp,Zu=!1,Sp=null,r}function rt(r,e){var t=e[Pp];t===void 0&&(t=e[Pp]=new Set);var n=r+"__bubble";t.has(n)||(KS(e,r,2,!1),t.add(n))}function Jh(r,e,t){var n=0;e&&(n|=4),KS(t,r,n,e)}var Dc="_reactListening"+Math.random().toString(36).slice(2);function _l(r){if(!r[Dc]){r[Dc]=!0,eS.forEach(function(t){t!=="selectionchange"&&(lC.has(t)||Jh(t,!1,r),Jh(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[Dc]||(e[Dc]=!0,Jh("selectionchange",!1,e))}}function KS(r,e,t,n){switch(CS(e)){case 1:var s=SR;break;case 4:s=ER;break;default:s=_g}t=s.bind(null,e,t,r),s=void 0,!bp||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?r.addEventListener(e,t,{capture:!0,passive:s}):r.addEventListener(e,t,!0):s!==void 0?r.addEventListener(e,t,{passive:s}):r.addEventListener(e,t,!1)}function Zh(r,e,t,n,s){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=_i(a),o===null)return;if(l=o.tag,l===5||l===6){n=i=o;continue e}a=a.parentNode}}n=n.return}gS(function(){var c=i,u=bg(t),d=[];e:{var h=VS.get(r);if(h!==void 0){var f=kg,m=r;switch(r){case"keypress":if(ku(t)===0)break e;case"keydown":case"keyup":f=jR;break;case"focusin":m="focus",f=Wh;break;case"focusout":m="blur",f=Wh;break;case"beforeblur":case"afterblur":f=Wh;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Wy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=AR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=UR;break;case US:case zS:case GS:f=RR;break;case HS:f=GR;break;case"scroll":f=TR;break;case"wheel":f=VR;break;case"copy":case"cut":case"paste":f=LR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=qy}var p=(e&4)!==0,g=!p&&r==="scroll",y=p?h!==null?h+"Capture":null:h;p=[];for(var x=c,w;x!==null;){w=x;var b=w.stateNode;if(w.tag===5&&b!==null&&(w=b,y!==null&&(b=xl(x,y),b!=null&&p.push(Al(x,b,w)))),g)break;x=x.return}0<p.length&&(h=new f(h,m,null,t,u),d.push({event:h,listeners:p}))}}if(!(e&7)){e:{if(h=r==="mouseover"||r==="pointerover",f=r==="mouseout"||r==="pointerout",h&&t!==xp&&(m=t.relatedTarget||t.fromElement)&&(_i(m)||m[is]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(m=t.relatedTarget||t.toElement,f=c,m=m?_i(m):null,m!==null&&(g=Zi(m),m!==g||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=c),f!==m)){if(p=Wy,b="onMouseLeave",y="onMouseEnter",x="mouse",(r==="pointerout"||r==="pointerover")&&(p=qy,b="onPointerLeave",y="onPointerEnter",x="pointer"),g=f==null?h:Po(f),w=m==null?h:Po(m),h=new p(b,x+"leave",f,t,u),h.target=g,h.relatedTarget=w,b=null,_i(u)===c&&(p=new p(y,x+"enter",m,t,u),p.target=w,p.relatedTarget=g,b=p),g=b,f&&m)t:{for(p=f,y=m,x=0,w=p;w;w=so(w))x++;for(w=0,b=y;b;b=so(b))w++;for(;0<x-w;)p=so(p),x--;for(;0<w-x;)y=so(y),w--;for(;x--;){if(p===y||y!==null&&p===y.alternate)break t;p=so(p),y=so(y)}p=null}else p=null;f!==null&&iv(d,h,f,p,!1),m!==null&&g!==null&&iv(d,g,m,p,!0)}}e:{if(h=c?Po(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var E=JR;else if(Xy(h))if(MS)E=rC;else{E=eC;var I=ZR}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(E=tC);if(E&&(E=E(r,c))){NS(d,E,t,u);break e}I&&I(r,h,c),r==="focusout"&&(I=h._wrapperState)&&I.controlled&&h.type==="number"&&pp(h,"number",h.value)}switch(I=c?Po(c):window,r){case"focusin":(Xy(I)||I.contentEditable==="true")&&(Co=I,Ap=c,il=null);break;case"focusout":il=Ap=Co=null;break;case"mousedown":kp=!0;break;case"contextmenu":case"mouseup":case"dragend":kp=!1,rv(d,t,u);break;case"selectionchange":if(iC)break;case"keydown":case"keyup":rv(d,t,u)}var S;if(Rg)e:{switch(r){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else Ro?DS(r,t)&&(C="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(C="onCompositionStart");C&&(PS&&t.locale!=="ko"&&(Ro||C!=="onCompositionStart"?C==="onCompositionEnd"&&Ro&&(S=LS()):($s=u,Ag="value"in $s?$s.value:$s.textContent,Ro=!0)),I=sd(c,C),0<I.length&&(C=new Ky(C,r,null,t,u),d.push({event:C,listeners:I}),S?C.data=S:(S=OS(t),S!==null&&(C.data=S)))),(S=KR?qR(r,t):YR(r,t))&&(c=sd(c,"onBeforeInput"),0<c.length&&(u=new Ky("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=S))}WS(d,e)})}function Al(r,e,t){return{instance:r,listener:e,currentTarget:t}}function sd(r,e){for(var t=e+"Capture",n=[];r!==null;){var s=r,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=xl(r,t),i!=null&&n.unshift(Al(r,i,s)),i=xl(r,e),i!=null&&n.push(Al(r,i,s))),r=r.return}return n}function so(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function iv(r,e,t,n,s){for(var i=e._reactName,o=[];t!==null&&t!==n;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&c!==null&&(a=c,s?(l=xl(t,i),l!=null&&o.unshift(Al(t,l,a))):s||(l=xl(t,i),l!=null&&o.push(Al(t,l,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var cC=/\r\n?/g,uC=/\u0000|\uFFFD/g;function ov(r){return(typeof r=="string"?r:""+r).replace(cC,`
`).replace(uC,"")}function Oc(r,e,t){if(e=ov(e),ov(r)!==e&&t)throw Error(le(425))}function id(){}var Ip=null,Rp=null;function Cp(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Lp=typeof setTimeout=="function"?setTimeout:void 0,dC=typeof clearTimeout=="function"?clearTimeout:void 0,av=typeof Promise=="function"?Promise:void 0,hC=typeof queueMicrotask=="function"?queueMicrotask:typeof av<"u"?function(r){return av.resolve(null).then(r).catch(fC)}:Lp;function fC(r){setTimeout(function(){throw r})}function ef(r,e){var t=e,n=0;do{var s=t.nextSibling;if(r.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(n===0){r.removeChild(s),Sl(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=s}while(t);Sl(e)}function Vs(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function lv(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Ia=Math.random().toString(36).slice(2),Cn="__reactFiber$"+Ia,kl="__reactProps$"+Ia,is="__reactContainer$"+Ia,Pp="__reactEvents$"+Ia,pC="__reactListeners$"+Ia,mC="__reactHandles$"+Ia;function _i(r){var e=r[Cn];if(e)return e;for(var t=r.parentNode;t;){if(e=t[is]||t[Cn]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=lv(r);r!==null;){if(t=r[Cn])return t;r=lv(r)}return e}r=t,t=r.parentNode}return null}function ac(r){return r=r[Cn]||r[is],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Po(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(le(33))}function Jd(r){return r[kl]||null}var Dp=[],Do=-1;function li(r){return{current:r}}function nt(r){0>Do||(r.current=Dp[Do],Dp[Do]=null,Do--)}function Ze(r,e){Do++,Dp[Do]=r.current,r.current=e}var ei={},qt=li(ei),hr=li(!1),zi=ei;function fa(r,e){var t=r.type.contextTypes;if(!t)return ei;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=s),s}function fr(r){return r=r.childContextTypes,r!=null}function od(){nt(hr),nt(qt)}function cv(r,e,t){if(qt.current!==ei)throw Error(le(168));Ze(qt,e),Ze(hr,t)}function qS(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(le(108,ZI(r)||"Unknown",s));return ht({},t,n)}function ad(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||ei,zi=qt.current,Ze(qt,r),Ze(hr,hr.current),!0}function uv(r,e,t){var n=r.stateNode;if(!n)throw Error(le(169));t?(r=qS(r,e,zi),n.__reactInternalMemoizedMergedChildContext=r,nt(hr),nt(qt),Ze(qt,r)):nt(hr),Ze(hr,t)}var Zn=null,Zd=!1,tf=!1;function YS(r){Zn===null?Zn=[r]:Zn.push(r)}function gC(r){Zd=!0,YS(r)}function ci(){if(!tf&&Zn!==null){tf=!0;var r=0,e=Ve;try{var t=Zn;for(Ve=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}Zn=null,Zd=!1}catch(s){throw Zn!==null&&(Zn=Zn.slice(r+1)),wS(Sg,ci),s}finally{Ve=e,tf=!1}}return null}var Oo=[],No=0,ld=null,cd=0,Mr=[],Fr=0,Gi=null,ts=1,rs="";function vi(r,e){Oo[No++]=cd,Oo[No++]=ld,ld=r,cd=e}function QS(r,e,t){Mr[Fr++]=ts,Mr[Fr++]=rs,Mr[Fr++]=Gi,Gi=r;var n=ts;r=rs;var s=32-hn(n)-1;n&=~(1<<s),t+=1;var i=32-hn(e)+s;if(30<i){var o=s-s%5;i=(n&(1<<o)-1).toString(32),n>>=o,s-=o,ts=1<<32-hn(e)+s|t<<s|n,rs=i+r}else ts=1<<i|t<<s|n,rs=r}function Lg(r){r.return!==null&&(vi(r,1),QS(r,1,0))}function Pg(r){for(;r===ld;)ld=Oo[--No],Oo[No]=null,cd=Oo[--No],Oo[No]=null;for(;r===Gi;)Gi=Mr[--Fr],Mr[Fr]=null,rs=Mr[--Fr],Mr[Fr]=null,ts=Mr[--Fr],Mr[Fr]=null}var kr=null,Ar=null,it=!1,dn=null;function XS(r,e){var t=Br(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function dv(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,kr=r,Ar=Vs(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,kr=r,Ar=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Gi!==null?{id:ts,overflow:rs}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Br(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,kr=r,Ar=null,!0):!1;default:return!1}}function Op(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Np(r){if(it){var e=Ar;if(e){var t=e;if(!dv(r,e)){if(Op(r))throw Error(le(418));e=Vs(t.nextSibling);var n=kr;e&&dv(r,e)?XS(n,t):(r.flags=r.flags&-4097|2,it=!1,kr=r)}}else{if(Op(r))throw Error(le(418));r.flags=r.flags&-4097|2,it=!1,kr=r}}}function hv(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;kr=r}function Nc(r){if(r!==kr)return!1;if(!it)return hv(r),it=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!Cp(r.type,r.memoizedProps)),e&&(e=Ar)){if(Op(r))throw JS(),Error(le(418));for(;e;)XS(r,e),e=Vs(e.nextSibling)}if(hv(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(le(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Ar=Vs(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Ar=null}}else Ar=kr?Vs(r.stateNode.nextSibling):null;return!0}function JS(){for(var r=Ar;r;)r=Vs(r.nextSibling)}function pa(){Ar=kr=null,it=!1}function Dg(r){dn===null?dn=[r]:dn.push(r)}var yC=us.ReactCurrentBatchConfig;function za(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(le(309));var n=t.stateNode}if(!n)throw Error(le(147,r));var s=n,i=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof r!="string")throw Error(le(284));if(!t._owner)throw Error(le(290,r))}return r}function Mc(r,e){throw r=Object.prototype.toString.call(e),Error(le(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function fv(r){var e=r._init;return e(r._payload)}function ZS(r){function e(y,x){if(r){var w=y.deletions;w===null?(y.deletions=[x],y.flags|=16):w.push(x)}}function t(y,x){if(!r)return null;for(;x!==null;)e(y,x),x=x.sibling;return null}function n(y,x){for(y=new Map;x!==null;)x.key!==null?y.set(x.key,x):y.set(x.index,x),x=x.sibling;return y}function s(y,x){return y=Ys(y,x),y.index=0,y.sibling=null,y}function i(y,x,w){return y.index=w,r?(w=y.alternate,w!==null?(w=w.index,w<x?(y.flags|=2,x):w):(y.flags|=2,x)):(y.flags|=1048576,x)}function o(y){return r&&y.alternate===null&&(y.flags|=2),y}function a(y,x,w,b){return x===null||x.tag!==6?(x=cf(w,y.mode,b),x.return=y,x):(x=s(x,w),x.return=y,x)}function l(y,x,w,b){var E=w.type;return E===Io?u(y,x,w.props.children,b,w.key):x!==null&&(x.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Ts&&fv(E)===x.type)?(b=s(x,w.props),b.ref=za(y,x,w),b.return=y,b):(b=Ou(w.type,w.key,w.props,null,y.mode,b),b.ref=za(y,x,w),b.return=y,b)}function c(y,x,w,b){return x===null||x.tag!==4||x.stateNode.containerInfo!==w.containerInfo||x.stateNode.implementation!==w.implementation?(x=uf(w,y.mode,b),x.return=y,x):(x=s(x,w.children||[]),x.return=y,x)}function u(y,x,w,b,E){return x===null||x.tag!==7?(x=$i(w,y.mode,b,E),x.return=y,x):(x=s(x,w),x.return=y,x)}function d(y,x,w){if(typeof x=="string"&&x!==""||typeof x=="number")return x=cf(""+x,y.mode,w),x.return=y,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case _c:return w=Ou(x.type,x.key,x.props,null,y.mode,w),w.ref=za(y,null,x),w.return=y,w;case ko:return x=uf(x,y.mode,w),x.return=y,x;case Ts:var b=x._init;return d(y,b(x._payload),w)}if(Ya(x)||Fa(x))return x=$i(x,y.mode,w,null),x.return=y,x;Mc(y,x)}return null}function h(y,x,w,b){var E=x!==null?x.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return E!==null?null:a(y,x,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case _c:return w.key===E?l(y,x,w,b):null;case ko:return w.key===E?c(y,x,w,b):null;case Ts:return E=w._init,h(y,x,E(w._payload),b)}if(Ya(w)||Fa(w))return E!==null?null:u(y,x,w,b,null);Mc(y,w)}return null}function f(y,x,w,b,E){if(typeof b=="string"&&b!==""||typeof b=="number")return y=y.get(w)||null,a(x,y,""+b,E);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case _c:return y=y.get(b.key===null?w:b.key)||null,l(x,y,b,E);case ko:return y=y.get(b.key===null?w:b.key)||null,c(x,y,b,E);case Ts:var I=b._init;return f(y,x,w,I(b._payload),E)}if(Ya(b)||Fa(b))return y=y.get(w)||null,u(x,y,b,E,null);Mc(x,b)}return null}function m(y,x,w,b){for(var E=null,I=null,S=x,C=x=0,R=null;S!==null&&C<w.length;C++){S.index>C?(R=S,S=null):R=S.sibling;var L=h(y,S,w[C],b);if(L===null){S===null&&(S=R);break}r&&S&&L.alternate===null&&e(y,S),x=i(L,x,C),I===null?E=L:I.sibling=L,I=L,S=R}if(C===w.length)return t(y,S),it&&vi(y,C),E;if(S===null){for(;C<w.length;C++)S=d(y,w[C],b),S!==null&&(x=i(S,x,C),I===null?E=S:I.sibling=S,I=S);return it&&vi(y,C),E}for(S=n(y,S);C<w.length;C++)R=f(S,y,C,w[C],b),R!==null&&(r&&R.alternate!==null&&S.delete(R.key===null?C:R.key),x=i(R,x,C),I===null?E=R:I.sibling=R,I=R);return r&&S.forEach(function($){return e(y,$)}),it&&vi(y,C),E}function p(y,x,w,b){var E=Fa(w);if(typeof E!="function")throw Error(le(150));if(w=E.call(w),w==null)throw Error(le(151));for(var I=E=null,S=x,C=x=0,R=null,L=w.next();S!==null&&!L.done;C++,L=w.next()){S.index>C?(R=S,S=null):R=S.sibling;var $=h(y,S,L.value,b);if($===null){S===null&&(S=R);break}r&&S&&$.alternate===null&&e(y,S),x=i($,x,C),I===null?E=$:I.sibling=$,I=$,S=R}if(L.done)return t(y,S),it&&vi(y,C),E;if(S===null){for(;!L.done;C++,L=w.next())L=d(y,L.value,b),L!==null&&(x=i(L,x,C),I===null?E=L:I.sibling=L,I=L);return it&&vi(y,C),E}for(S=n(y,S);!L.done;C++,L=w.next())L=f(S,y,C,L.value,b),L!==null&&(r&&L.alternate!==null&&S.delete(L.key===null?C:L.key),x=i(L,x,C),I===null?E=L:I.sibling=L,I=L);return r&&S.forEach(function(P){return e(y,P)}),it&&vi(y,C),E}function g(y,x,w,b){if(typeof w=="object"&&w!==null&&w.type===Io&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case _c:e:{for(var E=w.key,I=x;I!==null;){if(I.key===E){if(E=w.type,E===Io){if(I.tag===7){t(y,I.sibling),x=s(I,w.props.children),x.return=y,y=x;break e}}else if(I.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Ts&&fv(E)===I.type){t(y,I.sibling),x=s(I,w.props),x.ref=za(y,I,w),x.return=y,y=x;break e}t(y,I);break}else e(y,I);I=I.sibling}w.type===Io?(x=$i(w.props.children,y.mode,b,w.key),x.return=y,y=x):(b=Ou(w.type,w.key,w.props,null,y.mode,b),b.ref=za(y,x,w),b.return=y,y=b)}return o(y);case ko:e:{for(I=w.key;x!==null;){if(x.key===I)if(x.tag===4&&x.stateNode.containerInfo===w.containerInfo&&x.stateNode.implementation===w.implementation){t(y,x.sibling),x=s(x,w.children||[]),x.return=y,y=x;break e}else{t(y,x);break}else e(y,x);x=x.sibling}x=uf(w,y.mode,b),x.return=y,y=x}return o(y);case Ts:return I=w._init,g(y,x,I(w._payload),b)}if(Ya(w))return m(y,x,w,b);if(Fa(w))return p(y,x,w,b);Mc(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,x!==null&&x.tag===6?(t(y,x.sibling),x=s(x,w),x.return=y,y=x):(t(y,x),x=cf(w,y.mode,b),x.return=y,y=x),o(y)):t(y,x)}return g}var ma=ZS(!0),eE=ZS(!1),ud=li(null),dd=null,Mo=null,Og=null;function Ng(){Og=Mo=dd=null}function Mg(r){var e=ud.current;nt(ud),r._currentValue=e}function Mp(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function Ho(r,e){dd=r,Og=Mo=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(ur=!0),r.firstContext=null)}function zr(r){var e=r._currentValue;if(Og!==r)if(r={context:r,memoizedValue:e,next:null},Mo===null){if(dd===null)throw Error(le(308));Mo=r,dd.dependencies={lanes:0,firstContext:r}}else Mo=Mo.next=r;return e}var Ai=null;function Fg(r){Ai===null?Ai=[r]:Ai.push(r)}function tE(r,e,t,n){var s=e.interleaved;return s===null?(t.next=t,Fg(e)):(t.next=s.next,s.next=t),e.interleaved=t,os(r,n)}function os(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var _s=!1;function jg(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rE(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function ns(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function Ws(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,Be&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,os(r,t)}return s=n.interleaved,s===null?(e.next=e,Fg(n)):(e.next=s.next,s.next=e),n.interleaved=e,os(r,t)}function Iu(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,Eg(r,t)}}function pv(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function hd(r,e,t,n){var s=r.updateQueue;_s=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=r.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;o=0,u=c=l=null,a=i;do{var h=a.lane,f=a.eventTime;if((n&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=r,p=a;switch(h=e,f=t,p.tag){case 1:if(m=p.payload,typeof m=="function"){d=m.call(f,d,h);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=p.payload,h=typeof m=="function"?m.call(f,d,h):m,h==null)break e;d=ht({},d,h);break e;case 2:_s=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(!0);if(u===null&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Vi|=o,r.lanes=o,r.memoizedState=d}}function mv(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],s=n.callback;if(s!==null){if(n.callback=null,n=t,typeof s!="function")throw Error(le(191,s));s.call(n)}}}var lc={},Nn=li(lc),Il=li(lc),Rl=li(lc);function ki(r){if(r===lc)throw Error(le(174));return r}function $g(r,e){switch(Ze(Rl,e),Ze(Il,r),Ze(Nn,lc),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:gp(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=gp(e,r)}nt(Nn),Ze(Nn,e)}function ga(){nt(Nn),nt(Il),nt(Rl)}function nE(r){ki(Rl.current);var e=ki(Nn.current),t=gp(e,r.type);e!==t&&(Ze(Il,r),Ze(Nn,t))}function Bg(r){Il.current===r&&(nt(Nn),nt(Il))}var ct=li(0);function fd(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var rf=[];function Ug(){for(var r=0;r<rf.length;r++)rf[r]._workInProgressVersionPrimary=null;rf.length=0}var Ru=us.ReactCurrentDispatcher,nf=us.ReactCurrentBatchConfig,Hi=0,dt=null,It=null,Dt=null,pd=!1,ol=!1,Cl=0,vC=0;function Ht(){throw Error(le(321))}function zg(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!pn(r[t],e[t]))return!1;return!0}function Gg(r,e,t,n,s,i){if(Hi=i,dt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ru.current=r===null||r.memoizedState===null?SC:EC,r=t(n,s),ol){i=0;do{if(ol=!1,Cl=0,25<=i)throw Error(le(301));i+=1,Dt=It=null,e.updateQueue=null,Ru.current=TC,r=t(n,s)}while(ol)}if(Ru.current=md,e=It!==null&&It.next!==null,Hi=0,Dt=It=dt=null,pd=!1,e)throw Error(le(300));return r}function Hg(){var r=Cl!==0;return Cl=0,r}function En(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?dt.memoizedState=Dt=r:Dt=Dt.next=r,Dt}function Gr(){if(It===null){var r=dt.alternate;r=r!==null?r.memoizedState:null}else r=It.next;var e=Dt===null?dt.memoizedState:Dt.next;if(e!==null)Dt=e,It=r;else{if(r===null)throw Error(le(310));It=r,r={memoizedState:It.memoizedState,baseState:It.baseState,baseQueue:It.baseQueue,queue:It.queue,next:null},Dt===null?dt.memoizedState=Dt=r:Dt=Dt.next=r}return Dt}function Ll(r,e){return typeof e=="function"?e(r):e}function sf(r){var e=Gr(),t=e.queue;if(t===null)throw Error(le(311));t.lastRenderedReducer=r;var n=It,s=n.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}n.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,n=n.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((Hi&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:r(n,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=n):l=l.next=d,dt.lanes|=u,Vi|=u}c=c.next}while(c!==null&&c!==i);l===null?o=n:l.next=a,pn(n,e.memoizedState)||(ur=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=l,t.lastRenderedState=n}if(r=t.interleaved,r!==null){s=r;do i=s.lane,dt.lanes|=i,Vi|=i,s=s.next;while(s!==r)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function of(r){var e=Gr(),t=e.queue;if(t===null)throw Error(le(311));t.lastRenderedReducer=r;var n=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=r(i,o.action),o=o.next;while(o!==s);pn(i,e.memoizedState)||(ur=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,n]}function sE(){}function iE(r,e){var t=dt,n=Gr(),s=e(),i=!pn(n.memoizedState,s);if(i&&(n.memoizedState=s,ur=!0),n=n.queue,Vg(lE.bind(null,t,n,r),[r]),n.getSnapshot!==e||i||Dt!==null&&Dt.memoizedState.tag&1){if(t.flags|=2048,Pl(9,aE.bind(null,t,n,s,e),void 0,null),Nt===null)throw Error(le(349));Hi&30||oE(t,e,s)}return s}function oE(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=dt.updateQueue,e===null?(e={lastEffect:null,stores:null},dt.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function aE(r,e,t,n){e.value=t,e.getSnapshot=n,cE(e)&&uE(r)}function lE(r,e,t){return t(function(){cE(e)&&uE(r)})}function cE(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!pn(r,t)}catch{return!0}}function uE(r){var e=os(r,1);e!==null&&fn(e,r,1,-1)}function gv(r){var e=En();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ll,lastRenderedState:r},e.queue=r,r=r.dispatch=bC.bind(null,dt,r),[e.memoizedState,r]}function Pl(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=dt.updateQueue,e===null?(e={lastEffect:null,stores:null},dt.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function dE(){return Gr().memoizedState}function Cu(r,e,t,n){var s=En();dt.flags|=r,s.memoizedState=Pl(1|e,t,void 0,n===void 0?null:n)}function eh(r,e,t,n){var s=Gr();n=n===void 0?null:n;var i=void 0;if(It!==null){var o=It.memoizedState;if(i=o.destroy,n!==null&&zg(n,o.deps)){s.memoizedState=Pl(e,t,i,n);return}}dt.flags|=r,s.memoizedState=Pl(1|e,t,i,n)}function yv(r,e){return Cu(8390656,8,r,e)}function Vg(r,e){return eh(2048,8,r,e)}function hE(r,e){return eh(4,2,r,e)}function fE(r,e){return eh(4,4,r,e)}function pE(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function mE(r,e,t){return t=t!=null?t.concat([r]):null,eh(4,4,pE.bind(null,e,r),t)}function Wg(){}function gE(r,e){var t=Gr();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&zg(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function yE(r,e){var t=Gr();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&zg(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function vE(r,e,t){return Hi&21?(pn(t,e)||(t=ES(),dt.lanes|=t,Vi|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,ur=!0),r.memoizedState=t)}function xC(r,e){var t=Ve;Ve=t!==0&&4>t?t:4,r(!0);var n=nf.transition;nf.transition={};try{r(!1),e()}finally{Ve=t,nf.transition=n}}function xE(){return Gr().memoizedState}function wC(r,e,t){var n=qs(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},wE(r))bE(e,t);else if(t=tE(r,e,t,n),t!==null){var s=tr();fn(t,r,n,s),SE(t,e,n)}}function bC(r,e,t){var n=qs(r),s={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(wE(r))bE(e,s);else{var i=r.alternate;if(r.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,pn(a,o)){var l=e.interleaved;l===null?(s.next=s,Fg(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=tE(r,e,s,n),t!==null&&(s=tr(),fn(t,r,n,s),SE(t,e,n))}}function wE(r){var e=r.alternate;return r===dt||e!==null&&e===dt}function bE(r,e){ol=pd=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function SE(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,Eg(r,t)}}var md={readContext:zr,useCallback:Ht,useContext:Ht,useEffect:Ht,useImperativeHandle:Ht,useInsertionEffect:Ht,useLayoutEffect:Ht,useMemo:Ht,useReducer:Ht,useRef:Ht,useState:Ht,useDebugValue:Ht,useDeferredValue:Ht,useTransition:Ht,useMutableSource:Ht,useSyncExternalStore:Ht,useId:Ht,unstable_isNewReconciler:!1},SC={readContext:zr,useCallback:function(r,e){return En().memoizedState=[r,e===void 0?null:e],r},useContext:zr,useEffect:yv,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,Cu(4194308,4,pE.bind(null,e,r),t)},useLayoutEffect:function(r,e){return Cu(4194308,4,r,e)},useInsertionEffect:function(r,e){return Cu(4,2,r,e)},useMemo:function(r,e){var t=En();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=En();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=wC.bind(null,dt,r),[n.memoizedState,r]},useRef:function(r){var e=En();return r={current:r},e.memoizedState=r},useState:gv,useDebugValue:Wg,useDeferredValue:function(r){return En().memoizedState=r},useTransition:function(){var r=gv(!1),e=r[0];return r=xC.bind(null,r[1]),En().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=dt,s=En();if(it){if(t===void 0)throw Error(le(407));t=t()}else{if(t=e(),Nt===null)throw Error(le(349));Hi&30||oE(n,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,yv(lE.bind(null,n,i,r),[r]),n.flags|=2048,Pl(9,aE.bind(null,n,i,t,e),void 0,null),t},useId:function(){var r=En(),e=Nt.identifierPrefix;if(it){var t=rs,n=ts;t=(n&~(1<<32-hn(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Cl++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=vC++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},EC={readContext:zr,useCallback:gE,useContext:zr,useEffect:Vg,useImperativeHandle:mE,useInsertionEffect:hE,useLayoutEffect:fE,useMemo:yE,useReducer:sf,useRef:dE,useState:function(){return sf(Ll)},useDebugValue:Wg,useDeferredValue:function(r){var e=Gr();return vE(e,It.memoizedState,r)},useTransition:function(){var r=sf(Ll)[0],e=Gr().memoizedState;return[r,e]},useMutableSource:sE,useSyncExternalStore:iE,useId:xE,unstable_isNewReconciler:!1},TC={readContext:zr,useCallback:gE,useContext:zr,useEffect:Vg,useImperativeHandle:mE,useInsertionEffect:hE,useLayoutEffect:fE,useMemo:yE,useReducer:of,useRef:dE,useState:function(){return of(Ll)},useDebugValue:Wg,useDeferredValue:function(r){var e=Gr();return It===null?e.memoizedState=r:vE(e,It.memoizedState,r)},useTransition:function(){var r=of(Ll)[0],e=Gr().memoizedState;return[r,e]},useMutableSource:sE,useSyncExternalStore:iE,useId:xE,unstable_isNewReconciler:!1};function sn(r,e){if(r&&r.defaultProps){e=ht({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function Fp(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:ht({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var th={isMounted:function(r){return(r=r._reactInternals)?Zi(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=tr(),s=qs(r),i=ns(n,s);i.payload=e,t!=null&&(i.callback=t),e=Ws(r,i,s),e!==null&&(fn(e,r,s,n),Iu(e,r,s))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=tr(),s=qs(r),i=ns(n,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Ws(r,i,s),e!==null&&(fn(e,r,s,n),Iu(e,r,s))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=tr(),n=qs(r),s=ns(t,n);s.tag=2,e!=null&&(s.callback=e),e=Ws(r,s,n),e!==null&&(fn(e,r,n,t),Iu(e,r,n))}};function vv(r,e,t,n,s,i,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,i,o):e.prototype&&e.prototype.isPureReactComponent?!Tl(t,n)||!Tl(s,i):!0}function EE(r,e,t){var n=!1,s=ei,i=e.contextType;return typeof i=="object"&&i!==null?i=zr(i):(s=fr(e)?zi:qt.current,n=e.contextTypes,i=(n=n!=null)?fa(r,s):ei),e=new e(t,i),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=th,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=i),e}function xv(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&th.enqueueReplaceState(e,e.state,null)}function jp(r,e,t,n){var s=r.stateNode;s.props=t,s.state=r.memoizedState,s.refs={},jg(r);var i=e.contextType;typeof i=="object"&&i!==null?s.context=zr(i):(i=fr(e)?zi:qt.current,s.context=fa(r,i)),s.state=r.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Fp(r,e,i,t),s.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&th.enqueueReplaceState(s,s.state,null),hd(r,t,s,n),s.state=r.memoizedState),typeof s.componentDidMount=="function"&&(r.flags|=4194308)}function ya(r,e){try{var t="",n=e;do t+=JI(n),n=n.return;while(n);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:r,source:e,stack:s,digest:null}}function af(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function $p(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var _C=typeof WeakMap=="function"?WeakMap:Map;function TE(r,e,t){t=ns(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){yd||(yd=!0,Yp=n),$p(r,e)},t}function _E(r,e,t){t=ns(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;t.payload=function(){return n(s)},t.callback=function(){$p(r,e)}}var i=r.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){$p(r,e),typeof n!="function"&&(Ks===null?Ks=new Set([this]):Ks.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function wv(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new _C;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(t)||(s.add(t),r=$C.bind(null,r,e,t),e.then(r,r))}function bv(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function Sv(r,e,t,n,s){return r.mode&1?(r.flags|=65536,r.lanes=s,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ns(-1,1),e.tag=2,Ws(t,e,1))),t.lanes|=1),r)}var AC=us.ReactCurrentOwner,ur=!1;function Jt(r,e,t,n){e.child=r===null?eE(e,null,t,n):ma(e,r.child,t,n)}function Ev(r,e,t,n,s){t=t.render;var i=e.ref;return Ho(e,s),n=Gg(r,e,t,n,i,s),t=Hg(),r!==null&&!ur?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,as(r,e,s)):(it&&t&&Lg(e),e.flags|=1,Jt(r,e,n,s),e.child)}function Tv(r,e,t,n,s){if(r===null){var i=t.type;return typeof i=="function"&&!e0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,AE(r,e,i,n,s)):(r=Ou(t.type,null,n,e,e.mode,s),r.ref=e.ref,r.return=e,e.child=r)}if(i=r.child,!(r.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Tl,t(o,n)&&r.ref===e.ref)return as(r,e,s)}return e.flags|=1,r=Ys(i,n),r.ref=e.ref,r.return=e,e.child=r}function AE(r,e,t,n,s){if(r!==null){var i=r.memoizedProps;if(Tl(i,n)&&r.ref===e.ref)if(ur=!1,e.pendingProps=n=i,(r.lanes&s)!==0)r.flags&131072&&(ur=!0);else return e.lanes=r.lanes,as(r,e,s)}return Bp(r,e,t,n,s)}function kE(r,e,t){var n=e.pendingProps,s=n.children,i=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ze(jo,br),br|=t;else{if(!(t&1073741824))return r=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,Ze(jo,br),br|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:t,Ze(jo,br),br|=n}else i!==null?(n=i.baseLanes|t,e.memoizedState=null):n=t,Ze(jo,br),br|=n;return Jt(r,e,s,t),e.child}function IE(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Bp(r,e,t,n,s){var i=fr(t)?zi:qt.current;return i=fa(e,i),Ho(e,s),t=Gg(r,e,t,n,i,s),n=Hg(),r!==null&&!ur?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,as(r,e,s)):(it&&n&&Lg(e),e.flags|=1,Jt(r,e,t,s),e.child)}function _v(r,e,t,n,s){if(fr(t)){var i=!0;ad(e)}else i=!1;if(Ho(e,s),e.stateNode===null)Lu(r,e),EE(e,t,n),jp(e,t,n,s),n=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=zr(c):(c=fr(t)?zi:qt.current,c=fa(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||l!==c)&&xv(e,o,n,c),_s=!1;var h=e.memoizedState;o.state=h,hd(e,n,o,s),l=e.memoizedState,a!==n||h!==l||hr.current||_s?(typeof u=="function"&&(Fp(e,t,u,n),l=e.memoizedState),(a=_s||vv(e,t,a,n,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,rE(r,e),a=e.memoizedProps,c=e.type===e.elementType?a:sn(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=zr(l):(l=fr(t)?zi:qt.current,l=fa(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&xv(e,o,n,l),_s=!1,h=e.memoizedState,o.state=h,hd(e,n,o,s);var m=e.memoizedState;a!==d||h!==m||hr.current||_s?(typeof f=="function"&&(Fp(e,t,f,n),m=e.memoizedState),(c=_s||vv(e,t,c,n,h,m,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),o.props=n,o.state=m,o.context=l,n=c):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=1024),n=!1)}return Up(r,e,t,n,i,s)}function Up(r,e,t,n,s,i){IE(r,e);var o=(e.flags&128)!==0;if(!n&&!o)return s&&uv(e,t,!1),as(r,e,i);n=e.stateNode,AC.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&o?(e.child=ma(e,r.child,null,i),e.child=ma(e,null,a,i)):Jt(r,e,a,i),e.memoizedState=n.state,s&&uv(e,t,!0),e.child}function RE(r){var e=r.stateNode;e.pendingContext?cv(r,e.pendingContext,e.pendingContext!==e.context):e.context&&cv(r,e.context,!1),$g(r,e.containerInfo)}function Av(r,e,t,n,s){return pa(),Dg(s),e.flags|=256,Jt(r,e,t,n),e.child}var zp={dehydrated:null,treeContext:null,retryLane:0};function Gp(r){return{baseLanes:r,cachePool:null,transitions:null}}function CE(r,e,t){var n=e.pendingProps,s=ct.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(s|=1),Ze(ct,s&1),r===null)return Np(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,r=n.fallback,i?(n=e.mode,i=e.child,o={mode:"hidden",children:o},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=sh(o,n,0,null),r=$i(r,n,t,null),i.return=e,r.return=e,i.sibling=r,e.child=i,e.child.memoizedState=Gp(t),e.memoizedState=zp,r):Kg(e,o));if(s=r.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return kC(r,e,o,n,a,s,t);if(i){i=n.fallback,o=e.mode,s=r.child,a=s.sibling;var l={mode:"hidden",children:n.children};return!(o&1)&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=Ys(s,l),n.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Ys(a,i):(i=$i(i,o,t,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,o=r.child.memoizedState,o=o===null?Gp(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=r.childLanes&~t,e.memoizedState=zp,n}return i=r.child,r=i.sibling,n=Ys(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function Kg(r,e){return e=sh({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function Fc(r,e,t,n){return n!==null&&Dg(n),ma(e,r.child,null,t),r=Kg(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function kC(r,e,t,n,s,i,o){if(t)return e.flags&256?(e.flags&=-257,n=af(Error(le(422))),Fc(r,e,o,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(i=n.fallback,s=e.mode,n=sh({mode:"visible",children:n.children},s,0,null),i=$i(i,s,o,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&ma(e,r.child,null,o),e.child.memoizedState=Gp(o),e.memoizedState=zp,i);if(!(e.mode&1))return Fc(r,e,o,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var a=n.dgst;return n=a,i=Error(le(419)),n=af(i,n,void 0),Fc(r,e,o,n)}if(a=(o&r.childLanes)!==0,ur||a){if(n=Nt,n!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,os(r,s),fn(n,r,s,-1))}return Zg(),n=af(Error(le(421))),Fc(r,e,o,n)}return s.data==="$?"?(e.flags|=128,e.child=r.child,e=BC.bind(null,r),s._reactRetry=e,null):(r=i.treeContext,Ar=Vs(s.nextSibling),kr=e,it=!0,dn=null,r!==null&&(Mr[Fr++]=ts,Mr[Fr++]=rs,Mr[Fr++]=Gi,ts=r.id,rs=r.overflow,Gi=e),e=Kg(e,n.children),e.flags|=4096,e)}function kv(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),Mp(r.return,e,t)}function lf(r,e,t,n,s){var i=r.memoizedState;i===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=t,i.tailMode=s)}function LE(r,e,t){var n=e.pendingProps,s=n.revealOrder,i=n.tail;if(Jt(r,e,n.children,t),n=ct.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&kv(r,t,e);else if(r.tag===19)kv(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(Ze(ct,n),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)r=t.alternate,r!==null&&fd(r)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),lf(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(r=s.alternate,r!==null&&fd(r)===null){e.child=s;break}r=s.sibling,s.sibling=t,t=s,s=r}lf(e,!0,t,null,i);break;case"together":lf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Lu(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function as(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),Vi|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(le(153));if(e.child!==null){for(r=e.child,t=Ys(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=Ys(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function IC(r,e,t){switch(e.tag){case 3:RE(e),pa();break;case 5:nE(e);break;case 1:fr(e.type)&&ad(e);break;case 4:$g(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;Ze(ud,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Ze(ct,ct.current&1),e.flags|=128,null):t&e.child.childLanes?CE(r,e,t):(Ze(ct,ct.current&1),r=as(r,e,t),r!==null?r.sibling:null);Ze(ct,ct.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return LE(r,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ze(ct,ct.current),n)break;return null;case 22:case 23:return e.lanes=0,kE(r,e,t)}return as(r,e,t)}var PE,Hp,DE,OE;PE=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Hp=function(){};DE=function(r,e,t,n){var s=r.memoizedProps;if(s!==n){r=e.stateNode,ki(Nn.current);var i=null;switch(t){case"input":s=hp(r,s),n=hp(r,n),i=[];break;case"select":s=ht({},s,{value:void 0}),n=ht({},n,{value:void 0}),i=[];break;case"textarea":s=mp(r,s),n=mp(r,n),i=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=id)}yp(t,n);var o;t=null;for(c in s)if(!n.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(yl.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in n){var l=n[c];if(a=s!=null?s[c]:void 0,n.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(yl.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&rt("scroll",r),i||a===l||(i=[])):(i=i||[]).push(c,l))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};OE=function(r,e,t,n){t!==n&&(e.flags|=4)};function Ga(r,e){if(!it)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function Vt(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var s=r.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=r,s=s.sibling;else for(s=r.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=r,s=s.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function RC(r,e,t){var n=e.pendingProps;switch(Pg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(e),null;case 1:return fr(e.type)&&od(),Vt(e),null;case 3:return n=e.stateNode,ga(),nt(hr),nt(qt),Ug(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(Nc(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dn!==null&&(Jp(dn),dn=null))),Hp(r,e),Vt(e),null;case 5:Bg(e);var s=ki(Rl.current);if(t=e.type,r!==null&&e.stateNode!=null)DE(r,e,t,n,s),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(le(166));return Vt(e),null}if(r=ki(Nn.current),Nc(e)){n=e.stateNode,t=e.type;var i=e.memoizedProps;switch(n[Cn]=e,n[kl]=i,r=(e.mode&1)!==0,t){case"dialog":rt("cancel",n),rt("close",n);break;case"iframe":case"object":case"embed":rt("load",n);break;case"video":case"audio":for(s=0;s<Xa.length;s++)rt(Xa[s],n);break;case"source":rt("error",n);break;case"img":case"image":case"link":rt("error",n),rt("load",n);break;case"details":rt("toggle",n);break;case"input":My(n,i),rt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},rt("invalid",n);break;case"textarea":jy(n,i),rt("invalid",n)}yp(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?n.textContent!==a&&(i.suppressHydrationWarning!==!0&&Oc(n.textContent,a,r),s=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Oc(n.textContent,a,r),s=["children",""+a]):yl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&rt("scroll",n)}switch(t){case"input":Ac(n),Fy(n,i,!0);break;case"textarea":Ac(n),$y(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=id)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=lS(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=o.createElement(t,{is:n.is}):(r=o.createElement(t),t==="select"&&(o=r,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):r=o.createElementNS(r,t),r[Cn]=e,r[kl]=n,PE(r,e,!1,!1),e.stateNode=r;e:{switch(o=vp(t,n),t){case"dialog":rt("cancel",r),rt("close",r),s=n;break;case"iframe":case"object":case"embed":rt("load",r),s=n;break;case"video":case"audio":for(s=0;s<Xa.length;s++)rt(Xa[s],r);s=n;break;case"source":rt("error",r),s=n;break;case"img":case"image":case"link":rt("error",r),rt("load",r),s=n;break;case"details":rt("toggle",r),s=n;break;case"input":My(r,n),s=hp(r,n),rt("invalid",r);break;case"option":s=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},s=ht({},n,{value:void 0}),rt("invalid",r);break;case"textarea":jy(r,n),s=mp(r,n),rt("invalid",r);break;default:s=n}yp(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?dS(r,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&cS(r,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&vl(r,l):typeof l=="number"&&vl(r,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(yl.hasOwnProperty(i)?l!=null&&i==="onScroll"&&rt("scroll",r):l!=null&&yg(r,i,l,o))}switch(t){case"input":Ac(r),Fy(r,n,!1);break;case"textarea":Ac(r),$y(r);break;case"option":n.value!=null&&r.setAttribute("value",""+Zs(n.value));break;case"select":r.multiple=!!n.multiple,i=n.value,i!=null?Bo(r,!!n.multiple,i,!1):n.defaultValue!=null&&Bo(r,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(r.onclick=id)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Vt(e),null;case 6:if(r&&e.stateNode!=null)OE(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(le(166));if(t=ki(Rl.current),ki(Nn.current),Nc(e)){if(n=e.stateNode,t=e.memoizedProps,n[Cn]=e,(i=n.nodeValue!==t)&&(r=kr,r!==null))switch(r.tag){case 3:Oc(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Oc(n.nodeValue,t,(r.mode&1)!==0)}i&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Cn]=e,e.stateNode=n}return Vt(e),null;case 13:if(nt(ct),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(it&&Ar!==null&&e.mode&1&&!(e.flags&128))JS(),pa(),e.flags|=98560,i=!1;else if(i=Nc(e),n!==null&&n.dehydrated!==null){if(r===null){if(!i)throw Error(le(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(le(317));i[Cn]=e}else pa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Vt(e),i=!1}else dn!==null&&(Jp(dn),dn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||ct.current&1?Ct===0&&(Ct=3):Zg())),e.updateQueue!==null&&(e.flags|=4),Vt(e),null);case 4:return ga(),Hp(r,e),r===null&&_l(e.stateNode.containerInfo),Vt(e),null;case 10:return Mg(e.type._context),Vt(e),null;case 17:return fr(e.type)&&od(),Vt(e),null;case 19:if(nt(ct),i=e.memoizedState,i===null)return Vt(e),null;if(n=(e.flags&128)!==0,o=i.rendering,o===null)if(n)Ga(i,!1);else{if(Ct!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=fd(r),o!==null){for(e.flags|=128,Ga(i,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)i=t,r=n,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=r,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,r=o.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return Ze(ct,ct.current&1|2),e.child}r=r.sibling}i.tail!==null&&xt()>va&&(e.flags|=128,n=!0,Ga(i,!1),e.lanes=4194304)}else{if(!n)if(r=fd(o),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ga(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!it)return Vt(e),null}else 2*xt()-i.renderingStartTime>va&&t!==1073741824&&(e.flags|=128,n=!0,Ga(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=xt(),e.sibling=null,t=ct.current,Ze(ct,n?t&1|2:t&1),e):(Vt(e),null);case 22:case 23:return Jg(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?br&1073741824&&(Vt(e),e.subtreeFlags&6&&(e.flags|=8192)):Vt(e),null;case 24:return null;case 25:return null}throw Error(le(156,e.tag))}function CC(r,e){switch(Pg(e),e.tag){case 1:return fr(e.type)&&od(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return ga(),nt(hr),nt(qt),Ug(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return Bg(e),null;case 13:if(nt(ct),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(le(340));pa()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return nt(ct),null;case 4:return ga(),null;case 10:return Mg(e.type._context),null;case 22:case 23:return Jg(),null;case 24:return null;default:return null}}var jc=!1,Kt=!1,LC=typeof WeakSet=="function"?WeakSet:Set,ge=null;function Fo(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){yt(r,e,n)}else t.current=null}function Vp(r,e,t){try{t()}catch(n){yt(r,e,n)}}var Iv=!1;function PC(r,e){if(Ip=rd,r=$S(),Cg(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var s=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=r,h=null;t:for(;;){for(var f;d!==t||s!==0&&d.nodeType!==3||(a=o+s),d!==i||n!==0&&d.nodeType!==3||(l=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===r)break t;if(h===t&&++c===s&&(a=o),h===i&&++u===n&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Rp={focusedElem:r,selectionRange:t},rd=!1,ge=e;ge!==null;)if(e=ge,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,ge=r;else for(;ge!==null;){e=ge;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var p=m.memoizedProps,g=m.memoizedState,y=e.stateNode,x=y.getSnapshotBeforeUpdate(e.elementType===e.type?p:sn(e.type,p),g);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(le(163))}}catch(b){yt(e,e.return,b)}if(r=e.sibling,r!==null){r.return=e.return,ge=r;break}ge=e.return}return m=Iv,Iv=!1,m}function al(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&r)===r){var i=s.destroy;s.destroy=void 0,i!==void 0&&Vp(e,t,i)}s=s.next}while(s!==n)}}function rh(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function Wp(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function NE(r){var e=r.alternate;e!==null&&(r.alternate=null,NE(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[Cn],delete e[kl],delete e[Pp],delete e[pC],delete e[mC])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function ME(r){return r.tag===5||r.tag===3||r.tag===4}function Rv(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ME(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Kp(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=id));else if(n!==4&&(r=r.child,r!==null))for(Kp(r,e,t),r=r.sibling;r!==null;)Kp(r,e,t),r=r.sibling}function qp(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(qp(r,e,t),r=r.sibling;r!==null;)qp(r,e,t),r=r.sibling}var Mt=null,cn=!1;function ms(r,e,t){for(t=t.child;t!==null;)FE(r,e,t),t=t.sibling}function FE(r,e,t){if(On&&typeof On.onCommitFiberUnmount=="function")try{On.onCommitFiberUnmount(qd,t)}catch{}switch(t.tag){case 5:Kt||Fo(t,e);case 6:var n=Mt,s=cn;Mt=null,ms(r,e,t),Mt=n,cn=s,Mt!==null&&(cn?(r=Mt,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):Mt.removeChild(t.stateNode));break;case 18:Mt!==null&&(cn?(r=Mt,t=t.stateNode,r.nodeType===8?ef(r.parentNode,t):r.nodeType===1&&ef(r,t),Sl(r)):ef(Mt,t.stateNode));break;case 4:n=Mt,s=cn,Mt=t.stateNode.containerInfo,cn=!0,ms(r,e,t),Mt=n,cn=s;break;case 0:case 11:case 14:case 15:if(!Kt&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Vp(t,e,o),s=s.next}while(s!==n)}ms(r,e,t);break;case 1:if(!Kt&&(Fo(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){yt(t,e,a)}ms(r,e,t);break;case 21:ms(r,e,t);break;case 22:t.mode&1?(Kt=(n=Kt)||t.memoizedState!==null,ms(r,e,t),Kt=n):ms(r,e,t);break;default:ms(r,e,t)}}function Cv(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new LC),e.forEach(function(n){var s=UC.bind(null,r,n);t.has(n)||(t.add(n),n.then(s,s))})}}function Jr(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var s=t[n];try{var i=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Mt=a.stateNode,cn=!1;break e;case 3:Mt=a.stateNode.containerInfo,cn=!0;break e;case 4:Mt=a.stateNode.containerInfo,cn=!0;break e}a=a.return}if(Mt===null)throw Error(le(160));FE(i,o,s),Mt=null,cn=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){yt(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)jE(e,r),e=e.sibling}function jE(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Jr(e,r),wn(r),n&4){try{al(3,r,r.return),rh(3,r)}catch(p){yt(r,r.return,p)}try{al(5,r,r.return)}catch(p){yt(r,r.return,p)}}break;case 1:Jr(e,r),wn(r),n&512&&t!==null&&Fo(t,t.return);break;case 5:if(Jr(e,r),wn(r),n&512&&t!==null&&Fo(t,t.return),r.flags&32){var s=r.stateNode;try{vl(s,"")}catch(p){yt(r,r.return,p)}}if(n&4&&(s=r.stateNode,s!=null)){var i=r.memoizedProps,o=t!==null?t.memoizedProps:i,a=r.type,l=r.updateQueue;if(r.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&oS(s,i),vp(a,o);var c=vp(a,i);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?dS(s,d):u==="dangerouslySetInnerHTML"?cS(s,d):u==="children"?vl(s,d):yg(s,u,d,c)}switch(a){case"input":fp(s,i);break;case"textarea":aS(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?Bo(s,!!i.multiple,f,!1):h!==!!i.multiple&&(i.defaultValue!=null?Bo(s,!!i.multiple,i.defaultValue,!0):Bo(s,!!i.multiple,i.multiple?[]:"",!1))}s[kl]=i}catch(p){yt(r,r.return,p)}}break;case 6:if(Jr(e,r),wn(r),n&4){if(r.stateNode===null)throw Error(le(162));s=r.stateNode,i=r.memoizedProps;try{s.nodeValue=i}catch(p){yt(r,r.return,p)}}break;case 3:if(Jr(e,r),wn(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{Sl(e.containerInfo)}catch(p){yt(r,r.return,p)}break;case 4:Jr(e,r),wn(r);break;case 13:Jr(e,r),wn(r),s=r.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Qg=xt())),n&4&&Cv(r);break;case 22:if(u=t!==null&&t.memoizedState!==null,r.mode&1?(Kt=(c=Kt)||u,Jr(e,r),Kt=c):Jr(e,r),wn(r),n&8192){if(c=r.memoizedState!==null,(r.stateNode.isHidden=c)&&!u&&r.mode&1)for(ge=r,u=r.child;u!==null;){for(d=ge=u;ge!==null;){switch(h=ge,f=h.child,h.tag){case 0:case 11:case 14:case 15:al(4,h,h.return);break;case 1:Fo(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){n=h,t=h.return;try{e=n,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(p){yt(n,t,p)}}break;case 5:Fo(h,h.return);break;case 22:if(h.memoizedState!==null){Pv(d);continue}}f!==null?(f.return=h,ge=f):Pv(d)}u=u.sibling}e:for(u=null,d=r;;){if(d.tag===5){if(u===null){u=d;try{s=d.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=uS("display",o))}catch(p){yt(r,r.return,p)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(p){yt(r,r.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Jr(e,r),wn(r),n&4&&Cv(r);break;case 21:break;default:Jr(e,r),wn(r)}}function wn(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(ME(t)){var n=t;break e}t=t.return}throw Error(le(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(vl(s,""),n.flags&=-33);var i=Rv(r);qp(r,i,s);break;case 3:case 4:var o=n.stateNode.containerInfo,a=Rv(r);Kp(r,a,o);break;default:throw Error(le(161))}}catch(l){yt(r,r.return,l)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function DC(r,e,t){ge=r,$E(r)}function $E(r,e,t){for(var n=(r.mode&1)!==0;ge!==null;){var s=ge,i=s.child;if(s.tag===22&&n){var o=s.memoizedState!==null||jc;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Kt;a=jc;var c=Kt;if(jc=o,(Kt=l)&&!c)for(ge=s;ge!==null;)o=ge,l=o.child,o.tag===22&&o.memoizedState!==null?Dv(s):l!==null?(l.return=o,ge=l):Dv(s);for(;i!==null;)ge=i,$E(i),i=i.sibling;ge=s,jc=a,Kt=c}Lv(r)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ge=i):Lv(r)}}function Lv(r){for(;ge!==null;){var e=ge;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Kt||rh(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Kt)if(t===null)n.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:sn(e.type,t.memoizedProps);n.componentDidUpdate(s,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&mv(e,i,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}mv(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Sl(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(le(163))}Kt||e.flags&512&&Wp(e)}catch(h){yt(e,e.return,h)}}if(e===r){ge=null;break}if(t=e.sibling,t!==null){t.return=e.return,ge=t;break}ge=e.return}}function Pv(r){for(;ge!==null;){var e=ge;if(e===r){ge=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ge=t;break}ge=e.return}}function Dv(r){for(;ge!==null;){var e=ge;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{rh(4,e)}catch(l){yt(e,t,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(l){yt(e,s,l)}}var i=e.return;try{Wp(e)}catch(l){yt(e,i,l)}break;case 5:var o=e.return;try{Wp(e)}catch(l){yt(e,o,l)}}}catch(l){yt(e,e.return,l)}if(e===r){ge=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ge=a;break}ge=e.return}}var OC=Math.ceil,gd=us.ReactCurrentDispatcher,qg=us.ReactCurrentOwner,Ur=us.ReactCurrentBatchConfig,Be=0,Nt=null,Et=null,Ut=0,br=0,jo=li(0),Ct=0,Dl=null,Vi=0,nh=0,Yg=0,ll=null,lr=null,Qg=0,va=1/0,Yn=null,yd=!1,Yp=null,Ks=null,$c=!1,Bs=null,vd=0,cl=0,Qp=null,Pu=-1,Du=0;function tr(){return Be&6?xt():Pu!==-1?Pu:Pu=xt()}function qs(r){return r.mode&1?Be&2&&Ut!==0?Ut&-Ut:yC.transition!==null?(Du===0&&(Du=ES()),Du):(r=Ve,r!==0||(r=window.event,r=r===void 0?16:CS(r.type)),r):1}function fn(r,e,t,n){if(50<cl)throw cl=0,Qp=null,Error(le(185));ic(r,t,n),(!(Be&2)||r!==Nt)&&(r===Nt&&(!(Be&2)&&(nh|=t),Ct===4&&Rs(r,Ut)),pr(r,n),t===1&&Be===0&&!(e.mode&1)&&(va=xt()+500,Zd&&ci()))}function pr(r,e){var t=r.callbackNode;yR(r,e);var n=td(r,r===Nt?Ut:0);if(n===0)t!==null&&zy(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&zy(t),e===1)r.tag===0?gC(Ov.bind(null,r)):YS(Ov.bind(null,r)),hC(function(){!(Be&6)&&ci()}),t=null;else{switch(TS(n)){case 1:t=Sg;break;case 4:t=bS;break;case 16:t=ed;break;case 536870912:t=SS;break;default:t=ed}t=KE(t,BE.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function BE(r,e){if(Pu=-1,Du=0,Be&6)throw Error(le(327));var t=r.callbackNode;if(Vo()&&r.callbackNode!==t)return null;var n=td(r,r===Nt?Ut:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=xd(r,n);else{e=n;var s=Be;Be|=2;var i=zE();(Nt!==r||Ut!==e)&&(Yn=null,va=xt()+500,ji(r,e));do try{FC();break}catch(a){UE(r,a)}while(!0);Ng(),gd.current=i,Be=s,Et!==null?e=0:(Nt=null,Ut=0,e=Ct)}if(e!==0){if(e===2&&(s=Ep(r),s!==0&&(n=s,e=Xp(r,s))),e===1)throw t=Dl,ji(r,0),Rs(r,n),pr(r,xt()),t;if(e===6)Rs(r,n);else{if(s=r.current.alternate,!(n&30)&&!NC(s)&&(e=xd(r,n),e===2&&(i=Ep(r),i!==0&&(n=i,e=Xp(r,i))),e===1))throw t=Dl,ji(r,0),Rs(r,n),pr(r,xt()),t;switch(r.finishedWork=s,r.finishedLanes=n,e){case 0:case 1:throw Error(le(345));case 2:xi(r,lr,Yn);break;case 3:if(Rs(r,n),(n&130023424)===n&&(e=Qg+500-xt(),10<e)){if(td(r,0)!==0)break;if(s=r.suspendedLanes,(s&n)!==n){tr(),r.pingedLanes|=r.suspendedLanes&s;break}r.timeoutHandle=Lp(xi.bind(null,r,lr,Yn),e);break}xi(r,lr,Yn);break;case 4:if(Rs(r,n),(n&4194240)===n)break;for(e=r.eventTimes,s=-1;0<n;){var o=31-hn(n);i=1<<o,o=e[o],o>s&&(s=o),n&=~i}if(n=s,n=xt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*OC(n/1960))-n,10<n){r.timeoutHandle=Lp(xi.bind(null,r,lr,Yn),n);break}xi(r,lr,Yn);break;case 5:xi(r,lr,Yn);break;default:throw Error(le(329))}}}return pr(r,xt()),r.callbackNode===t?BE.bind(null,r):null}function Xp(r,e){var t=ll;return r.current.memoizedState.isDehydrated&&(ji(r,e).flags|=256),r=xd(r,e),r!==2&&(e=lr,lr=t,e!==null&&Jp(e)),r}function Jp(r){lr===null?lr=r:lr.push.apply(lr,r)}function NC(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var s=t[n],i=s.getSnapshot;s=s.value;try{if(!pn(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Rs(r,e){for(e&=~Yg,e&=~nh,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-hn(e),n=1<<t;r[t]=-1,e&=~n}}function Ov(r){if(Be&6)throw Error(le(327));Vo();var e=td(r,0);if(!(e&1))return pr(r,xt()),null;var t=xd(r,e);if(r.tag!==0&&t===2){var n=Ep(r);n!==0&&(e=n,t=Xp(r,n))}if(t===1)throw t=Dl,ji(r,0),Rs(r,e),pr(r,xt()),t;if(t===6)throw Error(le(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,xi(r,lr,Yn),pr(r,xt()),null}function Xg(r,e){var t=Be;Be|=1;try{return r(e)}finally{Be=t,Be===0&&(va=xt()+500,Zd&&ci())}}function Wi(r){Bs!==null&&Bs.tag===0&&!(Be&6)&&Vo();var e=Be;Be|=1;var t=Ur.transition,n=Ve;try{if(Ur.transition=null,Ve=1,r)return r()}finally{Ve=n,Ur.transition=t,Be=e,!(Be&6)&&ci()}}function Jg(){br=jo.current,nt(jo)}function ji(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,dC(t)),Et!==null)for(t=Et.return;t!==null;){var n=t;switch(Pg(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&od();break;case 3:ga(),nt(hr),nt(qt),Ug();break;case 5:Bg(n);break;case 4:ga();break;case 13:nt(ct);break;case 19:nt(ct);break;case 10:Mg(n.type._context);break;case 22:case 23:Jg()}t=t.return}if(Nt=r,Et=r=Ys(r.current,null),Ut=br=e,Ct=0,Dl=null,Yg=nh=Vi=0,lr=ll=null,Ai!==null){for(e=0;e<Ai.length;e++)if(t=Ai[e],n=t.interleaved,n!==null){t.interleaved=null;var s=n.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,n.next=o}t.pending=n}Ai=null}return r}function UE(r,e){do{var t=Et;try{if(Ng(),Ru.current=md,pd){for(var n=dt.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}pd=!1}if(Hi=0,Dt=It=dt=null,ol=!1,Cl=0,qg.current=null,t===null||t.return===null){Ct=1,Dl=e,Et=null;break}e:{var i=r,o=t.return,a=t,l=e;if(e=Ut,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=bv(o);if(f!==null){f.flags&=-257,Sv(f,o,a,i,e),f.mode&1&&wv(i,c,e),e=f,l=c;var m=e.updateQueue;if(m===null){var p=new Set;p.add(l),e.updateQueue=p}else m.add(l);break e}else{if(!(e&1)){wv(i,c,e),Zg();break e}l=Error(le(426))}}else if(it&&a.mode&1){var g=bv(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),Sv(g,o,a,i,e),Dg(ya(l,a));break e}}i=l=ya(l,a),Ct!==4&&(Ct=2),ll===null?ll=[i]:ll.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=TE(i,l,e);pv(i,y);break e;case 1:a=l;var x=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ks===null||!Ks.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var b=_E(i,a,e);pv(i,b);break e}}i=i.return}while(i!==null)}HE(t)}catch(E){e=E,Et===t&&t!==null&&(Et=t=t.return);continue}break}while(!0)}function zE(){var r=gd.current;return gd.current=md,r===null?md:r}function Zg(){(Ct===0||Ct===3||Ct===2)&&(Ct=4),Nt===null||!(Vi&268435455)&&!(nh&268435455)||Rs(Nt,Ut)}function xd(r,e){var t=Be;Be|=2;var n=zE();(Nt!==r||Ut!==e)&&(Yn=null,ji(r,e));do try{MC();break}catch(s){UE(r,s)}while(!0);if(Ng(),Be=t,gd.current=n,Et!==null)throw Error(le(261));return Nt=null,Ut=0,Ct}function MC(){for(;Et!==null;)GE(Et)}function FC(){for(;Et!==null&&!lR();)GE(Et)}function GE(r){var e=WE(r.alternate,r,br);r.memoizedProps=r.pendingProps,e===null?HE(r):Et=e,qg.current=null}function HE(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=CC(t,e),t!==null){t.flags&=32767,Et=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Ct=6,Et=null;return}}else if(t=RC(t,e,br),t!==null){Et=t;return}if(e=e.sibling,e!==null){Et=e;return}Et=e=r}while(e!==null);Ct===0&&(Ct=5)}function xi(r,e,t){var n=Ve,s=Ur.transition;try{Ur.transition=null,Ve=1,jC(r,e,t,n)}finally{Ur.transition=s,Ve=n}return null}function jC(r,e,t,n){do Vo();while(Bs!==null);if(Be&6)throw Error(le(327));t=r.finishedWork;var s=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(le(177));r.callbackNode=null,r.callbackPriority=0;var i=t.lanes|t.childLanes;if(vR(r,i),r===Nt&&(Et=Nt=null,Ut=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||$c||($c=!0,KE(ed,function(){return Vo(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Ur.transition,Ur.transition=null;var o=Ve;Ve=1;var a=Be;Be|=4,qg.current=null,PC(r,t),jE(t,r),sC(Rp),rd=!!Ip,Rp=Ip=null,r.current=t,DC(t),cR(),Be=a,Ve=o,Ur.transition=i}else r.current=t;if($c&&($c=!1,Bs=r,vd=s),i=r.pendingLanes,i===0&&(Ks=null),hR(t.stateNode),pr(r,xt()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)s=e[t],n(s.value,{componentStack:s.stack,digest:s.digest});if(yd)throw yd=!1,r=Yp,Yp=null,r;return vd&1&&r.tag!==0&&Vo(),i=r.pendingLanes,i&1?r===Qp?cl++:(cl=0,Qp=r):cl=0,ci(),null}function Vo(){if(Bs!==null){var r=TS(vd),e=Ur.transition,t=Ve;try{if(Ur.transition=null,Ve=16>r?16:r,Bs===null)var n=!1;else{if(r=Bs,Bs=null,vd=0,Be&6)throw Error(le(331));var s=Be;for(Be|=4,ge=r.current;ge!==null;){var i=ge,o=i.child;if(ge.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ge=c;ge!==null;){var u=ge;switch(u.tag){case 0:case 11:case 15:al(8,u,i)}var d=u.child;if(d!==null)d.return=u,ge=d;else for(;ge!==null;){u=ge;var h=u.sibling,f=u.return;if(NE(u),u===c){ge=null;break}if(h!==null){h.return=f,ge=h;break}ge=f}}}var m=i.alternate;if(m!==null){var p=m.child;if(p!==null){m.child=null;do{var g=p.sibling;p.sibling=null,p=g}while(p!==null)}}ge=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ge=o;else e:for(;ge!==null;){if(i=ge,i.flags&2048)switch(i.tag){case 0:case 11:case 15:al(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,ge=y;break e}ge=i.return}}var x=r.current;for(ge=x;ge!==null;){o=ge;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,ge=w;else e:for(o=x;ge!==null;){if(a=ge,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:rh(9,a)}}catch(E){yt(a,a.return,E)}if(a===o){ge=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,ge=b;break e}ge=a.return}}if(Be=s,ci(),On&&typeof On.onPostCommitFiberRoot=="function")try{On.onPostCommitFiberRoot(qd,r)}catch{}n=!0}return n}finally{Ve=t,Ur.transition=e}}return!1}function Nv(r,e,t){e=ya(t,e),e=TE(r,e,1),r=Ws(r,e,1),e=tr(),r!==null&&(ic(r,1,e),pr(r,e))}function yt(r,e,t){if(r.tag===3)Nv(r,r,t);else for(;e!==null;){if(e.tag===3){Nv(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ks===null||!Ks.has(n))){r=ya(t,r),r=_E(e,r,1),e=Ws(e,r,1),r=tr(),e!==null&&(ic(e,1,r),pr(e,r));break}}e=e.return}}function $C(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=tr(),r.pingedLanes|=r.suspendedLanes&t,Nt===r&&(Ut&t)===t&&(Ct===4||Ct===3&&(Ut&130023424)===Ut&&500>xt()-Qg?ji(r,0):Yg|=t),pr(r,e)}function VE(r,e){e===0&&(r.mode&1?(e=Rc,Rc<<=1,!(Rc&130023424)&&(Rc=4194304)):e=1);var t=tr();r=os(r,e),r!==null&&(ic(r,e,t),pr(r,t))}function BC(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),VE(r,t)}function UC(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,s=r.memoizedState;s!==null&&(t=s.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(le(314))}n!==null&&n.delete(e),VE(r,t)}var WE;WE=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||hr.current)ur=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return ur=!1,IC(r,e,t);ur=!!(r.flags&131072)}else ur=!1,it&&e.flags&1048576&&QS(e,cd,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Lu(r,e),r=e.pendingProps;var s=fa(e,qt.current);Ho(e,t),s=Gg(null,e,n,r,s,t);var i=Hg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,fr(n)?(i=!0,ad(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,jg(e),s.updater=th,e.stateNode=s,s._reactInternals=e,jp(e,n,r,t),e=Up(null,e,n,!0,i,t)):(e.tag=0,it&&i&&Lg(e),Jt(null,e,s,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Lu(r,e),r=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=GC(n),r=sn(n,r),s){case 0:e=Bp(null,e,n,r,t);break e;case 1:e=_v(null,e,n,r,t);break e;case 11:e=Ev(null,e,n,r,t);break e;case 14:e=Tv(null,e,n,sn(n.type,r),t);break e}throw Error(le(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:sn(n,s),Bp(r,e,n,s,t);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:sn(n,s),_v(r,e,n,s,t);case 3:e:{if(RE(e),r===null)throw Error(le(387));n=e.pendingProps,i=e.memoizedState,s=i.element,rE(r,e),hd(e,n,null,t);var o=e.memoizedState;if(n=o.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=ya(Error(le(423)),e),e=Av(r,e,n,t,s);break e}else if(n!==s){s=ya(Error(le(424)),e),e=Av(r,e,n,t,s);break e}else for(Ar=Vs(e.stateNode.containerInfo.firstChild),kr=e,it=!0,dn=null,t=eE(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(pa(),n===s){e=as(r,e,t);break e}Jt(r,e,n,t)}e=e.child}return e;case 5:return nE(e),r===null&&Np(e),n=e.type,s=e.pendingProps,i=r!==null?r.memoizedProps:null,o=s.children,Cp(n,s)?o=null:i!==null&&Cp(n,i)&&(e.flags|=32),IE(r,e),Jt(r,e,o,t),e.child;case 6:return r===null&&Np(e),null;case 13:return CE(r,e,t);case 4:return $g(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=ma(e,null,n,t):Jt(r,e,n,t),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:sn(n,s),Ev(r,e,n,s,t);case 7:return Jt(r,e,e.pendingProps,t),e.child;case 8:return Jt(r,e,e.pendingProps.children,t),e.child;case 12:return Jt(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ze(ud,n._currentValue),n._currentValue=o,i!==null)if(pn(i.value,o)){if(i.children===s.children&&!hr.current){e=as(r,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=ns(-1,t&-t),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),Mp(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(le(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Mp(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Jt(r,e,s.children,t),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,Ho(e,t),s=zr(s),n=n(s),e.flags|=1,Jt(r,e,n,t),e.child;case 14:return n=e.type,s=sn(n,e.pendingProps),s=sn(n.type,s),Tv(r,e,n,s,t);case 15:return AE(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:sn(n,s),Lu(r,e),e.tag=1,fr(n)?(r=!0,ad(e)):r=!1,Ho(e,t),EE(e,n,s),jp(e,n,s,t),Up(null,e,n,!0,r,t);case 19:return LE(r,e,t);case 22:return kE(r,e,t)}throw Error(le(156,e.tag))};function KE(r,e){return wS(r,e)}function zC(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Br(r,e,t,n){return new zC(r,e,t,n)}function e0(r){return r=r.prototype,!(!r||!r.isReactComponent)}function GC(r){if(typeof r=="function")return e0(r)?1:0;if(r!=null){if(r=r.$$typeof,r===xg)return 11;if(r===wg)return 14}return 2}function Ys(r,e){var t=r.alternate;return t===null?(t=Br(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function Ou(r,e,t,n,s,i){var o=2;if(n=r,typeof r=="function")e0(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case Io:return $i(t.children,s,i,e);case vg:o=8,s|=8;break;case lp:return r=Br(12,t,e,s|2),r.elementType=lp,r.lanes=i,r;case cp:return r=Br(13,t,e,s),r.elementType=cp,r.lanes=i,r;case up:return r=Br(19,t,e,s),r.elementType=up,r.lanes=i,r;case nS:return sh(t,s,i,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case tS:o=10;break e;case rS:o=9;break e;case xg:o=11;break e;case wg:o=14;break e;case Ts:o=16,n=null;break e}throw Error(le(130,r==null?r:typeof r,""))}return e=Br(o,t,e,s),e.elementType=r,e.type=n,e.lanes=i,e}function $i(r,e,t,n){return r=Br(7,r,n,e),r.lanes=t,r}function sh(r,e,t,n){return r=Br(22,r,n,e),r.elementType=nS,r.lanes=t,r.stateNode={isHidden:!1},r}function cf(r,e,t){return r=Br(6,r,null,e),r.lanes=t,r}function uf(r,e,t){return e=Br(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function HC(r,e,t,n,s){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Gh(0),this.expirationTimes=Gh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gh(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function t0(r,e,t,n,s,i,o,a,l){return r=new HC(r,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Br(3,null,null,e),r.current=i,i.stateNode=r,i.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},jg(i),r}function VC(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ko,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function qE(r){if(!r)return ei;r=r._reactInternals;e:{if(Zi(r)!==r||r.tag!==1)throw Error(le(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(fr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(le(171))}if(r.tag===1){var t=r.type;if(fr(t))return qS(r,t,e)}return e}function YE(r,e,t,n,s,i,o,a,l){return r=t0(t,n,!0,r,s,i,o,a,l),r.context=qE(null),t=r.current,n=tr(),s=qs(t),i=ns(n,s),i.callback=e??null,Ws(t,i,s),r.current.lanes=s,ic(r,s,n),pr(r,n),r}function ih(r,e,t,n){var s=e.current,i=tr(),o=qs(s);return t=qE(t),e.context===null?e.context=t:e.pendingContext=t,e=ns(i,o),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=Ws(s,e,o),r!==null&&(fn(r,s,o,i),Iu(r,s,o)),o}function wd(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function Mv(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function r0(r,e){Mv(r,e),(r=r.alternate)&&Mv(r,e)}function WC(){return null}var QE=typeof reportError=="function"?reportError:function(r){console.error(r)};function n0(r){this._internalRoot=r}oh.prototype.render=n0.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(le(409));ih(r,e,null,null)};oh.prototype.unmount=n0.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;Wi(function(){ih(null,r,null,null)}),e[is]=null}};function oh(r){this._internalRoot=r}oh.prototype.unstable_scheduleHydration=function(r){if(r){var e=kS();r={blockedOn:null,target:r,priority:e};for(var t=0;t<Is.length&&e!==0&&e<Is[t].priority;t++);Is.splice(t,0,r),t===0&&RS(r)}};function s0(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function ah(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function Fv(){}function KC(r,e,t,n,s){if(s){if(typeof n=="function"){var i=n;n=function(){var c=wd(o);i.call(c)}}var o=YE(e,n,r,0,null,!1,!1,"",Fv);return r._reactRootContainer=o,r[is]=o.current,_l(r.nodeType===8?r.parentNode:r),Wi(),o}for(;s=r.lastChild;)r.removeChild(s);if(typeof n=="function"){var a=n;n=function(){var c=wd(l);a.call(c)}}var l=t0(r,0,!1,null,null,!1,!1,"",Fv);return r._reactRootContainer=l,r[is]=l.current,_l(r.nodeType===8?r.parentNode:r),Wi(function(){ih(e,l,t,n)}),l}function lh(r,e,t,n,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=wd(o);a.call(l)}}ih(e,o,r,s)}else o=KC(t,e,r,s,n);return wd(o)}_S=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=Qa(e.pendingLanes);t!==0&&(Eg(e,t|1),pr(e,xt()),!(Be&6)&&(va=xt()+500,ci()))}break;case 13:Wi(function(){var n=os(r,1);if(n!==null){var s=tr();fn(n,r,1,s)}}),r0(r,1)}};Tg=function(r){if(r.tag===13){var e=os(r,134217728);if(e!==null){var t=tr();fn(e,r,134217728,t)}r0(r,134217728)}};AS=function(r){if(r.tag===13){var e=qs(r),t=os(r,e);if(t!==null){var n=tr();fn(t,r,e,n)}r0(r,e)}};kS=function(){return Ve};IS=function(r,e){var t=Ve;try{return Ve=r,e()}finally{Ve=t}};wp=function(r,e,t){switch(e){case"input":if(fp(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var s=Jd(n);if(!s)throw Error(le(90));iS(n),fp(n,s)}}}break;case"textarea":aS(r,t);break;case"select":e=t.value,e!=null&&Bo(r,!!t.multiple,e,!1)}};pS=Xg;mS=Wi;var qC={usingClientEntryPoint:!1,Events:[ac,Po,Jd,hS,fS,Xg]},Ha={findFiberByHostInstance:_i,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},YC={bundleType:Ha.bundleType,version:Ha.version,rendererPackageName:Ha.rendererPackageName,rendererConfig:Ha.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:us.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=vS(r),r===null?null:r.stateNode},findFiberByHostInstance:Ha.findFiberByHostInstance||WC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bc.isDisabled&&Bc.supportsFiber)try{qd=Bc.inject(YC),On=Bc}catch{}}Pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qC;Pr.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!s0(e))throw Error(le(200));return VC(r,e,null,t)};Pr.createRoot=function(r,e){if(!s0(r))throw Error(le(299));var t=!1,n="",s=QE;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=t0(r,1,!1,null,null,t,!1,n,s),r[is]=e.current,_l(r.nodeType===8?r.parentNode:r),new n0(e)};Pr.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(le(188)):(r=Object.keys(r).join(","),Error(le(268,r)));return r=vS(e),r=r===null?null:r.stateNode,r};Pr.flushSync=function(r){return Wi(r)};Pr.hydrate=function(r,e,t){if(!ah(e))throw Error(le(200));return lh(null,r,e,!0,t)};Pr.hydrateRoot=function(r,e,t){if(!s0(r))throw Error(le(405));var n=t!=null&&t.hydratedSources||null,s=!1,i="",o=QE;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=YE(e,null,r,1,t??null,s,!1,i,o),r[is]=e.current,_l(r),n)for(r=0;r<n.length;r++)t=n[r],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new oh(e)};Pr.render=function(r,e,t){if(!ah(e))throw Error(le(200));return lh(null,r,e,!1,t)};Pr.unmountComponentAtNode=function(r){if(!ah(r))throw Error(le(40));return r._reactRootContainer?(Wi(function(){lh(null,null,r,!1,function(){r._reactRootContainer=null,r[is]=null})}),!0):!1};Pr.unstable_batchedUpdates=Xg;Pr.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!ah(t))throw Error(le(200));if(r==null||r._reactInternals===void 0)throw Error(le(38));return lh(r,e,t,!1,n)};Pr.version="18.3.1-next-f1338f8080-20240426";function XE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(XE)}catch(r){console.error(r)}}XE(),Xb.exports=Pr;var cc=Xb.exports;const JE=cg(cc);var ZE,jv=cc;ZE=jv.createRoot,jv.hydrateRoot;const QC=1,XC=1e6;let df=0;function JC(){return df=(df+1)%Number.MAX_SAFE_INTEGER,df.toString()}const hf=new Map,$v=r=>{if(hf.has(r))return;const e=setTimeout(()=>{hf.delete(r),ul({type:"REMOVE_TOAST",toastId:r})},XC);hf.set(r,e)},ZC=(r,e)=>{switch(e.type){case"ADD_TOAST":return{...r,toasts:[e.toast,...r.toasts].slice(0,QC)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?$v(t):r.toasts.forEach(n=>{$v(n.id)}),{...r,toasts:r.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return e.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(t=>t.id!==e.toastId)}}},Nu=[];let Mu={toasts:[]};function ul(r){Mu=ZC(Mu,r),Nu.forEach(e=>{e(Mu)})}function Ki({...r}){const e=JC(),t=s=>ul({type:"UPDATE_TOAST",toast:{...s,id:e}}),n=()=>ul({type:"DISMISS_TOAST",toastId:e});return ul({type:"ADD_TOAST",toast:{...r,id:e,open:!0,onOpenChange:s=>{s||n()}}}),{id:e,dismiss:n,update:t}}function eT(){const[r,e]=T.useState(Mu);return T.useEffect(()=>(Nu.push(e),()=>{const t=Nu.indexOf(e);t>-1&&Nu.splice(t,1)}),[r]),{...r,toast:Ki,dismiss:t=>ul({type:"DISMISS_TOAST",toastId:t})}}function Ue(r,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(r==null||r(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function Bv(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function tT(...r){return e=>{let t=!1;const n=r.map(s=>{const i=Bv(s,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let s=0;s<n.length;s++){const i=n[s];typeof i=="function"?i():Bv(r[s],null)}}}}function vt(...r){return T.useCallback(tT(...r),r)}function eL(r,e){const t=T.createContext(e),n=i=>{const{children:o,...a}=i,l=T.useMemo(()=>a,Object.values(a));return v.jsx(t.Provider,{value:l,children:o})};n.displayName=r+"Provider";function s(i){const o=T.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${i}\` must be used within \`${r}\``)}return[n,s]}function eo(r,e=[]){let t=[];function n(i,o){const a=T.createContext(o),l=t.length;t=[...t,o];const c=d=>{var y;const{scope:h,children:f,...m}=d,p=((y=h==null?void 0:h[r])==null?void 0:y[l])||a,g=T.useMemo(()=>m,Object.values(m));return v.jsx(p.Provider,{value:g,children:f})};c.displayName=i+"Provider";function u(d,h){var p;const f=((p=h==null?void 0:h[r])==null?void 0:p[l])||a,m=T.useContext(f);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${i}\``)}return[c,u]}const s=()=>{const i=t.map(o=>T.createContext(o));return function(a){const l=(a==null?void 0:a[r])||i;return T.useMemo(()=>({[`__scope${r}`]:{...a,[r]:l}}),[a,l])}};return s.scopeName=r,[n,tL(s,...e)]}function tL(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const o=n.reduce((a,{useScope:l,scopeName:c})=>{const d=l(i)[`__scope${c}`];return{...a,...d}},{});return T.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function Ol(r){const e=nL(r),t=T.forwardRef((n,s)=>{const{children:i,...o}=n,a=T.Children.toArray(i),l=a.find(iL);if(l){const c=l.props.children,u=a.map(d=>d===l?T.Children.count(c)>1?T.Children.only(null):T.isValidElement(c)?c.props.children:null:d);return v.jsx(e,{...o,ref:s,children:T.isValidElement(c)?T.cloneElement(c,void 0,u):null})}return v.jsx(e,{...o,ref:s,children:i})});return t.displayName=`${r}.Slot`,t}var rL=Ol("Slot");function nL(r){const e=T.forwardRef((t,n)=>{const{children:s,...i}=t;if(T.isValidElement(s)){const o=aL(s),a=oL(i,s.props);return s.type!==T.Fragment&&(a.ref=n?tT(n,o):o),T.cloneElement(s,a)}return T.Children.count(s)>1?T.Children.only(null):null});return e.displayName=`${r}.SlotClone`,e}var rT=Symbol("radix.slottable");function sL(r){const e=({children:t})=>v.jsx(v.Fragment,{children:t});return e.displayName=`${r}.Slottable`,e.__radixId=rT,e}function iL(r){return T.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===rT}function oL(r,e){const t={...e};for(const n in e){const s=r[n],i=e[n];/^on[A-Z]/.test(n)?s&&i?t[n]=(...a)=>{const l=i(...a);return s(...a),l}:s&&(t[n]=s):n==="style"?t[n]={...s,...i}:n==="className"&&(t[n]=[s,i].filter(Boolean).join(" "))}return{...r,...t}}function aL(r){var n,s;let e=(n=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(s=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function lL(r){const e=r+"CollectionProvider",[t,n]=eo(e),[s,i]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=p=>{const{scope:g,children:y}=p,x=ue.useRef(null),w=ue.useRef(new Map).current;return v.jsx(s,{scope:g,itemMap:w,collectionRef:x,children:y})};o.displayName=e;const a=r+"CollectionSlot",l=Ol(a),c=ue.forwardRef((p,g)=>{const{scope:y,children:x}=p,w=i(a,y),b=vt(g,w.collectionRef);return v.jsx(l,{ref:b,children:x})});c.displayName=a;const u=r+"CollectionItemSlot",d="data-radix-collection-item",h=Ol(u),f=ue.forwardRef((p,g)=>{const{scope:y,children:x,...w}=p,b=ue.useRef(null),E=vt(g,b),I=i(u,y);return ue.useEffect(()=>(I.itemMap.set(b,{ref:b,...w}),()=>void I.itemMap.delete(b))),v.jsx(h,{[d]:"",ref:E,children:x})});f.displayName=u;function m(p){const g=i(r+"CollectionConsumer",p);return ue.useCallback(()=>{const x=g.collectionRef.current;if(!x)return[];const w=Array.from(x.querySelectorAll(`[${d}]`));return Array.from(g.itemMap.values()).sort((I,S)=>w.indexOf(I.ref.current)-w.indexOf(S.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:o,Slot:c,ItemSlot:f},m,n]}var cL=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],qe=cL.reduce((r,e)=>{const t=Ol(`Primitive.${e}`),n=T.forwardRef((s,i)=>{const{asChild:o,...a}=s,l=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),v.jsx(l,{...a,ref:i})});return n.displayName=`Primitive.${e}`,{...r,[e]:n}},{});function nT(r,e){r&&cc.flushSync(()=>r.dispatchEvent(e))}function Bt(r){const e=T.useRef(r);return T.useEffect(()=>{e.current=r}),T.useMemo(()=>(...t)=>{var n;return(n=e.current)==null?void 0:n.call(e,...t)},[])}function uL(r,e=globalThis==null?void 0:globalThis.document){const t=Bt(r);T.useEffect(()=>{const n=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var dL="DismissableLayer",Zp="dismissableLayer.update",hL="dismissableLayer.pointerDownOutside",fL="dismissableLayer.focusOutside",Uv,sT=T.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ch=T.forwardRef((r,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...l}=r,c=T.useContext(sT),[u,d]=T.useState(null),h=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=T.useState({}),m=vt(e,S=>d(S)),p=Array.from(c.layers),[g]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),y=p.indexOf(g),x=u?p.indexOf(u):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,b=x>=y,E=mL(S=>{const C=S.target,R=[...c.branches].some(L=>L.contains(C));!b||R||(s==null||s(S),o==null||o(S),S.defaultPrevented||a==null||a())},h),I=gL(S=>{const C=S.target;[...c.branches].some(L=>L.contains(C))||(i==null||i(S),o==null||o(S),S.defaultPrevented||a==null||a())},h);return uL(S=>{x===c.layers.size-1&&(n==null||n(S),!S.defaultPrevented&&a&&(S.preventDefault(),a()))},h),T.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(Uv=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),zv(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Uv)}},[u,h,t,c]),T.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),zv())},[u,c]),T.useEffect(()=>{const S=()=>f({});return document.addEventListener(Zp,S),()=>document.removeEventListener(Zp,S)},[]),v.jsx(qe.div,{...l,ref:m,style:{pointerEvents:w?b?"auto":"none":void 0,...r.style},onFocusCapture:Ue(r.onFocusCapture,I.onFocusCapture),onBlurCapture:Ue(r.onBlurCapture,I.onBlurCapture),onPointerDownCapture:Ue(r.onPointerDownCapture,E.onPointerDownCapture)})});ch.displayName=dL;var pL="DismissableLayerBranch",iT=T.forwardRef((r,e)=>{const t=T.useContext(sT),n=T.useRef(null),s=vt(e,n);return T.useEffect(()=>{const i=n.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),v.jsx(qe.div,{...r,ref:s})});iT.displayName=pL;function mL(r,e=globalThis==null?void 0:globalThis.document){const t=Bt(r),n=T.useRef(!1),s=T.useRef(()=>{});return T.useEffect(()=>{const i=a=>{if(a.target&&!n.current){let l=function(){oT(hL,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);n.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function gL(r,e=globalThis==null?void 0:globalThis.document){const t=Bt(r),n=T.useRef(!1);return T.useEffect(()=>{const s=i=>{i.target&&!n.current&&oT(fL,t,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function zv(){const r=new CustomEvent(Zp);document.dispatchEvent(r)}function oT(r,e,t,{discrete:n}){const s=t.originalEvent.target,i=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?nT(s,i):s.dispatchEvent(i)}var yL=ch,vL=iT,mn=globalThis!=null&&globalThis.document?T.useLayoutEffect:()=>{},xL="Portal",i0=T.forwardRef((r,e)=>{var a;const{container:t,...n}=r,[s,i]=T.useState(!1);mn(()=>i(!0),[]);const o=t||s&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?JE.createPortal(v.jsx(qe.div,{...n,ref:e}),o):null});i0.displayName=xL;function wL(r,e){return T.useReducer((t,n)=>e[t][n]??t,r)}var vn=r=>{const{present:e,children:t}=r,n=bL(e),s=typeof t=="function"?t({present:n.isPresent}):T.Children.only(t),i=vt(n.ref,SL(s));return typeof t=="function"||n.isPresent?T.cloneElement(s,{ref:i}):null};vn.displayName="Presence";function bL(r){const[e,t]=T.useState(),n=T.useRef(null),s=T.useRef(r),i=T.useRef("none"),o=r?"mounted":"unmounted",[a,l]=wL(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return T.useEffect(()=>{const c=Uc(n.current);i.current=a==="mounted"?c:"none"},[a]),mn(()=>{const c=n.current,u=s.current;if(u!==r){const h=i.current,f=Uc(c);r?l("MOUNT"):f==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&h!==f?"ANIMATION_OUT":"UNMOUNT"),s.current=r}},[r,l]),mn(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=f=>{const p=Uc(n.current).includes(f.animationName);if(f.target===e&&p&&(l("ANIMATION_END"),!s.current)){const g=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=g)})}},h=f=>{f.target===e&&(i.current=Uc(n.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:T.useCallback(c=>{n.current=c?getComputedStyle(c):null,t(c)},[])}}function Uc(r){return(r==null?void 0:r.animationName)||"none"}function SL(r){var n,s;let e=(n=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(s=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var EL=pg[" useInsertionEffect ".trim().toString()]||mn;function o0({prop:r,defaultProp:e,onChange:t=()=>{},caller:n}){const[s,i,o]=TL({defaultProp:e,onChange:t}),a=r!==void 0,l=a?r:s;{const u=T.useRef(r!==void 0);T.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${n} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,n])}const c=T.useCallback(u=>{var d;if(a){const h=_L(u)?u(r):u;h!==r&&((d=o.current)==null||d.call(o,h))}else i(u)},[a,r,i,o]);return[l,c]}function TL({defaultProp:r,onChange:e}){const[t,n]=T.useState(r),s=T.useRef(t),i=T.useRef(e);return EL(()=>{i.current=e},[e]),T.useEffect(()=>{var o;s.current!==t&&((o=i.current)==null||o.call(i,t),s.current=t)},[t,s]),[t,n,i]}function _L(r){return typeof r=="function"}var AL=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),kL="VisuallyHidden",uh=T.forwardRef((r,e)=>v.jsx(qe.span,{...r,ref:e,style:{...AL,...r.style}}));uh.displayName=kL;var IL=uh,a0="ToastProvider",[l0,RL,CL]=lL("Toast"),[aT]=eo("Toast",[CL]),[LL,dh]=aT(a0),lT=r=>{const{__scopeToast:e,label:t="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:i=50,children:o}=r,[a,l]=T.useState(null),[c,u]=T.useState(0),d=T.useRef(!1),h=T.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${a0}\`. Expected non-empty \`string\`.`),v.jsx(l0.Provider,{scope:e,children:v.jsx(LL,{scope:e,label:t,duration:n,swipeDirection:s,swipeThreshold:i,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:T.useCallback(()=>u(f=>f+1),[]),onToastRemove:T.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h,children:o})})};lT.displayName=a0;var cT="ToastViewport",PL=["F8"],em="toast.viewportPause",tm="toast.viewportResume",uT=T.forwardRef((r,e)=>{const{__scopeToast:t,hotkey:n=PL,label:s="Notifications ({hotkey})",...i}=r,o=dh(cT,t),a=RL(t),l=T.useRef(null),c=T.useRef(null),u=T.useRef(null),d=T.useRef(null),h=vt(e,d,o.onViewportChange),f=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),m=o.toastCount>0;T.useEffect(()=>{const g=y=>{var w;n.length!==0&&n.every(b=>y[b]||y.code===b)&&((w=d.current)==null||w.focus())};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[n]),T.useEffect(()=>{const g=l.current,y=d.current;if(m&&g&&y){const x=()=>{if(!o.isClosePausedRef.current){const I=new CustomEvent(em);y.dispatchEvent(I),o.isClosePausedRef.current=!0}},w=()=>{if(o.isClosePausedRef.current){const I=new CustomEvent(tm);y.dispatchEvent(I),o.isClosePausedRef.current=!1}},b=I=>{!g.contains(I.relatedTarget)&&w()},E=()=>{g.contains(document.activeElement)||w()};return g.addEventListener("focusin",x),g.addEventListener("focusout",b),g.addEventListener("pointermove",x),g.addEventListener("pointerleave",E),window.addEventListener("blur",x),window.addEventListener("focus",w),()=>{g.removeEventListener("focusin",x),g.removeEventListener("focusout",b),g.removeEventListener("pointermove",x),g.removeEventListener("pointerleave",E),window.removeEventListener("blur",x),window.removeEventListener("focus",w)}}},[m,o.isClosePausedRef]);const p=T.useCallback(({tabbingDirection:g})=>{const x=a().map(w=>{const b=w.ref.current,E=[b,...VL(b)];return g==="forwards"?E:E.reverse()});return(g==="forwards"?x.reverse():x).flat()},[a]);return T.useEffect(()=>{const g=d.current;if(g){const y=x=>{var E,I,S;const w=x.altKey||x.ctrlKey||x.metaKey;if(x.key==="Tab"&&!w){const C=document.activeElement,R=x.shiftKey;if(x.target===g&&R){(E=c.current)==null||E.focus();return}const P=p({tabbingDirection:R?"backwards":"forwards"}),U=P.findIndex(_=>_===C);ff(P.slice(U+1))?x.preventDefault():R?(I=c.current)==null||I.focus():(S=u.current)==null||S.focus()}};return g.addEventListener("keydown",y),()=>g.removeEventListener("keydown",y)}},[a,p]),v.jsxs(vL,{ref:l,role:"region","aria-label":s.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:m?void 0:"none"},children:[m&&v.jsx(rm,{ref:c,onFocusFromOutsideViewport:()=>{const g=p({tabbingDirection:"forwards"});ff(g)}}),v.jsx(l0.Slot,{scope:t,children:v.jsx(qe.ol,{tabIndex:-1,...i,ref:h})}),m&&v.jsx(rm,{ref:u,onFocusFromOutsideViewport:()=>{const g=p({tabbingDirection:"backwards"});ff(g)}})]})});uT.displayName=cT;var dT="ToastFocusProxy",rm=T.forwardRef((r,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:n,...s}=r,i=dh(dT,t);return v.jsx(uh,{"aria-hidden":!0,tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=i.viewport)!=null&&c.contains(a))&&n()}})});rm.displayName=dT;var uc="Toast",DL="toast.swipeStart",OL="toast.swipeMove",NL="toast.swipeCancel",ML="toast.swipeEnd",hT=T.forwardRef((r,e)=>{const{forceMount:t,open:n,defaultOpen:s,onOpenChange:i,...o}=r,[a,l]=o0({prop:n,defaultProp:s??!0,onChange:i,caller:uc});return v.jsx(vn,{present:t||a,children:v.jsx($L,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:Bt(r.onPause),onResume:Bt(r.onResume),onSwipeStart:Ue(r.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ue(r.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:Ue(r.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ue(r.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});hT.displayName=uc;var[FL,jL]=aT(uc,{onClose(){}}),$L=T.forwardRef((r,e)=>{const{__scopeToast:t,type:n="foreground",duration:s,open:i,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:f,...m}=r,p=dh(uc,t),[g,y]=T.useState(null),x=vt(e,_=>y(_)),w=T.useRef(null),b=T.useRef(null),E=s||p.duration,I=T.useRef(0),S=T.useRef(E),C=T.useRef(0),{onToastAdd:R,onToastRemove:L}=p,$=Bt(()=>{var H;(g==null?void 0:g.contains(document.activeElement))&&((H=p.viewport)==null||H.focus()),o()}),P=T.useCallback(_=>{!_||_===1/0||(window.clearTimeout(C.current),I.current=new Date().getTime(),C.current=window.setTimeout($,_))},[$]);T.useEffect(()=>{const _=p.viewport;if(_){const H=()=>{P(S.current),c==null||c()},V=()=>{const G=new Date().getTime()-I.current;S.current=S.current-G,window.clearTimeout(C.current),l==null||l()};return _.addEventListener(em,V),_.addEventListener(tm,H),()=>{_.removeEventListener(em,V),_.removeEventListener(tm,H)}}},[p.viewport,E,l,c,P]),T.useEffect(()=>{i&&!p.isClosePausedRef.current&&P(E)},[i,E,p.isClosePausedRef,P]),T.useEffect(()=>(R(),()=>L()),[R,L]);const U=T.useMemo(()=>g?xT(g):null,[g]);return p.viewport?v.jsxs(v.Fragment,{children:[U&&v.jsx(BL,{__scopeToast:t,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:U}),v.jsx(FL,{scope:t,onClose:$,children:cc.createPortal(v.jsx(l0.ItemSlot,{scope:t,children:v.jsx(yL,{asChild:!0,onEscapeKeyDown:Ue(a,()=>{p.isFocusedToastEscapeKeyDownRef.current||$(),p.isFocusedToastEscapeKeyDownRef.current=!1}),children:v.jsx(qe.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":p.swipeDirection,...m,ref:x,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:Ue(r.onKeyDown,_=>{_.key==="Escape"&&(a==null||a(_.nativeEvent),_.nativeEvent.defaultPrevented||(p.isFocusedToastEscapeKeyDownRef.current=!0,$()))}),onPointerDown:Ue(r.onPointerDown,_=>{_.button===0&&(w.current={x:_.clientX,y:_.clientY})}),onPointerMove:Ue(r.onPointerMove,_=>{if(!w.current)return;const H=_.clientX-w.current.x,V=_.clientY-w.current.y,G=!!b.current,j=["left","right"].includes(p.swipeDirection),F=["left","up"].includes(p.swipeDirection)?Math.min:Math.max,Y=j?F(0,H):0,M=j?0:F(0,V),D=_.pointerType==="touch"?10:2,ee={x:Y,y:M},Q={originalEvent:_,delta:ee};G?(b.current=ee,zc(OL,d,Q,{discrete:!1})):Gv(ee,p.swipeDirection,D)?(b.current=ee,zc(DL,u,Q,{discrete:!1}),_.target.setPointerCapture(_.pointerId)):(Math.abs(H)>D||Math.abs(V)>D)&&(w.current=null)}),onPointerUp:Ue(r.onPointerUp,_=>{const H=b.current,V=_.target;if(V.hasPointerCapture(_.pointerId)&&V.releasePointerCapture(_.pointerId),b.current=null,w.current=null,H){const G=_.currentTarget,j={originalEvent:_,delta:H};Gv(H,p.swipeDirection,p.swipeThreshold)?zc(ML,f,j,{discrete:!0}):zc(NL,h,j,{discrete:!0}),G.addEventListener("click",F=>F.preventDefault(),{once:!0})}})})})}),p.viewport)})]}):null}),BL=r=>{const{__scopeToast:e,children:t,...n}=r,s=dh(uc,e),[i,o]=T.useState(!1),[a,l]=T.useState(!1);return GL(()=>o(!0)),T.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:v.jsx(i0,{asChild:!0,children:v.jsx(uh,{...n,children:i&&v.jsxs(v.Fragment,{children:[s.label," ",t]})})})},UL="ToastTitle",fT=T.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return v.jsx(qe.div,{...n,ref:e})});fT.displayName=UL;var zL="ToastDescription",pT=T.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return v.jsx(qe.div,{...n,ref:e})});pT.displayName=zL;var mT="ToastAction",gT=T.forwardRef((r,e)=>{const{altText:t,...n}=r;return t.trim()?v.jsx(vT,{altText:t,asChild:!0,children:v.jsx(c0,{...n,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${mT}\`. Expected non-empty \`string\`.`),null)});gT.displayName=mT;var yT="ToastClose",c0=T.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r,s=jL(yT,t);return v.jsx(vT,{asChild:!0,children:v.jsx(qe.button,{type:"button",...n,ref:e,onClick:Ue(r.onClick,s.onClose)})})});c0.displayName=yT;var vT=T.forwardRef((r,e)=>{const{__scopeToast:t,altText:n,...s}=r;return v.jsx(qe.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:e})});function xT(r){const e=[];return Array.from(r.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&e.push(n.textContent),HL(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",i=n.dataset.radixToastAnnounceExclude==="";if(!s)if(i){const o=n.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...xT(n))}}),e}function zc(r,e,t,{discrete:n}){const s=t.originalEvent.currentTarget,i=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?nT(s,i):s.dispatchEvent(i)}var Gv=(r,e,t=0)=>{const n=Math.abs(r.x),s=Math.abs(r.y),i=n>s;return e==="left"||e==="right"?i&&n>t:!i&&s>t};function GL(r=()=>{}){const e=Bt(r);mn(()=>{let t=0,n=0;return t=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(n)}},[e])}function HL(r){return r.nodeType===r.ELEMENT_NODE}function VL(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function ff(r){const e=document.activeElement;return r.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var WL=lT,wT=uT,bT=hT,ST=fT,ET=pT,TT=gT,_T=c0;function AT(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var s=r.length;for(e=0;e<s;e++)r[e]&&(t=AT(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function kT(){for(var r,e,t=0,n="",s=arguments.length;t<s;t++)(r=arguments[t])&&(e=AT(r))&&(n&&(n+=" "),n+=e);return n}const Hv=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,Vv=kT,hh=(r,e)=>t=>{var n;if((e==null?void 0:e.variants)==null)return Vv(r,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:s,defaultVariants:i}=e,o=Object.keys(s).map(c=>{const u=t==null?void 0:t[c],d=i==null?void 0:i[c];if(u===null)return null;const h=Hv(u)||Hv(d);return s[c][h]}),a=t&&Object.entries(t).reduce((c,u)=>{let[d,h]=u;return h===void 0||(c[d]=h),c},{}),l=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((c,u)=>{let{class:d,className:h,...f}=u;return Object.entries(f).every(m=>{let[p,g]=m;return Array.isArray(g)?g.includes({...i,...a}[p]):{...i,...a}[p]===g})?[...c,d,h]:c},[]);return Vv(r,o,l,t==null?void 0:t.class,t==null?void 0:t.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KL=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),IT=(...r)=>r.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var qL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YL=T.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:o,...a},l)=>T.createElement("svg",{ref:l,...qL,width:e,height:e,stroke:r,strokeWidth:n?Number(t)*24/Number(e):t,className:IT("lucide",s),...a},[...o.map(([c,u])=>T.createElement(c,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=(r,e)=>{const t=T.forwardRef(({className:n,...s},i)=>T.createElement(YL,{ref:i,iconNode:e,className:IT(`lucide-${KL(r)}`,n),...s}));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nl=$e("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QL=$e("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=$e("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CT=$e("Captions",[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u0=$e("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d0=$e("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h0=$e("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=$e("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f0=$e("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ti=$e("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p0=$e("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XL=$e("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JL=$e("FileVideo",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m10 11 5 3-5 3v-6Z",key:"7ntvm4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fh=$e("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wv=$e("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=$e("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nm=$e("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZL=$e("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kv=$e("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eP=$e("MousePointerClick",[["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z",key:"s0h3yz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=$e("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=$e("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tP=$e("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rP=$e("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ph=$e("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DT=$e("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nP=$e("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sP=$e("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iP=$e("Tv",[["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",ry:"2",key:"10ag99"}],["polyline",{points:"17 2 12 7 7 2",key:"11pgbg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fu=$e("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sd=$e("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m0=$e("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oP=$e("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aP=$e("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=$e("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),g0="-",lP=r=>{const e=uP(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=r;return{getClassGroupId:o=>{const a=o.split(g0);return a[0]===""&&a.length!==1&&a.shift(),OT(a,e)||cP(o)},getConflictingClassGroupIds:(o,a)=>{const l=t[o]||[];return a&&n[o]?[...l,...n[o]]:l}}},OT=(r,e)=>{var o;if(r.length===0)return e.classGroupId;const t=r[0],n=e.nextPart.get(t),s=n?OT(r.slice(1),n):void 0;if(s)return s;if(e.validators.length===0)return;const i=r.join(g0);return(o=e.validators.find(({validator:a})=>a(i)))==null?void 0:o.classGroupId},qv=/^\[(.+)\]$/,cP=r=>{if(qv.test(r)){const e=qv.exec(r)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},uP=r=>{const{theme:e,prefix:t}=r,n={nextPart:new Map,validators:[]};return hP(Object.entries(r.classGroups),t).forEach(([i,o])=>{sm(o,n,i,e)}),n},sm=(r,e,t,n)=>{r.forEach(s=>{if(typeof s=="string"){const i=s===""?e:Yv(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(dP(s)){sm(s(n),e,t,n);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,o])=>{sm(o,Yv(e,i),t,n)})})},Yv=(r,e)=>{let t=r;return e.split(g0).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},dP=r=>r.isThemeGetter,hP=(r,e)=>e?r.map(([t,n])=>{const s=n.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,a])=>[e+o,a])):i);return[t,s]}):r,fP=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const s=(i,o)=>{t.set(i,o),e++,e>r&&(e=0,n=t,t=new Map)};return{get(i){let o=t.get(i);if(o!==void 0)return o;if((o=n.get(i))!==void 0)return s(i,o),o},set(i,o){t.has(i)?t.set(i,o):s(i,o)}}},NT="!",pP=r=>{const{separator:e,experimentalParseClassName:t}=r,n=e.length===1,s=e[0],i=e.length,o=a=>{const l=[];let c=0,u=0,d;for(let g=0;g<a.length;g++){let y=a[g];if(c===0){if(y===s&&(n||a.slice(g,g+i)===e)){l.push(a.slice(u,g)),u=g+i;continue}if(y==="/"){d=g;continue}}y==="["?c++:y==="]"&&c--}const h=l.length===0?a:a.substring(u),f=h.startsWith(NT),m=f?h.substring(1):h,p=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:p}};return t?a=>t({className:a,parseClassName:o}):o},mP=r=>{if(r.length<=1)return r;const e=[];let t=[];return r.forEach(n=>{n[0]==="["?(e.push(...t.sort(),n),t=[]):t.push(n)}),e.push(...t.sort()),e},gP=r=>({cache:fP(r.cacheSize),parseClassName:pP(r),...lP(r)}),yP=/\s+/,vP=(r,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:s}=e,i=[],o=r.trim().split(yP);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:f}=t(c);let m=!!f,p=n(m?h.substring(0,f):h);if(!p){if(!m){a=c+(a.length>0?" "+a:a);continue}if(p=n(h),!p){a=c+(a.length>0?" "+a:a);continue}m=!1}const g=mP(u).join(":"),y=d?g+NT:g,x=y+p;if(i.includes(x))continue;i.push(x);const w=s(p,m);for(let b=0;b<w.length;++b){const E=w[b];i.push(y+E)}a=c+(a.length>0?" "+a:a)}return a};function xP(){let r=0,e,t,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=MT(e))&&(n&&(n+=" "),n+=t);return n}const MT=r=>{if(typeof r=="string")return r;let e,t="";for(let n=0;n<r.length;n++)r[n]&&(e=MT(r[n]))&&(t&&(t+=" "),t+=e);return t};function wP(r,...e){let t,n,s,i=o;function o(l){const c=e.reduce((u,d)=>d(u),r());return t=gP(c),n=t.cache.get,s=t.cache.set,i=a,a(l)}function a(l){const c=n(l);if(c)return c;const u=vP(l,t);return s(l,u),u}return function(){return i(xP.apply(null,arguments))}}const tt=r=>{const e=t=>t[r]||[];return e.isThemeGetter=!0,e},FT=/^\[(?:([a-z-]+):)?(.+)\]$/i,bP=/^\d+\/\d+$/,SP=new Set(["px","full","screen"]),EP=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,TP=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,_P=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,AP=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kP=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Hn=r=>Wo(r)||SP.has(r)||bP.test(r),gs=r=>Ra(r,"length",NP),Wo=r=>!!r&&!Number.isNaN(Number(r)),pf=r=>Ra(r,"number",Wo),Va=r=>!!r&&Number.isInteger(Number(r)),IP=r=>r.endsWith("%")&&Wo(r.slice(0,-1)),Ie=r=>FT.test(r),ys=r=>EP.test(r),RP=new Set(["length","size","percentage"]),CP=r=>Ra(r,RP,jT),LP=r=>Ra(r,"position",jT),PP=new Set(["image","url"]),DP=r=>Ra(r,PP,FP),OP=r=>Ra(r,"",MP),Wa=()=>!0,Ra=(r,e,t)=>{const n=FT.exec(r);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):t(n[2]):!1},NP=r=>TP.test(r)&&!_P.test(r),jT=()=>!1,MP=r=>AP.test(r),FP=r=>kP.test(r),jP=()=>{const r=tt("colors"),e=tt("spacing"),t=tt("blur"),n=tt("brightness"),s=tt("borderColor"),i=tt("borderRadius"),o=tt("borderSpacing"),a=tt("borderWidth"),l=tt("contrast"),c=tt("grayscale"),u=tt("hueRotate"),d=tt("invert"),h=tt("gap"),f=tt("gradientColorStops"),m=tt("gradientColorStopPositions"),p=tt("inset"),g=tt("margin"),y=tt("opacity"),x=tt("padding"),w=tt("saturate"),b=tt("scale"),E=tt("sepia"),I=tt("skew"),S=tt("space"),C=tt("translate"),R=()=>["auto","contain","none"],L=()=>["auto","hidden","clip","visible","scroll"],$=()=>["auto",Ie,e],P=()=>[Ie,e],U=()=>["",Hn,gs],_=()=>["auto",Wo,Ie],H=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],V=()=>["solid","dashed","dotted","double","none"],G=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],j=()=>["start","end","center","between","around","evenly","stretch"],F=()=>["","0",Ie],Y=()=>["auto","avoid","all","avoid-page","page","left","right","column"],M=()=>[Wo,Ie];return{cacheSize:500,separator:":",theme:{colors:[Wa],spacing:[Hn,gs],blur:["none","",ys,Ie],brightness:M(),borderColor:[r],borderRadius:["none","","full",ys,Ie],borderSpacing:P(),borderWidth:U(),contrast:M(),grayscale:F(),hueRotate:M(),invert:F(),gap:P(),gradientColorStops:[r],gradientColorStopPositions:[IP,gs],inset:$(),margin:$(),opacity:M(),padding:P(),saturate:M(),scale:M(),sepia:F(),skew:M(),space:P(),translate:P()},classGroups:{aspect:[{aspect:["auto","square","video",Ie]}],container:["container"],columns:[{columns:[ys]}],"break-after":[{"break-after":Y()}],"break-before":[{"break-before":Y()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...H(),Ie]}],overflow:[{overflow:L()}],"overflow-x":[{"overflow-x":L()}],"overflow-y":[{"overflow-y":L()}],overscroll:[{overscroll:R()}],"overscroll-x":[{"overscroll-x":R()}],"overscroll-y":[{"overscroll-y":R()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[p]}],"inset-x":[{"inset-x":[p]}],"inset-y":[{"inset-y":[p]}],start:[{start:[p]}],end:[{end:[p]}],top:[{top:[p]}],right:[{right:[p]}],bottom:[{bottom:[p]}],left:[{left:[p]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Va,Ie]}],basis:[{basis:$()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ie]}],grow:[{grow:F()}],shrink:[{shrink:F()}],order:[{order:["first","last","none",Va,Ie]}],"grid-cols":[{"grid-cols":[Wa]}],"col-start-end":[{col:["auto",{span:["full",Va,Ie]},Ie]}],"col-start":[{"col-start":_()}],"col-end":[{"col-end":_()}],"grid-rows":[{"grid-rows":[Wa]}],"row-start-end":[{row:["auto",{span:[Va,Ie]},Ie]}],"row-start":[{"row-start":_()}],"row-end":[{"row-end":_()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ie]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ie]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...j()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...j(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...j(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[x]}],px:[{px:[x]}],py:[{py:[x]}],ps:[{ps:[x]}],pe:[{pe:[x]}],pt:[{pt:[x]}],pr:[{pr:[x]}],pb:[{pb:[x]}],pl:[{pl:[x]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ie,e]}],"min-w":[{"min-w":[Ie,e,"min","max","fit"]}],"max-w":[{"max-w":[Ie,e,"none","full","min","max","fit","prose",{screen:[ys]},ys]}],h:[{h:[Ie,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ie,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ie,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ie,e,"auto","min","max","fit"]}],"font-size":[{text:["base",ys,gs]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",pf]}],"font-family":[{font:[Wa]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ie]}],"line-clamp":[{"line-clamp":["none",Wo,pf]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Hn,Ie]}],"list-image":[{"list-image":["none",Ie]}],"list-style-type":[{list:["none","disc","decimal",Ie]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...V(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Hn,gs]}],"underline-offset":[{"underline-offset":["auto",Hn,Ie]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:P()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ie]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ie]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...H(),LP]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",CP]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},DP]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[...V(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:V()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...V()]}],"outline-offset":[{"outline-offset":[Hn,Ie]}],"outline-w":[{outline:[Hn,gs]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:U()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[Hn,gs]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",ys,OP]}],"shadow-color":[{shadow:[Wa]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":[...G(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":G()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",ys,Ie]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[w]}],sepia:[{sepia:[E]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[E]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ie]}],duration:[{duration:M()}],ease:[{ease:["linear","in","out","in-out",Ie]}],delay:[{delay:M()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ie]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[Va,Ie]}],"translate-x":[{"translate-x":[C]}],"translate-y":[{"translate-y":[C]}],"skew-x":[{"skew-x":[I]}],"skew-y":[{"skew-y":[I]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ie]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ie]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":P()}],"scroll-mx":[{"scroll-mx":P()}],"scroll-my":[{"scroll-my":P()}],"scroll-ms":[{"scroll-ms":P()}],"scroll-me":[{"scroll-me":P()}],"scroll-mt":[{"scroll-mt":P()}],"scroll-mr":[{"scroll-mr":P()}],"scroll-mb":[{"scroll-mb":P()}],"scroll-ml":[{"scroll-ml":P()}],"scroll-p":[{"scroll-p":P()}],"scroll-px":[{"scroll-px":P()}],"scroll-py":[{"scroll-py":P()}],"scroll-ps":[{"scroll-ps":P()}],"scroll-pe":[{"scroll-pe":P()}],"scroll-pt":[{"scroll-pt":P()}],"scroll-pr":[{"scroll-pr":P()}],"scroll-pb":[{"scroll-pb":P()}],"scroll-pl":[{"scroll-pl":P()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ie]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[Hn,gs,pf]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},$P=wP(jP);function Te(...r){return $P(kT(r))}const BP=WL,$T=T.forwardRef(({className:r,...e},t)=>v.jsx(wT,{ref:t,className:Te("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...e}));$T.displayName=wT.displayName;const UP=hh("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),BT=T.forwardRef(({className:r,variant:e,...t},n)=>v.jsx(bT,{ref:n,className:Te(UP({variant:e}),r),...t}));BT.displayName=bT.displayName;const zP=T.forwardRef(({className:r,...e},t)=>v.jsx(TT,{ref:t,className:Te("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",r),...e}));zP.displayName=TT.displayName;const UT=T.forwardRef(({className:r,...e},t)=>v.jsx(_T,{ref:t,className:Te("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...e,children:v.jsx(ui,{className:"h-4 w-4"})}));UT.displayName=_T.displayName;const zT=T.forwardRef(({className:r,...e},t)=>v.jsx(ST,{ref:t,className:Te("text-sm font-semibold",r),...e}));zT.displayName=ST.displayName;const GT=T.forwardRef(({className:r,...e},t)=>v.jsx(ET,{ref:t,className:Te("text-sm opacity-90",r),...e}));GT.displayName=ET.displayName;function GP(){const{toasts:r}=eT();return v.jsxs(BP,{children:[r.map(function({id:e,title:t,description:n,action:s,...i}){return v.jsxs(BT,{...i,children:[v.jsxs("div",{className:"grid gap-1",children:[t&&v.jsx(zT,{children:t}),n&&v.jsx(GT,{children:n})]}),s,v.jsx(UT,{})]},e)}),v.jsx($T,{})]})}var Qv=["light","dark"],HP="(prefers-color-scheme: dark)",VP=T.createContext(void 0),WP={setTheme:r=>{},themes:[]},KP=()=>{var r;return(r=T.useContext(VP))!=null?r:WP};T.memo(({forcedTheme:r,storageKey:e,attribute:t,enableSystem:n,enableColorScheme:s,defaultTheme:i,value:o,attrs:a,nonce:l})=>{let c=i==="system",u=t==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(m=>`'${m}'`).join(",")})`};`:`var d=document.documentElement,n='${t}',s='setAttribute';`,d=s?Qv.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",h=(m,p=!1,g=!0)=>{let y=o?o[m]:m,x=p?m+"|| ''":`'${y}'`,w="";return s&&g&&!p&&Qv.includes(m)&&(w+=`d.style.colorScheme = '${m}';`),t==="class"?p||y?w+=`c.add(${x})`:w+="null":y&&(w+=`d[s](n,${x})`),w},f=r?`!function(){${u}${h(r)}}()`:n?`!function(){try{${u}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='${HP}',m=window.matchMedia(t);if(m.media!==t||m.matches){${h("dark")}}else{${h("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}${c?"":"else{"+h(i,!1,!1)+"}"}${d}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${e}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}else{${h(i,!1,!1)};}${d}}catch(t){}}();`;return T.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})});var qP=r=>{switch(r){case"success":return XP;case"info":return ZP;case"warning":return JP;case"error":return eD;default:return null}},YP=Array(12).fill(0),QP=({visible:r,className:e})=>ue.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":r},ue.createElement("div",{className:"sonner-spinner"},YP.map((t,n)=>ue.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),XP=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ue.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),JP=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ue.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ZP=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ue.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),eD=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ue.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),tD=ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ue.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ue.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),rD=()=>{let[r,e]=ue.useState(document.hidden);return ue.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),r},im=1,nD=class{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{let e=this.subscribers.indexOf(r);this.subscribers.splice(e,1)}),this.publish=r=>{this.subscribers.forEach(e=>e(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var e;let{message:t,...n}=r,s=typeof(r==null?void 0:r.id)=="number"||((e=r.id)==null?void 0:e.length)>0?r.id:im++,i=this.toasts.find(a=>a.id===s),o=r.dismissible===void 0?!0:r.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),i?this.toasts=this.toasts.map(a=>a.id===s?(this.publish({...a,...r,id:s,title:t}),{...a,...r,id:s,dismissible:o,title:t}):a):this.addToast({title:t,...n,dismissible:o,id:s}),s},this.dismiss=r=>(this.dismissedToasts.add(r),r||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:r,dismiss:!0})),r),this.message=(r,e)=>this.create({...e,message:r}),this.error=(r,e)=>this.create({...e,message:r,type:"error"}),this.success=(r,e)=>this.create({...e,type:"success",message:r}),this.info=(r,e)=>this.create({...e,type:"info",message:r}),this.warning=(r,e)=>this.create({...e,type:"warning",message:r}),this.loading=(r,e)=>this.create({...e,type:"loading",message:r}),this.promise=(r,e)=>{if(!e)return;let t;e.loading!==void 0&&(t=this.create({...e,promise:r,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let n=r instanceof Promise?r:r(),s=t!==void 0,i,o=n.then(async l=>{if(i=["resolve",l],ue.isValidElement(l))s=!1,this.create({id:t,type:"default",message:l});else if(iD(l)&&!l.ok){s=!1;let c=typeof e.error=="function"?await e.error(`HTTP error! status: ${l.status}`):e.error,u=typeof e.description=="function"?await e.description(`HTTP error! status: ${l.status}`):e.description;this.create({id:t,type:"error",message:c,description:u})}else if(e.success!==void 0){s=!1;let c=typeof e.success=="function"?await e.success(l):e.success,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:t,type:"success",message:c,description:u})}}).catch(async l=>{if(i=["reject",l],e.error!==void 0){s=!1;let c=typeof e.error=="function"?await e.error(l):e.error,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:t,type:"error",message:c,description:u})}}).finally(()=>{var l;s&&(this.dismiss(t),t=void 0),(l=e.finally)==null||l.call(e)}),a=()=>new Promise((l,c)=>o.then(()=>i[0]==="reject"?c(i[1]):l(i[1])).catch(c));return typeof t!="string"&&typeof t!="number"?{unwrap:a}:Object.assign(t,{unwrap:a})},this.custom=(r,e)=>{let t=(e==null?void 0:e.id)||im++;return this.create({jsx:r(t),id:t,...e}),t},this.getActiveToasts=()=>this.toasts.filter(r=>!this.dismissedToasts.has(r.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},or=new nD,sD=(r,e)=>{let t=(e==null?void 0:e.id)||im++;return or.addToast({title:r,...e,id:t}),t},iD=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",oD=sD,aD=()=>or.toasts,lD=()=>or.getActiveToasts(),Xt=Object.assign(oD,{success:or.success,info:or.info,warning:or.warning,error:or.error,custom:or.custom,message:or.message,promise:or.promise,dismiss:or.dismiss,loading:or.loading},{getHistory:aD,getToasts:lD});function cD(r,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e==="top"&&t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=r:n.appendChild(document.createTextNode(r))}cD(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Gc(r){return r.label!==void 0}var uD=3,dD="32px",hD="16px",Xv=4e3,fD=356,pD=14,mD=20,gD=200;function Zr(...r){return r.filter(Boolean).join(" ")}function yD(r){let[e,t]=r.split("-"),n=[];return e&&n.push(e),t&&n.push(t),n}var vD=r=>{var e,t,n,s,i,o,a,l,c,u,d;let{invert:h,toast:f,unstyled:m,interacting:p,setHeights:g,visibleToasts:y,heights:x,index:w,toasts:b,expanded:E,removeToast:I,defaultRichColors:S,closeButton:C,style:R,cancelButtonStyle:L,actionButtonStyle:$,className:P="",descriptionClassName:U="",duration:_,position:H,gap:V,loadingIcon:G,expandByDefault:j,classNames:F,icons:Y,closeButtonAriaLabel:M="Close toast",pauseWhenPageIsHidden:D}=r,[ee,Q]=ue.useState(null),[te,oe]=ue.useState(null),[ce,de]=ue.useState(!1),[we,Le]=ue.useState(!1),[Re,ft]=ue.useState(!1),[Xe,k]=ue.useState(!1),[z,B]=ue.useState(!1),[N,O]=ue.useState(0),[W,J]=ue.useState(0),re=ue.useRef(f.duration||_||Xv),q=ue.useRef(null),se=ue.useRef(null),ae=w===0,ie=w+1<=y,he=f.type,De=f.dismissible!==!1,Ce=f.className||"",_t=f.descriptionClassName||"",mr=ue.useMemo(()=>x.findIndex(ke=>ke.toastId===f.id)||0,[x,f.id]),Lt=ue.useMemo(()=>{var ke;return(ke=f.closeButton)!=null?ke:C},[f.closeButton,C]),hs=ue.useMemo(()=>f.duration||_||Xv,[f.duration,_]),et=ue.useRef(0),qr=ue.useRef(0),no=ue.useRef(0),Gt=ue.useRef(null),[vc,Mh]=H.split("-"),xc=ue.useMemo(()=>x.reduce((ke,We,st)=>st>=mr?ke:ke+We.height,0),[x,mr]),wc=rD(),bc=f.invert||h,Gn=he==="loading";qr.current=ue.useMemo(()=>mr*V+xc,[mr,xc]),ue.useEffect(()=>{re.current=hs},[hs]),ue.useEffect(()=>{de(!0)},[]),ue.useEffect(()=>{let ke=se.current;if(ke){let We=ke.getBoundingClientRect().height;return J(We),g(st=>[{toastId:f.id,height:We,position:f.position},...st]),()=>g(st=>st.filter(Yr=>Yr.toastId!==f.id))}},[g,f.id]),ue.useLayoutEffect(()=>{if(!ce)return;let ke=se.current,We=ke.style.height;ke.style.height="auto";let st=ke.getBoundingClientRect().height;ke.style.height=We,J(st),g(Yr=>Yr.find(Qr=>Qr.toastId===f.id)?Yr.map(Qr=>Qr.toastId===f.id?{...Qr,height:st}:Qr):[{toastId:f.id,height:st,position:f.position},...Yr])},[ce,f.title,f.description,g,f.id]);let gr=ue.useCallback(()=>{Le(!0),O(qr.current),g(ke=>ke.filter(We=>We.toastId!==f.id)),setTimeout(()=>{I(f)},gD)},[f,I,g,qr]);ue.useEffect(()=>{if(f.promise&&he==="loading"||f.duration===1/0||f.type==="loading")return;let ke;return E||p||D&&wc?(()=>{if(no.current<et.current){let We=new Date().getTime()-et.current;re.current=re.current-We}no.current=new Date().getTime()})():re.current!==1/0&&(et.current=new Date().getTime(),ke=setTimeout(()=>{var We;(We=f.onAutoClose)==null||We.call(f,f),gr()},re.current)),()=>clearTimeout(ke)},[E,p,f,he,D,wc,gr]),ue.useEffect(()=>{f.delete&&gr()},[gr,f.delete]);function bI(){var ke,We,st;return Y!=null&&Y.loading?ue.createElement("div",{className:Zr(F==null?void 0:F.loader,(ke=f==null?void 0:f.classNames)==null?void 0:ke.loader,"sonner-loader"),"data-visible":he==="loading"},Y.loading):G?ue.createElement("div",{className:Zr(F==null?void 0:F.loader,(We=f==null?void 0:f.classNames)==null?void 0:We.loader,"sonner-loader"),"data-visible":he==="loading"},G):ue.createElement(QP,{className:Zr(F==null?void 0:F.loader,(st=f==null?void 0:f.classNames)==null?void 0:st.loader),visible:he==="loading"})}return ue.createElement("li",{tabIndex:0,ref:se,className:Zr(P,Ce,F==null?void 0:F.toast,(e=f==null?void 0:f.classNames)==null?void 0:e.toast,F==null?void 0:F.default,F==null?void 0:F[he],(t=f==null?void 0:f.classNames)==null?void 0:t[he]),"data-sonner-toast":"","data-rich-colors":(n=f.richColors)!=null?n:S,"data-styled":!(f.jsx||f.unstyled||m),"data-mounted":ce,"data-promise":!!f.promise,"data-swiped":z,"data-removed":we,"data-visible":ie,"data-y-position":vc,"data-x-position":Mh,"data-index":w,"data-front":ae,"data-swiping":Re,"data-dismissible":De,"data-type":he,"data-invert":bc,"data-swipe-out":Xe,"data-swipe-direction":te,"data-expanded":!!(E||j&&ce),style:{"--index":w,"--toasts-before":w,"--z-index":b.length-w,"--offset":`${we?N:qr.current}px`,"--initial-height":j?"auto":`${W}px`,...R,...f.style},onDragEnd:()=>{ft(!1),Q(null),Gt.current=null},onPointerDown:ke=>{Gn||!De||(q.current=new Date,O(qr.current),ke.target.setPointerCapture(ke.pointerId),ke.target.tagName!=="BUTTON"&&(ft(!0),Gt.current={x:ke.clientX,y:ke.clientY}))},onPointerUp:()=>{var ke,We,st,Yr;if(Xe||!De)return;Gt.current=null;let Qr=Number(((ke=se.current)==null?void 0:ke.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),fs=Number(((We=se.current)==null?void 0:We.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),fi=new Date().getTime()-((st=q.current)==null?void 0:st.getTime()),Xr=ee==="x"?Qr:fs,ps=Math.abs(Xr)/fi;if(Math.abs(Xr)>=mD||ps>.11){O(qr.current),(Yr=f.onDismiss)==null||Yr.call(f,f),oe(ee==="x"?Qr>0?"right":"left":fs>0?"down":"up"),gr(),k(!0),B(!1);return}ft(!1),Q(null)},onPointerMove:ke=>{var We,st,Yr,Qr;if(!Gt.current||!De||((We=window.getSelection())==null?void 0:We.toString().length)>0)return;let fs=ke.clientY-Gt.current.y,fi=ke.clientX-Gt.current.x,Xr=(st=r.swipeDirections)!=null?st:yD(H);!ee&&(Math.abs(fi)>1||Math.abs(fs)>1)&&Q(Math.abs(fi)>Math.abs(fs)?"x":"y");let ps={x:0,y:0};ee==="y"?(Xr.includes("top")||Xr.includes("bottom"))&&(Xr.includes("top")&&fs<0||Xr.includes("bottom")&&fs>0)&&(ps.y=fs):ee==="x"&&(Xr.includes("left")||Xr.includes("right"))&&(Xr.includes("left")&&fi<0||Xr.includes("right")&&fi>0)&&(ps.x=fi),(Math.abs(ps.x)>0||Math.abs(ps.y)>0)&&B(!0),(Yr=se.current)==null||Yr.style.setProperty("--swipe-amount-x",`${ps.x}px`),(Qr=se.current)==null||Qr.style.setProperty("--swipe-amount-y",`${ps.y}px`)}},Lt&&!f.jsx?ue.createElement("button",{"aria-label":M,"data-disabled":Gn,"data-close-button":!0,onClick:Gn||!De?()=>{}:()=>{var ke;gr(),(ke=f.onDismiss)==null||ke.call(f,f)},className:Zr(F==null?void 0:F.closeButton,(s=f==null?void 0:f.classNames)==null?void 0:s.closeButton)},(i=Y==null?void 0:Y.close)!=null?i:tD):null,f.jsx||T.isValidElement(f.title)?f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title:ue.createElement(ue.Fragment,null,he||f.icon||f.promise?ue.createElement("div",{"data-icon":"",className:Zr(F==null?void 0:F.icon,(o=f==null?void 0:f.classNames)==null?void 0:o.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||bI():null,f.type!=="loading"?f.icon||(Y==null?void 0:Y[he])||qP(he):null):null,ue.createElement("div",{"data-content":"",className:Zr(F==null?void 0:F.content,(a=f==null?void 0:f.classNames)==null?void 0:a.content)},ue.createElement("div",{"data-title":"",className:Zr(F==null?void 0:F.title,(l=f==null?void 0:f.classNames)==null?void 0:l.title)},typeof f.title=="function"?f.title():f.title),f.description?ue.createElement("div",{"data-description":"",className:Zr(U,_t,F==null?void 0:F.description,(c=f==null?void 0:f.classNames)==null?void 0:c.description)},typeof f.description=="function"?f.description():f.description):null),T.isValidElement(f.cancel)?f.cancel:f.cancel&&Gc(f.cancel)?ue.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||L,onClick:ke=>{var We,st;Gc(f.cancel)&&De&&((st=(We=f.cancel).onClick)==null||st.call(We,ke),gr())},className:Zr(F==null?void 0:F.cancelButton,(u=f==null?void 0:f.classNames)==null?void 0:u.cancelButton)},f.cancel.label):null,T.isValidElement(f.action)?f.action:f.action&&Gc(f.action)?ue.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||$,onClick:ke=>{var We,st;Gc(f.action)&&((st=(We=f.action).onClick)==null||st.call(We,ke),!ke.defaultPrevented&&gr())},className:Zr(F==null?void 0:F.actionButton,(d=f==null?void 0:f.classNames)==null?void 0:d.actionButton)},f.action.label):null))};function Jv(){if(typeof window>"u"||typeof document>"u")return"ltr";let r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}function xD(r,e){let t={};return[r,e].forEach((n,s)=>{let i=s===1,o=i?"--mobile-offset":"--offset",a=i?hD:dD;function l(c){["top","right","bottom","left"].forEach(u=>{t[`${o}-${u}`]=typeof c=="number"?`${c}px`:c})}typeof n=="number"||typeof n=="string"?l(n):typeof n=="object"?["top","right","bottom","left"].forEach(c=>{n[c]===void 0?t[`${o}-${c}`]=a:t[`${o}-${c}`]=typeof n[c]=="number"?`${n[c]}px`:n[c]}):l(a)}),t}var wD=T.forwardRef(function(r,e){let{invert:t,position:n="bottom-right",hotkey:s=["altKey","KeyT"],expand:i,closeButton:o,className:a,offset:l,mobileOffset:c,theme:u="light",richColors:d,duration:h,style:f,visibleToasts:m=uD,toastOptions:p,dir:g=Jv(),gap:y=pD,loadingIcon:x,icons:w,containerAriaLabel:b="Notifications",pauseWhenPageIsHidden:E}=r,[I,S]=ue.useState([]),C=ue.useMemo(()=>Array.from(new Set([n].concat(I.filter(D=>D.position).map(D=>D.position)))),[I,n]),[R,L]=ue.useState([]),[$,P]=ue.useState(!1),[U,_]=ue.useState(!1),[H,V]=ue.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),G=ue.useRef(null),j=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),F=ue.useRef(null),Y=ue.useRef(!1),M=ue.useCallback(D=>{S(ee=>{var Q;return(Q=ee.find(te=>te.id===D.id))!=null&&Q.delete||or.dismiss(D.id),ee.filter(({id:te})=>te!==D.id)})},[]);return ue.useEffect(()=>or.subscribe(D=>{if(D.dismiss){S(ee=>ee.map(Q=>Q.id===D.id?{...Q,delete:!0}:Q));return}setTimeout(()=>{JE.flushSync(()=>{S(ee=>{let Q=ee.findIndex(te=>te.id===D.id);return Q!==-1?[...ee.slice(0,Q),{...ee[Q],...D},...ee.slice(Q+1)]:[D,...ee]})})})}),[]),ue.useEffect(()=>{if(u!=="system"){V(u);return}if(u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?V("dark"):V("light")),typeof window>"u")return;let D=window.matchMedia("(prefers-color-scheme: dark)");try{D.addEventListener("change",({matches:ee})=>{V(ee?"dark":"light")})}catch{D.addListener(({matches:Q})=>{try{V(Q?"dark":"light")}catch(te){console.error(te)}})}},[u]),ue.useEffect(()=>{I.length<=1&&P(!1)},[I]),ue.useEffect(()=>{let D=ee=>{var Q,te;s.every(oe=>ee[oe]||ee.code===oe)&&(P(!0),(Q=G.current)==null||Q.focus()),ee.code==="Escape"&&(document.activeElement===G.current||(te=G.current)!=null&&te.contains(document.activeElement))&&P(!1)};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[s]),ue.useEffect(()=>{if(G.current)return()=>{F.current&&(F.current.focus({preventScroll:!0}),F.current=null,Y.current=!1)}},[G.current]),ue.createElement("section",{ref:e,"aria-label":`${b} ${j}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},C.map((D,ee)=>{var Q;let[te,oe]=D.split("-");return I.length?ue.createElement("ol",{key:D,dir:g==="auto"?Jv():g,tabIndex:-1,ref:G,className:a,"data-sonner-toaster":!0,"data-theme":H,"data-y-position":te,"data-lifted":$&&I.length>1&&!i,"data-x-position":oe,style:{"--front-toast-height":`${((Q=R[0])==null?void 0:Q.height)||0}px`,"--width":`${fD}px`,"--gap":`${y}px`,...f,...xD(l,c)},onBlur:ce=>{Y.current&&!ce.currentTarget.contains(ce.relatedTarget)&&(Y.current=!1,F.current&&(F.current.focus({preventScroll:!0}),F.current=null))},onFocus:ce=>{ce.target instanceof HTMLElement&&ce.target.dataset.dismissible==="false"||Y.current||(Y.current=!0,F.current=ce.relatedTarget)},onMouseEnter:()=>P(!0),onMouseMove:()=>P(!0),onMouseLeave:()=>{U||P(!1)},onDragEnd:()=>P(!1),onPointerDown:ce=>{ce.target instanceof HTMLElement&&ce.target.dataset.dismissible==="false"||_(!0)},onPointerUp:()=>_(!1)},I.filter(ce=>!ce.position&&ee===0||ce.position===D).map((ce,de)=>{var we,Le;return ue.createElement(vD,{key:ce.id,icons:w,index:de,toast:ce,defaultRichColors:d,duration:(we=p==null?void 0:p.duration)!=null?we:h,className:p==null?void 0:p.className,descriptionClassName:p==null?void 0:p.descriptionClassName,invert:t,visibleToasts:m,closeButton:(Le=p==null?void 0:p.closeButton)!=null?Le:o,interacting:U,position:D,style:p==null?void 0:p.style,unstyled:p==null?void 0:p.unstyled,classNames:p==null?void 0:p.classNames,cancelButtonStyle:p==null?void 0:p.cancelButtonStyle,actionButtonStyle:p==null?void 0:p.actionButtonStyle,removeToast:M,toasts:I.filter(Re=>Re.position==ce.position),heights:R.filter(Re=>Re.position==ce.position),setHeights:L,expandByDefault:i,gap:y,loadingIcon:x,expanded:$,pauseWhenPageIsHidden:E,swipeDirections:r.swipeDirections})})):null}))});const bD=({...r})=>{const{theme:e="system"}=KP();return v.jsx(wD,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})};var SD=pg[" useId ".trim().toString()]||(()=>{}),ED=0;function ju(r){const[e,t]=T.useState(SD());return mn(()=>{t(n=>n??String(ED++))},[r]),r||(e?`radix-${e}`:"")}const TD=["top","right","bottom","left"],ni=Math.min,Sr=Math.max,Ed=Math.round,Hc=Math.floor,Mn=r=>({x:r,y:r}),_D={left:"right",right:"left",bottom:"top",top:"bottom"},AD={start:"end",end:"start"};function om(r,e,t){return Sr(r,ni(e,t))}function ls(r,e){return typeof r=="function"?r(e):r}function cs(r){return r.split("-")[0]}function Ca(r){return r.split("-")[1]}function y0(r){return r==="x"?"y":"x"}function v0(r){return r==="y"?"height":"width"}const kD=new Set(["top","bottom"]);function Ln(r){return kD.has(cs(r))?"y":"x"}function x0(r){return y0(Ln(r))}function ID(r,e,t){t===void 0&&(t=!1);const n=Ca(r),s=x0(r),i=v0(s);let o=s==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=Td(o)),[o,Td(o)]}function RD(r){const e=Td(r);return[am(r),e,am(e)]}function am(r){return r.replace(/start|end/g,e=>AD[e])}const Zv=["left","right"],ex=["right","left"],CD=["top","bottom"],LD=["bottom","top"];function PD(r,e,t){switch(r){case"top":case"bottom":return t?e?ex:Zv:e?Zv:ex;case"left":case"right":return e?CD:LD;default:return[]}}function DD(r,e,t,n){const s=Ca(r);let i=PD(cs(r),t==="start",n);return s&&(i=i.map(o=>o+"-"+s),e&&(i=i.concat(i.map(am)))),i}function Td(r){return r.replace(/left|right|bottom|top/g,e=>_D[e])}function OD(r){return{top:0,right:0,bottom:0,left:0,...r}}function HT(r){return typeof r!="number"?OD(r):{top:r,right:r,bottom:r,left:r}}function _d(r){const{x:e,y:t,width:n,height:s}=r;return{width:n,height:s,top:t,left:e,right:e+n,bottom:t+s,x:e,y:t}}function tx(r,e,t){let{reference:n,floating:s}=r;const i=Ln(e),o=x0(e),a=v0(o),l=cs(e),c=i==="y",u=n.x+n.width/2-s.width/2,d=n.y+n.height/2-s.height/2,h=n[a]/2-s[a]/2;let f;switch(l){case"top":f={x:u,y:n.y-s.height};break;case"bottom":f={x:u,y:n.y+n.height};break;case"right":f={x:n.x+n.width,y:d};break;case"left":f={x:n.x-s.width,y:d};break;default:f={x:n.x,y:n.y}}switch(Ca(e)){case"start":f[o]-=h*(t&&c?-1:1);break;case"end":f[o]+=h*(t&&c?-1:1);break}return f}const ND=async(r,e,t)=>{const{placement:n="bottom",strategy:s="absolute",middleware:i=[],platform:o}=t,a=i.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:r,floating:e,strategy:s}),{x:u,y:d}=tx(c,n,l),h=n,f={},m=0;for(let p=0;p<a.length;p++){const{name:g,fn:y}=a[p],{x,y:w,data:b,reset:E}=await y({x:u,y:d,initialPlacement:n,placement:h,strategy:s,middlewareData:f,rects:c,platform:o,elements:{reference:r,floating:e}});u=x??u,d=w??d,f={...f,[g]:{...f[g],...b}},E&&m<=50&&(m++,typeof E=="object"&&(E.placement&&(h=E.placement),E.rects&&(c=E.rects===!0?await o.getElementRects({reference:r,floating:e,strategy:s}):E.rects),{x:u,y:d}=tx(c,h,l)),p=-1)}return{x:u,y:d,placement:h,strategy:s,middlewareData:f}};async function Ml(r,e){var t;e===void 0&&(e={});const{x:n,y:s,platform:i,rects:o,elements:a,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=ls(e,r),m=HT(f),g=a[h?d==="floating"?"reference":"floating":d],y=_d(await i.getClippingRect({element:(t=await(i.isElement==null?void 0:i.isElement(g)))==null||t?g:g.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),x=d==="floating"?{x:n,y:s,width:o.floating.width,height:o.floating.height}:o.reference,w=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),b=await(i.isElement==null?void 0:i.isElement(w))?await(i.getScale==null?void 0:i.getScale(w))||{x:1,y:1}:{x:1,y:1},E=_d(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:x,offsetParent:w,strategy:l}):x);return{top:(y.top-E.top+m.top)/b.y,bottom:(E.bottom-y.bottom+m.bottom)/b.y,left:(y.left-E.left+m.left)/b.x,right:(E.right-y.right+m.right)/b.x}}const MD=r=>({name:"arrow",options:r,async fn(e){const{x:t,y:n,placement:s,rects:i,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=ls(r,e)||{};if(c==null)return{};const d=HT(u),h={x:t,y:n},f=x0(s),m=v0(f),p=await o.getDimensions(c),g=f==="y",y=g?"top":"left",x=g?"bottom":"right",w=g?"clientHeight":"clientWidth",b=i.reference[m]+i.reference[f]-h[f]-i.floating[m],E=h[f]-i.reference[f],I=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let S=I?I[w]:0;(!S||!await(o.isElement==null?void 0:o.isElement(I)))&&(S=a.floating[w]||i.floating[m]);const C=b/2-E/2,R=S/2-p[m]/2-1,L=ni(d[y],R),$=ni(d[x],R),P=L,U=S-p[m]-$,_=S/2-p[m]/2+C,H=om(P,_,U),V=!l.arrow&&Ca(s)!=null&&_!==H&&i.reference[m]/2-(_<P?L:$)-p[m]/2<0,G=V?_<P?_-P:_-U:0;return{[f]:h[f]+G,data:{[f]:H,centerOffset:_-H-G,...V&&{alignmentOffset:G}},reset:V}}}),FD=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,n;const{placement:s,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...g}=ls(r,e);if((t=i.arrow)!=null&&t.alignmentOffset)return{};const y=cs(s),x=Ln(a),w=cs(a)===a,b=await(l.isRTL==null?void 0:l.isRTL(c.floating)),E=h||(w||!p?[Td(a)]:RD(a)),I=m!=="none";!h&&I&&E.push(...DD(a,p,m,b));const S=[a,...E],C=await Ml(e,g),R=[];let L=((n=i.flip)==null?void 0:n.overflows)||[];if(u&&R.push(C[y]),d){const _=ID(s,o,b);R.push(C[_[0]],C[_[1]])}if(L=[...L,{placement:s,overflows:R}],!R.every(_=>_<=0)){var $,P;const _=((($=i.flip)==null?void 0:$.index)||0)+1,H=S[_];if(H&&(!(d==="alignment"?x!==Ln(H):!1)||L.every(j=>j.overflows[0]>0&&Ln(j.placement)===x)))return{data:{index:_,overflows:L},reset:{placement:H}};let V=(P=L.filter(G=>G.overflows[0]<=0).sort((G,j)=>G.overflows[1]-j.overflows[1])[0])==null?void 0:P.placement;if(!V)switch(f){case"bestFit":{var U;const G=(U=L.filter(j=>{if(I){const F=Ln(j.placement);return F===x||F==="y"}return!0}).map(j=>[j.placement,j.overflows.filter(F=>F>0).reduce((F,Y)=>F+Y,0)]).sort((j,F)=>j[1]-F[1])[0])==null?void 0:U[0];G&&(V=G);break}case"initialPlacement":V=a;break}if(s!==V)return{reset:{placement:V}}}return{}}}};function rx(r,e){return{top:r.top-e.height,right:r.right-e.width,bottom:r.bottom-e.height,left:r.left-e.width}}function nx(r){return TD.some(e=>r[e]>=0)}const jD=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...s}=ls(r,e);switch(n){case"referenceHidden":{const i=await Ml(e,{...s,elementContext:"reference"}),o=rx(i,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:nx(o)}}}case"escaped":{const i=await Ml(e,{...s,altBoundary:!0}),o=rx(i,t.floating);return{data:{escapedOffsets:o,escaped:nx(o)}}}default:return{}}}}},VT=new Set(["left","top"]);async function $D(r,e){const{placement:t,platform:n,elements:s}=r,i=await(n.isRTL==null?void 0:n.isRTL(s.floating)),o=cs(t),a=Ca(t),l=Ln(t)==="y",c=VT.has(o)?-1:1,u=i&&l?-1:1,d=ls(e,r);let{mainAxis:h,crossAxis:f,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof m=="number"&&(f=a==="end"?m*-1:m),l?{x:f*u,y:h*c}:{x:h*c,y:f*u}}const BD=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,n;const{x:s,y:i,placement:o,middlewareData:a}=e,l=await $D(e,r);return o===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:s+l.x,y:i+l.y,data:{...l,placement:o}}}}},UD=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:n,placement:s}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:y,y:x}=g;return{x:y,y:x}}},...l}=ls(r,e),c={x:t,y:n},u=await Ml(e,l),d=Ln(cs(s)),h=y0(d);let f=c[h],m=c[d];if(i){const g=h==="y"?"top":"left",y=h==="y"?"bottom":"right",x=f+u[g],w=f-u[y];f=om(x,f,w)}if(o){const g=d==="y"?"top":"left",y=d==="y"?"bottom":"right",x=m+u[g],w=m-u[y];m=om(x,m,w)}const p=a.fn({...e,[h]:f,[d]:m});return{...p,data:{x:p.x-t,y:p.y-n,enabled:{[h]:i,[d]:o}}}}}},zD=function(r){return r===void 0&&(r={}),{options:r,fn(e){const{x:t,y:n,placement:s,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=ls(r,e),u={x:t,y:n},d=Ln(s),h=y0(d);let f=u[h],m=u[d];const p=ls(a,e),g=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(l){const w=h==="y"?"height":"width",b=i.reference[h]-i.floating[w]+g.mainAxis,E=i.reference[h]+i.reference[w]-g.mainAxis;f<b?f=b:f>E&&(f=E)}if(c){var y,x;const w=h==="y"?"width":"height",b=VT.has(cs(s)),E=i.reference[d]-i.floating[w]+(b&&((y=o.offset)==null?void 0:y[d])||0)+(b?0:g.crossAxis),I=i.reference[d]+i.reference[w]+(b?0:((x=o.offset)==null?void 0:x[d])||0)-(b?g.crossAxis:0);m<E?m=E:m>I&&(m=I)}return{[h]:f,[d]:m}}}},GD=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){var t,n;const{placement:s,rects:i,platform:o,elements:a}=e,{apply:l=()=>{},...c}=ls(r,e),u=await Ml(e,c),d=cs(s),h=Ca(s),f=Ln(s)==="y",{width:m,height:p}=i.floating;let g,y;d==="top"||d==="bottom"?(g=d,y=h===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(y=d,g=h==="end"?"top":"bottom");const x=p-u.top-u.bottom,w=m-u.left-u.right,b=ni(p-u[g],x),E=ni(m-u[y],w),I=!e.middlewareData.shift;let S=b,C=E;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(C=w),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(S=x),I&&!h){const L=Sr(u.left,0),$=Sr(u.right,0),P=Sr(u.top,0),U=Sr(u.bottom,0);f?C=m-2*(L!==0||$!==0?L+$:Sr(u.left,u.right)):S=p-2*(P!==0||U!==0?P+U:Sr(u.top,u.bottom))}await l({...e,availableWidth:C,availableHeight:S});const R=await o.getDimensions(a.floating);return m!==R.width||p!==R.height?{reset:{rects:!0}}:{}}}};function mh(){return typeof window<"u"}function La(r){return WT(r)?(r.nodeName||"").toLowerCase():"#document"}function Ir(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function Un(r){var e;return(e=(WT(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function WT(r){return mh()?r instanceof Node||r instanceof Ir(r).Node:!1}function gn(r){return mh()?r instanceof Element||r instanceof Ir(r).Element:!1}function Fn(r){return mh()?r instanceof HTMLElement||r instanceof Ir(r).HTMLElement:!1}function sx(r){return!mh()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Ir(r).ShadowRoot}const HD=new Set(["inline","contents"]);function dc(r){const{overflow:e,overflowX:t,overflowY:n,display:s}=yn(r);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!HD.has(s)}const VD=new Set(["table","td","th"]);function WD(r){return VD.has(La(r))}const KD=[":popover-open",":modal"];function gh(r){return KD.some(e=>{try{return r.matches(e)}catch{return!1}})}const qD=["transform","translate","scale","rotate","perspective"],YD=["transform","translate","scale","rotate","perspective","filter"],QD=["paint","layout","strict","content"];function w0(r){const e=b0(),t=gn(r)?yn(r):r;return qD.some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||YD.some(n=>(t.willChange||"").includes(n))||QD.some(n=>(t.contain||"").includes(n))}function XD(r){let e=si(r);for(;Fn(e)&&!xa(e);){if(w0(e))return e;if(gh(e))return null;e=si(e)}return null}function b0(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const JD=new Set(["html","body","#document"]);function xa(r){return JD.has(La(r))}function yn(r){return Ir(r).getComputedStyle(r)}function yh(r){return gn(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function si(r){if(La(r)==="html")return r;const e=r.assignedSlot||r.parentNode||sx(r)&&r.host||Un(r);return sx(e)?e.host:e}function KT(r){const e=si(r);return xa(e)?r.ownerDocument?r.ownerDocument.body:r.body:Fn(e)&&dc(e)?e:KT(e)}function Fl(r,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=KT(r),i=s===((n=r.ownerDocument)==null?void 0:n.body),o=Ir(s);if(i){const a=lm(o);return e.concat(o,o.visualViewport||[],dc(s)?s:[],a&&t?Fl(a):[])}return e.concat(s,Fl(s,[],t))}function lm(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function qT(r){const e=yn(r);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=Fn(r),i=s?r.offsetWidth:t,o=s?r.offsetHeight:n,a=Ed(t)!==i||Ed(n)!==o;return a&&(t=i,n=o),{width:t,height:n,$:a}}function S0(r){return gn(r)?r:r.contextElement}function Ko(r){const e=S0(r);if(!Fn(e))return Mn(1);const t=e.getBoundingClientRect(),{width:n,height:s,$:i}=qT(e);let o=(i?Ed(t.width):t.width)/n,a=(i?Ed(t.height):t.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const ZD=Mn(0);function YT(r){const e=Ir(r);return!b0()||!e.visualViewport?ZD:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function eO(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==Ir(r)?!1:e}function qi(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=r.getBoundingClientRect(),i=S0(r);let o=Mn(1);e&&(n?gn(n)&&(o=Ko(n)):o=Ko(r));const a=eO(i,t,n)?YT(i):Mn(0);let l=(s.left+a.x)/o.x,c=(s.top+a.y)/o.y,u=s.width/o.x,d=s.height/o.y;if(i){const h=Ir(i),f=n&&gn(n)?Ir(n):n;let m=h,p=lm(m);for(;p&&n&&f!==m;){const g=Ko(p),y=p.getBoundingClientRect(),x=yn(p),w=y.left+(p.clientLeft+parseFloat(x.paddingLeft))*g.x,b=y.top+(p.clientTop+parseFloat(x.paddingTop))*g.y;l*=g.x,c*=g.y,u*=g.x,d*=g.y,l+=w,c+=b,m=Ir(p),p=lm(m)}}return _d({width:u,height:d,x:l,y:c})}function E0(r,e){const t=yh(r).scrollLeft;return e?e.left+t:qi(Un(r)).left+t}function QT(r,e,t){t===void 0&&(t=!1);const n=r.getBoundingClientRect(),s=n.left+e.scrollLeft-(t?0:E0(r,n)),i=n.top+e.scrollTop;return{x:s,y:i}}function tO(r){let{elements:e,rect:t,offsetParent:n,strategy:s}=r;const i=s==="fixed",o=Un(n),a=e?gh(e.floating):!1;if(n===o||a&&i)return t;let l={scrollLeft:0,scrollTop:0},c=Mn(1);const u=Mn(0),d=Fn(n);if((d||!d&&!i)&&((La(n)!=="body"||dc(o))&&(l=yh(n)),Fn(n))){const f=qi(n);c=Ko(n),u.x=f.x+n.clientLeft,u.y=f.y+n.clientTop}const h=o&&!d&&!i?QT(o,l,!0):Mn(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:t.y*c.y-l.scrollTop*c.y+u.y+h.y}}function rO(r){return Array.from(r.getClientRects())}function nO(r){const e=Un(r),t=yh(r),n=r.ownerDocument.body,s=Sr(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),i=Sr(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-t.scrollLeft+E0(r);const a=-t.scrollTop;return yn(n).direction==="rtl"&&(o+=Sr(e.clientWidth,n.clientWidth)-s),{width:s,height:i,x:o,y:a}}function sO(r,e){const t=Ir(r),n=Un(r),s=t.visualViewport;let i=n.clientWidth,o=n.clientHeight,a=0,l=0;if(s){i=s.width,o=s.height;const c=b0();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:i,height:o,x:a,y:l}}const iO=new Set(["absolute","fixed"]);function oO(r,e){const t=qi(r,!0,e==="fixed"),n=t.top+r.clientTop,s=t.left+r.clientLeft,i=Fn(r)?Ko(r):Mn(1),o=r.clientWidth*i.x,a=r.clientHeight*i.y,l=s*i.x,c=n*i.y;return{width:o,height:a,x:l,y:c}}function ix(r,e,t){let n;if(e==="viewport")n=sO(r,t);else if(e==="document")n=nO(Un(r));else if(gn(e))n=oO(e,t);else{const s=YT(r);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return _d(n)}function XT(r,e){const t=si(r);return t===e||!gn(t)||xa(t)?!1:yn(t).position==="fixed"||XT(t,e)}function aO(r,e){const t=e.get(r);if(t)return t;let n=Fl(r,[],!1).filter(a=>gn(a)&&La(a)!=="body"),s=null;const i=yn(r).position==="fixed";let o=i?si(r):r;for(;gn(o)&&!xa(o);){const a=yn(o),l=w0(o);!l&&a.position==="fixed"&&(s=null),(i?!l&&!s:!l&&a.position==="static"&&!!s&&iO.has(s.position)||dc(o)&&!l&&XT(r,o))?n=n.filter(u=>u!==o):s=a,o=si(o)}return e.set(r,n),n}function lO(r){let{element:e,boundary:t,rootBoundary:n,strategy:s}=r;const o=[...t==="clippingAncestors"?gh(e)?[]:aO(e,this._c):[].concat(t),n],a=o[0],l=o.reduce((c,u)=>{const d=ix(e,u,s);return c.top=Sr(d.top,c.top),c.right=ni(d.right,c.right),c.bottom=ni(d.bottom,c.bottom),c.left=Sr(d.left,c.left),c},ix(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function cO(r){const{width:e,height:t}=qT(r);return{width:e,height:t}}function uO(r,e,t){const n=Fn(e),s=Un(e),i=t==="fixed",o=qi(r,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=Mn(0);function c(){l.x=E0(s)}if(n||!n&&!i)if((La(e)!=="body"||dc(s))&&(a=yh(e)),n){const f=qi(e,!0,i,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else s&&c();i&&!n&&s&&c();const u=s&&!n&&!i?QT(s,a):Mn(0),d=o.left+a.scrollLeft-l.x-u.x,h=o.top+a.scrollTop-l.y-u.y;return{x:d,y:h,width:o.width,height:o.height}}function mf(r){return yn(r).position==="static"}function ox(r,e){if(!Fn(r)||yn(r).position==="fixed")return null;if(e)return e(r);let t=r.offsetParent;return Un(r)===t&&(t=t.ownerDocument.body),t}function JT(r,e){const t=Ir(r);if(gh(r))return t;if(!Fn(r)){let s=si(r);for(;s&&!xa(s);){if(gn(s)&&!mf(s))return s;s=si(s)}return t}let n=ox(r,e);for(;n&&WD(n)&&mf(n);)n=ox(n,e);return n&&xa(n)&&mf(n)&&!w0(n)?t:n||XD(r)||t}const dO=async function(r){const e=this.getOffsetParent||JT,t=this.getDimensions,n=await t(r.floating);return{reference:uO(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function hO(r){return yn(r).direction==="rtl"}const fO={convertOffsetParentRelativeRectToViewportRelativeRect:tO,getDocumentElement:Un,getClippingRect:lO,getOffsetParent:JT,getElementRects:dO,getClientRects:rO,getDimensions:cO,getScale:Ko,isElement:gn,isRTL:hO};function ZT(r,e){return r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}function pO(r,e){let t=null,n;const s=Un(r);function i(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const c=r.getBoundingClientRect(),{left:u,top:d,width:h,height:f}=c;if(a||e(),!h||!f)return;const m=Hc(d),p=Hc(s.clientWidth-(u+h)),g=Hc(s.clientHeight-(d+f)),y=Hc(u),w={rootMargin:-m+"px "+-p+"px "+-g+"px "+-y+"px",threshold:Sr(0,ni(1,l))||1};let b=!0;function E(I){const S=I[0].intersectionRatio;if(S!==l){if(!b)return o();S?o(!1,S):n=setTimeout(()=>{o(!1,1e-7)},1e3)}S===1&&!ZT(c,r.getBoundingClientRect())&&o(),b=!1}try{t=new IntersectionObserver(E,{...w,root:s.ownerDocument})}catch{t=new IntersectionObserver(E,w)}t.observe(r)}return o(!0),i}function mO(r,e,t,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=S0(r),u=s||i?[...c?Fl(c):[],...Fl(e)]:[];u.forEach(y=>{s&&y.addEventListener("scroll",t,{passive:!0}),i&&y.addEventListener("resize",t)});const d=c&&a?pO(c,t):null;let h=-1,f=null;o&&(f=new ResizeObserver(y=>{let[x]=y;x&&x.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var w;(w=f)==null||w.observe(e)})),t()}),c&&!l&&f.observe(c),f.observe(e));let m,p=l?qi(r):null;l&&g();function g(){const y=qi(r);p&&!ZT(p,y)&&t(),p=y,m=requestAnimationFrame(g)}return t(),()=>{var y;u.forEach(x=>{s&&x.removeEventListener("scroll",t),i&&x.removeEventListener("resize",t)}),d==null||d(),(y=f)==null||y.disconnect(),f=null,l&&cancelAnimationFrame(m)}}const gO=BD,yO=UD,vO=FD,xO=GD,wO=jD,ax=MD,bO=zD,SO=(r,e,t)=>{const n=new Map,s={platform:fO,...t},i={...s.platform,_c:n};return ND(r,e,{...s,platform:i})};var EO=typeof document<"u",TO=function(){},$u=EO?T.useLayoutEffect:TO;function Ad(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="function"&&r.toString()===e.toString())return!0;let t,n,s;if(r&&e&&typeof r=="object"){if(Array.isArray(r)){if(t=r.length,t!==e.length)return!1;for(n=t;n--!==0;)if(!Ad(r[n],e[n]))return!1;return!0}if(s=Object.keys(r),t=s.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!{}.hasOwnProperty.call(e,s[n]))return!1;for(n=t;n--!==0;){const i=s[n];if(!(i==="_owner"&&r.$$typeof)&&!Ad(r[i],e[i]))return!1}return!0}return r!==r&&e!==e}function e_(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function lx(r,e){const t=e_(r);return Math.round(e*t)/t}function gf(r){const e=T.useRef(r);return $u(()=>{e.current=r}),e}function _O(r){r===void 0&&(r={});const{placement:e="bottom",strategy:t="absolute",middleware:n=[],platform:s,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=r,[u,d]=T.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=T.useState(n);Ad(h,n)||f(n);const[m,p]=T.useState(null),[g,y]=T.useState(null),x=T.useCallback(j=>{j!==I.current&&(I.current=j,p(j))},[]),w=T.useCallback(j=>{j!==S.current&&(S.current=j,y(j))},[]),b=i||m,E=o||g,I=T.useRef(null),S=T.useRef(null),C=T.useRef(u),R=l!=null,L=gf(l),$=gf(s),P=gf(c),U=T.useCallback(()=>{if(!I.current||!S.current)return;const j={placement:e,strategy:t,middleware:h};$.current&&(j.platform=$.current),SO(I.current,S.current,j).then(F=>{const Y={...F,isPositioned:P.current!==!1};_.current&&!Ad(C.current,Y)&&(C.current=Y,cc.flushSync(()=>{d(Y)}))})},[h,e,t,$,P]);$u(()=>{c===!1&&C.current.isPositioned&&(C.current.isPositioned=!1,d(j=>({...j,isPositioned:!1})))},[c]);const _=T.useRef(!1);$u(()=>(_.current=!0,()=>{_.current=!1}),[]),$u(()=>{if(b&&(I.current=b),E&&(S.current=E),b&&E){if(L.current)return L.current(b,E,U);U()}},[b,E,U,L,R]);const H=T.useMemo(()=>({reference:I,floating:S,setReference:x,setFloating:w}),[x,w]),V=T.useMemo(()=>({reference:b,floating:E}),[b,E]),G=T.useMemo(()=>{const j={position:t,left:0,top:0};if(!V.floating)return j;const F=lx(V.floating,u.x),Y=lx(V.floating,u.y);return a?{...j,transform:"translate("+F+"px, "+Y+"px)",...e_(V.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:F,top:Y}},[t,a,V.floating,u.x,u.y]);return T.useMemo(()=>({...u,update:U,refs:H,elements:V,floatingStyles:G}),[u,U,H,V,G])}const AO=r=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:r,fn(t){const{element:n,padding:s}=typeof r=="function"?r(t):r;return n&&e(n)?n.current!=null?ax({element:n.current,padding:s}).fn(t):{}:n?ax({element:n,padding:s}).fn(t):{}}}},kO=(r,e)=>({...gO(r),options:[r,e]}),IO=(r,e)=>({...yO(r),options:[r,e]}),RO=(r,e)=>({...bO(r),options:[r,e]}),CO=(r,e)=>({...vO(r),options:[r,e]}),LO=(r,e)=>({...xO(r),options:[r,e]}),PO=(r,e)=>({...wO(r),options:[r,e]}),DO=(r,e)=>({...AO(r),options:[r,e]});var OO="Arrow",t_=T.forwardRef((r,e)=>{const{children:t,width:n=10,height:s=5,...i}=r;return v.jsx(qe.svg,{...i,ref:e,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?t:v.jsx("polygon",{points:"0,0 30,0 15,10"})})});t_.displayName=OO;var NO=t_;function MO(r){const[e,t]=T.useState(void 0);return mn(()=>{if(r){t({width:r.offsetWidth,height:r.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const i=s[0];let o,a;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=r.offsetWidth,a=r.offsetHeight;t({width:o,height:a})});return n.observe(r,{box:"border-box"}),()=>n.unobserve(r)}else t(void 0)},[r]),e}var r_="Popper",[n_,s_]=eo(r_),[X8,i_]=n_(r_),o_="PopperAnchor",a_=T.forwardRef((r,e)=>{const{__scopePopper:t,virtualRef:n,...s}=r,i=i_(o_,t),o=T.useRef(null),a=vt(e,o);return T.useEffect(()=>{i.onAnchorChange((n==null?void 0:n.current)||o.current)}),n?null:v.jsx(qe.div,{...s,ref:a})});a_.displayName=o_;var T0="PopperContent",[FO,jO]=n_(T0),l_=T.forwardRef((r,e)=>{var ce,de,we,Le,Re,ft;const{__scopePopper:t,side:n="bottom",sideOffset:s=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:f="optimized",onPlaced:m,...p}=r,g=i_(T0,t),[y,x]=T.useState(null),w=vt(e,Xe=>x(Xe)),[b,E]=T.useState(null),I=MO(b),S=(I==null?void 0:I.width)??0,C=(I==null?void 0:I.height)??0,R=n+(i!=="center"?"-"+i:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},$=Array.isArray(c)?c:[c],P=$.length>0,U={padding:L,boundary:$.filter(BO),altBoundary:P},{refs:_,floatingStyles:H,placement:V,isPositioned:G,middlewareData:j}=_O({strategy:"fixed",placement:R,whileElementsMounted:(...Xe)=>mO(...Xe,{animationFrame:f==="always"}),elements:{reference:g.anchor},middleware:[kO({mainAxis:s+C,alignmentAxis:o}),l&&IO({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?RO():void 0,...U}),l&&CO({...U}),LO({...U,apply:({elements:Xe,rects:k,availableWidth:z,availableHeight:B})=>{const{width:N,height:O}=k.reference,W=Xe.floating.style;W.setProperty("--radix-popper-available-width",`${z}px`),W.setProperty("--radix-popper-available-height",`${B}px`),W.setProperty("--radix-popper-anchor-width",`${N}px`),W.setProperty("--radix-popper-anchor-height",`${O}px`)}}),b&&DO({element:b,padding:a}),UO({arrowWidth:S,arrowHeight:C}),h&&PO({strategy:"referenceHidden",...U})]}),[F,Y]=d_(V),M=Bt(m);mn(()=>{G&&(M==null||M())},[G,M]);const D=(ce=j.arrow)==null?void 0:ce.x,ee=(de=j.arrow)==null?void 0:de.y,Q=((we=j.arrow)==null?void 0:we.centerOffset)!==0,[te,oe]=T.useState();return mn(()=>{y&&oe(window.getComputedStyle(y).zIndex)},[y]),v.jsx("div",{ref:_.setFloating,"data-radix-popper-content-wrapper":"",style:{...H,transform:G?H.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:te,"--radix-popper-transform-origin":[(Le=j.transformOrigin)==null?void 0:Le.x,(Re=j.transformOrigin)==null?void 0:Re.y].join(" "),...((ft=j.hide)==null?void 0:ft.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:v.jsx(FO,{scope:t,placedSide:F,onArrowChange:E,arrowX:D,arrowY:ee,shouldHideArrow:Q,children:v.jsx(qe.div,{"data-side":F,"data-align":Y,...p,ref:w,style:{...p.style,animation:G?void 0:"none"}})})})});l_.displayName=T0;var c_="PopperArrow",$O={top:"bottom",right:"left",bottom:"top",left:"right"},u_=T.forwardRef(function(e,t){const{__scopePopper:n,...s}=e,i=jO(c_,n),o=$O[i.placedSide];return v.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:v.jsx(NO,{...s,ref:t,style:{...s.style,display:"block"}})})});u_.displayName=c_;function BO(r){return r!==null}var UO=r=>({name:"transformOrigin",options:r,fn(e){var g,y,x;const{placement:t,rects:n,middlewareData:s}=e,o=((g=s.arrow)==null?void 0:g.centerOffset)!==0,a=o?0:r.arrowWidth,l=o?0:r.arrowHeight,[c,u]=d_(t),d={start:"0%",center:"50%",end:"100%"}[u],h=(((y=s.arrow)==null?void 0:y.x)??0)+a/2,f=(((x=s.arrow)==null?void 0:x.y)??0)+l/2;let m="",p="";return c==="bottom"?(m=o?d:`${h}px`,p=`${-l}px`):c==="top"?(m=o?d:`${h}px`,p=`${n.floating.height+l}px`):c==="right"?(m=`${-l}px`,p=o?d:`${f}px`):c==="left"&&(m=`${n.floating.width+l}px`,p=o?d:`${f}px`),{data:{x:m,y:p}}}});function d_(r){const[e,t="center"]=r.split("-");return[e,t]}var zO=a_,GO=l_,HO=u_,[vh]=eo("Tooltip",[s_]),_0=s_(),h_="TooltipProvider",VO=700,cx="tooltip.open",[WO,f_]=vh(h_),p_=r=>{const{__scopeTooltip:e,delayDuration:t=VO,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:i}=r,o=T.useRef(!0),a=T.useRef(!1),l=T.useRef(0);return T.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),v.jsx(WO,{scope:e,isOpenDelayedRef:o,delayDuration:t,onOpen:T.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:T.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,n)},[n]),isPointerInTransitRef:a,onPointerInTransitChange:T.useCallback(c=>{a.current=c},[]),disableHoverableContent:s,children:i})};p_.displayName=h_;var m_="Tooltip",[J8,xh]=vh(m_),cm="TooltipTrigger",KO=T.forwardRef((r,e)=>{const{__scopeTooltip:t,...n}=r,s=xh(cm,t),i=f_(cm,t),o=_0(t),a=T.useRef(null),l=vt(e,a,s.onTriggerChange),c=T.useRef(!1),u=T.useRef(!1),d=T.useCallback(()=>c.current=!1,[]);return T.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),v.jsx(zO,{asChild:!0,...o,children:v.jsx(qe.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:l,onPointerMove:Ue(r.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!i.isPointerInTransitRef.current&&(s.onTriggerEnter(),u.current=!0)}),onPointerLeave:Ue(r.onPointerLeave,()=>{s.onTriggerLeave(),u.current=!1}),onPointerDown:Ue(r.onPointerDown,()=>{s.open&&s.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Ue(r.onFocus,()=>{c.current||s.onOpen()}),onBlur:Ue(r.onBlur,s.onClose),onClick:Ue(r.onClick,s.onClose)})})});KO.displayName=cm;var qO="TooltipPortal",[Z8,YO]=vh(qO,{forceMount:void 0}),wa="TooltipContent",g_=T.forwardRef((r,e)=>{const t=YO(wa,r.__scopeTooltip),{forceMount:n=t.forceMount,side:s="top",...i}=r,o=xh(wa,r.__scopeTooltip);return v.jsx(vn,{present:n||o.open,children:o.disableHoverableContent?v.jsx(y_,{side:s,...i,ref:e}):v.jsx(QO,{side:s,...i,ref:e})})}),QO=T.forwardRef((r,e)=>{const t=xh(wa,r.__scopeTooltip),n=f_(wa,r.__scopeTooltip),s=T.useRef(null),i=vt(e,s),[o,a]=T.useState(null),{trigger:l,onClose:c}=t,u=s.current,{onPointerInTransitChange:d}=n,h=T.useCallback(()=>{a(null),d(!1)},[d]),f=T.useCallback((m,p)=>{const g=m.currentTarget,y={x:m.clientX,y:m.clientY},x=tN(y,g.getBoundingClientRect()),w=rN(y,x),b=nN(p.getBoundingClientRect()),E=iN([...w,...b]);a(E),d(!0)},[d]);return T.useEffect(()=>()=>h(),[h]),T.useEffect(()=>{if(l&&u){const m=g=>f(g,u),p=g=>f(g,l);return l.addEventListener("pointerleave",m),u.addEventListener("pointerleave",p),()=>{l.removeEventListener("pointerleave",m),u.removeEventListener("pointerleave",p)}}},[l,u,f,h]),T.useEffect(()=>{if(o){const m=p=>{const g=p.target,y={x:p.clientX,y:p.clientY},x=(l==null?void 0:l.contains(g))||(u==null?void 0:u.contains(g)),w=!sN(y,o);x?h():w&&(h(),c())};return document.addEventListener("pointermove",m),()=>document.removeEventListener("pointermove",m)}},[l,u,o,c,h]),v.jsx(y_,{...r,ref:i})}),[XO,JO]=vh(m_,{isInside:!1}),ZO=sL("TooltipContent"),y_=T.forwardRef((r,e)=>{const{__scopeTooltip:t,children:n,"aria-label":s,onEscapeKeyDown:i,onPointerDownOutside:o,...a}=r,l=xh(wa,t),c=_0(t),{onClose:u}=l;return T.useEffect(()=>(document.addEventListener(cx,u),()=>document.removeEventListener(cx,u)),[u]),T.useEffect(()=>{if(l.trigger){const d=h=>{const f=h.target;f!=null&&f.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),v.jsx(ch,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:v.jsxs(GO,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[v.jsx(ZO,{children:n}),v.jsx(XO,{scope:t,isInside:!0,children:v.jsx(IL,{id:l.contentId,role:"tooltip",children:s||n})})]})})});g_.displayName=wa;var v_="TooltipArrow",eN=T.forwardRef((r,e)=>{const{__scopeTooltip:t,...n}=r,s=_0(t);return JO(v_,t).isInside?null:v.jsx(HO,{...s,...n,ref:e})});eN.displayName=v_;function tN(r,e){const t=Math.abs(e.top-r.y),n=Math.abs(e.bottom-r.y),s=Math.abs(e.right-r.x),i=Math.abs(e.left-r.x);switch(Math.min(t,n,s,i)){case i:return"left";case s:return"right";case t:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function rN(r,e,t=5){const n=[];switch(e){case"top":n.push({x:r.x-t,y:r.y+t},{x:r.x+t,y:r.y+t});break;case"bottom":n.push({x:r.x-t,y:r.y-t},{x:r.x+t,y:r.y-t});break;case"left":n.push({x:r.x+t,y:r.y-t},{x:r.x+t,y:r.y+t});break;case"right":n.push({x:r.x-t,y:r.y-t},{x:r.x-t,y:r.y+t});break}return n}function nN(r){const{top:e,right:t,bottom:n,left:s}=r;return[{x:s,y:e},{x:t,y:e},{x:t,y:n},{x:s,y:n}]}function sN(r,e){const{x:t,y:n}=r;let s=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i],l=e[o],c=a.x,u=a.y,d=l.x,h=l.y;u>n!=h>n&&t<(d-c)*(n-u)/(h-u)+c&&(s=!s)}return s}function iN(r){const e=r.slice();return e.sort((t,n)=>t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0),oN(e)}function oN(r){if(r.length<=1)return r.slice();const e=[];for(let n=0;n<r.length;n++){const s=r[n];for(;e.length>=2;){const i=e[e.length-1],o=e[e.length-2];if((i.x-o.x)*(s.y-o.y)>=(i.y-o.y)*(s.x-o.x))e.pop();else break}e.push(s)}e.pop();const t=[];for(let n=r.length-1;n>=0;n--){const s=r[n];for(;t.length>=2;){const i=t[t.length-1],o=t[t.length-2];if((i.x-o.x)*(s.y-o.y)>=(i.y-o.y)*(s.x-o.x))t.pop();else break}t.push(s)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var aN=p_,x_=g_;const lN=aN,cN=T.forwardRef(({className:r,sideOffset:e=4,...t},n)=>v.jsx(x_,{ref:n,sideOffset:e,className:Te("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t}));cN.displayName=x_.displayName;var hc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Yi=typeof window>"u"||"Deno"in globalThis;function ar(){}function uN(r,e){return typeof r=="function"?r(e):r}function um(r){return typeof r=="number"&&r>=0&&r!==1/0}function w_(r,e){return Math.max(r+(e||0)-Date.now(),0)}function Qs(r,e){return typeof r=="function"?r(e):r}function Nr(r,e){return typeof r=="function"?r(e):r}function ux(r,e){const{type:t="all",exact:n,fetchStatus:s,predicate:i,queryKey:o,stale:a}=r;if(o){if(n){if(e.queryHash!==A0(o,e.options))return!1}else if(!$l(e.queryKey,o))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||s&&s!==e.state.fetchStatus||i&&!i(e))}function dx(r,e){const{exact:t,status:n,predicate:s,mutationKey:i}=r;if(i){if(!e.options.mutationKey)return!1;if(t){if(jl(e.options.mutationKey)!==jl(i))return!1}else if(!$l(e.options.mutationKey,i))return!1}return!(n&&e.state.status!==n||s&&!s(e))}function A0(r,e){return((e==null?void 0:e.queryKeyHashFn)||jl)(r)}function jl(r){return JSON.stringify(r,(e,t)=>hm(t)?Object.keys(t).sort().reduce((n,s)=>(n[s]=t[s],n),{}):t)}function $l(r,e){return r===e?!0:typeof r!=typeof e?!1:r&&e&&typeof r=="object"&&typeof e=="object"?Object.keys(e).every(t=>$l(r[t],e[t])):!1}function b_(r,e){if(r===e)return r;const t=hx(r)&&hx(e);if(t||hm(r)&&hm(e)){const n=t?r:Object.keys(r),s=n.length,i=t?e:Object.keys(e),o=i.length,a=t?[]:{},l=new Set(n);let c=0;for(let u=0;u<o;u++){const d=t?u:i[u];(!t&&l.has(d)||t)&&r[d]===void 0&&e[d]===void 0?(a[d]=void 0,c++):(a[d]=b_(r[d],e[d]),a[d]===r[d]&&r[d]!==void 0&&c++)}return s===o&&c===s?r:a}return e}function dm(r,e){if(!e||Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(r[t]!==e[t])return!1;return!0}function hx(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function hm(r){if(!fx(r))return!1;const e=r.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!fx(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function fx(r){return Object.prototype.toString.call(r)==="[object Object]"}function dN(r){return new Promise(e=>{setTimeout(e,r)})}function fm(r,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(r,e):t.structuralSharing!==!1?b_(r,e):e}function hN(r,e,t=0){const n=[...r,e];return t&&n.length>t?n.slice(1):n}function fN(r,e,t=0){const n=[e,...r];return t&&n.length>t?n.slice(0,-1):n}var k0=Symbol();function S_(r,e){return!r.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!r.queryFn||r.queryFn===k0?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}function pN(r,e){return typeof r=="function"?r(...e):!!r}var Ri,Ls,ea,Cb,mN=(Cb=class extends hc{constructor(){super();Se(this,Ri);Se(this,Ls);Se(this,ea);ye(this,ea,e=>{if(!Yi&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){K(this,Ls)||this.setEventListener(K(this,ea))}onUnsubscribe(){var e;this.hasListeners()||((e=K(this,Ls))==null||e.call(this),ye(this,Ls,void 0))}setEventListener(e){var t;ye(this,ea,e),(t=K(this,Ls))==null||t.call(this),ye(this,Ls,e(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(e){K(this,Ri)!==e&&(ye(this,Ri,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof K(this,Ri)=="boolean"?K(this,Ri):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Ri=new WeakMap,Ls=new WeakMap,ea=new WeakMap,Cb),I0=new mN,ta,Ps,ra,Lb,gN=(Lb=class extends hc{constructor(){super();Se(this,ta,!0);Se(this,Ps);Se(this,ra);ye(this,ra,e=>{if(!Yi&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}})}onSubscribe(){K(this,Ps)||this.setEventListener(K(this,ra))}onUnsubscribe(){var e;this.hasListeners()||((e=K(this,Ps))==null||e.call(this),ye(this,Ps,void 0))}setEventListener(e){var t;ye(this,ra,e),(t=K(this,Ps))==null||t.call(this),ye(this,Ps,e(this.setOnline.bind(this)))}setOnline(e){K(this,ta)!==e&&(ye(this,ta,e),this.listeners.forEach(n=>{n(e)}))}isOnline(){return K(this,ta)}},ta=new WeakMap,Ps=new WeakMap,ra=new WeakMap,Lb),kd=new gN;function pm(){let r,e;const t=new Promise((s,i)=>{r=s,e=i});t.status="pending",t.catch(()=>{});function n(s){Object.assign(t,s),delete t.resolve,delete t.reject}return t.resolve=s=>{n({status:"fulfilled",value:s}),r(s)},t.reject=s=>{n({status:"rejected",reason:s}),e(s)},t}function yN(r){return Math.min(1e3*2**r,3e4)}function E_(r){return(r??"online")==="online"?kd.isOnline():!0}var T_=class extends Error{constructor(r){super("CancelledError"),this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function yf(r){return r instanceof T_}function __(r){let e=!1,t=0,n=!1,s;const i=pm(),o=p=>{var g;n||(h(new T_(p)),(g=r.abort)==null||g.call(r))},a=()=>{e=!0},l=()=>{e=!1},c=()=>I0.isFocused()&&(r.networkMode==="always"||kd.isOnline())&&r.canRun(),u=()=>E_(r.networkMode)&&r.canRun(),d=p=>{var g;n||(n=!0,(g=r.onSuccess)==null||g.call(r,p),s==null||s(),i.resolve(p))},h=p=>{var g;n||(n=!0,(g=r.onError)==null||g.call(r,p),s==null||s(),i.reject(p))},f=()=>new Promise(p=>{var g;s=y=>{(n||c())&&p(y)},(g=r.onPause)==null||g.call(r)}).then(()=>{var p;s=void 0,n||(p=r.onContinue)==null||p.call(r)}),m=()=>{if(n)return;let p;const g=t===0?r.initialPromise:void 0;try{p=g??r.fn()}catch(y){p=Promise.reject(y)}Promise.resolve(p).then(d).catch(y=>{var I;if(n)return;const x=r.retry??(Yi?0:3),w=r.retryDelay??yN,b=typeof w=="function"?w(t,y):w,E=x===!0||typeof x=="number"&&t<x||typeof x=="function"&&x(t,y);if(e||!E){h(y);return}t++,(I=r.onFail)==null||I.call(r,t,y),dN(b).then(()=>c()?void 0:f()).then(()=>{e?h(y):m()})})};return{promise:i,cancel:o,continue:()=>(s==null||s(),i),cancelRetry:a,continueRetry:l,canStart:u,start:()=>(u()?m():f().then(m),i)}}var vN=r=>setTimeout(r,0);function xN(){let r=[],e=0,t=a=>{a()},n=a=>{a()},s=vN;const i=a=>{e?r.push(a):s(()=>{t(a)})},o=()=>{const a=r;r=[],a.length&&s(()=>{n(()=>{a.forEach(l=>{t(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||o()}return l},batchCalls:a=>(...l)=>{i(()=>{a(...l)})},schedule:i,setNotifyFunction:a=>{t=a},setBatchNotifyFunction:a=>{n=a},setScheduler:a=>{s=a}}}var jt=xN(),Ci,Pb,A_=(Pb=class{constructor(){Se(this,Ci)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),um(this.gcTime)&&ye(this,Ci,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(Yi?1/0:5*60*1e3))}clearGcTimeout(){K(this,Ci)&&(clearTimeout(K(this,Ci)),ye(this,Ci,void 0))}},Ci=new WeakMap,Pb),na,Li,Or,Pi,Wt,ec,Di,an,qn,Db,wN=(Db=class extends A_{constructor(e){super();Se(this,an);Se(this,na);Se(this,Li);Se(this,Or);Se(this,Pi);Se(this,Wt);Se(this,ec);Se(this,Di);ye(this,Di,!1),ye(this,ec,e.defaultOptions),this.setOptions(e.options),this.observers=[],ye(this,Pi,e.client),ye(this,Or,K(this,Pi).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,ye(this,na,bN(this.options)),this.state=e.state??K(this,na),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=K(this,Wt))==null?void 0:e.promise}setOptions(e){this.options={...K(this,ec),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&K(this,Or).remove(this)}setData(e,t){const n=fm(this.state.data,e,this.options);return Fe(this,an,qn).call(this,{data:n,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),n}setState(e,t){Fe(this,an,qn).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var n,s;const t=(n=K(this,Wt))==null?void 0:n.promise;return(s=K(this,Wt))==null||s.cancel(e),t?t.then(ar).catch(ar):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(K(this,na))}isActive(){return this.observers.some(e=>Nr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===k0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Qs(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!w_(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(n=>n.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=K(this,Wt))==null||t.continue()}onOnline(){var t;const e=this.observers.find(n=>n.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=K(this,Wt))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),K(this,Or).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(K(this,Wt)&&(K(this,Di)?K(this,Wt).cancel({revert:!0}):K(this,Wt).cancelRetry()),this.scheduleGc()),K(this,Or).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Fe(this,an,qn).call(this,{type:"invalidate"})}fetch(e,t){var c,u,d;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(K(this,Wt))return K(this,Wt).continueRetry(),K(this,Wt).promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const n=new AbortController,s=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(ye(this,Di,!0),n.signal)})},i=()=>{const h=S_(this.options,t),m=(()=>{const p={client:K(this,Pi),queryKey:this.queryKey,meta:this.meta};return s(p),p})();return ye(this,Di,!1),this.options.persister?this.options.persister(h,m,this):h(m)},a=(()=>{const h={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:K(this,Pi),state:this.state,fetchFn:i};return s(h),h})();(c=this.options.behavior)==null||c.onFetch(a,this),ye(this,Li,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=a.fetchOptions)==null?void 0:u.meta))&&Fe(this,an,qn).call(this,{type:"fetch",meta:(d=a.fetchOptions)==null?void 0:d.meta});const l=h=>{var f,m,p,g;yf(h)&&h.silent||Fe(this,an,qn).call(this,{type:"error",error:h}),yf(h)||((m=(f=K(this,Or).config).onError)==null||m.call(f,h,this),(g=(p=K(this,Or).config).onSettled)==null||g.call(p,this.state.data,h,this)),this.scheduleGc()};return ye(this,Wt,__({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,abort:n.abort.bind(n),onSuccess:h=>{var f,m,p,g;if(h===void 0){l(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(h)}catch(y){l(y);return}(m=(f=K(this,Or).config).onSuccess)==null||m.call(f,h,this),(g=(p=K(this,Or).config).onSettled)==null||g.call(p,h,this.state.error,this),this.scheduleGc()},onError:l,onFail:(h,f)=>{Fe(this,an,qn).call(this,{type:"failed",failureCount:h,error:f})},onPause:()=>{Fe(this,an,qn).call(this,{type:"pause"})},onContinue:()=>{Fe(this,an,qn).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),K(this,Wt).start()}},na=new WeakMap,Li=new WeakMap,Or=new WeakMap,Pi=new WeakMap,Wt=new WeakMap,ec=new WeakMap,Di=new WeakMap,an=new WeakSet,qn=function(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...k_(n.data,this.options),fetchMeta:e.meta??null};case"success":return ye(this,Li,void 0),{...n,data:e.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return yf(s)&&s.revert&&K(this,Li)?{...K(this,Li),fetchStatus:"idle"}:{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),jt.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),K(this,Or).notify({query:this,type:"updated",action:e})})},Db);function k_(r,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:E_(e.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function bN(r){const e=typeof r.initialData=="function"?r.initialData():r.initialData,t=e!==void 0,n=t?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var _n,Ob,SN=(Ob=class extends hc{constructor(e={}){super();Se(this,_n);this.config=e,ye(this,_n,new Map)}build(e,t,n){const s=t.queryKey,i=t.queryHash??A0(s,t);let o=this.get(i);return o||(o=new wN({client:e,queryKey:s,queryHash:i,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(s)}),this.add(o)),o}add(e){K(this,_n).has(e.queryHash)||(K(this,_n).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=K(this,_n).get(e.queryHash);t&&(e.destroy(),t===e&&K(this,_n).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){jt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return K(this,_n).get(e)}getAll(){return[...K(this,_n).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>ux(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>ux(e,n)):t}notify(e){jt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){jt.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){jt.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},_n=new WeakMap,Ob),An,Yt,Oi,kn,bs,Nb,EN=(Nb=class extends A_{constructor(e){super();Se(this,kn);Se(this,An);Se(this,Yt);Se(this,Oi);this.mutationId=e.mutationId,ye(this,Yt,e.mutationCache),ye(this,An,[]),this.state=e.state||TN(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){K(this,An).includes(e)||(K(this,An).push(e),this.clearGcTimeout(),K(this,Yt).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){ye(this,An,K(this,An).filter(t=>t!==e)),this.scheduleGc(),K(this,Yt).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){K(this,An).length||(this.state.status==="pending"?this.scheduleGc():K(this,Yt).remove(this))}continue(){var e;return((e=K(this,Oi))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var i,o,a,l,c,u,d,h,f,m,p,g,y,x,w,b,E,I,S,C;const t=()=>{Fe(this,kn,bs).call(this,{type:"continue"})};ye(this,Oi,__({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(R,L)=>{Fe(this,kn,bs).call(this,{type:"failed",failureCount:R,error:L})},onPause:()=>{Fe(this,kn,bs).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>K(this,Yt).canRun(this)}));const n=this.state.status==="pending",s=!K(this,Oi).canStart();try{if(n)t();else{Fe(this,kn,bs).call(this,{type:"pending",variables:e,isPaused:s}),await((o=(i=K(this,Yt).config).onMutate)==null?void 0:o.call(i,e,this));const L=await((l=(a=this.options).onMutate)==null?void 0:l.call(a,e));L!==this.state.context&&Fe(this,kn,bs).call(this,{type:"pending",context:L,variables:e,isPaused:s})}const R=await K(this,Oi).start();return await((u=(c=K(this,Yt).config).onSuccess)==null?void 0:u.call(c,R,e,this.state.context,this)),await((h=(d=this.options).onSuccess)==null?void 0:h.call(d,R,e,this.state.context)),await((m=(f=K(this,Yt).config).onSettled)==null?void 0:m.call(f,R,null,this.state.variables,this.state.context,this)),await((g=(p=this.options).onSettled)==null?void 0:g.call(p,R,null,e,this.state.context)),Fe(this,kn,bs).call(this,{type:"success",data:R}),R}catch(R){try{throw await((x=(y=K(this,Yt).config).onError)==null?void 0:x.call(y,R,e,this.state.context,this)),await((b=(w=this.options).onError)==null?void 0:b.call(w,R,e,this.state.context)),await((I=(E=K(this,Yt).config).onSettled)==null?void 0:I.call(E,void 0,R,this.state.variables,this.state.context,this)),await((C=(S=this.options).onSettled)==null?void 0:C.call(S,void 0,R,e,this.state.context)),R}finally{Fe(this,kn,bs).call(this,{type:"error",error:R})}}finally{K(this,Yt).runNext(this)}}},An=new WeakMap,Yt=new WeakMap,Oi=new WeakMap,kn=new WeakSet,bs=function(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),jt.batch(()=>{K(this,An).forEach(n=>{n.onMutationUpdate(e)}),K(this,Yt).notify({mutation:this,type:"updated",action:e})})},Nb);function TN(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var es,ln,tc,Mb,_N=(Mb=class extends hc{constructor(e={}){super();Se(this,es);Se(this,ln);Se(this,tc);this.config=e,ye(this,es,new Set),ye(this,ln,new Map),ye(this,tc,0)}build(e,t,n){const s=new EN({mutationCache:this,mutationId:++Sc(this,tc)._,options:e.defaultMutationOptions(t),state:n});return this.add(s),s}add(e){K(this,es).add(e);const t=Vc(e);if(typeof t=="string"){const n=K(this,ln).get(t);n?n.push(e):K(this,ln).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(K(this,es).delete(e)){const t=Vc(e);if(typeof t=="string"){const n=K(this,ln).get(t);if(n)if(n.length>1){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}else n[0]===e&&K(this,ln).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Vc(e);if(typeof t=="string"){const n=K(this,ln).get(t),s=n==null?void 0:n.find(i=>i.state.status==="pending");return!s||s===e}else return!0}runNext(e){var n;const t=Vc(e);if(typeof t=="string"){const s=(n=K(this,ln).get(t))==null?void 0:n.find(i=>i!==e&&i.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){jt.batch(()=>{K(this,es).forEach(e=>{this.notify({type:"removed",mutation:e})}),K(this,es).clear(),K(this,ln).clear()})}getAll(){return Array.from(K(this,es))}find(e){const t={exact:!0,...e};return this.getAll().find(n=>dx(t,n))}findAll(e={}){return this.getAll().filter(t=>dx(e,t))}notify(e){jt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return jt.batch(()=>Promise.all(e.map(t=>t.continue().catch(ar))))}},es=new WeakMap,ln=new WeakMap,tc=new WeakMap,Mb);function Vc(r){var e;return(e=r.options.scope)==null?void 0:e.id}function px(r){return{onFetch:(e,t)=>{var u,d,h,f,m;const n=e.options,s=(h=(d=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:d.fetchMore)==null?void 0:h.direction,i=((f=e.state.data)==null?void 0:f.pages)||[],o=((m=e.state.data)==null?void 0:m.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let p=!1;const g=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},y=S_(e.options,e.fetchOptions),x=async(w,b,E)=>{if(p)return Promise.reject();if(b==null&&w.pages.length)return Promise.resolve(w);const S=(()=>{const $={client:e.client,queryKey:e.queryKey,pageParam:b,direction:E?"backward":"forward",meta:e.options.meta};return g($),$})(),C=await y(S),{maxPages:R}=e.options,L=E?fN:hN;return{pages:L(w.pages,C,R),pageParams:L(w.pageParams,b,R)}};if(s&&i.length){const w=s==="backward",b=w?AN:mx,E={pages:i,pageParams:o},I=b(n,E);a=await x(E,I,w)}else{const w=r??i.length;do{const b=l===0?o[0]??n.initialPageParam:mx(n,a);if(l>0&&b==null)break;a=await x(a,b),l++}while(l<w)}return a};e.options.persister?e.fetchFn=()=>{var p,g;return(g=(p=e.options).persister)==null?void 0:g.call(p,c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=c}}}function mx(r,{pages:e,pageParams:t}){const n=e.length-1;return e.length>0?r.getNextPageParam(e[n],e,t[n],t):void 0}function AN(r,{pages:e,pageParams:t}){var n;return e.length>0?(n=r.getPreviousPageParam)==null?void 0:n.call(r,e[0],e,t[0],t):void 0}var gt,Ds,Os,sa,ia,Ns,oa,aa,Fb,kN=(Fb=class{constructor(r={}){Se(this,gt);Se(this,Ds);Se(this,Os);Se(this,sa);Se(this,ia);Se(this,Ns);Se(this,oa);Se(this,aa);ye(this,gt,r.queryCache||new SN),ye(this,Ds,r.mutationCache||new _N),ye(this,Os,r.defaultOptions||{}),ye(this,sa,new Map),ye(this,ia,new Map),ye(this,Ns,0)}mount(){Sc(this,Ns)._++,K(this,Ns)===1&&(ye(this,oa,I0.subscribe(async r=>{r&&(await this.resumePausedMutations(),K(this,gt).onFocus())})),ye(this,aa,kd.subscribe(async r=>{r&&(await this.resumePausedMutations(),K(this,gt).onOnline())})))}unmount(){var r,e;Sc(this,Ns)._--,K(this,Ns)===0&&((r=K(this,oa))==null||r.call(this),ye(this,oa,void 0),(e=K(this,aa))==null||e.call(this),ye(this,aa,void 0))}isFetching(r){return K(this,gt).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return K(this,Ds).findAll({...r,status:"pending"}).length}getQueryData(r){var t;const e=this.defaultQueryOptions({queryKey:r});return(t=K(this,gt).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(r){const e=this.defaultQueryOptions(r),t=K(this,gt).build(this,e),n=t.state.data;return n===void 0?this.fetchQuery(r):(r.revalidateIfStale&&t.isStaleByTime(Qs(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(n))}getQueriesData(r){return K(this,gt).findAll(r).map(({queryKey:e,state:t})=>{const n=t.data;return[e,n]})}setQueryData(r,e,t){const n=this.defaultQueryOptions({queryKey:r}),s=K(this,gt).get(n.queryHash),i=s==null?void 0:s.state.data,o=uN(e,i);if(o!==void 0)return K(this,gt).build(this,n).setData(o,{...t,manual:!0})}setQueriesData(r,e,t){return jt.batch(()=>K(this,gt).findAll(r).map(({queryKey:n})=>[n,this.setQueryData(n,e,t)]))}getQueryState(r){var t;const e=this.defaultQueryOptions({queryKey:r});return(t=K(this,gt).get(e.queryHash))==null?void 0:t.state}removeQueries(r){const e=K(this,gt);jt.batch(()=>{e.findAll(r).forEach(t=>{e.remove(t)})})}resetQueries(r,e){const t=K(this,gt);return jt.batch(()=>(t.findAll(r).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...r},e)))}cancelQueries(r,e={}){const t={revert:!0,...e},n=jt.batch(()=>K(this,gt).findAll(r).map(s=>s.cancel(t)));return Promise.all(n).then(ar).catch(ar)}invalidateQueries(r,e={}){return jt.batch(()=>(K(this,gt).findAll(r).forEach(t=>{t.invalidate()}),(r==null?void 0:r.refetchType)==="none"?Promise.resolve():this.refetchQueries({...r,type:(r==null?void 0:r.refetchType)??(r==null?void 0:r.type)??"active"},e)))}refetchQueries(r,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},n=jt.batch(()=>K(this,gt).findAll(r).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let i=s.fetch(void 0,t);return t.throwOnError||(i=i.catch(ar)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(n).then(ar)}fetchQuery(r){const e=this.defaultQueryOptions(r);e.retry===void 0&&(e.retry=!1);const t=K(this,gt).build(this,e);return t.isStaleByTime(Qs(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(ar).catch(ar)}fetchInfiniteQuery(r){return r.behavior=px(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(ar).catch(ar)}ensureInfiniteQueryData(r){return r.behavior=px(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return kd.isOnline()?K(this,Ds).resumePausedMutations():Promise.resolve()}getQueryCache(){return K(this,gt)}getMutationCache(){return K(this,Ds)}getDefaultOptions(){return K(this,Os)}setDefaultOptions(r){ye(this,Os,r)}setQueryDefaults(r,e){K(this,sa).set(jl(r),{queryKey:r,defaultOptions:e})}getQueryDefaults(r){const e=[...K(this,sa).values()],t={};return e.forEach(n=>{$l(r,n.queryKey)&&Object.assign(t,n.defaultOptions)}),t}setMutationDefaults(r,e){K(this,ia).set(jl(r),{mutationKey:r,defaultOptions:e})}getMutationDefaults(r){const e=[...K(this,ia).values()],t={};return e.forEach(n=>{$l(r,n.mutationKey)&&Object.assign(t,n.defaultOptions)}),t}defaultQueryOptions(r){if(r._defaulted)return r;const e={...K(this,Os).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return e.queryHash||(e.queryHash=A0(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===k0&&(e.enabled=!1),e}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...K(this,Os).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){K(this,gt).clear(),K(this,Ds).clear()}},gt=new WeakMap,Ds=new WeakMap,Os=new WeakMap,sa=new WeakMap,ia=new WeakMap,Ns=new WeakMap,oa=new WeakMap,aa=new WeakMap,Fb),ir,je,rc,Qt,Ni,la,Ms,Fs,nc,ca,ua,Mi,Fi,js,da,ze,Ja,mm,gm,ym,vm,xm,wm,bm,I_,jb,IN=(jb=class extends hc{constructor(e,t){super();Se(this,ze);Se(this,ir);Se(this,je);Se(this,rc);Se(this,Qt);Se(this,Ni);Se(this,la);Se(this,Ms);Se(this,Fs);Se(this,nc);Se(this,ca);Se(this,ua);Se(this,Mi);Se(this,Fi);Se(this,js);Se(this,da,new Set);this.options=t,ye(this,ir,e),ye(this,Fs,null),ye(this,Ms,pm()),this.options.experimental_prefetchInRender||K(this,Ms).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(K(this,je).addObserver(this),gx(K(this,je),this.options)?Fe(this,ze,Ja).call(this):this.updateResult(),Fe(this,ze,vm).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Sm(K(this,je),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Sm(K(this,je),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Fe(this,ze,xm).call(this),Fe(this,ze,wm).call(this),K(this,je).removeObserver(this)}setOptions(e){const t=this.options,n=K(this,je);if(this.options=K(this,ir).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Nr(this.options.enabled,K(this,je))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Fe(this,ze,bm).call(this),K(this,je).setOptions(this.options),t._defaulted&&!dm(this.options,t)&&K(this,ir).getQueryCache().notify({type:"observerOptionsUpdated",query:K(this,je),observer:this});const s=this.hasListeners();s&&yx(K(this,je),n,this.options,t)&&Fe(this,ze,Ja).call(this),this.updateResult(),s&&(K(this,je)!==n||Nr(this.options.enabled,K(this,je))!==Nr(t.enabled,K(this,je))||Qs(this.options.staleTime,K(this,je))!==Qs(t.staleTime,K(this,je)))&&Fe(this,ze,mm).call(this);const i=Fe(this,ze,gm).call(this);s&&(K(this,je)!==n||Nr(this.options.enabled,K(this,je))!==Nr(t.enabled,K(this,je))||i!==K(this,js))&&Fe(this,ze,ym).call(this,i)}getOptimisticResult(e){const t=K(this,ir).getQueryCache().build(K(this,ir),e),n=this.createResult(t,e);return CN(this,n)&&(ye(this,Qt,n),ye(this,la,this.options),ye(this,Ni,K(this,je).state)),n}getCurrentResult(){return K(this,Qt)}trackResult(e,t){return new Proxy(e,{get:(n,s)=>(this.trackProp(s),t==null||t(s),Reflect.get(n,s))})}trackProp(e){K(this,da).add(e)}getCurrentQuery(){return K(this,je)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=K(this,ir).defaultQueryOptions(e),n=K(this,ir).getQueryCache().build(K(this,ir),t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return Fe(this,ze,Ja).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),K(this,Qt)))}createResult(e,t){var R;const n=K(this,je),s=this.options,i=K(this,Qt),o=K(this,Ni),a=K(this,la),c=e!==n?e.state:K(this,rc),{state:u}=e;let d={...u},h=!1,f;if(t._optimisticResults){const L=this.hasListeners(),$=!L&&gx(e,t),P=L&&yx(e,n,t,s);($||P)&&(d={...d,...k_(u.data,e.options)}),t._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:m,errorUpdatedAt:p,status:g}=d;f=d.data;let y=!1;if(t.placeholderData!==void 0&&f===void 0&&g==="pending"){let L;i!=null&&i.isPlaceholderData&&t.placeholderData===(a==null?void 0:a.placeholderData)?(L=i.data,y=!0):L=typeof t.placeholderData=="function"?t.placeholderData((R=K(this,ua))==null?void 0:R.state.data,K(this,ua)):t.placeholderData,L!==void 0&&(g="success",f=fm(i==null?void 0:i.data,L,t),h=!0)}if(t.select&&f!==void 0&&!y)if(i&&f===(o==null?void 0:o.data)&&t.select===K(this,nc))f=K(this,ca);else try{ye(this,nc,t.select),f=t.select(f),f=fm(i==null?void 0:i.data,f,t),ye(this,ca,f),ye(this,Fs,null)}catch(L){ye(this,Fs,L)}K(this,Fs)&&(m=K(this,Fs),f=K(this,ca),p=Date.now(),g="error");const x=d.fetchStatus==="fetching",w=g==="pending",b=g==="error",E=w&&x,I=f!==void 0,C={status:g,fetchStatus:d.fetchStatus,isPending:w,isSuccess:g==="success",isError:b,isInitialLoading:E,isLoading:E,data:f,dataUpdatedAt:d.dataUpdatedAt,error:m,errorUpdatedAt:p,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>c.dataUpdateCount||d.errorUpdateCount>c.errorUpdateCount,isFetching:x,isRefetching:x&&!w,isLoadingError:b&&!I,isPaused:d.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:b&&I,isStale:R0(e,t),refetch:this.refetch,promise:K(this,Ms),isEnabled:Nr(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const L=U=>{C.status==="error"?U.reject(C.error):C.data!==void 0&&U.resolve(C.data)},$=()=>{const U=ye(this,Ms,C.promise=pm());L(U)},P=K(this,Ms);switch(P.status){case"pending":e.queryHash===n.queryHash&&L(P);break;case"fulfilled":(C.status==="error"||C.data!==P.value)&&$();break;case"rejected":(C.status!=="error"||C.error!==P.reason)&&$();break}}return C}updateResult(){const e=K(this,Qt),t=this.createResult(K(this,je),this.options);if(ye(this,Ni,K(this,je).state),ye(this,la,this.options),K(this,Ni).data!==void 0&&ye(this,ua,K(this,je)),dm(t,e))return;ye(this,Qt,t);const n=()=>{if(!e)return!0;const{notifyOnChangeProps:s}=this.options,i=typeof s=="function"?s():s;if(i==="all"||!i&&!K(this,da).size)return!0;const o=new Set(i??K(this,da));return this.options.throwOnError&&o.add("error"),Object.keys(K(this,Qt)).some(a=>{const l=a;return K(this,Qt)[l]!==e[l]&&o.has(l)})};Fe(this,ze,I_).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Fe(this,ze,vm).call(this)}},ir=new WeakMap,je=new WeakMap,rc=new WeakMap,Qt=new WeakMap,Ni=new WeakMap,la=new WeakMap,Ms=new WeakMap,Fs=new WeakMap,nc=new WeakMap,ca=new WeakMap,ua=new WeakMap,Mi=new WeakMap,Fi=new WeakMap,js=new WeakMap,da=new WeakMap,ze=new WeakSet,Ja=function(e){Fe(this,ze,bm).call(this);let t=K(this,je).fetch(this.options,e);return e!=null&&e.throwOnError||(t=t.catch(ar)),t},mm=function(){Fe(this,ze,xm).call(this);const e=Qs(this.options.staleTime,K(this,je));if(Yi||K(this,Qt).isStale||!um(e))return;const n=w_(K(this,Qt).dataUpdatedAt,e)+1;ye(this,Mi,setTimeout(()=>{K(this,Qt).isStale||this.updateResult()},n))},gm=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(K(this,je)):this.options.refetchInterval)??!1},ym=function(e){Fe(this,ze,wm).call(this),ye(this,js,e),!(Yi||Nr(this.options.enabled,K(this,je))===!1||!um(K(this,js))||K(this,js)===0)&&ye(this,Fi,setInterval(()=>{(this.options.refetchIntervalInBackground||I0.isFocused())&&Fe(this,ze,Ja).call(this)},K(this,js)))},vm=function(){Fe(this,ze,mm).call(this),Fe(this,ze,ym).call(this,Fe(this,ze,gm).call(this))},xm=function(){K(this,Mi)&&(clearTimeout(K(this,Mi)),ye(this,Mi,void 0))},wm=function(){K(this,Fi)&&(clearInterval(K(this,Fi)),ye(this,Fi,void 0))},bm=function(){const e=K(this,ir).getQueryCache().build(K(this,ir),this.options);if(e===K(this,je))return;const t=K(this,je);ye(this,je,e),ye(this,rc,e.state),this.hasListeners()&&(t==null||t.removeObserver(this),e.addObserver(this))},I_=function(e){jt.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(K(this,Qt))}),K(this,ir).getQueryCache().notify({query:K(this,je),type:"observerResultsUpdated"})})},jb);function RN(r,e){return Nr(e.enabled,r)!==!1&&r.state.data===void 0&&!(r.state.status==="error"&&e.retryOnMount===!1)}function gx(r,e){return RN(r,e)||r.state.data!==void 0&&Sm(r,e,e.refetchOnMount)}function Sm(r,e,t){if(Nr(e.enabled,r)!==!1&&Qs(e.staleTime,r)!=="static"){const n=typeof t=="function"?t(r):t;return n==="always"||n!==!1&&R0(r,e)}return!1}function yx(r,e,t,n){return(r!==e||Nr(n.enabled,r)===!1)&&(!t.suspense||r.state.status!=="error")&&R0(r,t)}function R0(r,e){return Nr(e.enabled,r)!==!1&&r.isStaleByTime(Qs(e.staleTime,r))}function CN(r,e){return!dm(r.getCurrentResult(),e)}var R_=T.createContext(void 0),LN=r=>{const e=T.useContext(R_);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},PN=({client:r,children:e})=>(T.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),v.jsx(R_.Provider,{value:r,children:e})),C_=T.createContext(!1),DN=()=>T.useContext(C_);C_.Provider;function ON(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}var NN=T.createContext(ON()),MN=()=>T.useContext(NN),FN=(r,e)=>{(r.suspense||r.throwOnError||r.experimental_prefetchInRender)&&(e.isReset()||(r.retryOnMount=!1))},jN=r=>{T.useEffect(()=>{r.clearReset()},[r])},$N=({result:r,errorResetBoundary:e,throwOnError:t,query:n,suspense:s})=>r.isError&&!e.isReset()&&!r.isFetching&&n&&(s&&r.data===void 0||pN(t,[r.error,n])),BN=r=>{if(r.suspense){const e=n=>n==="static"?n:Math.max(n??1e3,1e3),t=r.staleTime;r.staleTime=typeof t=="function"?(...n)=>e(t(...n)):e(t),typeof r.gcTime=="number"&&(r.gcTime=Math.max(r.gcTime,1e3))}},UN=(r,e)=>r.isLoading&&r.isFetching&&!e,zN=(r,e)=>(r==null?void 0:r.suspense)&&e.isPending,vx=(r,e,t)=>e.fetchOptimistic(r).catch(()=>{t.clearReset()});function GN(r,e,t){var d,h,f,m,p;const n=DN(),s=MN(),i=LN(),o=i.defaultQueryOptions(r);(h=(d=i.getDefaultOptions().queries)==null?void 0:d._experimental_beforeQuery)==null||h.call(d,o),o._optimisticResults=n?"isRestoring":"optimistic",BN(o),FN(o,s),jN(s);const a=!i.getQueryCache().get(o.queryHash),[l]=T.useState(()=>new e(i,o)),c=l.getOptimisticResult(o),u=!n&&r.subscribed!==!1;if(T.useSyncExternalStore(T.useCallback(g=>{const y=u?l.subscribe(jt.batchCalls(g)):ar;return l.updateResult(),y},[l,u]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),T.useEffect(()=>{l.setOptions(o)},[o,l]),zN(o,c))throw vx(o,l,s);if($N({result:c,errorResetBoundary:s,throwOnError:o.throwOnError,query:i.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw c.error;if((m=(f=i.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||m.call(f,o,c),o.experimental_prefetchInRender&&!Yi&&UN(c,n)){const g=a?vx(o,l,s):(p=i.getQueryCache().get(o.queryHash))==null?void 0:p.promise;g==null||g.catch(ar).finally(()=>{l.updateResult()})}return o.notifyOnChangeProps?c:l.trackResult(c)}function Rr(r,e){return GN(r,IN)}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Bl(){return Bl=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Bl.apply(this,arguments)}var Us;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Us||(Us={}));const xx="popstate";function HN(r){r===void 0&&(r={});function e(n,s){let{pathname:i,search:o,hash:a}=n.location;return Em("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(n,s){return typeof s=="string"?s:Id(s)}return WN(e,t,null,r)}function Tt(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function L_(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function VN(){return Math.random().toString(36).substr(2,8)}function wx(r,e){return{usr:r.state,key:r.key,idx:e}}function Em(r,e,t,n){return t===void 0&&(t=null),Bl({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof e=="string"?Pa(e):e,{state:t,key:e&&e.key||n||VN()})}function Id(r){let{pathname:e="/",search:t="",hash:n=""}=r;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function Pa(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substr(n),r=r.substr(0,n)),r&&(e.pathname=r)}return e}function WN(r,e,t,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:i=!1}=n,o=s.history,a=Us.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(Bl({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Us.Pop;let g=u(),y=g==null?null:g-c;c=g,l&&l({action:a,location:p.location,delta:y})}function h(g,y){a=Us.Push;let x=Em(p.location,g,y);c=u()+1;let w=wx(x,c),b=p.createHref(x);try{o.pushState(w,"",b)}catch(E){if(E instanceof DOMException&&E.name==="DataCloneError")throw E;s.location.assign(b)}i&&l&&l({action:a,location:p.location,delta:1})}function f(g,y){a=Us.Replace;let x=Em(p.location,g,y);c=u();let w=wx(x,c),b=p.createHref(x);o.replaceState(w,"",b),i&&l&&l({action:a,location:p.location,delta:0})}function m(g){let y=s.location.origin!=="null"?s.location.origin:s.location.href,x=typeof g=="string"?g:Id(g);return x=x.replace(/ $/,"%20"),Tt(y,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,y)}let p={get action(){return a},get location(){return r(s,o)},listen(g){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(xx,d),l=g,()=>{s.removeEventListener(xx,d),l=null}},createHref(g){return e(s,g)},createURL:m,encodeLocation(g){let y=m(g);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:h,replace:f,go(g){return o.go(g)}};return p}var bx;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(bx||(bx={}));function KN(r,e,t){return t===void 0&&(t="/"),qN(r,e,t)}function qN(r,e,t,n){let s=typeof e=="string"?Pa(e):e,i=C0(s.pathname||"/",t);if(i==null)return null;let o=P_(r);YN(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=a2(i);a=s2(o[l],c)}return a}function P_(r,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(Tt(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let c=Xs([n,l.relativePath]),u=t.concat(l);i.children&&i.children.length>0&&(Tt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),P_(i.children,e,u,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:r2(c,i.index),routesMeta:u})};return r.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of D_(i.path))s(i,o,l)}),e}function D_(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(n.length===0)return s?[i,""]:[i];let o=D_(n.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>r.startsWith("/")&&l===""?"/":l)}function YN(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:n2(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const QN=/^:[\w-]+$/,XN=3,JN=2,ZN=1,e2=10,t2=-2,Sx=r=>r==="*";function r2(r,e){let t=r.split("/"),n=t.length;return t.some(Sx)&&(n+=t2),e&&(n+=JN),t.filter(s=>!Sx(s)).reduce((s,i)=>s+(QN.test(i)?XN:i===""?ZN:e2),n)}function n2(r,e){return r.length===e.length&&r.slice(0,-1).every((n,s)=>n===e[s])?r[r.length-1]-e[e.length-1]:0}function s2(r,e,t){let{routesMeta:n}=r,s={},i="/",o=[];for(let a=0;a<n.length;++a){let l=n[a],c=a===n.length-1,u=i==="/"?e:e.slice(i.length)||"/",d=i2({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d)return null;Object.assign(s,d.params),o.push({params:s,pathname:Xs([i,d.pathname]),pathnameBase:d2(Xs([i,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(i=Xs([i,d.pathnameBase]))}return o}function i2(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=o2(r.path,r.caseSensitive,r.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:n.reduce((c,u,d)=>{let{paramName:h,isOptional:f}=u;if(h==="*"){let p=a[d]||"";o=i.slice(0,i.length-p.length).replace(/(.)\/+$/,"$1")}const m=a[d];return f&&!m?c[h]=void 0:c[h]=(m||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:r}}function o2(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),L_(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let n=[],s="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(n.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),s+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":r!==""&&r!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),n]}function a2(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return L_(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),r}}function C0(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}function l2(r,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:s=""}=typeof r=="string"?Pa(r):r;return{pathname:t?t.startsWith("/")?t:c2(t,e):e,search:h2(n),hash:f2(s)}}function c2(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function vf(r,e,t,n){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function u2(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function O_(r,e){let t=u2(r);return e?t.map((n,s)=>s===t.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function N_(r,e,t,n){n===void 0&&(n=!1);let s;typeof r=="string"?s=Pa(r):(s=Bl({},r),Tt(!s.pathname||!s.pathname.includes("?"),vf("?","pathname","search",s)),Tt(!s.pathname||!s.pathname.includes("#"),vf("#","pathname","hash",s)),Tt(!s.search||!s.search.includes("#"),vf("#","search","hash",s)));let i=r===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let d=e.length-1;if(!n&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),d-=1;s.pathname=h.join("/")}a=d>=0?e[d]:"/"}let l=l2(s,a),c=o&&o!=="/"&&o.endsWith("/"),u=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const Xs=r=>r.join("/").replace(/\/\/+/g,"/"),d2=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),h2=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,f2=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function p2(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const M_=["post","put","patch","delete"];new Set(M_);const m2=["get",...M_];new Set(m2);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ul(){return Ul=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Ul.apply(this,arguments)}const L0=T.createContext(null),g2=T.createContext(null),to=T.createContext(null),wh=T.createContext(null),ds=T.createContext({outlet:null,matches:[],isDataRoute:!1}),F_=T.createContext(null);function y2(r,e){let{relative:t}=e===void 0?{}:e;fc()||Tt(!1);let{basename:n,navigator:s}=T.useContext(to),{hash:i,pathname:o,search:a}=B_(r,{relative:t}),l=o;return n!=="/"&&(l=o==="/"?n:Xs([n,o])),s.createHref({pathname:l,search:a,hash:i})}function fc(){return T.useContext(wh)!=null}function Da(){return fc()||Tt(!1),T.useContext(wh).location}function j_(r){T.useContext(to).static||T.useLayoutEffect(r)}function Vr(){let{isDataRoute:r}=T.useContext(ds);return r?P2():v2()}function v2(){fc()||Tt(!1);let r=T.useContext(L0),{basename:e,future:t,navigator:n}=T.useContext(to),{matches:s}=T.useContext(ds),{pathname:i}=Da(),o=JSON.stringify(O_(s,t.v7_relativeSplatPath)),a=T.useRef(!1);return j_(()=>{a.current=!0}),T.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){n.go(c);return}let d=N_(c,JSON.parse(o),i,u.relative==="path");r==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Xs([e,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[e,n,o,i,r])}const x2=T.createContext(null);function w2(r){let e=T.useContext(ds).outlet;return e&&T.createElement(x2.Provider,{value:r},e)}function $_(){let{matches:r}=T.useContext(ds),e=r[r.length-1];return e?e.params:{}}function B_(r,e){let{relative:t}=e===void 0?{}:e,{future:n}=T.useContext(to),{matches:s}=T.useContext(ds),{pathname:i}=Da(),o=JSON.stringify(O_(s,n.v7_relativeSplatPath));return T.useMemo(()=>N_(r,JSON.parse(o),i,t==="path"),[r,o,i,t])}function b2(r,e){return S2(r,e)}function S2(r,e,t,n){fc()||Tt(!1);let{navigator:s}=T.useContext(to),{matches:i}=T.useContext(ds),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=Da(),u;if(e){var d;let g=typeof e=="string"?Pa(e):e;l==="/"||(d=g.pathname)!=null&&d.startsWith(l)||Tt(!1),u=g}else u=c;let h=u.pathname||"/",f=h;if(l!=="/"){let g=l.replace(/^\//,"").split("/");f="/"+h.replace(/^\//,"").split("/").slice(g.length).join("/")}let m=KN(r,{pathname:f}),p=k2(m&&m.map(g=>Object.assign({},g,{params:Object.assign({},a,g.params),pathname:Xs([l,s.encodeLocation?s.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?l:Xs([l,s.encodeLocation?s.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),i,t,n);return e&&p?T.createElement(wh.Provider,{value:{location:Ul({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Us.Pop}},p):p}function E2(){let r=L2(),e=p2(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},e),t?T.createElement("pre",{style:s},t):null,null)}const T2=T.createElement(E2,null);class _2 extends T.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?T.createElement(ds.Provider,{value:this.props.routeContext},T.createElement(F_.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function A2(r){let{routeContext:e,match:t,children:n}=r,s=T.useContext(L0);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),T.createElement(ds.Provider,{value:e},n)}function k2(r,e,t,n){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),r==null){var i;if(!t)return null;if(t.errors)r=t.matches;else if((i=n)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let o=r,a=(s=t)==null?void 0:s.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||Tt(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(t&&n&&n.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:h,errors:f}=t,m=d.route.loader&&h[d.route.id]===void 0&&(!f||f[d.route.id]===void 0);if(d.route.lazy||m){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let f,m=!1,p=null,g=null;t&&(f=a&&d.route.id?a[d.route.id]:void 0,p=d.route.errorElement||T2,l&&(c<0&&h===0?(D2("route-fallback"),m=!0,g=null):c===h&&(m=!0,g=d.route.hydrateFallbackElement||null)));let y=e.concat(o.slice(0,h+1)),x=()=>{let w;return f?w=p:m?w=g:d.route.Component?w=T.createElement(d.route.Component,null):d.route.element?w=d.route.element:w=u,T.createElement(A2,{match:d,routeContext:{outlet:u,matches:y,isDataRoute:t!=null},children:w})};return t&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?T.createElement(_2,{location:t.location,revalidation:t.revalidation,component:p,error:f,children:x(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):x()},null)}var U_=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(U_||{}),z_=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(z_||{});function I2(r){let e=T.useContext(L0);return e||Tt(!1),e}function R2(r){let e=T.useContext(g2);return e||Tt(!1),e}function C2(r){let e=T.useContext(ds);return e||Tt(!1),e}function G_(r){let e=C2(),t=e.matches[e.matches.length-1];return t.route.id||Tt(!1),t.route.id}function L2(){var r;let e=T.useContext(F_),t=R2(),n=G_();return e!==void 0?e:(r=t.errors)==null?void 0:r[n]}function P2(){let{router:r}=I2(U_.UseNavigateStable),e=G_(z_.UseNavigateStable),t=T.useRef(!1);return j_(()=>{t.current=!0}),T.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?r.navigate(s):r.navigate(s,Ul({fromRouteId:e},i)))},[r,e])}const Ex={};function D2(r,e,t){Ex[r]||(Ex[r]=!0)}function O2(r,e){r==null||r.v7_startTransition,r==null||r.v7_relativeSplatPath}function N2(r){return w2(r.context)}function tn(r){Tt(!1)}function M2(r){let{basename:e="/",children:t=null,location:n,navigationType:s=Us.Pop,navigator:i,static:o=!1,future:a}=r;fc()&&Tt(!1);let l=e.replace(/^\/*/,"/"),c=T.useMemo(()=>({basename:l,navigator:i,static:o,future:Ul({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof n=="string"&&(n=Pa(n));let{pathname:u="/",search:d="",hash:h="",state:f=null,key:m="default"}=n,p=T.useMemo(()=>{let g=C0(u,l);return g==null?null:{location:{pathname:g,search:d,hash:h,state:f,key:m},navigationType:s}},[l,u,d,h,f,m,s]);return p==null?null:T.createElement(to.Provider,{value:c},T.createElement(wh.Provider,{children:t,value:p}))}function F2(r){let{children:e,location:t}=r;return b2(Tm(e),t)}new Promise(()=>{});function Tm(r,e){e===void 0&&(e=[]);let t=[];return T.Children.forEach(r,(n,s)=>{if(!T.isValidElement(n))return;let i=[...e,s];if(n.type===T.Fragment){t.push.apply(t,Tm(n.props.children,i));return}n.type!==tn&&Tt(!1),!n.props.index||!n.props.children||Tt(!1);let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Tm(n.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _m(){return _m=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_m.apply(this,arguments)}function j2(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,i;for(i=0;i<n.length;i++)s=n[i],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function $2(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function B2(r,e){return r.button===0&&(!e||e==="_self")&&!$2(r)}function Am(r){return r===void 0&&(r=""),new URLSearchParams(typeof r=="string"||Array.isArray(r)||r instanceof URLSearchParams?r:Object.keys(r).reduce((e,t)=>{let n=r[t];return e.concat(Array.isArray(n)?n.map(s=>[t,s]):[[t,n]])},[]))}function U2(r,e){let t=Am(r);return e&&e.forEach((n,s)=>{t.has(s)||e.getAll(s).forEach(i=>{t.append(s,i)})}),t}const z2=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],G2="6";try{window.__reactRouterVersion=G2}catch{}const H2="startTransition",Tx=pg[H2];function V2(r){let{basename:e,children:t,future:n,window:s}=r,i=T.useRef();i.current==null&&(i.current=HN({window:s,v5Compat:!0}));let o=i.current,[a,l]=T.useState({action:o.action,location:o.location}),{v7_startTransition:c}=n||{},u=T.useCallback(d=>{c&&Tx?Tx(()=>l(d)):l(d)},[l,c]);return T.useLayoutEffect(()=>o.listen(u),[o,u]),T.useEffect(()=>O2(n),[n]),T.createElement(M2,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:n})}const W2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",K2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Js=T.forwardRef(function(e,t){let{onClick:n,relative:s,reloadDocument:i,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:d}=e,h=j2(e,z2),{basename:f}=T.useContext(to),m,p=!1;if(typeof c=="string"&&K2.test(c)&&(m=c,W2))try{let w=new URL(window.location.href),b=c.startsWith("//")?new URL(w.protocol+c):new URL(c),E=C0(b.pathname,f);b.origin===w.origin&&E!=null?c=E+b.search+b.hash:p=!0}catch{}let g=y2(c,{relative:s}),y=q2(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:s,viewTransition:d});function x(w){n&&n(w),w.defaultPrevented||y(w)}return T.createElement("a",_m({},h,{href:m||g,onClick:p||i?n:x,ref:t,target:l}))});var _x;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(_x||(_x={}));var Ax;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(Ax||(Ax={}));function q2(r,e){let{target:t,replace:n,state:s,preventScrollReset:i,relative:o,viewTransition:a}=e===void 0?{}:e,l=Vr(),c=Da(),u=B_(r,{relative:o});return T.useCallback(d=>{if(B2(d,t)){d.preventDefault();let h=n!==void 0?n:Id(c)===Id(u);l(r,{replace:h,state:s,preventScrollReset:i,relative:o,viewTransition:a})}},[c,l,u,n,s,t,r,i,o,a])}function H_(r){let e=T.useRef(Am(r)),t=T.useRef(!1),n=Da(),s=T.useMemo(()=>U2(n.search,t.current?null:e.current),[n.search]),i=Vr(),o=T.useCallback((a,l)=>{const c=Am(typeof a=="function"?a(s):a);t.current=!0,i("?"+c,l)},[i,s]);return[s,o]}const Y2=hh("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),pe=T.forwardRef(({className:r,variant:e,size:t,asChild:n=!1,...s},i)=>{const o=n?rL:"button";return v.jsx(o,{className:Te(Y2({variant:e,size:t,className:r})),ref:i,...s})});pe.displayName="Button";class Q2 extends T.Component{constructor(){super(...arguments);pt(this,"state",{hasError:!1,error:null});pt(this,"handleReload",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(n=>n.unregister())}),window.location.href="/"})}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){console.error("Uncaught error:",t,n)}render(){var t;return this.state.hasError?v.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:v.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[v.jsx("h1",{className:"text-4xl font-bold text-primary",children:"Oops!"}),v.jsx("p",{className:"text-lg text-foreground",children:"Something went wrong"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:((t=this.state.error)==null?void 0:t.message)||"An unexpected error occurred"}),v.jsxs("div",{className:"flex gap-4 justify-center",children:[v.jsx(pe,{onClick:this.handleReload,variant:"default",children:"Reload App"}),v.jsx(pe,{onClick:()=>this.setState({hasError:!1,error:null}),variant:"outline",children:"Try Again"})]})]})}):this.props.children}}const X2=()=>{const[r,e]=T.useState(!0);return T.useEffect(()=>{const t=setTimeout(()=>{e(!1)},1500);return()=>clearTimeout(t)},[]),r?v.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-background via-black/95 to-background",children:v.jsxs("div",{className:"relative w-[120px] h-[120px]",children:[v.jsx("div",{className:"absolute inset-0 border-[3px] border-transparent border-t-primary border-r-primary rounded-full animate-[spin_1.2s_cubic-bezier(0.68,-0.55,0.265,1.55)_infinite]"}),v.jsx("div",{className:"absolute inset-[15px] border-[3px] border-transparent border-b-primary/80 border-l-primary/80 rounded-full animate-[spin_1s_cubic-bezier(0.68,-0.55,0.265,1.55)_infinite_reverse]"}),v.jsx("div",{className:"absolute inset-[30px] border-[3px] border-transparent border-t-primary/60 border-r-primary/60 rounded-full animate-[spin_0.8s_cubic-bezier(0.68,-0.55,0.265,1.55)_infinite]"}),v.jsx("div",{className:"absolute top-[50px] left-[50px] w-5 h-5 bg-gradient-to-br from-primary via-primary/80 to-primary/60 rounded-full animate-[pulse_1.5s_ease-in-out_infinite] shadow-[0_0_30px_rgba(239,68,68,0.8),0_0_60px_rgba(239,68,68,0.4)]"})]})}):null};var xf="focusScope.autoFocusOnMount",wf="focusScope.autoFocusOnUnmount",kx={bubbles:!1,cancelable:!0},J2="FocusScope",V_=T.forwardRef((r,e)=>{const{loop:t=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:i,...o}=r,[a,l]=T.useState(null),c=Bt(s),u=Bt(i),d=T.useRef(null),h=vt(e,p=>l(p)),f=T.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;T.useEffect(()=>{if(n){let p=function(w){if(f.paused||!a)return;const b=w.target;a.contains(b)?d.current=b:Ss(d.current,{select:!0})},g=function(w){if(f.paused||!a)return;const b=w.relatedTarget;b!==null&&(a.contains(b)||Ss(d.current,{select:!0}))},y=function(w){if(document.activeElement===document.body)for(const E of w)E.removedNodes.length>0&&Ss(a)};document.addEventListener("focusin",p),document.addEventListener("focusout",g);const x=new MutationObserver(y);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",g),x.disconnect()}}},[n,a,f.paused]),T.useEffect(()=>{if(a){Rx.add(f);const p=document.activeElement;if(!a.contains(p)){const y=new CustomEvent(xf,kx);a.addEventListener(xf,c),a.dispatchEvent(y),y.defaultPrevented||(Z2(sM(W_(a)),{select:!0}),document.activeElement===p&&Ss(a))}return()=>{a.removeEventListener(xf,c),setTimeout(()=>{const y=new CustomEvent(wf,kx);a.addEventListener(wf,u),a.dispatchEvent(y),y.defaultPrevented||Ss(p??document.body,{select:!0}),a.removeEventListener(wf,u),Rx.remove(f)},0)}}},[a,c,u,f]);const m=T.useCallback(p=>{if(!t&&!n||f.paused)return;const g=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,y=document.activeElement;if(g&&y){const x=p.currentTarget,[w,b]=eM(x);w&&b?!p.shiftKey&&y===b?(p.preventDefault(),t&&Ss(w,{select:!0})):p.shiftKey&&y===w&&(p.preventDefault(),t&&Ss(b,{select:!0})):y===x&&p.preventDefault()}},[t,n,f.paused]);return v.jsx(qe.div,{tabIndex:-1,...o,ref:h,onKeyDown:m})});V_.displayName=J2;function Z2(r,{select:e=!1}={}){const t=document.activeElement;for(const n of r)if(Ss(n,{select:e}),document.activeElement!==t)return}function eM(r){const e=W_(r),t=Ix(e,r),n=Ix(e.reverse(),r);return[t,n]}function W_(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function Ix(r,e){for(const t of r)if(!tM(t,{upTo:e}))return t}function tM(r,{upTo:e}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(e!==void 0&&r===e)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function rM(r){return r instanceof HTMLInputElement&&"select"in r}function Ss(r,{select:e=!1}={}){if(r&&r.focus){const t=document.activeElement;r.focus({preventScroll:!0}),r!==t&&rM(r)&&e&&r.select()}}var Rx=nM();function nM(){let r=[];return{add(e){const t=r[0];e!==t&&(t==null||t.pause()),r=Cx(r,e),r.unshift(e)},remove(e){var t;r=Cx(r,e),(t=r[0])==null||t.resume()}}}function Cx(r,e){const t=[...r],n=t.indexOf(e);return n!==-1&&t.splice(n,1),t}function sM(r){return r.filter(e=>e.tagName!=="A")}var bf=0;function iM(){T.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??Lx()),document.body.insertAdjacentElement("beforeend",r[1]??Lx()),bf++,()=>{bf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),bf--}},[])}function Lx(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var km=function(r,e){return km=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])},km(r,e)};function K_(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");km(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var jr=function(){return jr=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},jr.apply(this,arguments)};function di(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}function q_(r,e,t,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(s<3?o(i):s>3?o(e,t,i):o(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i}function Y_(r,e){return function(t,n){e(t,n,r)}}function Q_(r,e,t,n,s,i){function o(y){if(y!==void 0&&typeof y!="function")throw new TypeError("Function expected");return y}for(var a=n.kind,l=a==="getter"?"get":a==="setter"?"set":"value",c=!e&&r?n.static?r:r.prototype:null,u=e||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),d,h=!1,f=t.length-1;f>=0;f--){var m={};for(var p in n)m[p]=p==="access"?{}:n[p];for(var p in n.access)m.access[p]=n.access[p];m.addInitializer=function(y){if(h)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(y||null))};var g=(0,t[f])(a==="accessor"?{get:u.get,set:u.set}:u[l],m);if(a==="accessor"){if(g===void 0)continue;if(g===null||typeof g!="object")throw new TypeError("Object expected");(d=o(g.get))&&(u.get=d),(d=o(g.set))&&(u.set=d),(d=o(g.init))&&s.unshift(d)}else(d=o(g))&&(a==="field"?s.unshift(d):u[l]=d)}c&&Object.defineProperty(c,n.name,u),h=!0}function X_(r,e,t){for(var n=arguments.length>2,s=0;s<e.length;s++)t=n?e[s].call(r,t):e[s].call(r);return n?t:void 0}function J_(r){return typeof r=="symbol"?r:"".concat(r)}function Z_(r,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(r,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function e1(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function ve(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})}function t1(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(t=0)),t;)try{if(n=1,s&&(i=c[0]&2?s.return:c[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,c[1])).done)return i;switch(s=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],s=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var bh=Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]};function r1(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&bh(e,r,t)}function Rd(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function P0(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function n1(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(P0(arguments[e]));return r}function s1(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),s=0,e=0;e<t;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function D0(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}function ba(r){return this instanceof ba?(this.v=r,this):new ba(r)}function i1(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(f){return function(m){return Promise.resolve(m).then(f,d)}}function a(f,m){n[f]&&(s[f]=function(p){return new Promise(function(g,y){i.push([f,p,g,y])>1||l(f,p)})},m&&(s[f]=m(s[f])))}function l(f,m){try{c(n[f](m))}catch(p){h(i[0][3],p)}}function c(f){f.value instanceof ba?Promise.resolve(f.value.v).then(u,d):h(i[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function h(f,m){f(m),i.shift(),i.length&&l(i[0][0],i[0][1])}}function o1(r){var e,t;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=r[s]?function(o){return(t=!t)?{value:ba(r[s](o)),done:!1}:i?i(o):o}:i}}function a1(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Rd=="function"?Rd(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=r[i]&&function(o){return new Promise(function(a,l){o=r[i](o),s(a,l,o.done,o.value)})}}function s(i,o,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},o)}}function l1(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}var oM=Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e},Im=function(r){return Im=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},Im(r)};function c1(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t=Im(r),n=0;n<t.length;n++)t[n]!=="default"&&bh(e,r,t[n]);return oM(e,r),e}function u1(r){return r&&r.__esModule?r:{default:r}}function d1(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}function h1(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t}function f1(r,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof r=="function"?e===r:r.has(e)}function p1(r,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var n,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],t&&(s=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),r.stack.push({value:e,dispose:n,async:t})}else t&&r.stack.push({async:!0});return e}var aM=typeof SuppressedError=="function"?SuppressedError:function(r,e,t){var n=new Error(t);return n.name="SuppressedError",n.error=r,n.suppressed=e,n};function m1(r){function e(i){r.error=r.hasError?new aM(i,r.error,"An error was suppressed during disposal."):i,r.hasError=!0}var t,n=0;function s(){for(;t=r.stack.pop();)try{if(!t.async&&n===1)return n=0,r.stack.push(t),Promise.resolve().then(s);if(t.dispose){var i=t.dispose.call(t.value);if(t.async)return n|=2,Promise.resolve(i).then(s,function(o){return e(o),s()})}else n|=1}catch(o){e(o)}if(n===1)return r.hasError?Promise.reject(r.error):Promise.resolve();if(r.hasError)throw r.error}return s()}function g1(r,e){return typeof r=="string"&&/^\.\.?\//.test(r)?r.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,n,s,i,o){return n?e?".jsx":".js":s&&(!i||!o)?t:s+i+"."+o.toLowerCase()+"js"}):r}const lM={__extends:K_,__assign:jr,__rest:di,__decorate:q_,__param:Y_,__esDecorate:Q_,__runInitializers:X_,__propKey:J_,__setFunctionName:Z_,__metadata:e1,__awaiter:ve,__generator:t1,__createBinding:bh,__exportStar:r1,__values:Rd,__read:P0,__spread:n1,__spreadArrays:s1,__spreadArray:D0,__await:ba,__asyncGenerator:i1,__asyncDelegator:o1,__asyncValues:a1,__makeTemplateObject:l1,__importStar:c1,__importDefault:u1,__classPrivateFieldGet:d1,__classPrivateFieldSet:h1,__classPrivateFieldIn:f1,__addDisposableResource:p1,__disposeResources:m1,__rewriteRelativeImportExtension:g1},cM=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:p1,get __assign(){return jr},__asyncDelegator:o1,__asyncGenerator:i1,__asyncValues:a1,__await:ba,__awaiter:ve,__classPrivateFieldGet:d1,__classPrivateFieldIn:f1,__classPrivateFieldSet:h1,__createBinding:bh,__decorate:q_,__disposeResources:m1,__esDecorate:Q_,__exportStar:r1,__extends:K_,__generator:t1,__importDefault:u1,__importStar:c1,__makeTemplateObject:l1,__metadata:e1,__param:Y_,__propKey:J_,__read:P0,__rest:di,__rewriteRelativeImportExtension:g1,__runInitializers:X_,__setFunctionName:Z_,__spread:n1,__spreadArray:D0,__spreadArrays:s1,__values:Rd,default:lM},Symbol.toStringTag,{value:"Module"}));var Bu="right-scroll-bar-position",Uu="width-before-scroll-bar",uM="with-scroll-bars-hidden",dM="--removed-body-scroll-bar-size";function Sf(r,e){return typeof r=="function"?r(e):r&&(r.current=e),r}function hM(r,e){var t=T.useState(function(){return{value:r,callback:e,facade:{get current(){return t.value},set current(n){var s=t.value;s!==n&&(t.value=n,t.callback(n,s))}}}})[0];return t.callback=e,t.facade}var fM=typeof window<"u"?T.useLayoutEffect:T.useEffect,Px=new WeakMap;function pM(r,e){var t=hM(null,function(n){return r.forEach(function(s){return Sf(s,n)})});return fM(function(){var n=Px.get(t);if(n){var s=new Set(n),i=new Set(r),o=t.current;s.forEach(function(a){i.has(a)||Sf(a,null)}),i.forEach(function(a){s.has(a)||Sf(a,o)})}Px.set(t,r)},[r]),t}function mM(r){return r}function gM(r,e){e===void 0&&(e=mM);var t=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:r},useMedium:function(i){var o=e(i,n);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(i){for(n=!0;t.length;){var o=t;t=[],o.forEach(i)}t={push:function(a){return i(a)},filter:function(){return t}}},assignMedium:function(i){n=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(i),o=t}var l=function(){var u=o;o=[],u.forEach(i)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){o.push(u),c()},filter:function(u){return o=o.filter(u),t}}}};return s}function yM(r){r===void 0&&(r={});var e=gM(null);return e.options=jr({async:!0,ssr:!1},r),e}var y1=function(r){var e=r.sideCar,t=di(r,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return T.createElement(n,jr({},t))};y1.isSideCarExport=!0;function vM(r,e){return r.useMedium(e),y1}var v1=yM(),Ef=function(){},Sh=T.forwardRef(function(r,e){var t=T.useRef(null),n=T.useState({onScrollCapture:Ef,onWheelCapture:Ef,onTouchMoveCapture:Ef}),s=n[0],i=n[1],o=r.forwardProps,a=r.children,l=r.className,c=r.removeScrollBar,u=r.enabled,d=r.shards,h=r.sideCar,f=r.noRelative,m=r.noIsolation,p=r.inert,g=r.allowPinchZoom,y=r.as,x=y===void 0?"div":y,w=r.gapMode,b=di(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),E=h,I=pM([t,e]),S=jr(jr({},b),s);return T.createElement(T.Fragment,null,u&&T.createElement(E,{sideCar:v1,removeScrollBar:c,shards:d,noRelative:f,noIsolation:m,inert:p,setCallbacks:i,allowPinchZoom:!!g,lockRef:t,gapMode:w}),o?T.cloneElement(T.Children.only(a),jr(jr({},S),{ref:I})):T.createElement(x,jr({},S,{className:l,ref:I}),a))});Sh.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Sh.classNames={fullWidth:Uu,zeroRight:Bu};var xM=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function wM(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var e=xM();return e&&r.setAttribute("nonce",e),r}function bM(r,e){r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}function SM(r){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(r)}var EM=function(){var r=0,e=null;return{add:function(t){r==0&&(e=wM())&&(bM(e,t),SM(e)),r++},remove:function(){r--,!r&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},TM=function(){var r=EM();return function(e,t){T.useEffect(function(){return r.add(e),function(){r.remove()}},[e&&t])}},x1=function(){var r=TM(),e=function(t){var n=t.styles,s=t.dynamic;return r(n,s),null};return e},_M={left:0,top:0,right:0,gap:0},Tf=function(r){return parseInt(r||"",10)||0},AM=function(r){var e=window.getComputedStyle(document.body),t=e[r==="padding"?"paddingLeft":"marginLeft"],n=e[r==="padding"?"paddingTop":"marginTop"],s=e[r==="padding"?"paddingRight":"marginRight"];return[Tf(t),Tf(n),Tf(s)]},kM=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return _M;var e=AM(r),t=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-t+e[2]-e[0])}},IM=x1(),qo="data-scroll-locked",RM=function(r,e,t,n){var s=r.left,i=r.top,o=r.right,a=r.gap;return t===void 0&&(t="margin"),`
  .`.concat(uM,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(qo,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Bu,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Uu,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(Bu," .").concat(Bu,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Uu," .").concat(Uu,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(qo,`] {
    `).concat(dM,": ").concat(a,`px;
  }
`)},Dx=function(){var r=parseInt(document.body.getAttribute(qo)||"0",10);return isFinite(r)?r:0},CM=function(){T.useEffect(function(){return document.body.setAttribute(qo,(Dx()+1).toString()),function(){var r=Dx()-1;r<=0?document.body.removeAttribute(qo):document.body.setAttribute(qo,r.toString())}},[])},LM=function(r){var e=r.noRelative,t=r.noImportant,n=r.gapMode,s=n===void 0?"margin":n;CM();var i=T.useMemo(function(){return kM(s)},[s]);return T.createElement(IM,{styles:RM(i,!e,s,t?"":"!important")})},Rm=!1;if(typeof window<"u")try{var Wc=Object.defineProperty({},"passive",{get:function(){return Rm=!0,!0}});window.addEventListener("test",Wc,Wc),window.removeEventListener("test",Wc,Wc)}catch{Rm=!1}var io=Rm?{passive:!1}:!1,PM=function(r){return r.tagName==="TEXTAREA"},w1=function(r,e){if(!(r instanceof Element))return!1;var t=window.getComputedStyle(r);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!PM(r)&&t[e]==="visible")},DM=function(r){return w1(r,"overflowY")},OM=function(r){return w1(r,"overflowX")},Ox=function(r,e){var t=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=b1(r,n);if(s){var i=S1(r,n),o=i[1],a=i[2];if(o>a)return!0}n=n.parentNode}while(n&&n!==t.body);return!1},NM=function(r){var e=r.scrollTop,t=r.scrollHeight,n=r.clientHeight;return[e,t,n]},MM=function(r){var e=r.scrollLeft,t=r.scrollWidth,n=r.clientWidth;return[e,t,n]},b1=function(r,e){return r==="v"?DM(e):OM(e)},S1=function(r,e){return r==="v"?NM(e):MM(e)},FM=function(r,e){return r==="h"&&e==="rtl"?-1:1},jM=function(r,e,t,n,s){var i=FM(r,window.getComputedStyle(e).direction),o=i*n,a=t.target,l=e.contains(a),c=!1,u=o>0,d=0,h=0;do{if(!a)break;var f=S1(r,a),m=f[0],p=f[1],g=f[2],y=p-g-i*m;(m||y)&&b1(r,a)&&(d+=y,h+=m);var x=a.parentNode;a=x&&x.nodeType===Node.DOCUMENT_FRAGMENT_NODE?x.host:x}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(h)<1)&&(c=!0),c},Kc=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},Nx=function(r){return[r.deltaX,r.deltaY]},Mx=function(r){return r&&"current"in r?r.current:r},$M=function(r,e){return r[0]===e[0]&&r[1]===e[1]},BM=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},UM=0,oo=[];function zM(r){var e=T.useRef([]),t=T.useRef([0,0]),n=T.useRef(),s=T.useState(UM++)[0],i=T.useState(x1)[0],o=T.useRef(r);T.useEffect(function(){o.current=r},[r]),T.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(s));var p=D0([r.lockRef.current],(r.shards||[]).map(Mx),!0).filter(Boolean);return p.forEach(function(g){return g.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),p.forEach(function(g){return g.classList.remove("allow-interactivity-".concat(s))})}}},[r.inert,r.lockRef.current,r.shards]);var a=T.useCallback(function(p,g){if("touches"in p&&p.touches.length===2||p.type==="wheel"&&p.ctrlKey)return!o.current.allowPinchZoom;var y=Kc(p),x=t.current,w="deltaX"in p?p.deltaX:x[0]-y[0],b="deltaY"in p?p.deltaY:x[1]-y[1],E,I=p.target,S=Math.abs(w)>Math.abs(b)?"h":"v";if("touches"in p&&S==="h"&&I.type==="range")return!1;var C=Ox(S,I);if(!C)return!0;if(C?E=S:(E=S==="v"?"h":"v",C=Ox(S,I)),!C)return!1;if(!n.current&&"changedTouches"in p&&(w||b)&&(n.current=E),!E)return!0;var R=n.current||E;return jM(R,g,p,R==="h"?w:b)},[]),l=T.useCallback(function(p){var g=p;if(!(!oo.length||oo[oo.length-1]!==i)){var y="deltaY"in g?Nx(g):Kc(g),x=e.current.filter(function(E){return E.name===g.type&&(E.target===g.target||g.target===E.shadowParent)&&$M(E.delta,y)})[0];if(x&&x.should){g.cancelable&&g.preventDefault();return}if(!x){var w=(o.current.shards||[]).map(Mx).filter(Boolean).filter(function(E){return E.contains(g.target)}),b=w.length>0?a(g,w[0]):!o.current.noIsolation;b&&g.cancelable&&g.preventDefault()}}},[]),c=T.useCallback(function(p,g,y,x){var w={name:p,delta:g,target:y,should:x,shadowParent:GM(y)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(b){return b!==w})},1)},[]),u=T.useCallback(function(p){t.current=Kc(p),n.current=void 0},[]),d=T.useCallback(function(p){c(p.type,Nx(p),p.target,a(p,r.lockRef.current))},[]),h=T.useCallback(function(p){c(p.type,Kc(p),p.target,a(p,r.lockRef.current))},[]);T.useEffect(function(){return oo.push(i),r.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,io),document.addEventListener("touchmove",l,io),document.addEventListener("touchstart",u,io),function(){oo=oo.filter(function(p){return p!==i}),document.removeEventListener("wheel",l,io),document.removeEventListener("touchmove",l,io),document.removeEventListener("touchstart",u,io)}},[]);var f=r.removeScrollBar,m=r.inert;return T.createElement(T.Fragment,null,m?T.createElement(i,{styles:BM(s)}):null,f?T.createElement(LM,{noRelative:r.noRelative,gapMode:r.gapMode}):null)}function GM(r){for(var e=null;r!==null;)r instanceof ShadowRoot&&(e=r.host,r=r.host),r=r.parentNode;return e}const HM=vM(v1,zM);var E1=T.forwardRef(function(r,e){return T.createElement(Sh,jr({},r,{ref:e,sideCar:HM}))});E1.classNames=Sh.classNames;var VM=function(r){if(typeof document>"u")return null;var e=Array.isArray(r)?r[0]:r;return e.ownerDocument.body},ao=new WeakMap,qc=new WeakMap,Yc={},_f=0,T1=function(r){return r&&(r.host||T1(r.parentNode))},WM=function(r,e){return e.map(function(t){if(r.contains(t))return t;var n=T1(t);return n&&r.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",r,". Doing nothing"),null)}).filter(function(t){return!!t})},KM=function(r,e,t,n){var s=WM(e,Array.isArray(r)?r:[r]);Yc[t]||(Yc[t]=new WeakMap);var i=Yc[t],o=[],a=new Set,l=new Set(s),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};s.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var f=h.getAttribute(n),m=f!==null&&f!=="false",p=(ao.get(h)||0)+1,g=(i.get(h)||0)+1;ao.set(h,p),i.set(h,g),o.push(h),p===1&&m&&qc.set(h,!0),g===1&&h.setAttribute(t,"true"),m||h.setAttribute(n,"true")}catch(y){console.error("aria-hidden: cannot operate on ",h,y)}})};return u(e),a.clear(),_f++,function(){o.forEach(function(d){var h=ao.get(d)-1,f=i.get(d)-1;ao.set(d,h),i.set(d,f),h||(qc.has(d)||d.removeAttribute(n),qc.delete(d)),f||d.removeAttribute(t)}),_f--,_f||(ao=new WeakMap,ao=new WeakMap,qc=new WeakMap,Yc={})}},qM=function(r,e,t){t===void 0&&(t="data-aria-hidden");var n=Array.from(Array.isArray(r)?r:[r]),s=VM(r);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live]"))),KM(n,s,t,"aria-hidden")):function(){return null}},Eh="Dialog",[_1]=eo(Eh),[YM,xn]=_1(Eh),A1=r=>{const{__scopeDialog:e,children:t,open:n,defaultOpen:s,onOpenChange:i,modal:o=!0}=r,a=T.useRef(null),l=T.useRef(null),[c,u]=o0({prop:n,defaultProp:s??!1,onChange:i,caller:Eh});return v.jsx(YM,{scope:e,triggerRef:a,contentRef:l,contentId:ju(),titleId:ju(),descriptionId:ju(),open:c,onOpenChange:u,onOpenToggle:T.useCallback(()=>u(d=>!d),[u]),modal:o,children:t})};A1.displayName=Eh;var k1="DialogTrigger",I1=T.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=xn(k1,t),i=vt(e,s.triggerRef);return v.jsx(qe.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":M0(s.open),...n,ref:i,onClick:Ue(r.onClick,s.onOpenToggle)})});I1.displayName=k1;var O0="DialogPortal",[QM,R1]=_1(O0,{forceMount:void 0}),C1=r=>{const{__scopeDialog:e,forceMount:t,children:n,container:s}=r,i=xn(O0,e);return v.jsx(QM,{scope:e,forceMount:t,children:T.Children.map(n,o=>v.jsx(vn,{present:t||i.open,children:v.jsx(i0,{asChild:!0,container:s,children:o})}))})};C1.displayName=O0;var Cd="DialogOverlay",L1=T.forwardRef((r,e)=>{const t=R1(Cd,r.__scopeDialog),{forceMount:n=t.forceMount,...s}=r,i=xn(Cd,r.__scopeDialog);return i.modal?v.jsx(vn,{present:n||i.open,children:v.jsx(JM,{...s,ref:e})}):null});L1.displayName=Cd;var XM=Ol("DialogOverlay.RemoveScroll"),JM=T.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=xn(Cd,t);return v.jsx(E1,{as:XM,allowPinchZoom:!0,shards:[s.contentRef],children:v.jsx(qe.div,{"data-state":M0(s.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),Qi="DialogContent",P1=T.forwardRef((r,e)=>{const t=R1(Qi,r.__scopeDialog),{forceMount:n=t.forceMount,...s}=r,i=xn(Qi,r.__scopeDialog);return v.jsx(vn,{present:n||i.open,children:i.modal?v.jsx(ZM,{...s,ref:e}):v.jsx(eF,{...s,ref:e})})});P1.displayName=Qi;var ZM=T.forwardRef((r,e)=>{const t=xn(Qi,r.__scopeDialog),n=T.useRef(null),s=vt(e,t.contentRef,n);return T.useEffect(()=>{const i=n.current;if(i)return qM(i)},[]),v.jsx(D1,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ue(r.onCloseAutoFocus,i=>{var o;i.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Ue(r.onPointerDownOutside,i=>{const o=i.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&i.preventDefault()}),onFocusOutside:Ue(r.onFocusOutside,i=>i.preventDefault())})}),eF=T.forwardRef((r,e)=>{const t=xn(Qi,r.__scopeDialog),n=T.useRef(!1),s=T.useRef(!1);return v.jsx(D1,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,a;(o=r.onCloseAutoFocus)==null||o.call(r,i),i.defaultPrevented||(n.current||(a=t.triggerRef.current)==null||a.focus(),i.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:i=>{var l,c;(l=r.onInteractOutside)==null||l.call(r,i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const o=i.target;((c=t.triggerRef.current)==null?void 0:c.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&s.current&&i.preventDefault()}})}),D1=T.forwardRef((r,e)=>{const{__scopeDialog:t,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:i,...o}=r,a=xn(Qi,t),l=T.useRef(null),c=vt(e,l);return iM(),v.jsxs(v.Fragment,{children:[v.jsx(V_,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:i,children:v.jsx(ch,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":M0(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),v.jsxs(v.Fragment,{children:[v.jsx(tF,{titleId:a.titleId}),v.jsx(nF,{contentRef:l,descriptionId:a.descriptionId})]})]})}),N0="DialogTitle",O1=T.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=xn(N0,t);return v.jsx(qe.h2,{id:s.titleId,...n,ref:e})});O1.displayName=N0;var N1="DialogDescription",M1=T.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=xn(N1,t);return v.jsx(qe.p,{id:s.descriptionId,...n,ref:e})});M1.displayName=N1;var F1="DialogClose",j1=T.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=xn(F1,t);return v.jsx(qe.button,{type:"button",...n,ref:e,onClick:Ue(r.onClick,()=>s.onOpenChange(!1))})});j1.displayName=F1;function M0(r){return r?"open":"closed"}var $1="DialogTitleWarning",[e6,B1]=eL($1,{contentName:Qi,titleName:N0,docsSlug:"dialog"}),tF=({titleId:r})=>{const e=B1($1),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return T.useEffect(()=>{r&&(document.getElementById(r)||console.error(t))},[t,r]),null},rF="DialogDescriptionWarning",nF=({contentRef:r,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${B1(rF).contentName}}.`;return T.useEffect(()=>{var i;const s=(i=r.current)==null?void 0:i.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(n))},[n,r,e]),null},U1=A1,sF=I1,z1=C1,Th=L1,_h=P1,Ah=O1,kh=M1,G1=j1;const iF=U1,oF=sF,aF=z1,H1=T.forwardRef(({className:r,...e},t)=>v.jsx(Th,{className:Te("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...e,ref:t}));H1.displayName=Th.displayName;const lF=hh("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),V1=T.forwardRef(({side:r="right",className:e,children:t,...n},s)=>v.jsxs(aF,{children:[v.jsx(H1,{}),v.jsxs(_h,{ref:s,className:Te(lF({side:r}),e),...n,children:[t,v.jsxs(G1,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[v.jsx(ui,{className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));V1.displayName=_h.displayName;const W1=({className:r,...e})=>v.jsx("div",{className:Te("flex flex-col space-y-2 text-center sm:text-left",r),...e});W1.displayName="SheetHeader";const K1=T.forwardRef(({className:r,...e},t)=>v.jsx(Ah,{ref:t,className:Te("text-lg font-semibold text-foreground",r),...e}));K1.displayName=Ah.displayName;const cF=T.forwardRef(({className:r,...e},t)=>v.jsx(kh,{ref:t,className:Te("text-sm text-muted-foreground",r),...e}));cF.displayName=kh.displayName;var Ih="Collapsible",[uF]=eo(Ih),[dF,F0]=uF(Ih),q1=T.forwardRef((r,e)=>{const{__scopeCollapsible:t,open:n,defaultOpen:s,disabled:i,onOpenChange:o,...a}=r,[l,c]=o0({prop:n,defaultProp:s??!1,onChange:o,caller:Ih});return v.jsx(dF,{scope:t,disabled:i,contentId:ju(),open:l,onOpenToggle:T.useCallback(()=>c(u=>!u),[c]),children:v.jsx(qe.div,{"data-state":$0(l),"data-disabled":i?"":void 0,...a,ref:e})})});q1.displayName=Ih;var Y1="CollapsibleTrigger",Q1=T.forwardRef((r,e)=>{const{__scopeCollapsible:t,...n}=r,s=F0(Y1,t);return v.jsx(qe.button,{type:"button","aria-controls":s.contentId,"aria-expanded":s.open||!1,"data-state":$0(s.open),"data-disabled":s.disabled?"":void 0,disabled:s.disabled,...n,ref:e,onClick:Ue(r.onClick,s.onOpenToggle)})});Q1.displayName=Y1;var j0="CollapsibleContent",X1=T.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=F0(j0,r.__scopeCollapsible);return v.jsx(vn,{present:t||s.open,children:({present:i})=>v.jsx(hF,{...n,ref:e,present:i})})});X1.displayName=j0;var hF=T.forwardRef((r,e)=>{const{__scopeCollapsible:t,present:n,children:s,...i}=r,o=F0(j0,t),[a,l]=T.useState(n),c=T.useRef(null),u=vt(e,c),d=T.useRef(0),h=d.current,f=T.useRef(0),m=f.current,p=o.open||a,g=T.useRef(p),y=T.useRef(void 0);return T.useEffect(()=>{const x=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(x)},[]),mn(()=>{const x=c.current;if(x){y.current=y.current||{transitionDuration:x.style.transitionDuration,animationName:x.style.animationName},x.style.transitionDuration="0s",x.style.animationName="none";const w=x.getBoundingClientRect();d.current=w.height,f.current=w.width,g.current||(x.style.transitionDuration=y.current.transitionDuration,x.style.animationName=y.current.animationName),l(n)}},[o.open,n]),v.jsx(qe.div,{"data-state":$0(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!p,...i,ref:u,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":m?`${m}px`:void 0,...r.style},children:p&&s})});function $0(r){return r?"open":"closed"}var fF=q1;const B0=fF,U0=Q1,z0=X1,Vn=async r=>{{const e=await fetch(`https://rxsgzadulpspurijnijl.supabase.co/functions/v1/movie-proxy?endpoint=${encodeURIComponent(r)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`API call failed: ${e.statusText}`);return{data:await e.json()}}},lo=r=>{var s,i,o;const e=(s=r.releaseDate)==null?void 0:s.split("-")[0],t=((i=r.genre)==null?void 0:i.split(",").map(a=>a.trim()))||[],n=r.duration?Math.floor(r.duration/60):void 0;return{id:r.subjectId,detailPath:r.detailPath,title:r.title,poster:((o=r.cover)==null?void 0:o.url)||"",year:e,rating:r.imdbRatingValue,genre:t,description:r.description,duration:n?`${n}min`:void 0,subjectType:r.subjectType}},Ot={getHomepage:async()=>{const{data:r}=await Vn("/homepage");if(!r.results||!r.results.operatingList)return{featured:[],categories:[],trending:[]};const e=[];let t=[];return r.results.operatingList.forEach(n=>{var s,i;if(n.type==="BANNER"&&((s=n.banner)!=null&&s.items)){const o=n.banner.items.filter(a=>a.subject).map(a=>lo(a.subject));(i=n.title)!=null&&i.includes("Banner")&&o.length>0&&(t=o)}else n.subjects&&n.subjects.length>0&&e.push({name:n.title||"Movies",movies:n.subjects.map(lo)})}),{featured:t,categories:e,trending:[]}},getTrending:async()=>{var e;const{data:r}=await Vn("/trending");return(e=r.results)!=null&&e.subjectList?r.results.subjectList.map(lo):[]},searchMovies:async r=>{var t;const{data:e}=await Vn(`/search/${encodeURIComponent(r)}`);return(t=e.results)!=null&&t.items?e.results.items.map(lo):[]},getMovieDetails:async r=>{var e,t,n,s;try{const{data:i}=await Vn(`/info/${r}`);if(i.error||i.status===500)throw console.error("API error response:",i),new Error(i.error||"Movie not found");if(!((e=i.results)!=null&&e.subject))throw console.error("Invalid API response:",i),new Error("Movie not found");const o=i.results.subject,a=lo(o);if(o.subtitles){a.subtitlesString=o.subtitles;const d=o.subtitles.split(",").map(h=>h.trim());a.subtitles=d.map(h=>({language:h.toLowerCase().replace(/\s+/g,"-"),label:h,url:void 0}))}let l=o.trailer_url;(n=(t=o.trailer)==null?void 0:t.videoAddress)!=null&&n.url?l=o.trailer.videoAddress.url:typeof o.trailer=="string"&&(l=o.trailer),a.trailer=l,a.trailer_url=l;const c=o.subjectType===2;a.isSeries=c;const u=(s=i.results)==null?void 0:s.resource;return c&&(u!=null&&u.seasons)&&(a.seasons=u.seasons.map(d=>({seasonNumber:d.se,episodes:Array.from({length:d.maxEp},(h,f)=>({episodeNumber:f+1,sources:[]}))}))),u&&(a.resource=u),i.results.stars&&(a.cast=i.results.stars.filter(d=>d.staffType===1).slice(0,15).map(d=>{var h;return{name:d.name,image:d.avatarUrl||d.image||((h=d.cover)==null?void 0:h.url),character:d.character||d.roleName}})),a}catch(i){throw console.error("Error fetching movie details:",i),i}},getMovieSources:async r=>{var e;try{try{const{data:i}=await Vn(`/sources/${r}`);if(i.results&&Array.isArray(i.results)&&i.results.length>0){const o=i.subtitles?i.subtitles.map(a=>({language:a.lan,label:a.lanName,url:a.url})):[];return i.results.map(a=>({...a,size:a.size?`${(parseInt(a.size)/(1024*1024)).toFixed(0)}MB`:"",stream_url:a.stream_url||a.download_url,subtitles:o}))}}catch{console.log("Direct sources endpoint failed, trying with detailPath")}const n=(e=(await Vn(`/info/${r}`)).data.results)==null?void 0:e.subject;if(!n)return[];const{data:s}=await Vn(`/sources/${n.detailPath}`);if(s.results&&Array.isArray(s.results)&&s.results.length>0){const i=s.subtitles?s.subtitles.map(o=>({language:o.lan,label:o.lanName,url:o.url})):[];return s.results.map(o=>({...o,size:o.size?`${(parseInt(o.size)/(1024*1024)).toFixed(0)}MB`:"",stream_url:o.stream_url||o.download_url,subtitles:i}))}return[]}catch(t){return console.error("Error fetching movie sources:",t),[]}},getEpisodeSources:async(r,e,t)=>{try{const{data:n}=await Vn(`/sources/${r}?season=${e}&episode=${t}`);if(n.results&&Array.isArray(n.results)&&n.results.length>0){const s=n.subtitles?n.subtitles.map(i=>({language:i.lan,label:i.lanName,url:i.url})):[];return n.results.map(i=>({...i,size:i.size?`${(parseInt(i.size)/(1024*1024)).toFixed(0)}MB`:"",stream_url:i.stream_url||i.download_url,subtitles:s}))}return[]}catch(n){return console.log(`No sources found for S${e}E${t}:`,n),[]}},getSubtitleUrl:(r,e,t,n)=>{const s="https://subs.movieapi.giftedtech.co.ke";return t&&n?`${s}/${r}/S${t}E${n}/${e}.vtt`:`${s}/${r}/${e}.vtt`},getRelatedMovies:async(r,e)=>{var t;try{const{data:n}=await Vn("/homepage");if(!((t=n.results)!=null&&t.operatingList))return[];let s=[];n.results.operatingList.forEach(o=>{o.subjects&&o.subjects.length>0&&(s=[...s,...o.subjects.map(lo)])});let i=s.filter(o=>o.id!==r);if(e&&e.length>0){const o=i.filter(a=>a.genre&&a.genre.some(l=>e.includes(l)));return[...o,...i.filter(a=>!o.includes(a))].slice(0,12)}return i.slice(0,12)}catch(n){return console.error("Error fetching related movies:",n),[]}}},pF=()=>{const[r,e]=T.useState(null),[t,n]=T.useState(!1);return T.useEffect(()=>{n((()=>{const a=navigator.userAgent.toLowerCase();return!/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(a)})());const o=a=>{a.preventDefault(),e(a)};return window.addEventListener("beforeinstallprompt",o),()=>{window.removeEventListener("beforeinstallprompt",o)}},[]),{installPWA:async()=>{if(!r){window.open("https://install.bwmxmd.online","_blank");return}try{await r.prompt();const{outcome:i}=await r.userChoice;i==="accepted"&&console.log("PWA installed successfully"),e(null)}catch(i){console.error("Error installing PWA:",i),window.open("https://install.bwmxmd.online","_blank")}},isDesktop:t}},mF="MovieAppDB",gF=1,Oe={VIDEO_PROGRESS:"videoProgress",WATCH_HISTORY:"watchHistory",SEARCH_HISTORY:"searchHistory",SETTINGS:"settings"};class yF{constructor(){pt(this,"db",null);pt(this,"initPromise",null)}async init(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const n=indexedDB.open(mF,gF);n.onerror=()=>{console.error("IndexedDB failed to open:",n.error),t(n.error)},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=s=>{const i=s.target.result;i.objectStoreNames.contains(Oe.VIDEO_PROGRESS)||i.createObjectStore(Oe.VIDEO_PROGRESS,{keyPath:"id"}),i.objectStoreNames.contains(Oe.WATCH_HISTORY)||i.createObjectStore(Oe.WATCH_HISTORY,{keyPath:"id"}).createIndex("watchedAt","watchedAt",{unique:!1}),i.objectStoreNames.contains(Oe.SEARCH_HISTORY)||i.createObjectStore(Oe.SEARCH_HISTORY,{keyPath:"term"}).createIndex("timestamp","timestamp",{unique:!1}),i.objectStoreNames.contains(Oe.SETTINGS)||i.createObjectStore(Oe.SETTINGS,{keyPath:"key"})}}),this.initPromise)}async getVideoProgress(e){try{return await this.init(),this.db?new Promise((t,n)=>{const o=this.db.transaction([Oe.VIDEO_PROGRESS],"readonly").objectStore(Oe.VIDEO_PROGRESS).get(e);o.onsuccess=()=>t(o.result||null),o.onerror=()=>n(o.error)}):null}catch(t){return console.error("Error getting video progress:",t),null}}async saveVideoProgress(e,t){try{if(await this.init(),!this.db)throw new Error("DB not initialized");return new Promise((n,s)=>{const a=this.db.transaction([Oe.VIDEO_PROGRESS],"readwrite").objectStore(Oe.VIDEO_PROGRESS).put({id:e,...t});a.onsuccess=()=>n(),a.onerror=()=>s(a.error)})}catch(n){console.error("Error saving video progress:",n)}}async deleteVideoProgress(e){try{return await this.init(),this.db?new Promise((t,n)=>{const o=this.db.transaction([Oe.VIDEO_PROGRESS],"readwrite").objectStore(Oe.VIDEO_PROGRESS).delete(e);o.onsuccess=()=>t(),o.onerror=()=>n(o.error)}):void 0}catch(t){console.error("Error deleting video progress:",t)}}async getAllVideoProgress(){try{return await this.init(),this.db?new Promise((e,t)=>{const i=this.db.transaction([Oe.VIDEO_PROGRESS],"readonly").objectStore(Oe.VIDEO_PROGRESS).getAll();i.onsuccess=()=>{const o={};i.result.forEach(a=>{o[a.id]=a}),e(o)},i.onerror=()=>t(i.error)}):{}}catch(e){return console.error("Error getting all video progress:",e),{}}}async getWatchHistory(){try{return await this.init(),this.db?new Promise((e,t)=>{const i=this.db.transaction([Oe.WATCH_HISTORY],"readonly").objectStore(Oe.WATCH_HISTORY).getAll();i.onsuccess=()=>e(i.result||[]),i.onerror=()=>t(i.error)}):[]}catch(e){return console.error("Error getting watch history:",e),[]}}async saveWatchHistory(e){try{if(await this.init(),!this.db)throw new Error("DB not initialized");return new Promise((t,n)=>{const s=this.db.transaction([Oe.WATCH_HISTORY],"readwrite"),i=s.objectStore(Oe.WATCH_HISTORY);i.clear(),e.forEach(o=>{i.put(o)}),s.oncomplete=()=>t(),s.onerror=()=>n(s.error)})}catch(t){console.error("Error saving watch history:",t)}}async addToWatchHistory(e){try{if(await this.init(),!this.db)throw new Error("DB not initialized");return new Promise((t,n)=>{const o=this.db.transaction([Oe.WATCH_HISTORY],"readwrite").objectStore(Oe.WATCH_HISTORY).put(e);o.onsuccess=()=>t(),o.onerror=()=>n(o.error)})}catch(t){console.error("Error adding to watch history:",t)}}async deleteFromWatchHistory(e){try{return await this.init(),this.db?new Promise((t,n)=>{const o=this.db.transaction([Oe.WATCH_HISTORY],"readwrite").objectStore(Oe.WATCH_HISTORY).delete(e);o.onsuccess=()=>t(),o.onerror=()=>n(o.error)}):void 0}catch(t){console.error("Error deleting from watch history:",t)}}async clearWatchHistory(){try{return await this.init(),this.db?new Promise((e,t)=>{const i=this.db.transaction([Oe.WATCH_HISTORY],"readwrite").objectStore(Oe.WATCH_HISTORY).clear();i.onsuccess=()=>e(),i.onerror=()=>t(i.error)}):void 0}catch(e){console.error("Error clearing watch history:",e)}}async getSearchHistory(){try{return await this.init(),this.db?new Promise((e,t)=>{const o=this.db.transaction([Oe.SEARCH_HISTORY],"readonly").objectStore(Oe.SEARCH_HISTORY).index("timestamp").openCursor(null,"prev"),a=[];o.onsuccess=()=>{const l=o.result;l?(a.push(l.value.term),l.continue()):e(a)},o.onerror=()=>t(o.error)}):[]}catch(e){return console.error("Error getting search history:",e),[]}}async addSearchTerm(e){try{if(await this.init(),!this.db)throw new Error("DB not initialized");return new Promise((t,n)=>{const o=this.db.transaction([Oe.SEARCH_HISTORY],"readwrite").objectStore(Oe.SEARCH_HISTORY).put({term:e,timestamp:Date.now()});o.onsuccess=()=>t(),o.onerror=()=>n(o.error)})}catch(t){console.error("Error adding search term:",t)}}async deleteSearchTerm(e){try{return await this.init(),this.db?new Promise((t,n)=>{const o=this.db.transaction([Oe.SEARCH_HISTORY],"readwrite").objectStore(Oe.SEARCH_HISTORY).delete(e);o.onsuccess=()=>t(),o.onerror=()=>n(o.error)}):void 0}catch(t){console.error("Error deleting search term:",t)}}async clearSearchHistory(){try{return await this.init(),this.db?new Promise((e,t)=>{const i=this.db.transaction([Oe.SEARCH_HISTORY],"readwrite").objectStore(Oe.SEARCH_HISTORY).clear();i.onsuccess=()=>e(),i.onerror=()=>t(i.error)}):void 0}catch(e){console.error("Error clearing search history:",e)}}async getSetting(e){try{return await this.init(),this.db?new Promise((t,n)=>{const o=this.db.transaction([Oe.SETTINGS],"readonly").objectStore(Oe.SETTINGS).get(e);o.onsuccess=()=>{var a;return t(((a=o.result)==null?void 0:a.value)||null)},o.onerror=()=>n(o.error)}):null}catch(t){return console.error("Error getting setting:",t),null}}async saveSetting(e,t){try{if(await this.init(),!this.db)throw new Error("DB not initialized");return new Promise((n,s)=>{const a=this.db.transaction([Oe.SETTINGS],"readwrite").objectStore(Oe.SETTINGS).put({key:e,value:t});a.onsuccess=()=>n(),a.onerror=()=>s(a.error)})}catch(n){console.error("Error saving setting:",n)}}}const wt=new yF;class vF{constructor(){pt(this,"migrated",!1);pt(this,"useIndexedDB",!0)}async init(){try{await wt.init(),this.migrated||(await this.migrateFromLocalStorage(),this.migrated=!0)}catch(e){console.error("IndexedDB initialization failed, falling back to localStorage:",e),this.useIndexedDB=!1}}async migrateFromLocalStorage(){try{const e=localStorage.getItem("videoProgress");if(e){const i=JSON.parse(e);for(const[o,a]of Object.entries(i))await wt.saveVideoProgress(o,a);console.log(" Migrated video progress to IndexedDB")}const t=localStorage.getItem("watch_history");if(t){const i=JSON.parse(t);await wt.saveWatchHistory(i),console.log(" Migrated watch history to IndexedDB")}const n=localStorage.getItem("movie_search_history");if(n){const i=JSON.parse(n);for(const o of i)await wt.addSearchTerm(o);console.log(" Migrated search history to IndexedDB")}const s=localStorage.getItem("selectedVideoQuality");s&&(await wt.saveSetting("selectedVideoQuality",s),console.log(" Migrated quality setting to IndexedDB")),console.log(" Migration from localStorage to IndexedDB complete")}catch(e){console.error("Error during migration:",e)}}async getVideoProgress(e){try{if(this.useIndexedDB)return await wt.getVideoProgress(e)}catch(t){console.warn("IndexedDB failed, using localStorage:",t)}try{return JSON.parse(localStorage.getItem("videoProgress")||"{}")[e]||null}catch(t){return console.error("Error reading from storage:",t),null}}async saveVideoProgress(e,t){const n={...t,updatedAt:new Date().toISOString()};try{if(this.useIndexedDB){await wt.saveVideoProgress(e,n);return}}catch(s){console.warn("IndexedDB save failed, using localStorage:",s)}try{const s=JSON.parse(localStorage.getItem("videoProgress")||"{}");s[e]=n,localStorage.setItem("videoProgress",JSON.stringify(s))}catch(s){console.error("Failed to save video progress (storage may be full):",s),this.cleanupOldData()}}async deleteVideoProgress(e){try{if(this.useIndexedDB){await wt.deleteVideoProgress(e);return}}catch(t){console.warn("IndexedDB delete failed, using localStorage:",t)}try{const t=JSON.parse(localStorage.getItem("videoProgress")||"{}");delete t[e],localStorage.setItem("videoProgress",JSON.stringify(t))}catch(t){console.error("Error deleting video progress:",t)}}async getAllVideoProgress(){try{if(this.useIndexedDB)return await wt.getAllVideoProgress()}catch(e){console.warn("IndexedDB failed, using localStorage:",e)}try{return JSON.parse(localStorage.getItem("videoProgress")||"{}")}catch(e){return console.error("Error getting all video progress:",e),{}}}async getWatchHistory(){try{if(this.useIndexedDB)return await wt.getWatchHistory()}catch(e){console.warn("IndexedDB failed, using localStorage:",e)}try{return JSON.parse(localStorage.getItem("watch_history")||"[]")}catch(e){return console.error("Error getting watch history:",e),[]}}async saveWatchHistory(e){const t=e.slice(0,50);try{if(this.useIndexedDB){await wt.saveWatchHistory(t);return}}catch(n){console.warn("IndexedDB save failed, using localStorage:",n)}try{localStorage.setItem("watch_history",JSON.stringify(t))}catch(n){console.error("Failed to save watch history (storage may be full):",n),this.cleanupOldData()}}async addToWatchHistory(e){try{if(this.useIndexedDB){await wt.addToWatchHistory(e);return}}catch(t){console.warn("IndexedDB add failed, using localStorage:",t)}try{const t=await this.getWatchHistory(),n=t.findIndex(s=>s.id===e.id);n!==-1?t[n]=e:t.unshift(e),await this.saveWatchHistory(t.slice(0,50))}catch(t){console.error("Error adding to watch history:",t)}}async deleteFromWatchHistory(e){try{if(this.useIndexedDB){await wt.deleteFromWatchHistory(e);return}}catch(t){console.warn("IndexedDB delete failed, using localStorage:",t)}try{const n=(await this.getWatchHistory()).filter(s=>s.id!==e);await this.saveWatchHistory(n)}catch(t){console.error("Error deleting from watch history:",t)}}async clearWatchHistory(){try{if(this.useIndexedDB){await wt.clearWatchHistory();return}}catch(e){console.warn("IndexedDB clear failed, using localStorage:",e)}try{localStorage.setItem("watch_history","[]")}catch(e){console.error("Error clearing watch history:",e)}}async getSearchHistory(){try{if(this.useIndexedDB)return await wt.getSearchHistory()}catch(e){console.warn("IndexedDB failed, using localStorage:",e)}try{return JSON.parse(localStorage.getItem("movie_search_history")||"[]")}catch(e){return console.error("Error getting search history:",e),[]}}async addSearchTerm(e){if(e.trim()){try{if(this.useIndexedDB){await wt.addSearchTerm(e);return}}catch(t){console.warn("IndexedDB add failed, using localStorage:",t)}try{const n=(await this.getSearchHistory()).filter(i=>i!==e);n.unshift(e);const s=n.slice(0,10);localStorage.setItem("movie_search_history",JSON.stringify(s))}catch(t){console.error("Error adding search term:",t)}}}async deleteSearchTerm(e){try{if(this.useIndexedDB){await wt.deleteSearchTerm(e);return}}catch(t){console.warn("IndexedDB delete failed, using localStorage:",t)}try{const n=(await this.getSearchHistory()).filter(s=>s!==e);localStorage.setItem("movie_search_history",JSON.stringify(n))}catch(t){console.error("Error deleting search term:",t)}}async clearSearchHistory(){try{if(this.useIndexedDB){await wt.clearSearchHistory();return}}catch(e){console.warn("IndexedDB clear failed, using localStorage:",e)}try{localStorage.removeItem("movie_search_history")}catch(e){console.error("Error clearing search history:",e)}}async getSetting(e,t=null){try{if(this.useIndexedDB){const n=await wt.getSetting(e);return n!==null?n:t}}catch(n){console.warn("IndexedDB failed, using localStorage:",n)}try{const n=localStorage.getItem(e);return n!==null?n:t}catch(n){return console.error("Error getting setting:",n),t}}async saveSetting(e,t){try{if(this.useIndexedDB){await wt.saveSetting(e,t);return}}catch(n){console.warn("IndexedDB save failed, using localStorage:",n)}try{localStorage.setItem(e,t)}catch(n){console.error("Error saving setting:",n)}}async cleanupOldData(){try{console.log("Cleaning up old data to free storage space...");const e=await this.getAllVideoProgress(),n=Object.entries(e).sort((i,o)=>{const a=new Date(i[1].updatedAt||0).getTime();return new Date(o[1].updatedAt||0).getTime()-a});for(let i=20;i<n.length;i++)await this.deleteVideoProgress(n[i][0]);const s=await this.getWatchHistory();s.length>30&&await this.saveWatchHistory(s.slice(0,30)),console.log(" Cleanup complete")}catch(e){console.error("Error during cleanup:",e)}}}const ot=new vF;ot.init().catch(r=>{console.error("Failed to initialize storage:",r)});const xF=()=>{const[r,e]=T.useState(""),[t,n]=T.useState(!1),[s,i]=T.useState([]),[o,a]=T.useState(!1),l=Vr(),{installPWA:c,isDesktop:u}=pF(),{data:d}=Rr({queryKey:["homepage"],queryFn:Ot.getHomepage,staleTime:5*60*1e3}),h=async()=>{try{const p=await ot.getWatchHistory();i(p)}catch(p){console.error("Failed to load watch history:",p),i([])}},f=async p=>{var g;try{const x=(g=(await ot.getWatchHistory())[p])==null?void 0:g.id;x&&(await ot.deleteFromWatchHistory(x),await h(),Ki({title:"Deleted",description:"Item removed from watch history"}))}catch(y){console.error("Failed to delete item:",y)}},m=async()=>{try{await ot.clearWatchHistory(),i([]),Ki({title:"Cleared",description:"All watch history has been cleared"})}catch(p){console.error("Failed to clear history:",p)}};return v.jsx("nav",{className:"fixed top-0 left-0 lg:left-72 right-0 z-30 transition-all duration-300",children:v.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:v.jsxs("div",{className:"flex h-16 lg:h-20 items-center justify-between gap-4",children:[v.jsxs(Js,{to:"/",className:"flex lg:hidden items-center gap-2 shrink-0 group",children:[v.jsx("div",{className:"relative",children:v.jsx("img",{src:"https://url.bwmxmd.online/Adams.4mbjrppb.jpg",alt:"BWMGIFT Logo",className:"h-9 w-9 object-contain transition-transform group-hover:scale-110 drop-shadow-[0_0_12px_rgba(239,68,68,0.6)]"})}),v.jsxs("span",{className:"text-2xl font-black tracking-tight drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",style:{background:"linear-gradient(135deg, #ef4444 0%, #f97316 50%, #eab308 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:["BWM",v.jsx("span",{style:{background:"linear-gradient(135deg, #10b981 0%, #3b82f6 50%, #8b5cf6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"GIFT"})]})]}),v.jsx(pe,{variant:"default",size:"icon",className:"hidden lg:flex shrink-0 bg-primary hover:bg-primary/90 ml-auto",onClick:()=>l("/search"),children:v.jsx(bd,{className:"h-4 w-4"})}),u&&v.jsxs(pe,{variant:"outline",size:"sm",className:"hidden lg:flex items-center gap-2 border-primary/40 bg-gradient-to-r from-primary/10 to-primary/5 hover:from-primary/20 hover:to-primary/10 hover:border-primary transition-all",onClick:c,children:[v.jsx(ti,{className:"h-4 w-4"}),"Download PC app"]}),v.jsxs("div",{className:"flex lg:hidden items-center gap-2",children:[v.jsx(pe,{variant:"ghost",size:"icon",className:"lg:hidden shrink-0 bg-black/60 hover:bg-black/80 border border-white/10",onClick:()=>l("/search"),children:v.jsx(bd,{className:"h-5 w-5"})}),v.jsxs(iF,{open:t,onOpenChange:p=>{n(p),p&&h()},children:[v.jsx(oF,{asChild:!0,children:v.jsx(pe,{variant:"outline",size:"icon",className:"shrink-0 border-primary/40 bg-gradient-to-br from-primary/5 to-primary/10 hover:from-primary/20 hover:to-primary/30 hover:border-primary hover:shadow-[0_0_15px_rgba(239,68,68,0.3)] transition-all duration-300",children:v.jsx(ZL,{className:"h-5 w-5 text-primary"})})}),v.jsxs(V1,{side:"right",className:"w-[320px] bg-gradient-to-br from-background via-background to-primary/5 backdrop-blur-xl border-l border-primary/30 shadow-2xl",children:[v.jsx(W1,{className:"border-b border-primary/20 pb-4 bg-gradient-to-r from-primary/5 to-transparent",children:v.jsx(K1,{className:"text-left",children:v.jsxs(Js,{to:"/",className:"flex items-center gap-3 group",onClick:()=>n(!1),children:[v.jsx("div",{className:"relative",children:v.jsx("img",{src:"https://url.bwmxmd.online/Adams.4mbjrppb.jpg",alt:"BWMGIFT Logo",className:"h-10 w-10 object-contain transition-transform group-hover:scale-110 group-hover:rotate-12 drop-shadow-[0_0_12px_rgba(239,68,68,0.6)]"})}),v.jsxs("span",{className:"text-2xl font-black tracking-tight drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",style:{background:"linear-gradient(135deg, #ef4444 0%, #f97316 50%, #eab308 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:["BWM",v.jsx("span",{style:{background:"linear-gradient(135deg, #10b981 0%, #3b82f6 50%, #8b5cf6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"GIFT"})]})]})})}),v.jsxs("div",{className:"flex flex-col gap-6 mt-8",children:[v.jsxs("div",{className:"flex flex-col gap-3",children:[v.jsx(pe,{variant:"ghost",className:"justify-start gap-3 hover:bg-primary/10 hover:text-primary transition-all",asChild:!0,children:v.jsxs(Js,{to:"/",onClick:()=>n(!1),children:[v.jsx(PT,{className:"h-5 w-5"}),"Home"]})}),(d==null?void 0:d.categories)&&d.categories.length>0&&v.jsxs(B0,{open:o,onOpenChange:a,children:[v.jsx(U0,{asChild:!0,children:v.jsxs(pe,{variant:"ghost",className:"w-full justify-between gap-3 hover:bg-primary/10 hover:text-primary transition-all",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsx(fh,{className:"h-5 w-5"}),"Categories"]}),v.jsx(u0,{className:`h-4 w-4 transition-transform ${o?"rotate-180":""}`})]})}),v.jsx(z0,{className:"pl-8 mt-1 max-h-[300px] overflow-y-auto space-y-1 scrollbar-thin scrollbar-thumb-primary/20 scrollbar-track-transparent",children:d.categories.map(p=>v.jsx(pe,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm hover:bg-primary/5 hover:text-primary",onClick:()=>{l(`/category/${encodeURIComponent(p.name)}`),n(!1)},children:p.name},p.name))})]}),u&&v.jsxs(pe,{variant:"ghost",className:"justify-start gap-3 hover:bg-primary/10 hover:text-primary transition-all",onClick:()=>{c(),n(!1)},children:[v.jsx(ti,{className:"h-5 w-5"}),"Download PC app"]}),v.jsxs("div",{className:"border-t border-border pt-4",children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"Watch History"}),s.length>0&&v.jsx(pe,{variant:"ghost",size:"sm",onClick:m,className:"text-xs h-auto py-1 px-2 hover:text-destructive",children:"Clear All"})]}),v.jsx("div",{className:"max-h-[400px] overflow-y-auto space-y-2 pr-2 scrollbar-thin scrollbar-thumb-primary/20 scrollbar-track-transparent",children:s.length>0?s.slice(0,20).map((p,g)=>v.jsxs("div",{className:"flex gap-2 p-2 bg-secondary/50 rounded-lg group relative hover:bg-secondary/70 transition-all",children:[v.jsxs("div",{className:"flex gap-2 flex-1 cursor-pointer",onClick:()=>{l(`/movie/${p.id}`),n(!1)},children:[v.jsx("img",{src:p.poster||"/placeholder.svg",alt:p.title,className:"w-12 h-16 object-cover rounded flex-shrink-0",onError:y=>{y.currentTarget.src="/placeholder.svg"}}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsx("p",{className:"font-medium truncate text-sm",children:p.title}),v.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(p.watchedAt).toLocaleDateString()})]})]}),v.jsx(pe,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity hover:text-destructive",onClick:y=>{y.stopPropagation(),f(g)},children:v.jsx(DT,{className:"h-4 w-4"})})]},g)):v.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No watched movies yet"})})]})]}),v.jsxs("div",{className:"border-t border-border pt-6 mt-4",children:[v.jsx("h3",{className:"font-semibold text-sm mb-3 text-muted-foreground",children:"Developed by"}),v.jsxs("p",{className:"text-sm text-foreground mb-4 font-medium",children:[v.jsx("span",{className:"text-primary",children:"Gifted Tech"})," & ",v.jsx("span",{className:"text-primary",children:"Ibrahim Adams"})]}),v.jsx("h3",{className:"font-semibold text-sm mb-3 text-muted-foreground",children:"Follow our sites"}),v.jsxs("div",{className:"flex flex-col gap-2",children:[v.jsx(pe,{variant:"outline",size:"sm",className:"justify-start gap-2 hover:bg-primary/10 hover:text-primary hover:border-primary transition-all",asChild:!0,children:v.jsxs("a",{href:"https://bwmxmd.online",target:"_blank",rel:"noopener noreferrer",children:[v.jsx(p0,{className:"h-4 w-4"}),"bwmxmd.online"]})}),v.jsx(pe,{variant:"outline",size:"sm",className:"justify-start gap-2 hover:bg-primary/10 hover:text-primary hover:border-primary transition-all",asChild:!0,children:v.jsxs("a",{href:"https://giftedtech.co.ke",target:"_blank",rel:"noopener noreferrer",children:[v.jsx(f0,{className:"h-4 w-4"}),"giftedtech.co.ke"]})})]})]})]})]})]})]})]})})})};var wF=T.createContext(void 0);function bF(r){const e=T.useContext(wF);return r||e||"ltr"}function SF(r,[e,t]){return Math.min(t,Math.max(e,r))}function EF(r,e){return T.useReducer((t,n)=>e[t][n]??t,r)}var G0="ScrollArea",[J1]=eo(G0),[TF,Wr]=J1(G0),Z1=T.forwardRef((r,e)=>{const{__scopeScrollArea:t,type:n="hover",dir:s,scrollHideDelay:i=600,...o}=r,[a,l]=T.useState(null),[c,u]=T.useState(null),[d,h]=T.useState(null),[f,m]=T.useState(null),[p,g]=T.useState(null),[y,x]=T.useState(0),[w,b]=T.useState(0),[E,I]=T.useState(!1),[S,C]=T.useState(!1),R=vt(e,$=>l($)),L=bF(s);return v.jsx(TF,{scope:t,type:n,dir:L,scrollHideDelay:i,scrollArea:a,viewport:c,onViewportChange:u,content:d,onContentChange:h,scrollbarX:f,onScrollbarXChange:m,scrollbarXEnabled:E,onScrollbarXEnabledChange:I,scrollbarY:p,onScrollbarYChange:g,scrollbarYEnabled:S,onScrollbarYEnabledChange:C,onCornerWidthChange:x,onCornerHeightChange:b,children:v.jsx(qe.div,{dir:L,...o,ref:R,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":w+"px",...r.style}})})});Z1.displayName=G0;var eA="ScrollAreaViewport",tA=T.forwardRef((r,e)=>{const{__scopeScrollArea:t,children:n,nonce:s,...i}=r,o=Wr(eA,t),a=T.useRef(null),l=vt(e,a,o.onViewportChange);return v.jsxs(v.Fragment,{children:[v.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),v.jsx(qe.div,{"data-radix-scroll-area-viewport":"",...i,ref:l,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...r.style},children:v.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});tA.displayName=eA;var zn="ScrollAreaScrollbar",H0=T.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=Wr(zn,r.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=s,a=r.orientation==="horizontal";return T.useEffect(()=>(a?i(!0):o(!0),()=>{a?i(!1):o(!1)}),[a,i,o]),s.type==="hover"?v.jsx(_F,{...n,ref:e,forceMount:t}):s.type==="scroll"?v.jsx(AF,{...n,ref:e,forceMount:t}):s.type==="auto"?v.jsx(rA,{...n,ref:e,forceMount:t}):s.type==="always"?v.jsx(V0,{...n,ref:e}):null});H0.displayName=zn;var _F=T.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=Wr(zn,r.__scopeScrollArea),[i,o]=T.useState(!1);return T.useEffect(()=>{const a=s.scrollArea;let l=0;if(a){const c=()=>{window.clearTimeout(l),o(!0)},u=()=>{l=window.setTimeout(()=>o(!1),s.scrollHideDelay)};return a.addEventListener("pointerenter",c),a.addEventListener("pointerleave",u),()=>{window.clearTimeout(l),a.removeEventListener("pointerenter",c),a.removeEventListener("pointerleave",u)}}},[s.scrollArea,s.scrollHideDelay]),v.jsx(vn,{present:t||i,children:v.jsx(rA,{"data-state":i?"visible":"hidden",...n,ref:e})})}),AF=T.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=Wr(zn,r.__scopeScrollArea),i=r.orientation==="horizontal",o=Ch(()=>l("SCROLL_END"),100),[a,l]=EF("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return T.useEffect(()=>{if(a==="idle"){const c=window.setTimeout(()=>l("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(c)}},[a,s.scrollHideDelay,l]),T.useEffect(()=>{const c=s.viewport,u=i?"scrollLeft":"scrollTop";if(c){let d=c[u];const h=()=>{const f=c[u];d!==f&&(l("SCROLL"),o()),d=f};return c.addEventListener("scroll",h),()=>c.removeEventListener("scroll",h)}},[s.viewport,i,l,o]),v.jsx(vn,{present:t||a!=="hidden",children:v.jsx(V0,{"data-state":a==="hidden"?"hidden":"visible",...n,ref:e,onPointerEnter:Ue(r.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:Ue(r.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),rA=T.forwardRef((r,e)=>{const t=Wr(zn,r.__scopeScrollArea),{forceMount:n,...s}=r,[i,o]=T.useState(!1),a=r.orientation==="horizontal",l=Ch(()=>{if(t.viewport){const c=t.viewport.offsetWidth<t.viewport.scrollWidth,u=t.viewport.offsetHeight<t.viewport.scrollHeight;o(a?c:u)}},10);return Sa(t.viewport,l),Sa(t.content,l),v.jsx(vn,{present:n||i,children:v.jsx(V0,{"data-state":i?"visible":"hidden",...s,ref:e})})}),V0=T.forwardRef((r,e)=>{const{orientation:t="vertical",...n}=r,s=Wr(zn,r.__scopeScrollArea),i=T.useRef(null),o=T.useRef(0),[a,l]=T.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),c=aA(a.viewport,a.content),u={...n,sizes:a,onSizesChange:l,hasThumb:c>0&&c<1,onThumbChange:h=>i.current=h,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:h=>o.current=h};function d(h,f){return PF(h,o.current,a,f)}return t==="horizontal"?v.jsx(kF,{...u,ref:e,onThumbPositionChange:()=>{if(s.viewport&&i.current){const h=s.viewport.scrollLeft,f=Fx(h,a,s.dir);i.current.style.transform=`translate3d(${f}px, 0, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollLeft=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollLeft=d(h,s.dir))}}):t==="vertical"?v.jsx(IF,{...u,ref:e,onThumbPositionChange:()=>{if(s.viewport&&i.current){const h=s.viewport.scrollTop,f=Fx(h,a);i.current.style.transform=`translate3d(0, ${f}px, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollTop=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollTop=d(h))}}):null}),kF=T.forwardRef((r,e)=>{const{sizes:t,onSizesChange:n,...s}=r,i=Wr(zn,r.__scopeScrollArea),[o,a]=T.useState(),l=T.useRef(null),c=vt(e,l,i.onScrollbarXChange);return T.useEffect(()=>{l.current&&a(getComputedStyle(l.current))},[l]),v.jsx(sA,{"data-orientation":"horizontal",...s,ref:c,sizes:t,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Rh(t)+"px",...r.style},onThumbPointerDown:u=>r.onThumbPointerDown(u.x),onDragScroll:u=>r.onDragScroll(u.x),onWheelScroll:(u,d)=>{if(i.viewport){const h=i.viewport.scrollLeft+u.deltaX;r.onWheelScroll(h),cA(h,d)&&u.preventDefault()}},onResize:()=>{l.current&&i.viewport&&o&&n({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:l.current.clientWidth,paddingStart:Pd(o.paddingLeft),paddingEnd:Pd(o.paddingRight)}})}})}),IF=T.forwardRef((r,e)=>{const{sizes:t,onSizesChange:n,...s}=r,i=Wr(zn,r.__scopeScrollArea),[o,a]=T.useState(),l=T.useRef(null),c=vt(e,l,i.onScrollbarYChange);return T.useEffect(()=>{l.current&&a(getComputedStyle(l.current))},[l]),v.jsx(sA,{"data-orientation":"vertical",...s,ref:c,sizes:t,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Rh(t)+"px",...r.style},onThumbPointerDown:u=>r.onThumbPointerDown(u.y),onDragScroll:u=>r.onDragScroll(u.y),onWheelScroll:(u,d)=>{if(i.viewport){const h=i.viewport.scrollTop+u.deltaY;r.onWheelScroll(h),cA(h,d)&&u.preventDefault()}},onResize:()=>{l.current&&i.viewport&&o&&n({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:l.current.clientHeight,paddingStart:Pd(o.paddingTop),paddingEnd:Pd(o.paddingBottom)}})}})}),[RF,nA]=J1(zn),sA=T.forwardRef((r,e)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:s,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:a,onThumbPositionChange:l,onDragScroll:c,onWheelScroll:u,onResize:d,...h}=r,f=Wr(zn,t),[m,p]=T.useState(null),g=vt(e,R=>p(R)),y=T.useRef(null),x=T.useRef(""),w=f.viewport,b=n.content-n.viewport,E=Bt(u),I=Bt(l),S=Ch(d,10);function C(R){if(y.current){const L=R.clientX-y.current.left,$=R.clientY-y.current.top;c({x:L,y:$})}}return T.useEffect(()=>{const R=L=>{const $=L.target;(m==null?void 0:m.contains($))&&E(L,b)};return document.addEventListener("wheel",R,{passive:!1}),()=>document.removeEventListener("wheel",R,{passive:!1})},[w,m,b,E]),T.useEffect(I,[n,I]),Sa(m,S),Sa(f.content,S),v.jsx(RF,{scope:t,scrollbar:m,hasThumb:s,onThumbChange:Bt(i),onThumbPointerUp:Bt(o),onThumbPositionChange:I,onThumbPointerDown:Bt(a),children:v.jsx(qe.div,{...h,ref:g,style:{position:"absolute",...h.style},onPointerDown:Ue(r.onPointerDown,R=>{R.button===0&&(R.target.setPointerCapture(R.pointerId),y.current=m.getBoundingClientRect(),x.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",f.viewport&&(f.viewport.style.scrollBehavior="auto"),C(R))}),onPointerMove:Ue(r.onPointerMove,C),onPointerUp:Ue(r.onPointerUp,R=>{const L=R.target;L.hasPointerCapture(R.pointerId)&&L.releasePointerCapture(R.pointerId),document.body.style.webkitUserSelect=x.current,f.viewport&&(f.viewport.style.scrollBehavior=""),y.current=null})})})}),Ld="ScrollAreaThumb",iA=T.forwardRef((r,e)=>{const{forceMount:t,...n}=r,s=nA(Ld,r.__scopeScrollArea);return v.jsx(vn,{present:t||s.hasThumb,children:v.jsx(CF,{ref:e,...n})})}),CF=T.forwardRef((r,e)=>{const{__scopeScrollArea:t,style:n,...s}=r,i=Wr(Ld,t),o=nA(Ld,t),{onThumbPositionChange:a}=o,l=vt(e,d=>o.onThumbChange(d)),c=T.useRef(void 0),u=Ch(()=>{c.current&&(c.current(),c.current=void 0)},100);return T.useEffect(()=>{const d=i.viewport;if(d){const h=()=>{if(u(),!c.current){const f=DF(d,a);c.current=f,a()}};return a(),d.addEventListener("scroll",h),()=>d.removeEventListener("scroll",h)}},[i.viewport,u,a]),v.jsx(qe.div,{"data-state":o.hasThumb?"visible":"hidden",...s,ref:l,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:Ue(r.onPointerDownCapture,d=>{const f=d.target.getBoundingClientRect(),m=d.clientX-f.left,p=d.clientY-f.top;o.onThumbPointerDown({x:m,y:p})}),onPointerUp:Ue(r.onPointerUp,o.onThumbPointerUp)})});iA.displayName=Ld;var W0="ScrollAreaCorner",oA=T.forwardRef((r,e)=>{const t=Wr(W0,r.__scopeScrollArea),n=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&n?v.jsx(LF,{...r,ref:e}):null});oA.displayName=W0;var LF=T.forwardRef((r,e)=>{const{__scopeScrollArea:t,...n}=r,s=Wr(W0,t),[i,o]=T.useState(0),[a,l]=T.useState(0),c=!!(i&&a);return Sa(s.scrollbarX,()=>{var d;const u=((d=s.scrollbarX)==null?void 0:d.offsetHeight)||0;s.onCornerHeightChange(u),l(u)}),Sa(s.scrollbarY,()=>{var d;const u=((d=s.scrollbarY)==null?void 0:d.offsetWidth)||0;s.onCornerWidthChange(u),o(u)}),c?v.jsx(qe.div,{...n,ref:e,style:{width:i,height:a,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function Pd(r){return r?parseInt(r,10):0}function aA(r,e){const t=r/e;return isNaN(t)?0:t}function Rh(r){const e=aA(r.viewport,r.content),t=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=(r.scrollbar.size-t)*e;return Math.max(n,18)}function PF(r,e,t,n="ltr"){const s=Rh(t),i=s/2,o=e||i,a=s-o,l=t.scrollbar.paddingStart+o,c=t.scrollbar.size-t.scrollbar.paddingEnd-a,u=t.content-t.viewport,d=n==="ltr"?[0,u]:[u*-1,0];return lA([l,c],d)(r)}function Fx(r,e,t="ltr"){const n=Rh(e),s=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,i=e.scrollbar.size-s,o=e.content-e.viewport,a=i-n,l=t==="ltr"?[0,o]:[o*-1,0],c=SF(r,l);return lA([0,o],[0,a])(c)}function lA(r,e){return t=>{if(r[0]===r[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(r[1]-r[0]);return e[0]+n*(t-r[0])}}function cA(r,e){return r>0&&r<e}var DF=(r,e=()=>{})=>{let t={left:r.scrollLeft,top:r.scrollTop},n=0;return function s(){const i={left:r.scrollLeft,top:r.scrollTop},o=t.left!==i.left,a=t.top!==i.top;(o||a)&&e(),t=i,n=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(n)};function Ch(r,e){const t=Bt(r),n=T.useRef(0);return T.useEffect(()=>()=>window.clearTimeout(n.current),[]),T.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,e)},[t,e])}function Sa(r,e){const t=Bt(e);mn(()=>{let n=0;if(r){const s=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(t)});return s.observe(r),()=>{window.cancelAnimationFrame(n),s.unobserve(r)}}},[r,t])}var uA=Z1,OF=tA,NF=oA;const jn=T.forwardRef(({className:r,children:e,...t},n)=>v.jsxs(uA,{ref:n,className:Te("relative overflow-hidden",r),...t,children:[v.jsx(OF,{className:"h-full w-full rounded-[inherit]",children:e}),v.jsx(zl,{}),v.jsx(NF,{})]}));jn.displayName=uA.displayName;const zl=T.forwardRef(({className:r,orientation:e="vertical",...t},n)=>v.jsx(H0,{ref:n,orientation:e,className:Te("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:v.jsx(iA,{className:"relative flex-1 rounded-full bg-border"})}));zl.displayName=H0.displayName;const MF=()=>{const[r,e]=T.useState([]),[t,n]=T.useState(!1),s=Vr(),{data:i}=Rr({queryKey:["homepage"],queryFn:Ot.getHomepage,staleTime:5*60*1e3});T.useEffect(()=>{o()},[]);const o=async()=>{try{const c=await ot.getWatchHistory();e(c)}catch(c){console.error("Failed to load watch history:",c),e([])}},a=async c=>{var u;try{const h=(u=(await ot.getWatchHistory())[c])==null?void 0:u.id;h&&(await ot.deleteFromWatchHistory(h),await o(),Ki({title:"Deleted",description:"Item removed from watch history"}))}catch(d){console.error("Failed to delete item:",d)}},l=async()=>{try{await ot.clearWatchHistory(),e([]),Ki({title:"Cleared",description:"All watch history has been cleared"})}catch(c){console.error("Failed to clear history:",c)}};return v.jsxs("aside",{className:"hidden lg:flex flex-col fixed left-0 top-0 h-screen w-72 bg-gradient-to-br from-background via-background to-primary/5 backdrop-blur-xl border-r border-primary/30 shadow-2xl z-40",children:[v.jsx("div",{className:"p-6 border-b border-primary/20 bg-gradient-to-r from-primary/5 to-transparent",children:v.jsxs(Js,{to:"/",className:"flex items-center gap-3 group",children:[v.jsx("div",{className:"relative",children:v.jsx("img",{src:"https://url.bwmxmd.online/Adams.4mbjrppb.jpg",alt:"BWMGIFT Logo",className:"h-10 w-10 object-contain transition-transform group-hover:scale-110 group-hover:rotate-12 drop-shadow-[0_0_12px_rgba(239,68,68,0.6)]"})}),v.jsxs("span",{className:"text-2xl font-black tracking-tight drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",style:{background:"linear-gradient(135deg, #ef4444 0%, #f97316 50%, #eab308 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:["BWM",v.jsx("span",{style:{background:"linear-gradient(135deg, #10b981 0%, #3b82f6 50%, #8b5cf6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"GIFT"})]})]})}),v.jsxs("div",{className:"p-4 border-b border-border space-y-2",children:[v.jsx(pe,{variant:"ghost",className:"w-full justify-start gap-3 hover:bg-primary/10 hover:text-primary transition-all",asChild:!0,children:v.jsxs(Js,{to:"/",children:[v.jsx(PT,{className:"h-5 w-5"}),"Home"]})}),(i==null?void 0:i.categories)&&i.categories.length>0&&v.jsxs(B0,{open:t,onOpenChange:n,children:[v.jsx(U0,{asChild:!0,children:v.jsxs(pe,{variant:"ghost",className:"w-full justify-between gap-3 hover:bg-primary/10 hover:text-primary transition-all",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsx(fh,{className:"h-5 w-5"}),"Categories"]}),v.jsx(u0,{className:`h-4 w-4 transition-transform ${t?"rotate-180":""}`})]})}),v.jsx(z0,{className:"pl-8 mt-1 max-h-[300px] overflow-y-auto space-y-1 scrollbar-thin scrollbar-thumb-primary/20 scrollbar-track-transparent",children:i.categories.map(c=>v.jsx(pe,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm hover:bg-primary/5 hover:text-primary",onClick:()=>s(`/category/${encodeURIComponent(c.name)}`),children:c.name},c.name))})]})]}),v.jsxs("div",{className:"flex-1 flex flex-col min-h-0 p-4",children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"Watch History"}),r.length>0&&v.jsx(pe,{variant:"ghost",size:"sm",onClick:l,className:"text-xs h-auto py-1 px-2",children:"Clear All"})]}),v.jsx(jn,{className:"flex-1",children:v.jsx("div",{className:"space-y-2 pr-4",children:r.length>0?r.slice(0,20).map((c,u)=>v.jsxs("div",{className:"flex gap-2 p-2 bg-secondary/50 rounded-lg group relative hover:bg-secondary/70 transition-all",children:[v.jsxs("div",{className:"flex gap-2 flex-1 cursor-pointer",onClick:()=>s(`/movie/${c.id}`),children:[v.jsx("img",{src:c.poster||"/placeholder.svg",alt:c.title,className:"w-12 h-16 object-cover rounded flex-shrink-0",onError:d=>{d.currentTarget.src="/placeholder.svg"}}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsx("p",{className:"font-medium truncate text-sm",children:c.title}),v.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(c.watchedAt).toLocaleDateString()})]})]}),v.jsx(pe,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity hover:text-destructive",onClick:d=>{d.stopPropagation(),a(u)},children:v.jsx(DT,{className:"h-4 w-4"})})]},u)):v.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No watched movies yet"})})})]}),v.jsxs("div",{className:"border-t border-border p-4",children:[v.jsx("h3",{className:"font-semibold text-sm mb-3 text-muted-foreground",children:"Developed by"}),v.jsxs("p",{className:"text-sm text-foreground mb-4 font-medium",children:[v.jsx("span",{className:"text-primary",children:"Gifted Tech"})," & ",v.jsx("span",{className:"text-primary",children:"Ibrahim Adams"})]}),v.jsx("h3",{className:"font-semibold text-sm mb-3 text-muted-foreground",children:"Follow our sites"}),v.jsxs("div",{className:"flex flex-col gap-2",children:[v.jsx(pe,{variant:"outline",size:"sm",className:"justify-start gap-2 hover:bg-primary/10 hover:text-primary hover:border-primary transition-all",asChild:!0,children:v.jsxs("a",{href:"https://bwmxmd.online",target:"_blank",rel:"noopener noreferrer",children:[v.jsx(p0,{className:"h-4 w-4"}),"bwmxmd.online"]})}),v.jsx(pe,{variant:"outline",size:"sm",className:"justify-start gap-2 hover:bg-primary/10 hover:text-primary hover:border-primary transition-all",asChild:!0,children:v.jsxs("a",{href:"https://giftedtech.co.ke",target:"_blank",rel:"noopener noreferrer",children:[v.jsx(f0,{className:"h-4 w-4"}),"giftedtech.co.ke"]})})]})]})]})},FF=()=>v.jsx("footer",{className:"border-t border-border bg-gradient-to-b from-card to-background/50 mt-16",children:v.jsx("div",{className:"container mx-auto px-4 py-10",children:v.jsxs("div",{className:"text-center space-y-6",children:[v.jsxs("p",{className:"text-sm md:text-base text-foreground/80 mb-6",children:[" 2025 BwmGift | Developed by ",v.jsx("span",{className:"text-primary font-bold",children:"Gifted Tech"})," & ",v.jsx("span",{className:"text-primary font-bold",children:"Ibrahim Adams"})]}),v.jsxs("div",{className:"flex items-center justify-center gap-4 flex-wrap",children:[v.jsx(pe,{variant:"outline",size:"lg",asChild:!0,className:"gap-2 hover:bg-primary/20 hover:text-primary hover:border-primary transition-all bg-background/80 backdrop-blur-sm border-2 font-semibold",children:v.jsxs("a",{href:"https://bwmxmd.online",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[v.jsx(p0,{className:"h-5 w-5 flex-shrink-0"}),v.jsx("span",{className:"whitespace-nowrap",children:"bwmxmd.online"})]})}),v.jsx(pe,{variant:"outline",size:"lg",asChild:!0,className:"gap-2 hover:bg-primary/20 hover:text-primary hover:border-primary transition-all bg-background/80 backdrop-blur-sm border-2 font-semibold",children:v.jsxs("a",{href:"https://giftedtech.co.ke",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[v.jsx(f0,{className:"h-5 w-5 flex-shrink-0"}),v.jsx("span",{className:"whitespace-nowrap",children:"giftedtech.co.ke"})]})})]})]})})});function jF(){return v.jsxs("div",{className:"min-h-screen flex flex-col",children:[v.jsx(MF,{}),v.jsxs("div",{className:"lg:ml-72 flex flex-col min-h-screen text-sm lg:text-base",children:[v.jsx(xF,{}),v.jsx("main",{className:"flex-1",children:v.jsx(N2,{})}),v.jsx(FF,{})]})]})}const $F=({movies:r,onIndexChange:e})=>{var m;const[t,n]=T.useState(0),[s,i]=T.useState(!0),o=T.useRef(null),a=T.useRef(null);T.useEffect(()=>{e==null||e(t)},[t,e]),T.useEffect(()=>{const p=g=>{n(g.detail),a.current&&clearInterval(a.current)};return window.addEventListener("hero-carousel-navigate",p),()=>{window.removeEventListener("hero-carousel-navigate",p)}},[]);const l=r[t],c=(l==null?void 0:l.poster)||"/placeholder.svg";let u="";l&&(u=l.trailer_url||"",typeof l.trailer=="string"&&l.trailer?u=l.trailer:l.trailer&&typeof l.trailer=="object"&&((m=l.trailer.videoAddress)!=null&&m.url)&&(u=l.trailer.videoAddress.url)),T.useEffect(()=>{if(o.current&&u){o.current.load();const p=o.current.play();p!==void 0&&p.catch(g=>{console.log("Autoplay prevented:",g)})}},[t,u]),T.useEffect(()=>(a.current=setInterval(()=>{n(p=>(p+1)%r.length)},5e3),()=>{a.current&&clearInterval(a.current)}),[r.length]);const d=()=>{n(p=>(p+1)%r.length)},h=()=>{n(p=>(p-1+r.length)%r.length),a.current&&clearInterval(a.current)},f=()=>{n(p=>(p+1)%r.length),a.current&&clearInterval(a.current)};return r.length===0?null:v.jsxs("div",{className:"relative w-full md:w-screen h-[75vh] md:h-[90vh] lg:h-[85vh] md:-mx-4 lg:-ml-0 overflow-visible mt-0 md:mt-0 mb-6 md:mb-8",children:[v.jsxs("div",{className:"absolute inset-0 lg:-bottom-[600px] bg-black overflow-hidden z-0",children:[u?v.jsxs(v.Fragment,{children:[v.jsx("video",{ref:o,className:"w-full h-full object-cover",muted:s,playsInline:!0,autoPlay:!0,controls:!0,onEnded:d,preload:"auto",children:v.jsx("source",{src:u,type:"video/mp4"})},l.id),v.jsx(pe,{variant:"ghost",size:"icon",onClick:()=>i(!s),className:"absolute top-4 right-4 bg-black/50 hover:bg-black/70 text-white z-10",children:s?v.jsx(m0,{className:"h-5 w-5"}):v.jsx(Sd,{className:"h-5 w-5"})})]}):v.jsx("img",{src:c,alt:l.title,className:"w-full h-full object-cover object-center",onError:p=>{const g=p.target;g.src="/placeholder.svg"}}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 via-background/30 to-transparent"}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-background/60 via-transparent to-transparent"}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-background/40 to-background"})]}),v.jsx("div",{className:"relative h-full flex items-end justify-start md:justify-start pb-32 md:pb-48 lg:pb-52 px-4 md:px-8 lg:px-12 pt-16 md:pt-24",children:v.jsxs("div",{className:"max-w-full md:max-w-xl lg:max-w-2xl w-full text-left md:text-left",children:[v.jsx("h1",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-3 md:mb-2 text-shadow-red drop-shadow-[0_2px_10px_rgba(0,0,0,0.8)] break-words",children:l.title}),v.jsxs("div",{className:"flex flex-wrap items-center justify-start md:justify-start gap-2 mb-3 md:mb-2 text-sm md:text-xs",children:[l.year&&v.jsx("span",{className:"text-foreground/80 whitespace-nowrap",children:l.year}),l.rating&&v.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[v.jsx(ph,{className:"h-4 w-4 md:h-4 md:w-4 fill-yellow-400 text-yellow-400"}),v.jsx("span",{className:"text-foreground/80",children:l.rating})]}),l.genre&&l.genre.length>0&&v.jsx("span",{className:"text-foreground/80 truncate",children:l.genre.slice(0,2).join(", ")})]}),(l.overview||l.description)&&v.jsx("p",{className:"hidden md:block text-xs text-foreground/70 mb-2 md:mb-3 line-clamp-2 max-w-md break-words",children:l.overview||l.description}),v.jsxs("div",{className:"flex flex-col items-start md:items-start gap-3",children:[v.jsx(Js,{to:`/movie/${l.id}`,onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),children:v.jsxs(pe,{size:"default",className:"gap-2 cinema-gradient text-base md:text-base hover:scale-105 transition-transform",children:[v.jsx(ri,{className:"h-5 w-5 md:h-5 md:w-5"}),"Watch Now"]})}),r.length>1&&v.jsxs("div",{className:"flex gap-2",children:[v.jsx(pe,{variant:"ghost",size:"icon",onClick:h,className:"bg-white/10 hover:bg-white/20 text-white h-9 w-9 md:h-8 md:w-8 rounded-full border border-white/30 hover:border-white/50 hover:scale-110 transition-all duration-200","aria-label":"Previous slide",children:v.jsx(d0,{className:"h-4 w-4 md:h-4 md:w-4"})}),v.jsx(pe,{variant:"ghost",size:"icon",onClick:f,className:"bg-white/10 hover:bg-white/20 text-white h-9 w-9 md:h-8 md:w-8 rounded-full border border-white/30 hover:border-white/50 hover:scale-110 transition-all duration-200","aria-label":"Next slide",children:v.jsx(h0,{className:"h-4 w-4 md:h-4 md:w-4"})})]})]})]})}),v.jsx("div",{className:"hidden lg:block absolute top-20 right-8 w-28 h-42 rounded-lg overflow-hidden shadow-2xl border-2 border-white/20 hover:scale-105 transition-transform",children:v.jsx("img",{src:c,alt:`${l.title} poster`,className:"w-full h-full object-cover",onError:p=>{const g=p.target;g.src="/placeholder.svg"}})})]})},BF=({movies:r,onIndexChange:e})=>{var m;const[t,n]=T.useState(0),[s,i]=T.useState(!0),o=T.useRef(null),a=T.useRef(null);T.useEffect(()=>{e==null||e(t)},[t,e]),T.useEffect(()=>{const p=g=>{n(g.detail),a.current&&clearInterval(a.current)};return window.addEventListener("hero-carousel-navigate",p),()=>{window.removeEventListener("hero-carousel-navigate",p)}},[]);const l=r[t],c=(l==null?void 0:l.poster)||"/placeholder.svg";let u="";l&&(u=l.trailer_url||"",typeof l.trailer=="string"&&l.trailer?u=l.trailer:l.trailer&&typeof l.trailer=="object"&&((m=l.trailer.videoAddress)!=null&&m.url)&&(u=l.trailer.videoAddress.url)),T.useEffect(()=>{if(o.current&&u){o.current.load();const p=o.current.play();p!==void 0&&p.catch(g=>{console.log("Autoplay prevented:",g)})}},[t,u]),T.useEffect(()=>(a.current=setInterval(()=>{n(p=>(p+1)%r.length)},5e3),()=>{a.current&&clearInterval(a.current)}),[r.length]);const d=()=>{n(p=>(p+1)%r.length)},h=()=>{n(p=>(p-1+r.length)%r.length),a.current&&clearInterval(a.current)},f=()=>{n(p=>(p+1)%r.length),a.current&&clearInterval(a.current)};return r.length===0?null:v.jsxs("div",{className:"relative w-full h-[85vh] overflow-hidden",children:[v.jsxs("div",{className:"absolute inset-0",children:[u?v.jsxs(v.Fragment,{children:[v.jsx("video",{ref:o,className:"w-full h-full object-cover object-[center_20%]",muted:s,playsInline:!0,autoPlay:!0,controls:!1,onEnded:d,preload:"auto",children:v.jsx("source",{src:u,type:"video/mp4"})},l.id),v.jsx(pe,{variant:"ghost",size:"icon",onClick:()=>i(!s),className:"absolute top-4 right-4 bg-black/50 hover:bg-black/70 text-white z-10",children:s?v.jsx(m0,{className:"h-5 w-5"}):v.jsx(Sd,{className:"h-5 w-5"})})]}):v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"absolute inset-0 bg-cover bg-center blur-sm scale-105 opacity-40",style:{backgroundImage:`url(${c})`}}),v.jsx("div",{className:"absolute inset-0",children:v.jsx("div",{className:"w-full h-full bg-contain bg-center bg-no-repeat",style:{backgroundImage:`url(${c})`}})})]}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/60 to-transparent"}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-background/80 via-transparent to-transparent"})]}),v.jsx("div",{className:"relative h-full flex items-end pb-32 px-12",children:v.jsxs("div",{className:"max-w-2xl",children:[v.jsx("h1",{className:"text-5xl font-bold mb-4 text-shadow-red drop-shadow-[0_2px_10px_rgba(0,0,0,0.8)]",children:l.title}),v.jsxs("div",{className:"flex items-center gap-3 mb-4 text-sm",children:[l.year&&v.jsx("span",{className:"text-foreground/80",children:l.year}),l.rating&&v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(ph,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),v.jsx("span",{className:"text-foreground/80",children:l.rating})]}),l.genre&&l.genre.length>0&&v.jsx("span",{className:"text-foreground/80",children:l.genre.slice(0,2).join(", ")})]}),(l.overview||l.description)&&v.jsx("p",{className:"text-base text-foreground/80 mb-6 line-clamp-3 max-w-xl",children:l.overview||l.description}),v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsx(Js,{to:`/movie/${l.id}`,onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),children:v.jsxs(pe,{size:"lg",className:"gap-2 cinema-gradient text-base hover:scale-105 transition-transform",children:[v.jsx(ri,{className:"h-5 w-5"}),"Watch Now"]})}),r.length>1&&v.jsxs("div",{className:"flex gap-2",children:[v.jsx(pe,{variant:"ghost",size:"icon",onClick:h,className:"bg-white/10 hover:bg-white/20 text-white h-10 w-10 rounded-full border border-white/30 hover:border-white/50 hover:scale-110 transition-all duration-200","aria-label":"Previous slide",children:v.jsx(d0,{className:"h-5 w-5"})}),v.jsx(pe,{variant:"ghost",size:"icon",onClick:f,className:"bg-white/10 hover:bg-white/20 text-white h-10 w-10 rounded-full border border-white/30 hover:border-white/50 hover:scale-110 transition-all duration-200","aria-label":"Next slide",children:v.jsx(h0,{className:"h-5 w-5"})})]})]})]})})]})},UF="modulepreload",zF=function(r){return"/"+r},jx={},Oa=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=zF(l),l in jx)return;jx[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":UF,c||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((h,f)=>{d.addEventListener("load",h),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},GF=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Oa(async()=>{const{default:n}=await Promise.resolve().then(()=>ro);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class K0 extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class $x extends K0{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Bx extends K0{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ux extends K0{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Cm;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Cm||(Cm={}));class HF{constructor(e,{headers:t={},customFetch:n,region:s=Cm.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=GF(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return ve(this,arguments,void 0,function*(t,n={}){var s;try{const{headers:i,method:o,body:a,signal:l}=n;let c={},{region:u}=n;u||(u=this.region);const d=new URL(`${this.url}/${t}`);u&&u!=="any"&&(c["x-region"]=u,d.searchParams.set("forceFunctionRegion",u));let h;a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",h=a):typeof a=="string"?(c["Content-Type"]="text/plain",h=a):typeof FormData<"u"&&a instanceof FormData?h=a:(c["Content-Type"]="application/json",h=JSON.stringify(a)):h=a;const f=yield this.fetch(d.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),i),body:h,signal:l}).catch(y=>{throw y.name==="AbortError"?y:new $x(y)}),m=f.headers.get("x-relay-error");if(m&&m==="true")throw new Bx(f);if(!f.ok)throw new Ux(f);let p=((s=f.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield f.json():p==="application/octet-stream"||p==="application/pdf"?g=yield f.blob():p==="text/event-stream"?g=f:p==="multipart/form-data"?g=yield f.formData():g=yield f.text(),{data:g,error:null,response:f}}catch(i){return i instanceof Error&&i.name==="AbortError"?{data:null,error:new $x(i)}:{data:null,error:i,response:i instanceof Ux||i instanceof Bx?i.context:void 0}}})}}var cr={};const Na=$b(cM);var Qc={},Xc={},Jc={},Zc={},eu={},VF=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ea=VF();const WF=Ea.fetch,dA=Ea.fetch.bind(Ea),hA=Ea.Headers,KF=Ea.Request,qF=Ea.Response,ro=Object.freeze(Object.defineProperty({__proto__:null,Headers:hA,Request:KF,Response:qF,default:dA,fetch:WF},Symbol.toStringTag,{value:"Module"})),YF=$b(ro);var tu={},zx;function fA(){if(zx)return tu;zx=1,Object.defineProperty(tu,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return tu.default=r,tu}var Gx;function pA(){if(Gx)return eu;Gx=1,Object.defineProperty(eu,"__esModule",{value:!0});const r=Na,e=r.__importDefault(YF),t=r.__importDefault(fA());class n{constructor(i){var o,a;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(o=i.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=i.signal,this.isMaybeSingle=(a=i.isMaybeSingle)!==null&&a!==void 0?a:!1,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=new Headers(this.headers),this.headers.set(i,o),this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,h,f;let m=null,p=null,g=null,y=c.status,x=c.statusText;if(c.ok){if(this.method!=="HEAD"){const I=await c.text();I===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((u=this.headers.get("Accept"))===null||u===void 0)&&u.includes("application/vnd.pgrst.plan+text"))?p=I:p=JSON.parse(I))}const b=(d=this.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),E=(h=c.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");b&&E&&E.length>1&&(g=parseInt(E[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(p)&&(p.length>1?(m={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,g=null,y=406,x="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{const b=await c.text();try{m=JSON.parse(b),Array.isArray(m)&&c.status===404&&(p=[],m=null,y=200,x="OK")}catch{c.status===404&&b===""?(y=204,x="No Content"):m={message:b}}if(m&&this.isMaybeSingle&&(!((f=m==null?void 0:m.details)===null||f===void 0)&&f.includes("0 rows"))&&(m=null,y=200,x="OK"),m&&this.shouldThrowOnError)throw new t.default(m)}return{error:m,data:p,count:g,status:y,statusText:x}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,h;return{error:{message:`${(u=c==null?void 0:c.name)!==null&&u!==void 0?u:"FetchError"}: ${c==null?void 0:c.message}`,details:`${(d=c==null?void 0:c.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=c==null?void 0:c.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,o)}returns(){return this}overrideTypes(){return this}}return eu.default=n,eu}var Hx;function mA(){if(Hx)return Zc;Hx=1,Object.defineProperty(Zc,"__esModule",{value:!0});const e=Na.__importDefault(pA());class t extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${h}"; options=${d};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Zc.default=t,Zc}var Vx;function q0(){if(Vx)return Jc;Vx=1,Object.defineProperty(Jc,"__esModule",{value:!0});const e=Na.__importDefault(mA());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${l}fts${c}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return Jc.default=t,Jc}var Wx;function gA(){if(Wx)return Xc;Wx=1,Object.defineProperty(Xc,"__esModule",{value:!0});const e=Na.__importDefault(q0());class t{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=new Headers(i),this.schema=o,this.fetch=a}select(s,i){const{head:o=!1,count:a}=i??{},l=o?"HEAD":"GET";let c=!1;const u=(s??"*").split("").map(d=>/\s/.test(d)&&!c?"":(d==='"'&&(c=!c),d)).join("");return this.url.searchParams.set("select",u),a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:i,defaultToNull:o=!0}={}){var a;const l="POST";if(i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){var c;const u="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),a&&this.headers.append("Prefer",`count=${a}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const d=s.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(d.length>0){const h=[...new Set(d)].map(f=>`"${f}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(s,{count:i}={}){var o;const a="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:s}={}){var i;const o="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return Xc.default=t,Xc}var Kx;function QF(){if(Kx)return Qc;Kx=1,Object.defineProperty(Qc,"__esModule",{value:!0});const r=Na,e=r.__importDefault(gA()),t=r.__importDefault(q0());class n{constructor(i,{headers:o={},schema:a,fetch:l}={}){this.url=i,this.headers=new Headers(o),this.schemaName=a,this.fetch=l}from(i){const o=new URL(`${this.url}/${i}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new n(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,o={},{head:a=!1,get:l=!1,count:c}={}){var u;let d;const h=new URL(`${this.url}/rpc/${i}`);let f;a||l?(d=a?"HEAD":"GET",Object.entries(o).filter(([p,g])=>g!==void 0).map(([p,g])=>[p,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([p,g])=>{h.searchParams.append(p,g)})):(d="POST",f=o);const m=new Headers(this.headers);return c&&m.set("Prefer",`count=${c}`),new t.default({method:d,url:h,headers:m,schema:this.schemaName,body:f,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return Qc.default=n,Qc}Object.defineProperty(cr,"__esModule",{value:!0});cr.PostgrestError=cr.PostgrestBuilder=cr.PostgrestTransformBuilder=cr.PostgrestFilterBuilder=cr.PostgrestQueryBuilder=cr.PostgrestClient=void 0;const Ma=Na,yA=Ma.__importDefault(QF());cr.PostgrestClient=yA.default;const vA=Ma.__importDefault(gA());cr.PostgrestQueryBuilder=vA.default;const xA=Ma.__importDefault(q0());cr.PostgrestFilterBuilder=xA.default;const wA=Ma.__importDefault(mA());cr.PostgrestTransformBuilder=wA.default;const bA=Ma.__importDefault(pA());cr.PostgrestBuilder=bA.default;const SA=Ma.__importDefault(fA());cr.PostgrestError=SA.default;var XF=cr.default={PostgrestClient:yA.default,PostgrestQueryBuilder:vA.default,PostgrestFilterBuilder:xA.default,PostgrestTransformBuilder:wA.default,PostgrestBuilder:bA.default,PostgrestError:SA.default};const{PostgrestClient:JF,PostgrestQueryBuilder:t6,PostgrestFilterBuilder:r6,PostgrestTransformBuilder:n6,PostgrestBuilder:s6,PostgrestError:i6}=XF;class ZF{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const ej="2.76.1",tj=`realtime-js/${ej}`,rj="1.0.0",Lm=1e4,nj=1e3,sj=100;var dl;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(dl||(dl={}));var At;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(At||(At={}));var un;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(un||(un={}));var Pm;(function(r){r.websocket="websocket"})(Pm||(Pm={}));var Si;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Si||(Si={}));class ij{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=n.decode(e.slice(o,o+s));o=o+s;const l=n.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class EA{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Je;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Je||(Je={}));const qx=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=oj(o,r,e,s),i),{}):{}},oj=(r,e,t,n)=>{const s=e.find(a=>a.name===r),i=s==null?void 0:s.type,o=t[r];return i&&!n.includes(i)?TA(i,o):Dm(o)},TA=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return uj(e,t)}switch(r){case Je.bool:return aj(e);case Je.float4:case Je.float8:case Je.int2:case Je.int4:case Je.int8:case Je.numeric:case Je.oid:return lj(e);case Je.json:case Je.jsonb:return cj(e);case Je.timestamp:return dj(e);case Je.abstime:case Je.date:case Je.daterange:case Je.int4range:case Je.int8range:case Je.money:case Je.reltime:case Je.text:case Je.time:case Je.timestamptz:case Je.timetz:case Je.tsrange:case Je.tstzrange:return Dm(e);default:return Dm(e)}},Dm=r=>r,aj=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},lj=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},cj=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},uj=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>TA(e,a))}return r},dj=r=>typeof r=="string"?r.replace(" ","T"):r,_A=r=>{const e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Af{constructor(e,t,n={},s=Lm){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Yx;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Yx||(Yx={}));class hl{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=hl.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=hl.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=hl.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=i[c];if(d){const h=u.map(g=>g.presence_ref),f=d.map(g=>g.presence_ref),m=u.filter(g=>f.indexOf(g.presence_ref)<0),p=d.filter(g=>h.indexOf(g.presence_ref)<0);m.length>0&&(a[c]=m),p.length>0&&(l[c]=p)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},n,s)}static syncDiff(e,t,n,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(f=>f.presence_ref),h=u.filter(f=>d.indexOf(f.presence_ref)<0);e[a].unshift(...h)}n(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Qx;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Qx||(Qx={}));var fl;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(fl||(fl={}));var Qn;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Qn||(Qn={}));class Y0{constructor(e,t={config:{}},n){var s,i;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=At.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Af(this,un.join,this.params,this.timeout),this.rejoinTimer=new EA(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=At.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=At.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=At.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=At.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=At.errored,this.rejoinTimer.scheduleTimeout())}),this._on(un.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new hl(this),this.broadcastEndpointURL=_A(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==At.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(f=>f.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[fl.PRESENCE]&&this.bindings[fl.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,d={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(Qn.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(Qn.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket.setAuth(),f===void 0){e==null||e(Qn.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,g=(m=p==null?void 0:p.length)!==null&&m!==void 0?m:0,y=[];for(let x=0;x<g;x++){const w=p[x],{filter:{event:b,schema:E,table:I,filter:S}}=w,C=f&&f[x];if(C&&C.event===b&&C.schema===E&&C.table===I&&C.filter===S)y.push(Object.assign(Object.assign({},w),{id:C.id}));else{this.unsubscribe(),this.state=At.errored,e==null||e(Qn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(Qn.SUBSCRIBED);return}}).receive("error",f=>{this.state=At.errored,e==null||e(Qn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Qn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===At.joined&&e===fl.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var s;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=At.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(un.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Af(this,un.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=At.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Af(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>sj){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=un;if(n&&[a,l,c,u].indexOf(o)>=0&&n!==this._joinRef())return;let h=this._onMessage(o,t,n);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var m,p,g;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((g=(p=f.filter)===null||p===void 0?void 0:p.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(f=>f.callback(h,n)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var m,p,g,y,x,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const b=f.id,E=(m=f.filter)===null||m===void 0?void 0:m.event;return b&&((p=t.ids)===null||p===void 0?void 0:p.includes(b))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const b=(x=(y=f==null?void 0:f.filter)===null||y===void 0?void 0:y.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return b==="*"||b===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:p,table:g,commit_timestamp:y,type:x,errors:w}=m;h=Object.assign(Object.assign({},{schema:p,table:g,commit_timestamp:y,eventType:x,new:{},old:{},errors:w}),this._getPayloadRecords(m))}f.callback(h,n)})}_isClosed(){return this.state===At.closed}_isJoined(){return this.state===At.joined}_isJoining(){return this.state===At.joining}_isLeaving(){return this.state===At.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Y0.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(un.close,{},e)}_onError(e){this._on(un.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=At.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=qx(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=qx(e.columns,e.old_record)),t}}const kf=()=>{},ru={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},hj=[1e3,2e3,5e3,1e4],fj=1e4,pj=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class mj{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Lm,this.transport=null,this.heartbeatIntervalMs=ru.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=kf,this.ref=0,this.reconnectTimer=null,this.logger=kf,this.conn=null,this.sendBuffer=[],this.serializer=new ij,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...o)=>Oa(async()=>{const{default:a}=await Promise.resolve().then(()=>ro);return{default:a}},void 0).then(({default:a})=>a(...o)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Pm.websocket}`,this.httpEndpoint=_A(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ZF.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:rj}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case dl.connecting:return Si.Connecting;case dl.open:return Si.Open;case dl.closing:return Si.Closing;default:return Si.Closed}}isConnected(){return this.connectionState()===Si.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new Y0(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${n} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(nj,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ru.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:i,ref:o}=t,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${s} ${a}`.trim(),i),this.channels.filter(c=>c._isMember(n)).forEach(c=>c._trigger(s,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(un.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([pj],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:tj};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(un.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new EA(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ru.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,i,o,a,l,c,u;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:Lm,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:ru.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:kf,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:d=>hj[d-1]||fj,this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(d,h)=>h(JSON.stringify(d)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Q0 extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function lt(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class gj extends Q0{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Om extends Q0{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const X0=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Oa(async()=>{const{default:n}=await Promise.resolve().then(()=>ro);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},yj=()=>ve(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Oa(()=>Promise.resolve().then(()=>ro),void 0)).Response:Response}),Nm=r=>{if(Array.isArray(r))return r.map(t=>Nm(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Nm(n)}),e},vj=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},If=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),xj=(r,e,t)=>ve(void 0,void 0,void 0,function*(){const n=yield yj();r instanceof n&&!(t!=null&&t.noResolveJson)?r.json().then(s=>{const i=r.status||500,o=(s==null?void 0:s.statusCode)||i+"";e(new gj(If(s),i,o))}).catch(s=>{e(new Om(If(s),s))}):e(new Om(If(r),r))}),wj=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!n?s:(vj(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,e!=null&&e.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function pc(r,e,t,n,s,i){return ve(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,wj(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>xj(l,a,n))})})}function Gl(r,e,t,n){return ve(this,void 0,void 0,function*(){return pc(r,"GET",e,t,n)})}function on(r,e,t,n,s){return ve(this,void 0,void 0,function*(){return pc(r,"POST",e,n,s,t)})}function Mm(r,e,t,n,s){return ve(this,void 0,void 0,function*(){return pc(r,"PUT",e,n,s,t)})}function bj(r,e,t,n){return ve(this,void 0,void 0,function*(){return pc(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function J0(r,e,t,n,s){return ve(this,void 0,void 0,function*(){return pc(r,"DELETE",e,n,s,t)})}class Sj{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return ve(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(lt(e))return{data:null,error:e};throw e}})}}var AA;class Ej{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[AA]="BlobDownloadBuilder",this.promise=null}asStream(){return new Sj(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return ve(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(lt(e))return{data:null,error:e};throw e}})}}AA=Symbol.toStringTag;const Tj={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Xx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class _j{constructor(e,t={},n,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=X0(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,s){return ve(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Xx),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s!=null&&s.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),d=yield(e=="PUT"?Mm:on)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(lt(i))return{data:null,error:i};throw i}})}upload(e,t,n){return ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return ve(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Xx.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield Mm(this.fetch,a.toString(),l,{headers:u});return{data:{path:i,fullPath:d.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(lt(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return ve(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const i=yield on(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Q0("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lt(n))return{data:null,error:n};throw n}})}update(e,t,n){return ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return ve(this,void 0,void 0,function*(){try{return{data:yield on(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(lt(s))return{data:null,error:s};throw s}})}copy(e,t,n){return ve(this,void 0,void 0,function*(){try{return{data:{path:(yield on(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(lt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return ve(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield on(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(lt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return ve(this,void 0,void 0,function*(){try{const s=yield on(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(lt(s))return{data:null,error:s};throw s}})}download(e,t){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"",a=this._getFinalPath(e),l=()=>Gl(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new Ej(l,this.shouldThrowOnError)}info(e){return ve(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield Gl(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Nm(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lt(n))return{data:null,error:n};throw n}})}exists(e){return ve(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield bj(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lt(n)&&n instanceof Om){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return ve(this,void 0,void 0,function*(){try{return{data:yield J0(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(lt(t))return{data:null,error:t};throw t}})}list(e,t,n){return ve(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Tj),t),{prefix:e||""});return{data:yield on(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(lt(s))return{data:null,error:s};throw s}})}listV2(e,t){return ve(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield on(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const kA="2.76.1",IA={"X-Client-Info":`storage-js/${kA}`};class Aj{constructor(e,t={},n,s){this.shouldThrowOnError=!1;const i=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},IA),t),this.fetch=X0(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return ve(this,void 0,void 0,function*(){try{return{data:yield Gl(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(lt(e))return{data:null,error:e};throw e}})}getBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield Gl(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(lt(t))return{data:null,error:t};throw t}})}createBucket(e){return ve(this,arguments,void 0,function*(t,n={public:!1}){try{return{data:yield on(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(lt(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ve(this,void 0,void 0,function*(){try{return{data:yield Mm(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield on(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(lt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield J0(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(lt(t))return{data:null,error:t};throw t}})}}class kj{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},IA),t),this.fetch=X0(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield on(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(lt(t))return{data:null,error:t};throw t}})}listBuckets(e){return ve(this,void 0,void 0,function*(){try{const t=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&t.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&t.set("sortOrder",e.sortOrder),e!=null&&e.search&&t.set("search",e.search);const n=t.toString(),s=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`,i=yield Gl(this.fetch,s,{headers:this.headers});return{data:Array.isArray(i)?i.filter(a=>a.type==="ANALYTICS"):[],error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(lt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield J0(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(lt(t))return{data:null,error:t};throw t}})}}const Z0={"X-Client-Info":`storage-js/${kA}`,"Content-Type":"application/json"};class RA extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Tr(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}class Rf extends RA{constructor(e,t,n){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ij extends RA{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var Jx;(function(r){r.InternalError="InternalError",r.S3VectorConflictException="S3VectorConflictException",r.S3VectorNotFoundException="S3VectorNotFoundException",r.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",r.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",r.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(Jx||(Jx={}));const ey=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Oa(async()=>{const{default:n}=await Promise.resolve().then(()=>ro);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Rj=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Zx=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Cj=(r,e,t)=>ve(void 0,void 0,void 0,function*(){if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!(t!=null&&t.noResolveJson)){const s=r.status||500,i=r;if(typeof i.json=="function")i.json().then(o=>{const a=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||s+"";e(new Rf(Zx(o),s,a))}).catch(()=>{const o=s+"",a=i.statusText||`HTTP ${s} error`;e(new Rf(a,s,o))});else{const o=s+"",a=i.statusText||`HTTP ${s} error`;e(new Rf(a,s,o))}}else e(new Ij(Zx(r),r))}),Lj=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return n?(Rj(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,Object.assign(Object.assign({},s),t)):s};function Pj(r,e,t,n,s,i){return ve(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,Lj(e,n,s,i)).then(l=>{if(!l.ok)throw l;if(n!=null&&n.noResolveJson)return l;const c=l.headers.get("content-type");return!c||!c.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>Cj(l,a,n))})})}function _r(r,e,t,n,s){return ve(this,void 0,void 0,function*(){return Pj(r,"POST",e,n,s,t)})}class Dj{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Z0),t),this.fetch=ey(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return ve(this,void 0,void 0,function*(){try{return{data:(yield _r(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}getIndex(e,t){return ve(this,void 0,void 0,function*(){try{return{data:yield _r(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Tr(n))return{data:null,error:n};throw n}})}listIndexes(e){return ve(this,void 0,void 0,function*(){try{return{data:yield _r(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return ve(this,void 0,void 0,function*(){try{return{data:(yield _r(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Tr(n))return{data:null,error:n};throw n}})}}class Oj{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Z0),t),this.fetch=ey(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return ve(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield _r(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}getVectors(e){return ve(this,void 0,void 0,function*(){try{return{data:yield _r(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}listVectors(e){return ve(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield _r(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}queryVectors(e){return ve(this,void 0,void 0,function*(){try{return{data:yield _r(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}deleteVectors(e){return ve(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield _r(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}}class Nj{constructor(e,t={},n){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Z0),t),this.fetch=ey(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:(yield _r(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}getBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:yield _r(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}listBuckets(){return ve(this,arguments,void 0,function*(e={}){try{return{data:yield _r(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ve(this,void 0,void 0,function*(){try{return{data:(yield _r(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Tr(t))return{data:null,error:t};throw t}})}}class Mj extends Nj{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Fj(this.url,this.headers,e,this.fetch)}}class Fj extends Dj{constructor(e,t,n,s){super(e,t,s),this.vectorBucketName=n}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return ve(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return ve(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return ve(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return ve(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new jj(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class jj extends Oj{constructor(e,t,n,s,i){super(e,t,i),this.vectorBucketName=n,this.indexName=s}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return ve(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return ve(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return ve(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return ve(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return ve(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class $j extends Aj{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new _j(this.url,this.headers,e,this.fetch)}get vectors(){return new Mj(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new kj(this.url+"/iceberg",this.headers,this.fetch)}}const Bj="2.76.1";let Za="";typeof Deno<"u"?Za="deno":typeof document<"u"?Za="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Za="react-native":Za="node";const Uj={"X-Client-Info":`supabase-js-${Za}/${Bj}`},zj={headers:Uj},Gj={schema:"public"},Hj={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Vj={},Wj=r=>{let e;return r?e=r:typeof fetch>"u"?e=dA:e=fetch,(...t)=>e(...t)},Kj=()=>typeof Headers>"u"?hA:Headers,qj=(r,e,t)=>{const n=Wj(t),s=Kj();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:r;let c=new s(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(i,Object.assign(Object.assign({},o),{headers:c}))}};function Yj(r){return r.endsWith("/")?r:r+"/"}function Qj(r,e){var t,n;const{db:s,auth:i,realtime:o,global:a}=r,{db:l,auth:c,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(n=a==null?void 0:a.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return r.accessToken?h.accessToken=r.accessToken:delete h.accessToken,h}function Xj(r){const e=r==null?void 0:r.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Yj(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const CA="2.76.1",xo=30*1e3,Fm=3,Cf=Fm*xo,Jj="http://localhost:9999",Zj="supabase.auth.token",e$={"X-Client-Info":`gotrue-js/${CA}`},jm="X-Supabase-Api-Version",LA={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},t$=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,r$=10*60*1e3;class Hl extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function be(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class n$ extends Hl{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function s$(r){return be(r)&&r.name==="AuthApiError"}class Ei extends Hl{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class hi extends Hl{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Es extends hi{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function i$(r){return be(r)&&r.name==="AuthSessionMissingError"}class co extends hi{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class nu extends hi{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class su extends hi{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function o$(r){return be(r)&&r.name==="AuthImplicitGrantRedirectError"}class ew extends hi{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $m extends hi{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Lf(r){return be(r)&&r.name==="AuthRetryableFetchError"}class tw extends hi{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Bm extends hi{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Dd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),rw=` 	
\r=`.split(""),a$=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<rw.length;e+=1)r[rw[e].charCodeAt(0)]=-2;for(let e=0;e<Dd.length;e+=1)r[Dd[e].charCodeAt(0)]=e;return r})();function nw(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Dd[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Dd[n]),e.queuedBits-=6}}function PA(r,e,t){const n=a$[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function sw(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{u$(o,n,t)};for(let o=0;o<r.length;o+=1)PA(r.charCodeAt(o),s,i);return e.join("")}function l$(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function c$(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}l$(n,e)}}function u$(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if(!(r>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Yo(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)PA(r.charCodeAt(s),t,n);return new Uint8Array(e)}function d$(r){const e=[];return c$(r,t=>e.push(t)),new Uint8Array(e)}function Ii(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>nw(s,t,n)),nw(null,t,n),e.join("")}function h$(r){return Math.round(Date.now()/1e3)+r}function f$(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const vr=()=>typeof window<"u"&&typeof document<"u",pi={tested:!1,writable:!1},DA=()=>{if(!vr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(pi.tested)return pi.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),pi.tested=!0,pi.writable=!0}catch{pi.tested=!0,pi.writable=!1}return pi.writable};function p$(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const OA=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Oa(async()=>{const{default:n}=await Promise.resolve().then(()=>ro);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},m$=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",wo=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},mi=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},vs=async(r,e)=>{await r.removeItem(e)};class Lh{constructor(){this.promise=new Lh.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Lh.promiseConstructor=Promise;function Pf(r){const e=r.split(".");if(e.length!==3)throw new Bm("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!t$.test(e[n]))throw new Bm("JWT not in base64url format");return{header:JSON.parse(sw(e[0])),payload:JSON.parse(sw(e[1])),signature:Yo(e[2]),raw:{header:e[0],payload:e[1]}}}async function g$(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function y$(r,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){n(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function v$(r){return("0"+r.toString(16)).substr(-2)}function x$(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,v$).join("")}async function w$(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function b$(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await w$(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function uo(r,e,t=!1){const n=x$();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await wo(r,`${e}-code-verifier`,s);const i=await b$(n);return[i,n===i?"plain":"s256"]}const S$=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function E$(r){const e=r.headers.get(jm);if(!e||!e.match(S$))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function T$(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function _$(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const A$=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ho(r){if(!A$.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Df(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function iw(r){return JSON.parse(JSON.stringify(r))}const wi=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),k$=[502,503,504];async function ow(r){var e;if(!m$(r))throw new $m(wi(r),0);if(k$.includes(r.status))throw new $m(wi(r),r.status);let t;try{t=await r.json()}catch(i){throw new Ei(wi(i),i)}let n;const s=E$(r);if(s&&s.getTime()>=LA["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new tw(wi(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Es}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new tw(wi(t),r.status,t.weak_password.reasons);throw new n$(wi(t),r.status||500,n)}const I$=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function Ae(r,e,t,n){var s;const i=Object.assign({},n==null?void 0:n.headers);i[jm]||(i[jm]=LA["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const o=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await R$(r,e,t+a,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function R$(r,e,t,n,s,i){const o=I$(e,n,s,i);let a;try{a=await r(t,Object.assign({},o))}catch(l){throw console.error(l),new $m(wi(l),0)}if(a.ok||await ow(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(l){await ow(l)}}function rn(r){var e;let t=null;P$(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=h$(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function aw(r){const e=rn(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Cs(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function C$(r){return{data:r,error:null}}function L$(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i}=r,o=di(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function lw(r){return r}function P$(r){return r.access_token&&r.refresh_token&&r.expires_in}const Of=["global","local","others"];class D${constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=OA(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Of[0]){if(Of.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Of.join(", ")}`);try{return await Ae(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(be(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await Ae(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Cs})}catch(n){if(be(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=di(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await Ae(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:L$,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(be(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Cs})}catch(t){if(be(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await Ae(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:lw});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const p=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=p}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(be(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){ho(e);try{return await Ae(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Cs})}catch(t){if(be(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ho(e);try{return await Ae(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Cs})}catch(n){if(be(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){ho(e);try{return await Ae(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Cs})}catch(n){if(be(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){ho(e.userId);try{const{data:t,error:n}=await Ae(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(be(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ho(e.userId),ho(e.id);try{return{data:await Ae(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await Ae(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:lw});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const p=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=p}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(be(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(be(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Ae(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(be(t))return{data:null,error:t};throw t}}async _deleteOAuthClient(e){try{return await Ae(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(be(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(be(t))return{data:null,error:t};throw t}}}function cw(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const fo={debug:!!(globalThis&&DA()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class NA extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class O$ extends NA{}async function N$(r,e,t){fo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),fo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){fo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{fo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw fo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new O$(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(fo.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function M$(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function MA(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function F$(r){return parseInt(r,16)}function j$(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function $$(r){var e;const{chainId:t,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:d,version:h}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const f=MA(r.address),m=u?`${u}://${n}`:n,p=r.statement?`${r.statement}
`:"",g=`${m} wants you to sign in with your Ethereum account:
${f}

${p}`;let y=`URI: ${d}
Version: ${h}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(y+=`
Expiration Time: ${s.toISOString()}`),a&&(y+=`
Not Before: ${a.toISOString()}`),l&&(y+=`
Request ID: ${l}`),c){let x=`
Resources:`;for(const w of c){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);x+=`
- ${w}`}y+=x}return`${g}
${y}`}class bt extends Error{constructor({message:e,code:t,cause:n,name:s}){var i;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=s??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class Od extends bt{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function B$({error:r,options:e}){var t,n,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new bt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new bt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new bt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new bt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new bt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new bt({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new bt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new bt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const o=window.location.hostname;if(FA(o)){if(i.rp.id!==o)return new bt({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new bt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new bt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new bt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new bt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function U$({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new bt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new bt({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const n=window.location.hostname;if(FA(n)){if(t.rpId!==n)return new bt({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new bt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new bt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new bt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class z${createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const G$=new z$;function H$(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:n}=r,s=di(r,["challenge","user","excludeCredentials"]),i=Yo(e).buffer,o=Object.assign(Object.assign({},t),{id:Yo(t.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const c=n[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:Yo(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function V$(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,n=di(r,["challenge","allowCredentials"]),s=Yo(e).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const a=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:Yo(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function W$(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:Ii(new Uint8Array(r.response.attestationObject)),clientDataJSON:Ii(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function K$(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,n=r.getClientExtensionResults(),s=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:Ii(new Uint8Array(s.authenticatorData)),clientDataJSON:Ii(new Uint8Array(s.clientDataJSON)),signature:Ii(new Uint8Array(s.signature)),userHandle:s.userHandle?Ii(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function FA(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function uw(){var r,e;return!!(vr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function q$(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Od("Browser returned unexpected credential type",e)}:{data:null,error:new Od("Empty credential response",e)}}catch(e){return{data:null,error:B$({error:e,options:r})}}}async function Y$(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Od("Browser returned unexpected credential type",e)}:{data:null,error:new Od("Empty credential response",e)}}catch(e){return{data:null,error:U$({error:e,options:r})}}}const Q$={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},X$={userVerification:"preferred",hints:["security-key"]};function Nd(...r){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of r)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))n[i]=o;else if(t(o))n[i]=o;else if(e(o)){const a=n[i];e(a)?n[i]=Nd(a,o):n[i]=Nd(o)}else n[i]=o}return n}function J$(r,e){return Nd(Q$,r,e||{})}function Z$(r,e){return Nd(X$,r,e||{})}class eB{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};const l=s??G$.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:c}=o.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${n}`),c.displayName||(c.displayName=c.name)}switch(o.webauthn.type){case"create":{const c=J$(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:d}=await q$({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}case"request":{const c=Z$(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:d}=await Y$(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}}}catch(o){return be(o)?{data:null,error:o}:{data:null,error:new Ei("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}},i){if(!t)return{data:null,error:new Hl("rpId is required for WebAuthn authentication")};try{if(!uw())return{data:null,error:new Ei("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:n,credential_response:l.credential_response}})}catch(o){return be(o)?{data:null,error:o}:{data:null,error:new Ei("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s},i){if(!t)return{data:null,error:new Hl("rpId is required for WebAuthn registration")};try{if(!uw())return{data:null,error:new Ei("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var d;return(d=u.data)===null||d===void 0?void 0:d.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return be(o)?{data:null,error:o}:{data:null,error:new Ei("Unexpected error in register",o)}}}}M$();const tB={url:Jj,storageKey:Zj,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:e$,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function dw(r,e,t){return await t()}const po={};class Vl{get jwks(){var e,t;return(t=(e=po[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){po[this.storageKey]=Object.assign(Object.assign({},po[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=po[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){po[this.storageKey]=Object.assign(Object.assign({},po[this.storageKey]),{cachedAt:e})}constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Vl.nextInstanceID,Vl.nextInstanceID+=1,this.instanceID>0&&vr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},tB),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new D$({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=OA(s.fetch),this.lock=s.lock||dw,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:vr()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=N$:this.lock=dw,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new eB(this)},this.persistSession?(s.storage?this.storage=s.storage:DA()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=cw(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=cw(this.memoryStorage)),vr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${CA}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=p$(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),vr()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),o$(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return be(t)?{error:t}:{error:new Ei("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const i=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:rn}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(be(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,n,s;try{let i;if("email"in e){const{email:u,password:d,options:h}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await uo(this.storage,this.storageKey)),i=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:u,password:d,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:m},xform:rn})}else if("phone"in e){const{phone:u,password:d,options:h}=e;i=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:rn})}else throw new nu("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(be(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:aw})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:aw})}else throw new nu("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new co}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(be(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,s,i,o,a,l,c,u,d,h;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:p,wallet:g,statement:y,options:x}=e;let w;if(vr())if(typeof g=="object")w=g;else{const R=window;if("ethereum"in R&&typeof R.ethereum=="object"&&"request"in R.ethereum&&typeof R.ethereum.request=="function")w=R.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=g}const b=new URL((t=x==null?void 0:x.url)!==null&&t!==void 0?t:window.location.href),E=await w.request({method:"eth_requestAccounts"}).then(R=>R).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!E||E.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const I=MA(E[0]);let S=(n=x==null?void 0:x.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!S){const R=await w.request({method:"eth_chainId"});S=F$(R)}const C={domain:b.host,address:I,statement:y,uri:b.href,version:"1",chainId:S,nonce:(s=x==null?void 0:x.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=x==null?void 0:x.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=x==null?void 0:x.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=x==null?void 0:x.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=x==null?void 0:x.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=x==null?void 0:x.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=$$(C),m=await w.request({method:"personal_sign",params:[j$(f),I]})}try{const{data:p,error:g}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:m},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:rn});if(g)throw g;return!p||!p.session||!p.user?{data:{user:null,session:null},error:new co}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:Object.assign({},p),error:g})}catch(p){if(be(p))return{data:{user:null,session:null},error:p};throw p}}async signInWithSolana(e){var t,n,s,i,o,a,l,c,u,d,h,f;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:g,wallet:y,statement:x,options:w}=e;let b;if(vr())if(typeof y=="object")b=y;else{const I=window;if("solana"in I&&typeof I.solana=="object"&&("signIn"in I.solana&&typeof I.solana.signIn=="function"||"signMessage"in I.solana&&typeof I.solana.signMessage=="function"))b=I.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=y}const E=new URL((t=w==null?void 0:w.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in b&&b.signIn){const I=await b.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),x?{statement:x}:null));let S;if(Array.isArray(I)&&I[0]&&typeof I[0]=="object")S=I[0];else if(I&&typeof I=="object"&&"signedMessage"in I&&"signature"in I)S=I;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)m=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),p=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in b)||typeof b.signMessage!="function"||!("publicKey"in b)||typeof b!="object"||!b.publicKey||!("toBase58"in b.publicKey)||typeof b.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${E.host} wants you to sign in with your Solana account:`,b.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(s=(n=w==null?void 0:w.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((d=(u=w==null?void 0:w.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...w.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const I=await b.signMessage(new TextEncoder().encode(m),"utf8");if(!I||!(I instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=I}}try{const{data:g,error:y}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Ii(p)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:rn});if(y)throw y;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new co}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:y})}catch(g){if(be(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await mi(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:i,error:o}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:rn});if(await vs(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new co}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(be(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:i,nonce:o}=e,a=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:rn}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new co}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(be(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await uo(this.storage,this.storageKey));const{error:d}=await Ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await Ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new nu("You must provide either an email or phone number.")}catch(a){if(be(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,n;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await Ae(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:rn});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(be(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await uo(this.storage,this.storageKey)),await Ae(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:C$})}catch(i){if(be(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Es;const{error:s}=await Ae(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(be(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:o}=await Ae(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:o,error:a}=await Ae(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new nu("You must provide either an email or phone number and a type")}catch(t){if(be(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await mi(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Cf:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await mi(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Df()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Cs}):await this._useSession(async t=>{var n,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Es}:await Ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Cs})})}catch(t){if(be(t))return i$(t)&&(await this._removeSession(),await vs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new Es;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await uo(this.storage,this.storageKey));const{data:c,error:u}=await Ae(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Cs});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(be(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Es;const t=Date.now()/1e3;let n=t,s=!0,i=null;const{payload:o}=Pf(e.access_token);if(o.exp&&(n=o.exp,s=n<=t),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(be(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Es;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(be(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!vr())throw new su("No browser detected.");if(e.error||e.error_description||e.error_code)throw new su(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new ew("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new su("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ew("No code detected.");const{data:x,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new su("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const f=h-u;f*1e3<=xo&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const m=h-d;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,u);const{data:p,error:g}=await this._getUser(i);if(g)throw g;const y={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:h,refresh_token:o,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(n){if(be(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await mi(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{error:i};const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(s$(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await vs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=f$(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await uo(this.storage,this.storageKey,!0));try{return await Ae(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(be(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:s}=await this._useSession(async i=>{var o,a,l,c,u;const{data:d,error:h}=i;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Ae(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return vr()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(be(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:s,data:{session:i}}=t;if(s)throw s;const{options:o,provider:a,token:l,access_token:c,nonce:u}=e,d=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i==null?void 0:i.access_token)!==null&&n!==void 0?n:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:rn}),{data:h,error:f}=d;return f?{data:{user:null,session:null},error:f}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new co}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),{data:h,error:f})}catch(s){if(be(s))return{data:{user:null,session:null},error:s};throw s}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:o}=t;if(o)throw o;return await Ae(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(be(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await y$(async s=>(s>0&&await g$(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Ae(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:rn})),(s,i)=>{const o=200*Math.pow(2,s);return i&&Lf(i)&&Date.now()+o-n<xo})}catch(n){if(this._debug(t,"error",n),be(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),vr()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await mi(this.storage,this.storageKey);if(s&&this.userStorage){let o=await mi(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await wo(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Df()}else if(s&&!s.user&&!s.user){const o=await mi(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await vs(this.storage,this.storageKey+"-user"),await wo(this.storage,this.storageKey,s)):s.user=Df()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Cf;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${Cf}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),Lf(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Es;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Lh;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Es;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),be(i)){const o={data:null,error:i};return Lf(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await wo(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const i=iw(s);await wo(this.storage,this.storageKey,i)}else{const s=iw(t);await wo(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await vs(this.storage,this.storageKey),await vs(this.storage,this.storageKey+"-code-verifier"),await vs(this.storage,this.storageKey+"-user"),this.userStorage&&await vs(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&vr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),xo);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/xo);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${xo}ms, refresh threshold is ${Fm} ticks`),s<=Fm&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof NA)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!vr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,o]=await uo(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;return i?{data:null,error:i}:await Ae(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(be(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await Ae(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(be(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?W$(e.webauthn.credential_response):K$(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await Ae(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(t){if(be(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{data:null,error:i};const o=await Ae(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:H$(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:V$(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(be(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Pf(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(a=>a.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+r$>s)return n;const{data:i,error:o}=await Ae(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:f,error:m}=await this.getSession();if(m||!f.session)return{data:null,error:m};n=f.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=Pf(n);t!=null&&t.allowExpired||T$(i.exp);const c=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!c){const{error:f}=await this.getUser(n);if(f)throw f;return{data:{claims:i,header:s,signature:o},error:null}}const u=_$(s.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,d$(`${a}.${l}`)))throw new Bm("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(n){if(be(n))return{data:null,error:n};throw n}}}Vl.nextInstanceID=0;const rB=Vl;class nB extends rB{constructor(e){super(e)}}class sB{constructor(e,t,n){var s,i,o;this.supabaseUrl=e,this.supabaseKey=t;const a=Xj(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,c={db:Gj,realtime:Vj,auth:Object.assign(Object.assign({},Hj),{storageKey:l}),global:zj},u=Qj(n??{},c);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=qj(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new JF(new URL("rest/v1",a).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new $j(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new HF(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:i,storageKey:o,flowType:a,lock:l,debug:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new nB({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:i,flowType:a,lock:l,debug:c,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new mj(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const iB=(r,e,t)=>new sB(r,e,t);function oB(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}oB()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const aB="https://rxsgzadulpspurijnijl.supabase.co",lB="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4c2d6YWR1bHBzcHVyaWpuaWpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyNTYwNDAsImV4cCI6MjA3MzgzMjA0MH0.ecRSinKzZUNoo32Nawbxf1qpr6bZgfPGYzkyW3uKtp0",zu=iB(aB,lB,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),cB=()=>Rr({queryKey:["ui_settings"],queryFn:async()=>{const{data:r,error:e}=await zu.from("ui_settings").select("setting_key, setting_value");if(e)throw e;const t={};return r.forEach(n=>{t[n.setting_key]=n.setting_value}),t},staleTime:1e3}),uB=hh("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function dB({className:r,variant:e,...t}){return v.jsx("div",{className:Te(uB({variant:e}),r),...t})}const Wl=({movie:r})=>{var s,i;const{data:e}=cB(),t=r.poster||"/placeholder.svg",n=o=>{o.preventDefault(),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{window.location.href=`/movie/${r.id}`},100)};return v.jsxs(Js,{to:`/movie/${r.id}`,onClick:n,className:`group relative block overflow-hidden rounded-lg ${((s=e==null?void 0:e.card_transparency)==null?void 0:s.background)||"bg-card/20"} backdrop-blur-sm hover-lift animate-fade-in border ${((i=e==null?void 0:e.card_transparency)==null?void 0:i.border)||"border-white/5"}`,children:[v.jsxs("div",{className:"aspect-[2/3] overflow-hidden relative",children:[v.jsx("img",{src:t,alt:r.title,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-110",loading:"lazy",onError:o=>{const a=o.target;a.src="/placeholder.svg"}}),v.jsx(dB,{variant:"secondary",className:"absolute top-2 right-2 gap-1 bg-black/80 text-white border-white/20",children:r.subjectType===2?v.jsxs(v.Fragment,{children:[v.jsx(iP,{className:"h-3 w-3"}),v.jsx("span",{className:"text-xs",children:"Series"})]}):v.jsxs(v.Fragment,{children:[v.jsx(fh,{className:"h-3 w-3"}),v.jsx("span",{className:"text-xs",children:"Movie"})]})})]}),v.jsxs("div",{className:"p-3 h-[72px] flex flex-col justify-between",children:[v.jsx("h3",{className:"font-semibold text-sm line-clamp-2 text-foreground leading-tight",children:r.title}),v.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground h-4",children:[r.year&&v.jsx("span",{children:r.year}),r.rating&&v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(ph,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),v.jsx("span",{children:r.rating})]})]})]}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]})},Nf=({movies:r,title:e})=>{const t=T.useRef(null),n=Vr(),s=()=>{window.scrollTo({top:0,behavior:"smooth"}),n(`/category/${encodeURIComponent(e)}`)},i=o=>{if(t.current){const l=o==="left"?t.current.scrollLeft-400:t.current.scrollLeft+400;t.current.scrollTo({left:l,behavior:"smooth"})}};return r.length===0?null:v.jsxs("div",{className:"relative group",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-shadow-red",children:e}),e!=="Most watched"&&v.jsxs(pe,{variant:"ghost",size:"sm",onClick:s,className:"gap-1 hover:bg-primary/10 hover:text-primary text-sm",children:["See More",v.jsx(QL,{className:"h-4 w-4"})]})]}),v.jsx("div",{ref:t,className:"flex gap-3 overflow-x-auto scrollbar-hide scroll-smooth pb-4",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:r.map(o=>v.jsx("div",{className:"flex-shrink-0 w-[110px] sm:w-[130px] md:w-[145px]",children:v.jsx(Wl,{movie:o})},o.id))}),v.jsx(pe,{variant:"ghost",size:"icon",onClick:()=>i("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 bg-black/70 hover:bg-black/90 text-white opacity-0 group-hover:opacity-100 transition-opacity z-10",children:v.jsx(d0,{className:"h-6 w-6"})}),v.jsx(pe,{variant:"ghost",size:"icon",onClick:()=>i("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 bg-black/70 hover:bg-black/90 text-white opacity-0 group-hover:opacity-100 transition-opacity z-10",children:v.jsx(h0,{className:"h-6 w-6"})})]})},Ti=T.forwardRef(({className:r,...e},t)=>v.jsx("div",{ref:t,className:Te("rounded-lg border bg-card text-card-foreground shadow-sm",r),...e}));Ti.displayName="Card";const bo=T.forwardRef(({className:r,...e},t)=>v.jsx("div",{ref:t,className:Te("flex flex-col space-y-1.5 p-6",r),...e}));bo.displayName="CardHeader";const So=T.forwardRef(({className:r,...e},t)=>v.jsx("h3",{ref:t,className:Te("text-2xl font-semibold leading-none tracking-tight",r),...e}));So.displayName="CardTitle";const Um=T.forwardRef(({className:r,...e},t)=>v.jsx("p",{ref:t,className:Te("text-sm text-muted-foreground",r),...e}));Um.displayName="CardDescription";const Eo=T.forwardRef(({className:r,...e},t)=>v.jsx("div",{ref:t,className:Te("p-6 pt-0",r),...e}));Eo.displayName="CardContent";const hB=T.forwardRef(({className:r,...e},t)=>v.jsx("div",{ref:t,className:Te("flex items-center p-6 pt-0",r),...e}));hB.displayName="CardFooter";const fB=()=>{const r=Vr(),[e,t]=T.useState([]),[n,s]=T.useState(null);T.useEffect(()=>{i()},[]);async function i(){try{const c=await ot.getAllVideoProgress(),d=(await ot.getWatchHistory()).map(h=>{const f=c[h.id]||{};return{...h,...f,poster:h.poster||"",seasons:h.seasons||f.seasons,subtitles:h.subtitles||f.subtitles,sources:h.sources||f.sources,isSeries:h.isSeries||!1}}).filter(h=>h.time&&h.duration&&h.time>10&&h.time<h.duration-30);t(d)}catch(c){console.error("Failed to load watch history:",c),t([])}}const o=c=>{console.log("Continue Watching Item Data:",{id:c.id,hasSources:!!c.sources,sources:c.sources?"Present":"Missing",hasSubtitles:!!c.subtitles,subtitles:c.subtitles?"Present":"Missing"}),s(c.id);const u=new URLSearchParams;u.set("url",c.url||""),u.set("movieId",c.id),u.set("movieTitle",c.title),u.set("poster",c.poster||""),u.set("resumeTime",(c.time||0).toString()),c.subtitles&&(u.set("subtitles",c.subtitles),console.log(" Subtitles added to URL params")),c.sources?(u.set("sources",c.sources),console.log(" Sources added to URL params")):console.warn(" No sources data available for quality selection"),c.isSeries&&c.season&&c.episode?(u.set("title",`${c.title} S${c.season}E${c.episode}`),u.set("season",c.season),u.set("episode",c.episode),c.seasons&&u.set("seasons",c.seasons)):u.set("title",c.title),r(`/player?${u.toString()}`)},a=async(c,u)=>{c.stopPropagation();try{await ot.deleteFromWatchHistory(u),await ot.deleteVideoProgress(u),await i()}catch(d){console.error("Failed to delete item:",d)}},l=(c,u)=>!c||!u||u===0?0:Math.min(c/u*100,100);return e.length===0?null:v.jsx("section",{className:"w-full py-6",children:v.jsxs(jn,{className:"w-full",children:[v.jsx("div",{className:"flex gap-4 pb-4",children:e.map(c=>v.jsxs(Ti,{className:"group relative overflow-hidden cursor-pointer flex-shrink-0 w-[150px] sm:w-[200px] bg-card",onClick:()=>o(c),children:[v.jsx("div",{className:"absolute top-2 left-2 z-20 px-3 py-1 bg-gradient-to-r from-primary via-purple-500 to-pink-500 rounded-full shadow-lg",children:v.jsx("span",{className:"text-xs sm:text-sm font-bold text-white tracking-wide",children:"Continue Watching"})}),v.jsx(pe,{variant:"ghost",size:"sm",className:"absolute top-1 right-1 z-20 h-7 w-7 p-0 bg-black/70 hover:bg-black/90 text-white rounded-full md:opacity-0 md:group-hover:opacity-100 transition-opacity shadow-lg",onClick:u=>a(u,c.id),children:v.jsx(ui,{className:"h-4 w-4"})}),v.jsxs("div",{className:"relative aspect-[2/3]",children:[v.jsx("img",{src:c.poster||"/placeholder.svg",alt:c.title,className:"w-full h-full object-cover",onError:u=>{const d=u.target;d.src="/placeholder.svg"}}),v.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:v.jsxs(pe,{size:"sm",className:"gap-2",disabled:n===c.id,children:[n===c.id?v.jsx(nm,{className:"h-4 w-4 animate-spin"}):v.jsx(ri,{className:"h-4 w-4"}),n===c.id?"Loading...":"Continue"]})}),v.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/20",children:v.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${l(c.time,c.duration)}%`}})})]}),v.jsxs("div",{className:"p-3 bg-card",children:[v.jsx("p",{className:"text-sm sm:text-base font-semibold truncate",children:c.title}),c.season&&c.episode&&v.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["S",c.season,"E",c.episode]})]})]},c.id))}),v.jsx(zl,{orientation:"horizontal"})]})})},iu=[{name:"Gifted Tech  WhatsApp",url:"https://whatsapp.com/channel/0029Vb3hlgX5kg7G0nFggl0Y",type:"whatsapp",gradientFrom:"from-emerald-600",gradientTo:"to-emerald-500",shadowColor:"rgba(16,185,129,0.4)"},{name:"Bwm xmd  WhatsApp",url:"https://whatsapp.com/channel/0029VaZuGSxEawdxZK9CzM0Y",type:"whatsapp",gradientFrom:"from-emerald-600",gradientTo:"to-emerald-500",shadowColor:"rgba(16,185,129,0.4)"},{name:"Bwm xmd  Website",url:"https://bwmxmd.online",type:"website",gradientFrom:"from-blue-600 via-purple-600",gradientTo:"to-pink-600",shadowColor:"rgba(147,51,234,0.4)"},{name:"Gifted Tech  Website",url:"https://giftedtech.co.ke",type:"website",gradientFrom:"from-orange-600 via-red-600",gradientTo:"to-pink-600",shadowColor:"rgba(239,68,68,0.4)"}];function pB(){const[r,e]=T.useState(0),t=T.useRef(),n=iu[r];T.useEffect(()=>(t.current=setInterval(()=>{e(i=>(i+1)%iu.length)},4e3),()=>{t.current&&clearInterval(t.current)}),[]);const s=i=>{e(i),t.current&&clearInterval(t.current),t.current=setInterval(()=>{e(o=>(o+1)%iu.length)},4e3)};return v.jsxs("section",{className:"py-12 md:py-20 bg-gradient-to-br from-primary/10 via-primary/5 to-background rounded-3xl border border-primary/20 relative overflow-hidden",children:[v.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_hsl(var(--primary)/0.15),transparent_50%)]"}),v.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_left,_hsl(var(--primary)/0.1),transparent_50%)]"}),v.jsxs("div",{className:"relative text-center space-y-8 px-4",children:[v.jsxs("div",{className:"space-y-3",children:[v.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black tracking-tight",children:v.jsx("span",{className:"bg-gradient-to-r from-primary via-orange-500 to-yellow-500 bg-clip-text text-transparent drop-shadow-lg",children:"Join Our Community"})}),v.jsx("p",{className:"text-base sm:text-lg text-muted-foreground max-w-2xl mx-auto",children:"Connect with fellow movie enthusiasts and stay updated with the latest releases"})]}),v.jsx("div",{className:"max-w-2xl mx-auto pt-4",children:v.jsxs("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:`group relative block px-8 py-6 bg-gradient-to-r ${n.gradientFrom} ${n.gradientTo} hover:scale-105 text-white font-bold rounded-2xl transition-all duration-500 overflow-hidden animate-fade-in`,style:{boxShadow:`0 10px 40px ${n.shadowColor}`},children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-700"}),v.jsxs("div",{className:"relative flex items-center justify-center gap-3",children:[n.type==="whatsapp"?v.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})}):v.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})}),v.jsx("span",{className:"text-lg sm:text-xl",children:n.name})]})]},r)}),v.jsx("div",{className:"flex items-center justify-center gap-2 pt-4",children:iu.map((i,o)=>v.jsx("button",{onClick:()=>s(o),className:`transition-all duration-300 rounded-full ${o===r?"w-8 h-2 bg-primary":"w-2 h-2 bg-primary/30 hover:bg-primary/50"}`,"aria-label":`Go to slide ${o+1}`},o))})]})]})}function In({className:r,...e}){return v.jsx("div",{className:Te("animate-pulse rounded-md bg-muted",r),...e})}const ty=()=>v.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:v.jsxs("div",{className:"text-center space-y-6 max-w-2xl animate-fade-in",children:[v.jsx("div",{className:"flex justify-center mb-6",children:v.jsx("div",{className:"relative",children:v.jsx("div",{className:"w-24 h-24 bg-primary/10 rounded-full flex items-center justify-center animate-pulse",children:v.jsx(sP,{className:"w-12 h-12 text-primary"})})})}),v.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground",children:"Under Development"}),v.jsxs("p",{className:"text-lg md:text-xl text-muted-foreground",children:["Our website is currently under development.",v.jsx("br",{}),"Please come back later!"]}),v.jsxs("div",{className:"pt-8 space-y-6",children:[v.jsxs("div",{className:"space-y-4",children:[v.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Connect With Us"}),v.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[v.jsxs("div",{className:"p-6 bg-card rounded-lg border space-y-3",children:[v.jsx("h3",{className:"font-semibold text-lg",children:"Gifted Tech"}),v.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[v.jsxs("p",{children:[" Website: ",v.jsx("a",{href:"https://giftedtech.co.ke",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"giftedtech.co.ke"})]}),v.jsxs("p",{children:[" WhatsApp: ",v.jsx("a",{href:"https://whatsapp.com/channel/0029Vb3hlgX5kg7G0nFggl0Y",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Join Channel"})]})]})]}),v.jsxs("div",{className:"p-6 bg-card rounded-lg border space-y-3",children:[v.jsx("h3",{className:"font-semibold text-lg",children:"BWM XMD"}),v.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[v.jsxs("p",{children:[" Website: ",v.jsx("a",{href:"https://bwmxmd.online",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"bwmxmd.online"})]}),v.jsxs("p",{children:[" WhatsApp: ",v.jsx("a",{href:"https://whatsapp.com/channel/0029VaZuGSxEawdxZK9CzM0Y",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Join Channel"})]})]})]})]})]}),v.jsx(pe,{onClick:()=>window.location.reload(),size:"lg",className:"mt-4",children:"Try Again"})]})]})}),Mf=768;function mB(){const[r,e]=T.useState(void 0);return T.useEffect(()=>{const t=window.matchMedia(`(max-width: ${Mf-1}px)`),n=()=>{e(window.innerWidth<Mf)};return t.addEventListener("change",n),e(window.innerWidth<Mf),()=>t.removeEventListener("change",n)},[]),!!r}const gB=()=>{T.useEffect(()=>{fetch("https://rxsgzadulpspurijnijl.supabase.co/functions/v1/track-visit",{method:"POST",headers:{"Content-Type":"application/json"}}).catch(()=>{})},[])};function yB(){const r=mB();gB();const{data:e,isLoading:t,error:n}=Rr({queryKey:["homepage"],queryFn:Ot.getHomepage,staleTime:5*60*1e3}),{data:s}=Rr({queryKey:["trending"],queryFn:Ot.getTrending,staleTime:5*60*1e3});return n?v.jsx(ty,{}):v.jsx("div",{className:"w-full",children:t?v.jsxs("div",{className:"container mx-auto px-4 py-8 pt-24 space-y-4",children:[v.jsx(In,{className:"h-8 w-48"}),v.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:12}).map((i,o)=>v.jsx(In,{className:"aspect-[2/3] rounded-lg"},o))})]}):v.jsxs(v.Fragment,{children:[!r&&(e==null?void 0:e.featured)&&e.featured.length>0&&v.jsx(BF,{movies:[...e.featured.slice(0,3),...(s==null?void 0:s.slice(0,3))||[]]}),r&&(e==null?void 0:e.featured)&&e.featured.length>0&&v.jsx($F,{movies:[...e.featured.slice(0,3),...(s==null?void 0:s.slice(0,3))||[]]}),v.jsxs("div",{className:"container mx-auto px-4 space-y-4 md:space-y-6 -mt-20 md:-mt-12",children:[s&&s.length>0&&v.jsx("section",{className:"md:hidden relative z-10",children:v.jsx(Nf,{movies:s,title:"Most watched"})}),v.jsx(fB,{}),(e==null?void 0:e.categories)&&e.categories.length>0&&e.categories[0]&&v.jsx("section",{children:v.jsx(Nf,{movies:e.categories[0].movies,title:e.categories[0].name})}),v.jsx(pB,{}),(e==null?void 0:e.categories)&&e.categories.length>1&&v.jsx(v.Fragment,{children:e.categories.slice(1).map(i=>i.movies&&i.movies.length>0&&v.jsx("section",{children:v.jsx(Nf,{movies:i.movies,title:i.name})},i.name))})]})]})})}const ry=({movies:r,loading:e})=>e?v.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:12}).map((t,n)=>v.jsx(In,{className:"aspect-[2/3] rounded-lg"},n))}):r.length===0?v.jsx("div",{className:"text-center py-12",children:v.jsx("p",{className:"text-muted-foreground",children:"No movies found"})}):v.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-7 gap-3",children:r.map(t=>v.jsx(Wl,{movie:t},t.id))});function vB(){const{data:r,isLoading:e,error:t}=Rr({queryKey:["trending"],queryFn:Ot.getTrending,staleTime:3e5});return t?v.jsx(ty,{}):v.jsxs("div",{className:"container mx-auto px-4 py-8",children:[v.jsx("h1",{className:"text-3xl font-bold mb-8 text-shadow-red",children:"Trending Movies"}),v.jsx(ry,{movies:r||[],loading:e})]})}const ny=T.forwardRef(({className:r,type:e,...t},n)=>v.jsx("input",{type:e,className:Te("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:n,...t}));ny.displayName="Input";const xB=10;function wB(){const[r,e]=H_(),t=r.get("q")||"",[n,s]=T.useState(t),[i,o]=T.useState([]);T.useEffect(()=>{a()},[]);async function a(){try{const m=await ot.getSearchHistory();o(m.slice(0,xB))}catch(m){console.error("Failed to load search history:",m),o([])}}const l=T.useCallback(async m=>{if(m.trim())try{await ot.addSearchTerm(m),await a()}catch(p){console.error("Failed to save search term:",p)}},[]);T.useEffect(()=>{if(!n.trim()){t&&e({});return}const m=setTimeout(()=>{e({q:n.trim()}),l(n.trim())},300);return()=>clearTimeout(m)},[n,e,l,t]);const{data:c,isLoading:u,error:d}=Rr({queryKey:["search",t],queryFn:()=>Ot.searchMovies(t),enabled:!!t,staleTime:5*60*1e3}),h=async()=>{try{await ot.clearSearchHistory(),o([])}catch(m){console.error("Failed to clear search history:",m)}},f=async m=>{try{await ot.deleteSearchTerm(m),await a()}catch(p){console.error("Failed to remove search term:",p)}};return v.jsxs("div",{className:"container mx-auto px-4 py-8 pt-24",children:[v.jsxs("div",{className:"flex items-center justify-between mb-6",children:[v.jsx("h1",{className:"text-3xl font-bold text-shadow-red",children:"Search Movies"}),v.jsxs(pe,{variant:"outline",onClick:()=>window.location.href="/",className:"gap-2",children:[v.jsx(Nl,{className:"h-4 w-4"}),"Back to Home"]})]}),v.jsx("div",{className:"max-w-2xl mb-8",children:v.jsxs("div",{className:"relative",children:[v.jsx(bd,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),v.jsx(ny,{type:"text",placeholder:"Start typing to search...",value:n,onChange:m=>s(m.target.value),className:"pl-10 bg-secondary border-border h-12 text-base"})]})}),!t&&i.length>0&&v.jsxs("div",{className:"max-w-2xl mb-8",children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[v.jsx(LT,{className:"h-5 w-5"}),"Recent Searches"]}),v.jsx(pe,{variant:"ghost",size:"sm",onClick:h,children:"Clear All"})]}),v.jsx("div",{className:"flex flex-wrap gap-2",children:i.map((m,p)=>v.jsxs("button",{onClick:()=>s(m),className:"group flex items-center gap-2 px-4 py-2 bg-secondary rounded-full hover:bg-secondary/80 transition-colors",children:[v.jsx("span",{className:"text-sm",children:m}),v.jsx(ui,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity",onClick:g=>{g.stopPropagation(),f(m)}})]},p))})]}),!t&&v.jsxs("div",{className:"text-center py-16",children:[v.jsx(bd,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),v.jsx("p",{className:"text-muted-foreground",children:i.length>0?"Click a recent search or type to find movies":"Start typing to search for movies"})]}),t&&v.jsx(v.Fragment,{children:d?v.jsx(ty,{}):v.jsxs(v.Fragment,{children:[v.jsx("p",{className:"text-muted-foreground mb-8",children:u?"Searching...":`Results for "${t}"`}),v.jsx(ry,{movies:c||[],loading:u})]})})]})}const bB=()=>{const r=Vr();return v.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:v.jsxs("div",{className:"text-center space-y-6 max-w-2xl animate-fade-in",children:[v.jsx("div",{className:"flex justify-center mb-6",children:v.jsx("div",{className:"relative",children:v.jsx("div",{className:"w-24 h-24 bg-primary/10 rounded-full flex items-center justify-center animate-pulse",children:v.jsx(fh,{className:"w-12 h-12 text-primary"})})})}),v.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground",children:"Movie Not Available Yet"}),v.jsxs("p",{className:"text-lg md:text-xl text-muted-foreground",children:["This movie is not available in our web yet but is coming soon!",v.jsx("br",{}),"Stay connected with us for updates."]}),v.jsxs("div",{className:"pt-8 space-y-6",children:[v.jsxs("div",{className:"space-y-4",children:[v.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Join Our Community"}),v.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[v.jsxs("div",{className:"p-6 bg-card rounded-lg border space-y-3",children:[v.jsx("h3",{className:"font-semibold text-lg",children:"Gifted Tech"}),v.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[v.jsxs("p",{children:[" Website: ",v.jsx("a",{href:"https://giftedtech.co.ke",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"giftedtech.co.ke"})]}),v.jsxs("p",{children:[" WhatsApp: ",v.jsx("a",{href:"https://whatsapp.com/channel/0029Vb3hlgX5kg7G0nFggl0Y",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Join Channel"})]})]})]}),v.jsxs("div",{className:"p-6 bg-card rounded-lg border space-y-3",children:[v.jsx("h3",{className:"font-semibold text-lg",children:"BWM XMD"}),v.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[v.jsxs("p",{children:[" Website: ",v.jsx("a",{href:"https://bwmxmd.online",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"bwmxmd.online"})]}),v.jsxs("p",{children:[" WhatsApp: ",v.jsx("a",{href:"https://whatsapp.com/channel/0029VaZuGSxEawdxZK9CzM0Y",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Join Channel"})]})]})]})]})]}),v.jsx(pe,{onClick:()=>r("/"),size:"lg",className:"mt-4",children:"Back to Home"})]})]})})},Ph=U1,SB=z1,jA=T.forwardRef(({className:r,...e},t)=>v.jsx(Th,{ref:t,className:Te("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...e}));jA.displayName=Th.displayName;const mc=T.forwardRef(({className:r,children:e,...t},n)=>v.jsxs(SB,{children:[v.jsx(jA,{}),v.jsxs(_h,{ref:n,className:Te("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t,children:[e,v.jsxs(G1,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[v.jsx(ui,{className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));mc.displayName=_h.displayName;const gc=({className:r,...e})=>v.jsx("div",{className:Te("flex flex-col space-y-1.5 text-center sm:text-left",r),...e});gc.displayName="DialogHeader";const yc=T.forwardRef(({className:r,...e},t)=>v.jsx(Ah,{ref:t,className:Te("text-lg font-semibold leading-none tracking-tight",r),...e}));yc.displayName=Ah.displayName;const EB=T.forwardRef(({className:r,...e},t)=>v.jsx(kh,{ref:t,className:Te("text-sm text-muted-foreground",r),...e}));EB.displayName=kh.displayName;const sy=({sources:r,isOpen:e,onClose:t,onSelect:n,mode:s,title:i})=>{const o=[...r].sort((a,l)=>{const c=u=>{const d=u.match(/(\d+)p/);return d?parseInt(d[1]):0};return c(l.quality)-c(a.quality)});return v.jsx(Ph,{open:e,onOpenChange:t,children:v.jsxs(mc,{className:"sm:max-w-md",children:[v.jsxs(gc,{children:[v.jsx(yc,{className:"flex items-center gap-2",children:s==="stream"?v.jsxs(v.Fragment,{children:[v.jsx(ri,{className:"h-5 w-5"}),"Select Quality to Stream"]}):v.jsxs(v.Fragment,{children:[v.jsx(ti,{className:"h-5 w-5"}),"Select Quality to Download"]})}),i&&v.jsx("p",{className:"text-sm text-muted-foreground",children:i})]}),v.jsx(jn,{className:"max-h-[400px] pr-4",children:v.jsx("div",{className:"space-y-2",children:o.map((a,l)=>{const c=a.quality.includes("1080p")||a.quality.includes("4K");return v.jsxs(pe,{variant:"outline",className:Te("w-full justify-between h-auto py-4",c&&"border-primary/50 hover:border-primary"),onClick:()=>{n(a),t()},children:[v.jsxs("div",{className:"flex items-center gap-2",children:[c&&v.jsx(rP,{className:"h-4 w-4 text-primary"}),v.jsxs("div",{className:"text-left",children:[v.jsx("div",{className:"font-semibold",children:a.quality}),a.size&&v.jsx("div",{className:"text-xs text-muted-foreground",children:a.size}),a.format&&v.jsx("div",{className:"text-xs text-muted-foreground uppercase",children:a.format})]})]}),s==="stream"?v.jsx(ri,{className:"h-4 w-4"}):v.jsx(ti,{className:"h-4 w-4"})]},l)})})})]})})},$A=({seasons:r,onWatch:e,onDownload:t,movieTitle:n,movieId:s,onEpisodeWatch:i,onEpisodeDownload:o,currentSeason:a,currentEpisode:l,loadingSourceId:c,loadingAction:u})=>{const[d,h]=T.useState(a||1),[f,m]=T.useState(null),[p,g]=T.useState(()=>({[a||1]:!0})),[y,x]=T.useState(!1),[w,b]=T.useState("stream"),[E,I]=T.useState([]),[S,C]=T.useState(!1),[R,L]=T.useState(null),$=(V,G)=>{window.location.pathname.includes("/player")?i(s,G,V.episodeNumber):(m(V),h(G),setTimeout(()=>{const j=document.getElementById("episode-actions");j&&j.scrollIntoView({behavior:"smooth",block:"nearest"})},100))},P=async()=>{if(f){C(!0),L("stream");try{const V=await Ot.getEpisodeSources(s,d,f.episodeNumber);if(V.length===0){Xt.error("No sources available for this episode");return}I(V),b("stream"),x(!0)}catch{Xt.error("Failed to load episode sources")}finally{C(!1),L(null)}}},U=async()=>{if(f){C(!0),L("download");try{const V=await Ot.getEpisodeSources(s,d,f.episodeNumber);if(V.length===0){Xt.error("No sources available for this episode");return}I(V),b("download"),x(!0)}catch{Xt.error("Failed to load episode sources")}finally{C(!1),L(null)}}},H=window.location.pathname.includes("/player")&&a&&l?{season:a,episode:l}:f?{season:d,episode:f.episodeNumber}:null;return v.jsxs("div",{className:"space-y-4 overflow-x-hidden w-full",children:[v.jsx("h2",{className:"text-xl font-semibold",children:"Episodes & Seasons"}),v.jsxs("div",{className:"space-y-4",children:[v.jsx("div",{className:"space-y-4",children:r.map(V=>v.jsxs(B0,{open:p[V.seasonNumber],onOpenChange:G=>g(j=>({...j,[V.seasonNumber]:G})),className:"border rounded-lg overflow-hidden bg-card/50",children:[v.jsx(U0,{className:"w-full",children:v.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-muted/50 transition-colors",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsx(u0,{className:Te("h-5 w-5 transition-transform",p[V.seasonNumber]&&"rotate-180")}),v.jsxs("h3",{className:"text-lg font-semibold",children:["Season ",V.seasonNumber]})]}),v.jsxs("span",{className:"text-sm text-muted-foreground",children:[V.episodes.length," episodes"]})]})}),v.jsx(z0,{children:v.jsx("div",{className:"p-4 pt-0",children:v.jsx("div",{className:"flex flex-wrap gap-2",children:V.episodes.map(G=>v.jsx("button",{onClick:()=>$(G,V.seasonNumber),className:Te("flex-shrink-0 w-12 h-12 sm:w-14 sm:h-14 rounded-md border-2 transition-all hover:scale-105 flex items-center justify-center",(H==null?void 0:H.episode)===G.episodeNumber&&(H==null?void 0:H.season)===V.seasonNumber?"border-primary bg-primary/10 font-bold":"border-border bg-card hover:border-primary/50"),children:v.jsx("span",{className:"text-sm sm:text-base font-semibold",children:G.episodeNumber})},G.episodeNumber))})})})]},V.seasonNumber))}),f&&!window.location.pathname.includes("/player")&&(`${d}${f.episodeNumber}`,r.find(V=>V.seasonNumber===d),v.jsxs("div",{className:"space-y-3 p-6 rounded-lg bg-card border-2 border-primary/50",id:"episode-actions",children:[v.jsxs("div",{className:"text-center",children:[v.jsxs("h3",{className:"font-semibold text-lg mb-1",children:["Season ",d," - Episode ",f.episodeNumber]}),f.title&&v.jsx("p",{className:"text-sm text-muted-foreground",children:f.title})]}),v.jsxs("div",{className:"flex gap-3",children:[v.jsx(pe,{onClick:P,className:"gap-2 flex-1 h-12",size:"lg",disabled:S,children:S&&R==="stream"?v.jsxs(v.Fragment,{children:[v.jsx(nm,{className:"h-5 w-5 animate-spin"}),"Loading..."]}):v.jsxs(v.Fragment,{children:[v.jsx(ri,{className:"h-5 w-5"}),"Stream"]})}),v.jsx(pe,{onClick:U,variant:"secondary",className:"gap-2 flex-1 h-12",size:"lg",disabled:S,children:S&&R==="download"?v.jsxs(v.Fragment,{children:[v.jsx(nm,{className:"h-5 w-5 animate-spin"}),"Loading..."]}):v.jsxs(v.Fragment,{children:[v.jsx(ti,{className:"h-5 w-5"}),"Download"]})})]})]}))]}),E.length>0&&f&&v.jsx(sy,{sources:E,isOpen:y,onClose:()=>x(!1),onSelect:V=>{w==="stream"?i(s,d,f.episodeNumber,V.quality):o(s,d,f.episodeNumber,V.quality)},mode:w,title:`${n} - S${d}E${f.episodeNumber}`})]})},TB=({isOpen:r,onClose:e,onDownloadWithSubtitles:t,onDownloadVideoOnly:n,title:s,hasSubtitles:i})=>v.jsx(Ph,{open:r,onOpenChange:e,children:v.jsxs(mc,{className:"sm:max-w-md",children:[v.jsxs(gc,{children:[v.jsxs(yc,{className:"flex items-center gap-2",children:[v.jsx(ti,{className:"h-5 w-5"}),"Download Options"]}),s&&v.jsx("p",{className:"text-sm text-muted-foreground",children:s})]}),v.jsxs("div",{className:"space-y-3",children:[v.jsx(pe,{variant:"outline",className:"w-full justify-start h-auto py-4",onClick:()=>{n(),e()},children:v.jsxs("div",{className:"flex items-center gap-3 w-full",children:[v.jsx(JL,{className:"h-5 w-5 text-primary"}),v.jsxs("div",{className:"text-left flex-1",children:[v.jsx("div",{className:"font-semibold",children:"Video Only"}),v.jsx("div",{className:"text-xs text-muted-foreground",children:"Download just the video file"})]})]})}),i&&v.jsx(pe,{variant:"outline",className:"w-full justify-start h-auto py-4",onClick:()=>{t(),e()},children:v.jsxs("div",{className:"flex items-center gap-3 w-full",children:[v.jsx(XL,{className:"h-5 w-5 text-primary"}),v.jsxs("div",{className:"text-left flex-1",children:[v.jsx("div",{className:"font-semibold",children:"Video + Subtitles"}),v.jsx("div",{className:"text-xs text-muted-foreground",children:"Download video and subtitle files (.srt/.vtt) in a zip"})]})]})})]})]})});function ou(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var BA={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(r,e){(function(t){r.exports=t()})(function(){return function t(n,s,i){function o(c,u){if(!s[c]){if(!n[c]){var d=typeof ou=="function"&&ou;if(!u&&d)return d(c,!0);if(a)return a(c,!0);var h=new Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h}var f=s[c]={exports:{}};n[c][0].call(f.exports,function(m){var p=n[c][1][m];return o(p||m)},f,f.exports,t,n,s,i)}return s[c].exports}for(var a=typeof ou=="function"&&ou,l=0;l<i.length;l++)o(i[l]);return o}({1:[function(t,n,s){var i=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(l){for(var c,u,d,h,f,m,p,g=[],y=0,x=l.length,w=x,b=i.getTypeOf(l)!=="string";y<l.length;)w=x-y,d=b?(c=l[y++],u=y<x?l[y++]:0,y<x?l[y++]:0):(c=l.charCodeAt(y++),u=y<x?l.charCodeAt(y++):0,y<x?l.charCodeAt(y++):0),h=c>>2,f=(3&c)<<4|u>>4,m=1<w?(15&u)<<2|d>>6:64,p=2<w?63&d:64,g.push(a.charAt(h)+a.charAt(f)+a.charAt(m)+a.charAt(p));return g.join("")},s.decode=function(l){var c,u,d,h,f,m,p=0,g=0,y="data:";if(l.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var x,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&w--,l.charAt(l.length-2)===a.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=o.uint8array?new Uint8Array(0|w):new Array(0|w);p<l.length;)c=a.indexOf(l.charAt(p++))<<2|(h=a.indexOf(l.charAt(p++)))>>4,u=(15&h)<<4|(f=a.indexOf(l.charAt(p++)))>>2,d=(3&f)<<6|(m=a.indexOf(l.charAt(p++))),x[g++]=c,f!==64&&(x[g++]=u),m!==64&&(x[g++]=d);return x}},{"./support":30,"./utils":32}],2:[function(t,n,s){var i=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(u,d,h,f,m){this.compressedSize=u,this.uncompressedSize=d,this.crc32=h,this.compression=f,this.compressedContent=m}c.prototype={getContentWorker:function(){var u=new o(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return u.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(u,d,h){return u.pipe(new a).pipe(new l("uncompressedSize")).pipe(d.compressWorker(h)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,n,s){var i=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,n,s){var i=t("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();n.exports=function(a,l){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?function(c,u,d,h){var f=o,m=h+d;c^=-1;for(var p=h;p<m;p++)c=c>>>8^f[255&(c^u[p])];return-1^c}(0|l,a,a.length,0):function(c,u,d,h){var f=o,m=h+d;c^=-1;for(var p=h;p<m;p++)c=c>>>8^f[255&(c^u.charCodeAt(p))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,n,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,n,s){var i=null;i=typeof Promise<"u"?Promise:t("lie"),n.exports={Promise:i}},{lie:37}],7:[function(t,n,s){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),c=i?"uint8array":"array";function u(d,h){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=h,this.meta={}}s.magic="\b\0",a.inherits(u,l),u.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,d.data),!1)},u.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(h){d.push({data:h,meta:d.meta})}},s.compressWorker=function(d){return new u("Deflate",d)},s.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,n,s){function i(f,m){var p,g="";for(p=0;p<m;p++)g+=String.fromCharCode(255&f),f>>>=8;return g}function o(f,m,p,g,y,x){var w,b,E=f.file,I=f.compression,S=x!==c.utf8encode,C=a.transformTo("string",x(E.name)),R=a.transformTo("string",c.utf8encode(E.name)),L=E.comment,$=a.transformTo("string",x(L)),P=a.transformTo("string",c.utf8encode(L)),U=R.length!==E.name.length,_=P.length!==L.length,H="",V="",G="",j=E.dir,F=E.date,Y={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(Y.crc32=f.crc32,Y.compressedSize=f.compressedSize,Y.uncompressedSize=f.uncompressedSize);var M=0;m&&(M|=8),S||!U&&!_||(M|=2048);var D=0,ee=0;j&&(D|=16),y==="UNIX"?(ee=798,D|=function(te,oe){var ce=te;return te||(ce=oe?16893:33204),(65535&ce)<<16}(E.unixPermissions,j)):(ee=20,D|=function(te){return 63&(te||0)}(E.dosPermissions)),w=F.getUTCHours(),w<<=6,w|=F.getUTCMinutes(),w<<=5,w|=F.getUTCSeconds()/2,b=F.getUTCFullYear()-1980,b<<=4,b|=F.getUTCMonth()+1,b<<=5,b|=F.getUTCDate(),U&&(V=i(1,1)+i(u(C),4)+R,H+="up"+i(V.length,2)+V),_&&(G=i(1,1)+i(u($),4)+P,H+="uc"+i(G.length,2)+G);var Q="";return Q+=`
\0`,Q+=i(M,2),Q+=I.magic,Q+=i(w,2),Q+=i(b,2),Q+=i(Y.crc32,4),Q+=i(Y.compressedSize,4),Q+=i(Y.uncompressedSize,4),Q+=i(C.length,2),Q+=i(H.length,2),{fileRecord:d.LOCAL_FILE_HEADER+Q+C+H,dirRecord:d.CENTRAL_FILE_HEADER+i(ee,2)+Q+i($.length,2)+"\0\0\0\0"+i(D,4)+i(g,4)+C+H+$}}var a=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),u=t("../crc32"),d=t("../signature");function h(f,m,p,g){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(h,l),h.prototype.push=function(f){var m=f.meta.percent||0,p=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,l.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-g-1))/p:100}}))},h.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var p=o(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,p=o(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(g){return d.DATA_DESCRIPTOR+i(g.crc32,4)+i(g.compressedSize,4)+i(g.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-f,g=function(y,x,w,b,E){var I=a.transformTo("string",E(b));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(y,2)+i(y,2)+i(x,4)+i(w,4)+i(I.length,2)+I}(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(p){m.processChunk(p)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(p){m.error(p)}),this},h.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(f){var m=this._sources;if(!l.prototype.error.call(this,f))return!1;for(var p=0;p<m.length;p++)try{m[p].error(f)}catch{}return!0},h.prototype.lock=function(){l.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},n.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,n,s){var i=t("../compressions"),o=t("./ZipFileWorker");s.generateWorker=function(a,l,c){var u=new o(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{a.forEach(function(h,f){d++;var m=function(x,w){var b=x||w,E=i[b];if(!E)throw new Error(b+" is not a valid compression method !");return E}(f.options.compression,l.compression),p=f.options.compressionOptions||l.compressionOptions||{},g=f.dir,y=f.date;f._compressWorker(m,p).withStreamInfo("file",{name:h,dir:g,date:y,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=d}catch(h){u.error(h)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,n,s){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new i;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.10.1",i.loadAsync=function(o,a){return new i().loadAsync(o,a)},i.external=t("./external"),n.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,n,s){var i=t("./utils"),o=t("./external"),a=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function d(h){return new o.Promise(function(f,m){var p=h.decompressed.getContentWorker().pipe(new c);p.on("error",function(g){m(g)}).on("end",function(){p.streamInfo.crc32!==h.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(h,f){var m=this;return f=i.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(h)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",h,!0,f.optimizedBinaryString,f.base64).then(function(p){var g=new l(f);return g.load(p),g}).then(function(p){var g=[o.Promise.resolve(p)],y=p.files;if(f.checkCRC32)for(var x=0;x<y.length;x++)g.push(d(y[x]));return o.Promise.all(g)}).then(function(p){for(var g=p.shift(),y=g.files,x=0;x<y.length;x++){var w=y[x],b=w.fileNameStr,E=i.resolve(w.fileNameStr);m.file(E,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:f.createFolders}),w.dir||(m.file(E).unsafeOriginalName=b)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,n,s){var i=t("../utils"),o=t("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(u){c.push({data:u,meta:{percent:0}})}).on("error",function(u){c.isPaused?this.generatedError=u:c.error(u)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,n,s){var i=t("readable-stream").Readable;function o(a,l,c){i.call(this,l),this._helper=a;var u=this;a.on("data",function(d,h){u.push(d)||u._helper.pause(),c&&c(h)}).on("error",function(d){u.emit("error",d)}).on("end",function(){u.push(null)})}t("../utils").inherits(o,i),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,n,s){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,o);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,o)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var o=new Buffer(i);return o.fill(0),o},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(t,n,s){function i(E,I,S){var C,R=a.getTypeOf(I),L=a.extend(S||{},u);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(E=y(E)),L.createFolders&&(C=g(E))&&x.call(this,C,!0);var $=R==="string"&&L.binary===!1&&L.base64===!1;S&&S.binary!==void 0||(L.binary=!$),(I instanceof d&&I.uncompressedSize===0||L.dir||!I||I.length===0)&&(L.base64=!1,L.binary=!0,I="",L.compression="STORE",R="string");var P=null;P=I instanceof d||I instanceof l?I:m.isNode&&m.isStream(I)?new p(E,I):a.prepareContent(E,I,L.binary,L.optimizedBinaryString,L.base64);var U=new h(E,P,L);this.files[E]=U}var o=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),u=t("./defaults"),d=t("./compressedObject"),h=t("./zipObject"),f=t("./generate"),m=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),g=function(E){E.slice(-1)==="/"&&(E=E.substring(0,E.length-1));var I=E.lastIndexOf("/");return 0<I?E.substring(0,I):""},y=function(E){return E.slice(-1)!=="/"&&(E+="/"),E},x=function(E,I){return I=I!==void 0?I:u.createFolders,E=y(E),this.files[E]||i.call(this,E,null,{dir:!0,createFolders:I}),this.files[E]};function w(E){return Object.prototype.toString.call(E)==="[object RegExp]"}var b={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(E){var I,S,C;for(I in this.files)C=this.files[I],(S=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&E(S,C)},filter:function(E){var I=[];return this.forEach(function(S,C){E(S,C)&&I.push(C)}),I},file:function(E,I,S){if(arguments.length!==1)return E=this.root+E,i.call(this,E,I,S),this;if(w(E)){var C=E;return this.filter(function(L,$){return!$.dir&&C.test(L)})}var R=this.files[this.root+E];return R&&!R.dir?R:null},folder:function(E){if(!E)return this;if(w(E))return this.filter(function(R,L){return L.dir&&E.test(R)});var I=this.root+E,S=x.call(this,I),C=this.clone();return C.root=S.name,C},remove:function(E){E=this.root+E;var I=this.files[E];if(I||(E.slice(-1)!=="/"&&(E+="/"),I=this.files[E]),I&&!I.dir)delete this.files[E];else for(var S=this.filter(function(R,L){return L.name.slice(0,E.length)===E}),C=0;C<S.length;C++)delete this.files[S[C].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(E){var I,S={};try{if((S=a.extend(E||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");a.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var C=S.comment||this.comment||"";I=f.generateWorker(this,S,C)}catch(R){(I=new l("error")).error(R)}return new c(I,S.type||"string",S.mimeType)},generateAsync:function(E,I){return this.generateInternalStream(E).accumulate(I)},generateNodeStream:function(E,I){return(E=E||{}).type||(E.type="nodebuffer"),this.generateInternalStream(E).toNodejsStream(I)}};n.exports=b},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,n,s){n.exports=t("stream")},{stream:void 0}],17:[function(t,n,s){var i=t("./DataReader");function o(a){i.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}t("../utils").inherits(o,i),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),u=a.charCodeAt(2),d=a.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===l&&this.data[h+1]===c&&this.data[h+2]===u&&this.data[h+3]===d)return h-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),u=a.charCodeAt(2),d=a.charCodeAt(3),h=this.readData(4);return l===h[0]&&c===h[1]&&u===h[2]&&d===h[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,n,s){var i=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(t,n,s){var i=t("./Uint8ArrayReader");function o(a){i.call(this,a)}t("../utils").inherits(o,i),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,n,s){var i=t("./DataReader");function o(a){i.call(this,a)}t("../utils").inherits(o,i),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,n,s){var i=t("./ArrayReader");function o(a){i.call(this,a)}t("../utils").inherits(o,i),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,n,s){var i=t("../utils"),o=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),u=t("./Uint8ArrayReader");n.exports=function(d){var h=i.getTypeOf(d);return i.checkSupport(h),h!=="string"||o.uint8array?h==="nodebuffer"?new c(d):o.uint8array?new u(i.transformTo("uint8array",d)):new a(i.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,n,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,n,s){var i=t("./GenericWorker"),o=t("../utils");function a(l){i.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,i),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,n,s){var i=t("./GenericWorker"),o=t("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,i),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,n,s){var i=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,n,s){var i=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(u){c.dataIsReady=!0,c.data=u,c.max=u&&u.length||0,c.type=i.getTypeOf(u),c.isPaused||c._tickAndRepeat()},function(u){c.error(u)})}i.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,n,s){function i(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=i},{}],29:[function(t,n,s){var i=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),c=t("../support"),u=t("../external"),d=null;if(c.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function h(m,p){return new u.Promise(function(g,y){var x=[],w=m._internalType,b=m._outputType,E=m._mimeType;m.on("data",function(I,S){x.push(I),p&&p(S)}).on("error",function(I){x=[],y(I)}).on("end",function(){try{var I=function(S,C,R){switch(S){case"blob":return i.newBlob(i.transformTo("arraybuffer",C),R);case"base64":return l.encode(C);default:return i.transformTo(S,C)}}(b,function(S,C){var R,L=0,$=null,P=0;for(R=0;R<C.length;R++)P+=C[R].length;switch(S){case"string":return C.join("");case"array":return Array.prototype.concat.apply([],C);case"uint8array":for($=new Uint8Array(P),R=0;R<C.length;R++)$.set(C[R],L),L+=C[R].length;return $;case"nodebuffer":return Buffer.concat(C);default:throw new Error("concat : unsupported type '"+S+"'")}}(w,x),E);g(I)}catch(S){y(S)}x=[]}).resume()})}function f(m,p,g){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=g,i.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(x){this._worker=new a("error"),this._worker.error(x)}}f.prototype={accumulate:function(m){return h(this,m)},on:function(m,p){var g=this;return m==="data"?this._worker.on(m,function(y){p.call(g,y.data,y.meta)}):this._worker.on(m,function(){i.delay(p,arguments,g)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,n,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var i=new ArrayBuffer(0);try{s.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),s.blob=o.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!t("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(t,n,s){for(var i=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function h(){l.call(this,"utf-8 encode")}s.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(m){var p,g,y,x,w,b=m.length,E=0;for(x=0;x<b;x++)(64512&(g=m.charCodeAt(x)))==55296&&x+1<b&&(64512&(y=m.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),x++),E+=g<128?1:g<2048?2:g<65536?3:4;for(p=o.uint8array?new Uint8Array(E):new Array(E),x=w=0;w<E;x++)(64512&(g=m.charCodeAt(x)))==55296&&x+1<b&&(64512&(y=m.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),x++),g<128?p[w++]=g:(g<2048?p[w++]=192|g>>>6:(g<65536?p[w++]=224|g>>>12:(p[w++]=240|g>>>18,p[w++]=128|g>>>12&63),p[w++]=128|g>>>6&63),p[w++]=128|63&g);return p}(f)},s.utf8decode=function(f){return o.nodebuffer?i.transformTo("nodebuffer",f).toString("utf-8"):function(m){var p,g,y,x,w=m.length,b=new Array(2*w);for(p=g=0;p<w;)if((y=m[p++])<128)b[g++]=y;else if(4<(x=c[y]))b[g++]=65533,p+=x-1;else{for(y&=x===2?31:x===3?15:7;1<x&&p<w;)y=y<<6|63&m[p++],x--;1<x?b[g++]=65533:y<65536?b[g++]=y:(y-=65536,b[g++]=55296|y>>10&1023,b[g++]=56320|1023&y)}return b.length!==g&&(b.subarray?b=b.subarray(0,g):b.length=g),i.applyFromCharCode(b)}(f=i.transformTo(o.uint8array?"uint8array":"array",f))},i.inherits(d,l),d.prototype.processChunk=function(f){var m=i.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=function(x,w){var b;for((w=w||x.length)>x.length&&(w=x.length),b=w-1;0<=b&&(192&x[b])==128;)b--;return b<0||b===0?w:b+c[x[b]]>w?b:w}(m),y=m;g!==m.length&&(o.uint8array?(y=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(y=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:s.utf8decode(y),meta:f.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=d,i.inherits(h,l),h.prototype.processChunk=function(f){this.push({data:s.utf8encode(f.data),meta:f.meta})},s.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,n,s){var i=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function c(p){return p}function u(p,g){for(var y=0;y<p.length;++y)g[y]=255&p.charCodeAt(y);return g}t("setimmediate"),s.newBlob=function(p,g){s.checkSupport("blob");try{return new Blob([p],{type:g})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,g,y){var x=[],w=0,b=p.length;if(b<=y)return String.fromCharCode.apply(null,p);for(;w<b;)g==="array"||g==="nodebuffer"?x.push(String.fromCharCode.apply(null,p.slice(w,Math.min(w+y,b)))):x.push(String.fromCharCode.apply(null,p.subarray(w,Math.min(w+y,b)))),w+=y;return x.join("")},stringifyByChar:function(p){for(var g="",y=0;y<p.length;y++)g+=String.fromCharCode(p[y]);return g},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function h(p){var g=65536,y=s.getTypeOf(p),x=!0;if(y==="uint8array"?x=d.applyCanBeUsed.uint8array:y==="nodebuffer"&&(x=d.applyCanBeUsed.nodebuffer),x)for(;1<g;)try{return d.stringifyByChunk(p,y,g)}catch{g=Math.floor(g/2)}return d.stringifyByChar(p)}function f(p,g){for(var y=0;y<p.length;y++)g[y]=p[y];return g}s.applyFromCharCode=h;var m={};m.string={string:c,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:h,array:c,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return h(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:c,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:h,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:c,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:h,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:c},s.transformTo=function(p,g){if(g=g||"",!p)return g;s.checkSupport(p);var y=s.getTypeOf(g);return m[y][p](g)},s.resolve=function(p){for(var g=p.split("/"),y=[],x=0;x<g.length;x++){var w=g[x];w==="."||w===""&&x!==0&&x!==g.length-1||(w===".."?y.pop():y.push(w))}return y.join("/")},s.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(p)?"nodebuffer":i.uint8array&&p instanceof Uint8Array?"uint8array":i.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(p){if(!i[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(p){var g,y,x="";for(y=0;y<(p||"").length;y++)x+="\\x"+((g=p.charCodeAt(y))<16?"0":"")+g.toString(16).toUpperCase();return x},s.delay=function(p,g,y){setImmediate(function(){p.apply(y||null,g||[])})},s.inherits=function(p,g){function y(){}y.prototype=g.prototype,p.prototype=new y},s.extend=function(){var p,g,y={};for(p=0;p<arguments.length;p++)for(g in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],g)&&y[g]===void 0&&(y[g]=arguments[p][g]);return y},s.prepareContent=function(p,g,y,x,w){return l.Promise.resolve(g).then(function(b){return i.blob&&(b instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(b))!==-1)&&typeof FileReader<"u"?new l.Promise(function(E,I){var S=new FileReader;S.onload=function(C){E(C.target.result)},S.onerror=function(C){I(C.target.error)},S.readAsArrayBuffer(b)}):b}).then(function(b){var E=s.getTypeOf(b);return E?(E==="arraybuffer"?b=s.transformTo("uint8array",b):E==="string"&&(w?b=o.decode(b):y&&x!==!0&&(b=function(I){return u(I,i.uint8array?new Uint8Array(I.length):new Array(I.length))}(b))),b):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,n,s){var i=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");function u(d){this.files=[],this.loadOptions=d}u.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(h)+", expected "+o.pretty(d)+")")}},isSignature:function(d,h){var f=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===h;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),h=c.uint8array?"uint8array":"array",f=o.transformTo(h,d);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,h,f,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),h=this.reader.readInt(4),f=this.reader.readData(h),this.zip64ExtensibleData[d]={id:d,length:h,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,h;for(d=0;d<this.files.length;d++)h=this.files[d],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var h=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=h-f;if(0<m)this.isSignature(h,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=i(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,n,s){var i=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),u=t("./compressions"),d=t("./support");function h(f,m){this.options=f,this.loadOptions=m}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(g){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===g)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=i(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,p,g,y=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<y;)m=f.readInt(2),p=f.readInt(2),g=f.readData(p),this.extraFields[m]={id:m,length:p,value:g};f.setIndex(y)},handleUTF8:function(){var f=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var y=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=i(f.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:c.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=i(f.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:c.utf8decode(m.readData(f.length-5))}return null}},n.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,n,s){function i(m,p,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=p,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),u=t("./stream/GenericWorker");i.prototype={internalStream:function(m){var p=null,g="string";try{if(!m)throw new Error("No output type specified.");var y=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),p=this._decompressWorker();var x=!this._dataBinary;x&&!y&&(p=p.pipe(new l.Utf8EncodeWorker)),!x&&y&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(w){(p=new u("error")).error(w)}return new o(p,g,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof c&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(g,m,p)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<d.length;f++)i.prototype[d[f]]=h;n.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,n,s){(function(i){var o,a,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var c=0,u=new l(m),d=i.document.createTextNode("");u.observe(d,{characterData:!0}),o=function(){d.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)o="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var p=i.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},i.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var h=new i.MessageChannel;h.port1.onmessage=m,o=function(){h.port2.postMessage(0)}}var f=[];function m(){var p,g;a=!0;for(var y=f.length;y;){for(g=f,f=[],p=-1;++p<y;)g[p]();y=f.length}a=!1}n.exports=function(p){f.push(p)!==1||a||o()}}).call(this,typeof Ec<"u"?Ec:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,n,s){var i=t("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function d(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function h(y,x,w){this.promise=y,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function f(y,x,w){i(function(){var b;try{b=x(w)}catch(E){return a.reject(y,E)}b===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,b)})}function m(y){var x=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof x=="function")return function(){x.apply(y,arguments)}}function p(y,x){var w=!1;function b(S){w||(w=!0,a.reject(y,S))}function E(S){w||(w=!0,a.resolve(y,S))}var I=g(function(){x(E,b)});I.status==="error"&&b(I.value)}function g(y,x){var w={};try{w.value=y(x),w.status="success"}catch(b){w.status="error",w.value=b}return w}(n.exports=d).prototype.finally=function(y){if(typeof y!="function")return this;var x=this.constructor;return this.then(function(w){return x.resolve(y()).then(function(){return w})},function(w){return x.resolve(y()).then(function(){throw w})})},d.prototype.catch=function(y){return this.then(null,y)},d.prototype.then=function(y,x){if(typeof y!="function"&&this.state===c||typeof x!="function"&&this.state===l)return this;var w=new this.constructor(o);return this.state!==u?f(w,this.state===c?y:x,this.outcome):this.queue.push(new h(w,y,x)),w},h.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},h.prototype.otherCallFulfilled=function(y){f(this.promise,this.onFulfilled,y)},h.prototype.callRejected=function(y){a.reject(this.promise,y)},h.prototype.otherCallRejected=function(y){f(this.promise,this.onRejected,y)},a.resolve=function(y,x){var w=g(m,x);if(w.status==="error")return a.reject(y,w.value);var b=w.value;if(b)p(y,b);else{y.state=c,y.outcome=x;for(var E=-1,I=y.queue.length;++E<I;)y.queue[E].callFulfilled(x)}return y},a.reject=function(y,x){y.state=l,y.outcome=x;for(var w=-1,b=y.queue.length;++w<b;)y.queue[w].callRejected(x);return y},d.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},d.reject=function(y){var x=new this(o);return a.reject(x,y)},d.all=function(y){var x=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=y.length,b=!1;if(!w)return this.resolve([]);for(var E=new Array(w),I=0,S=-1,C=new this(o);++S<w;)R(y[S],S);return C;function R(L,$){x.resolve(L).then(function(P){E[$]=P,++I!==w||b||(b=!0,a.resolve(C,E))},function(P){b||(b=!0,a.reject(C,P))})}},d.race=function(y){var x=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=y.length,b=!1;if(!w)return this.resolve([]);for(var E=-1,I=new this(o);++E<w;)S=y[E],x.resolve(S).then(function(C){b||(b=!0,a.resolve(I,C))},function(C){b||(b=!0,a.reject(I,C))});var S;return I}},{immediate:36}],38:[function(t,n,s){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),n.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,n,s){var i=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),u=Object.prototype.toString,d=0,h=-1,f=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:h,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},y||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var w=i.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(w!==d)throw new Error(l[w]);if(x.header&&i.deflateSetHeader(this.strm,x.header),x.dictionary){var b;if(b=typeof x.dictionary=="string"?a.string2buf(x.dictionary):u.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(w=i.deflateSetDictionary(this.strm,b))!==d)throw new Error(l[w]);this._dict_set=!0}}function g(y,x){var w=new p(x);if(w.push(y,!0),w.err)throw w.msg||l[w.err];return w.result}p.prototype.push=function(y,x){var w,b,E=this.strm,I=this.options.chunkSize;if(this.ended)return!1;b=x===~~x?x:x===!0?4:0,typeof y=="string"?E.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?E.input=new Uint8Array(y):E.input=y,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new o.Buf8(I),E.next_out=0,E.avail_out=I),(w=i.deflate(E,b))!==1&&w!==d)return this.onEnd(w),!(this.ended=!0);E.avail_out!==0&&(E.avail_in!==0||b!==4&&b!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(E.output,E.next_out))):this.onData(o.shrinkBuf(E.output,E.next_out)))}while((0<E.avail_in||E.avail_out===0)&&w!==1);return b===4?(w=i.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===d):b!==2||(this.onEnd(d),!(E.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},s.Deflate=p,s.deflate=g,s.deflateRaw=function(y,x){return(x=x||{}).raw=!0,g(y,x)},s.gzip=function(y,x){return(x=x||{}).gzip=!0,g(y,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,n,s){var i=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),u=t("./zlib/zstream"),d=t("./zlib/gzheader"),h=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=i.inflateInit2(this.strm,g.windowBits);if(y!==l.Z_OK)throw new Error(c[y]);this.header=new d,i.inflateGetHeader(this.strm,this.header)}function m(p,g){var y=new f(g);if(y.push(p,!0),y.err)throw y.msg||c[y.err];return y.result}f.prototype.push=function(p,g){var y,x,w,b,E,I,S=this.strm,C=this.options.chunkSize,R=this.options.dictionary,L=!1;if(this.ended)return!1;x=g===~~g?g:g===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?S.input=a.binstring2buf(p):h.call(p)==="[object ArrayBuffer]"?S.input=new Uint8Array(p):S.input=p,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(C),S.next_out=0,S.avail_out=C),(y=i.inflate(S,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&R&&(I=typeof R=="string"?a.string2buf(R):h.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,y=i.inflateSetDictionary(this.strm,I)),y===l.Z_BUF_ERROR&&L===!0&&(y=l.Z_OK,L=!1),y!==l.Z_STREAM_END&&y!==l.Z_OK)return this.onEnd(y),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&y!==l.Z_STREAM_END&&(S.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=a.utf8border(S.output,S.next_out),b=S.next_out-w,E=a.buf2string(S.output,w),S.next_out=b,S.avail_out=C-b,b&&o.arraySet(S.output,S.output,w,b,0),this.onData(E)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(L=!0)}while((0<S.avail_in||S.avail_out===0)&&y!==l.Z_STREAM_END);return y===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(y=i.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(S.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},s.Inflate=f,s.inflate=m,s.inflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},s.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,n,s){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var u=c.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var d in u)u.hasOwnProperty(d)&&(l[d]=u[d])}}return l},s.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,u,d,h){if(c.subarray&&l.subarray)l.set(c.subarray(u,u+d),h);else for(var f=0;f<d;f++)l[h+f]=c[u+f]},flattenChunks:function(l){var c,u,d,h,f,m;for(c=d=0,u=l.length;c<u;c++)d+=l[c].length;for(m=new Uint8Array(d),c=h=0,u=l.length;c<u;c++)f=l[c],m.set(f,h),h+=f.length;return m}},a={arraySet:function(l,c,u,d,h){for(var f=0;f<d;f++)l[h+f]=c[u+f]},flattenChunks:function(l){return[].concat.apply([],l)}};s.setTyped=function(l){l?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,o)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,a))},s.setTyped(i)},{}],42:[function(t,n,s){var i=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new i.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(d,h){if(h<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(d,h));for(var f="",m=0;m<h;m++)f+=String.fromCharCode(d[m]);return f}l[254]=l[254]=1,s.string2buf=function(d){var h,f,m,p,g,y=d.length,x=0;for(p=0;p<y;p++)(64512&(f=d.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=d.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),x+=f<128?1:f<2048?2:f<65536?3:4;for(h=new i.Buf8(x),p=g=0;g<x;p++)(64512&(f=d.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=d.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),p++),f<128?h[g++]=f:(f<2048?h[g++]=192|f>>>6:(f<65536?h[g++]=224|f>>>12:(h[g++]=240|f>>>18,h[g++]=128|f>>>12&63),h[g++]=128|f>>>6&63),h[g++]=128|63&f);return h},s.buf2binstring=function(d){return u(d,d.length)},s.binstring2buf=function(d){for(var h=new i.Buf8(d.length),f=0,m=h.length;f<m;f++)h[f]=d.charCodeAt(f);return h},s.buf2string=function(d,h){var f,m,p,g,y=h||d.length,x=new Array(2*y);for(f=m=0;f<y;)if((p=d[f++])<128)x[m++]=p;else if(4<(g=l[p]))x[m++]=65533,f+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&f<y;)p=p<<6|63&d[f++],g--;1<g?x[m++]=65533:p<65536?x[m++]=p:(p-=65536,x[m++]=55296|p>>10&1023,x[m++]=56320|1023&p)}return u(x,m)},s.utf8border=function(d,h){var f;for((h=h||d.length)>d.length&&(h=d.length),f=h-1;0<=f&&(192&d[f])==128;)f--;return f<0||f===0?h:f+l[d[f]]>h?f:h}},{"./common":41}],43:[function(t,n,s){n.exports=function(i,o,a,l){for(var c=65535&i|0,u=i>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;u=u+(c=c+o[l++]|0)|0,--d;);c%=65521,u%=65521}return c|u<<16|0}},{}],44:[function(t,n,s){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,n,s){var i=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();n.exports=function(o,a,l,c){var u=i,d=c+l;o^=-1;for(var h=c;h<d;h++)o=o>>>8^u[255&(o^a[h])];return-1^o}},{}],46:[function(t,n,s){var i,o=t("../utils/common"),a=t("./trees"),l=t("./adler32"),c=t("./crc32"),u=t("./messages"),d=0,h=4,f=0,m=-2,p=-1,g=4,y=2,x=8,w=9,b=286,E=30,I=19,S=2*b+1,C=15,R=3,L=258,$=L+R+1,P=42,U=113,_=1,H=2,V=3,G=4;function j(k,z){return k.msg=u[z],z}function F(k){return(k<<1)-(4<k?9:0)}function Y(k){for(var z=k.length;0<=--z;)k[z]=0}function M(k){var z=k.state,B=z.pending;B>k.avail_out&&(B=k.avail_out),B!==0&&(o.arraySet(k.output,z.pending_buf,z.pending_out,B,k.next_out),k.next_out+=B,z.pending_out+=B,k.total_out+=B,k.avail_out-=B,z.pending-=B,z.pending===0&&(z.pending_out=0))}function D(k,z){a._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,z),k.block_start=k.strstart,M(k.strm)}function ee(k,z){k.pending_buf[k.pending++]=z}function Q(k,z){k.pending_buf[k.pending++]=z>>>8&255,k.pending_buf[k.pending++]=255&z}function te(k,z){var B,N,O=k.max_chain_length,W=k.strstart,J=k.prev_length,re=k.nice_match,q=k.strstart>k.w_size-$?k.strstart-(k.w_size-$):0,se=k.window,ae=k.w_mask,ie=k.prev,he=k.strstart+L,De=se[W+J-1],Ce=se[W+J];k.prev_length>=k.good_match&&(O>>=2),re>k.lookahead&&(re=k.lookahead);do if(se[(B=z)+J]===Ce&&se[B+J-1]===De&&se[B]===se[W]&&se[++B]===se[W+1]){W+=2,B++;do;while(se[++W]===se[++B]&&se[++W]===se[++B]&&se[++W]===se[++B]&&se[++W]===se[++B]&&se[++W]===se[++B]&&se[++W]===se[++B]&&se[++W]===se[++B]&&se[++W]===se[++B]&&W<he);if(N=L-(he-W),W=he-L,J<N){if(k.match_start=z,re<=(J=N))break;De=se[W+J-1],Ce=se[W+J]}}while((z=ie[z&ae])>q&&--O!=0);return J<=k.lookahead?J:k.lookahead}function oe(k){var z,B,N,O,W,J,re,q,se,ae,ie=k.w_size;do{if(O=k.window_size-k.lookahead-k.strstart,k.strstart>=ie+(ie-$)){for(o.arraySet(k.window,k.window,ie,ie,0),k.match_start-=ie,k.strstart-=ie,k.block_start-=ie,z=B=k.hash_size;N=k.head[--z],k.head[z]=ie<=N?N-ie:0,--B;);for(z=B=ie;N=k.prev[--z],k.prev[z]=ie<=N?N-ie:0,--B;);O+=ie}if(k.strm.avail_in===0)break;if(J=k.strm,re=k.window,q=k.strstart+k.lookahead,se=O,ae=void 0,ae=J.avail_in,se<ae&&(ae=se),B=ae===0?0:(J.avail_in-=ae,o.arraySet(re,J.input,J.next_in,ae,q),J.state.wrap===1?J.adler=l(J.adler,re,ae,q):J.state.wrap===2&&(J.adler=c(J.adler,re,ae,q)),J.next_in+=ae,J.total_in+=ae,ae),k.lookahead+=B,k.lookahead+k.insert>=R)for(W=k.strstart-k.insert,k.ins_h=k.window[W],k.ins_h=(k.ins_h<<k.hash_shift^k.window[W+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[W+R-1])&k.hash_mask,k.prev[W&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=W,W++,k.insert--,!(k.lookahead+k.insert<R)););}while(k.lookahead<$&&k.strm.avail_in!==0)}function ce(k,z){for(var B,N;;){if(k.lookahead<$){if(oe(k),k.lookahead<$&&z===d)return _;if(k.lookahead===0)break}if(B=0,k.lookahead>=R&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+R-1])&k.hash_mask,B=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),B!==0&&k.strstart-B<=k.w_size-$&&(k.match_length=te(k,B)),k.match_length>=R)if(N=a._tr_tally(k,k.strstart-k.match_start,k.match_length-R),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=R){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+R-1])&k.hash_mask,B=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else N=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(N&&(D(k,!1),k.strm.avail_out===0))return _}return k.insert=k.strstart<R-1?k.strstart:R-1,z===h?(D(k,!0),k.strm.avail_out===0?V:G):k.last_lit&&(D(k,!1),k.strm.avail_out===0)?_:H}function de(k,z){for(var B,N,O;;){if(k.lookahead<$){if(oe(k),k.lookahead<$&&z===d)return _;if(k.lookahead===0)break}if(B=0,k.lookahead>=R&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+R-1])&k.hash_mask,B=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=R-1,B!==0&&k.prev_length<k.max_lazy_match&&k.strstart-B<=k.w_size-$&&(k.match_length=te(k,B),k.match_length<=5&&(k.strategy===1||k.match_length===R&&4096<k.strstart-k.match_start)&&(k.match_length=R-1)),k.prev_length>=R&&k.match_length<=k.prev_length){for(O=k.strstart+k.lookahead-R,N=a._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-R),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=O&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+R-1])&k.hash_mask,B=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=R-1,k.strstart++,N&&(D(k,!1),k.strm.avail_out===0))return _}else if(k.match_available){if((N=a._tr_tally(k,0,k.window[k.strstart-1]))&&D(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return _}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(N=a._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<R-1?k.strstart:R-1,z===h?(D(k,!0),k.strm.avail_out===0?V:G):k.last_lit&&(D(k,!1),k.strm.avail_out===0)?_:H}function we(k,z,B,N,O){this.good_length=k,this.max_lazy=z,this.nice_length=B,this.max_chain=N,this.func=O}function Le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*E+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(C+1),this.heap=new o.Buf16(2*b+1),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*b+1),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Re(k){var z;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=y,(z=k.state).pending=0,z.pending_out=0,z.wrap<0&&(z.wrap=-z.wrap),z.status=z.wrap?P:U,k.adler=z.wrap===2?0:1,z.last_flush=d,a._tr_init(z),f):j(k,m)}function ft(k){var z=Re(k);return z===f&&function(B){B.window_size=2*B.w_size,Y(B.head),B.max_lazy_match=i[B.level].max_lazy,B.good_match=i[B.level].good_length,B.nice_match=i[B.level].nice_length,B.max_chain_length=i[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=R-1,B.match_available=0,B.ins_h=0}(k.state),z}function Xe(k,z,B,N,O,W){if(!k)return m;var J=1;if(z===p&&(z=6),N<0?(J=0,N=-N):15<N&&(J=2,N-=16),O<1||w<O||B!==x||N<8||15<N||z<0||9<z||W<0||g<W)return j(k,m);N===8&&(N=9);var re=new Le;return(k.state=re).strm=k,re.wrap=J,re.gzhead=null,re.w_bits=N,re.w_size=1<<re.w_bits,re.w_mask=re.w_size-1,re.hash_bits=O+7,re.hash_size=1<<re.hash_bits,re.hash_mask=re.hash_size-1,re.hash_shift=~~((re.hash_bits+R-1)/R),re.window=new o.Buf8(2*re.w_size),re.head=new o.Buf16(re.hash_size),re.prev=new o.Buf16(re.w_size),re.lit_bufsize=1<<O+6,re.pending_buf_size=4*re.lit_bufsize,re.pending_buf=new o.Buf8(re.pending_buf_size),re.d_buf=1*re.lit_bufsize,re.l_buf=3*re.lit_bufsize,re.level=z,re.strategy=W,re.method=B,ft(k)}i=[new we(0,0,0,0,function(k,z){var B=65535;for(B>k.pending_buf_size-5&&(B=k.pending_buf_size-5);;){if(k.lookahead<=1){if(oe(k),k.lookahead===0&&z===d)return _;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var N=k.block_start+B;if((k.strstart===0||k.strstart>=N)&&(k.lookahead=k.strstart-N,k.strstart=N,D(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-$&&(D(k,!1),k.strm.avail_out===0))return _}return k.insert=0,z===h?(D(k,!0),k.strm.avail_out===0?V:G):(k.strstart>k.block_start&&(D(k,!1),k.strm.avail_out),_)}),new we(4,4,8,4,ce),new we(4,5,16,8,ce),new we(4,6,32,32,ce),new we(4,4,16,16,de),new we(8,16,32,32,de),new we(8,16,128,128,de),new we(8,32,128,256,de),new we(32,128,258,1024,de),new we(32,258,258,4096,de)],s.deflateInit=function(k,z){return Xe(k,z,x,15,8,0)},s.deflateInit2=Xe,s.deflateReset=ft,s.deflateResetKeep=Re,s.deflateSetHeader=function(k,z){return k&&k.state?k.state.wrap!==2?m:(k.state.gzhead=z,f):m},s.deflate=function(k,z){var B,N,O,W;if(!k||!k.state||5<z||z<0)return k?j(k,m):m;if(N=k.state,!k.output||!k.input&&k.avail_in!==0||N.status===666&&z!==h)return j(k,k.avail_out===0?-5:m);if(N.strm=k,B=N.last_flush,N.last_flush=z,N.status===P)if(N.wrap===2)k.adler=0,ee(N,31),ee(N,139),ee(N,8),N.gzhead?(ee(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),ee(N,255&N.gzhead.time),ee(N,N.gzhead.time>>8&255),ee(N,N.gzhead.time>>16&255),ee(N,N.gzhead.time>>24&255),ee(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),ee(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(ee(N,255&N.gzhead.extra.length),ee(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(k.adler=c(k.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(ee(N,0),ee(N,0),ee(N,0),ee(N,0),ee(N,0),ee(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),ee(N,3),N.status=U);else{var J=x+(N.w_bits-8<<4)<<8;J|=(2<=N.strategy||N.level<2?0:N.level<6?1:N.level===6?2:3)<<6,N.strstart!==0&&(J|=32),J+=31-J%31,N.status=U,Q(N,J),N.strstart!==0&&(Q(N,k.adler>>>16),Q(N,65535&k.adler)),k.adler=1}if(N.status===69)if(N.gzhead.extra){for(O=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>O&&(k.adler=c(k.adler,N.pending_buf,N.pending-O,O)),M(k),O=N.pending,N.pending!==N.pending_buf_size));)ee(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>O&&(k.adler=c(k.adler,N.pending_buf,N.pending-O,O)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(N.status===73)if(N.gzhead.name){O=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>O&&(k.adler=c(k.adler,N.pending_buf,N.pending-O,O)),M(k),O=N.pending,N.pending===N.pending_buf_size)){W=1;break}W=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,ee(N,W)}while(W!==0);N.gzhead.hcrc&&N.pending>O&&(k.adler=c(k.adler,N.pending_buf,N.pending-O,O)),W===0&&(N.gzindex=0,N.status=91)}else N.status=91;if(N.status===91)if(N.gzhead.comment){O=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>O&&(k.adler=c(k.adler,N.pending_buf,N.pending-O,O)),M(k),O=N.pending,N.pending===N.pending_buf_size)){W=1;break}W=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,ee(N,W)}while(W!==0);N.gzhead.hcrc&&N.pending>O&&(k.adler=c(k.adler,N.pending_buf,N.pending-O,O)),W===0&&(N.status=103)}else N.status=103;if(N.status===103&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&M(k),N.pending+2<=N.pending_buf_size&&(ee(N,255&k.adler),ee(N,k.adler>>8&255),k.adler=0,N.status=U)):N.status=U),N.pending!==0){if(M(k),k.avail_out===0)return N.last_flush=-1,f}else if(k.avail_in===0&&F(z)<=F(B)&&z!==h)return j(k,-5);if(N.status===666&&k.avail_in!==0)return j(k,-5);if(k.avail_in!==0||N.lookahead!==0||z!==d&&N.status!==666){var re=N.strategy===2?function(q,se){for(var ae;;){if(q.lookahead===0&&(oe(q),q.lookahead===0)){if(se===d)return _;break}if(q.match_length=0,ae=a._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,ae&&(D(q,!1),q.strm.avail_out===0))return _}return q.insert=0,se===h?(D(q,!0),q.strm.avail_out===0?V:G):q.last_lit&&(D(q,!1),q.strm.avail_out===0)?_:H}(N,z):N.strategy===3?function(q,se){for(var ae,ie,he,De,Ce=q.window;;){if(q.lookahead<=L){if(oe(q),q.lookahead<=L&&se===d)return _;if(q.lookahead===0)break}if(q.match_length=0,q.lookahead>=R&&0<q.strstart&&(ie=Ce[he=q.strstart-1])===Ce[++he]&&ie===Ce[++he]&&ie===Ce[++he]){De=q.strstart+L;do;while(ie===Ce[++he]&&ie===Ce[++he]&&ie===Ce[++he]&&ie===Ce[++he]&&ie===Ce[++he]&&ie===Ce[++he]&&ie===Ce[++he]&&ie===Ce[++he]&&he<De);q.match_length=L-(De-he),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=R?(ae=a._tr_tally(q,1,q.match_length-R),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(ae=a._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),ae&&(D(q,!1),q.strm.avail_out===0))return _}return q.insert=0,se===h?(D(q,!0),q.strm.avail_out===0?V:G):q.last_lit&&(D(q,!1),q.strm.avail_out===0)?_:H}(N,z):i[N.level].func(N,z);if(re!==V&&re!==G||(N.status=666),re===_||re===V)return k.avail_out===0&&(N.last_flush=-1),f;if(re===H&&(z===1?a._tr_align(N):z!==5&&(a._tr_stored_block(N,0,0,!1),z===3&&(Y(N.head),N.lookahead===0&&(N.strstart=0,N.block_start=0,N.insert=0))),M(k),k.avail_out===0))return N.last_flush=-1,f}return z!==h?f:N.wrap<=0?1:(N.wrap===2?(ee(N,255&k.adler),ee(N,k.adler>>8&255),ee(N,k.adler>>16&255),ee(N,k.adler>>24&255),ee(N,255&k.total_in),ee(N,k.total_in>>8&255),ee(N,k.total_in>>16&255),ee(N,k.total_in>>24&255)):(Q(N,k.adler>>>16),Q(N,65535&k.adler)),M(k),0<N.wrap&&(N.wrap=-N.wrap),N.pending!==0?f:1)},s.deflateEnd=function(k){var z;return k&&k.state?(z=k.state.status)!==P&&z!==69&&z!==73&&z!==91&&z!==103&&z!==U&&z!==666?j(k,m):(k.state=null,z===U?j(k,-3):f):m},s.deflateSetDictionary=function(k,z){var B,N,O,W,J,re,q,se,ae=z.length;if(!k||!k.state||(W=(B=k.state).wrap)===2||W===1&&B.status!==P||B.lookahead)return m;for(W===1&&(k.adler=l(k.adler,z,ae,0)),B.wrap=0,ae>=B.w_size&&(W===0&&(Y(B.head),B.strstart=0,B.block_start=0,B.insert=0),se=new o.Buf8(B.w_size),o.arraySet(se,z,ae-B.w_size,B.w_size,0),z=se,ae=B.w_size),J=k.avail_in,re=k.next_in,q=k.input,k.avail_in=ae,k.next_in=0,k.input=z,oe(B);B.lookahead>=R;){for(N=B.strstart,O=B.lookahead-(R-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[N+R-1])&B.hash_mask,B.prev[N&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=N,N++,--O;);B.strstart=N,B.lookahead=R-1,oe(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=R-1,B.match_available=0,k.next_in=re,k.input=q,k.avail_in=J,B.wrap=W,f},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,n,s){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,n,s){n.exports=function(i,o){var a,l,c,u,d,h,f,m,p,g,y,x,w,b,E,I,S,C,R,L,$,P,U,_,H;a=i.state,l=i.next_in,_=i.input,c=l+(i.avail_in-5),u=i.next_out,H=i.output,d=u-(o-i.avail_out),h=u+(i.avail_out-257),f=a.dmax,m=a.wsize,p=a.whave,g=a.wnext,y=a.window,x=a.hold,w=a.bits,b=a.lencode,E=a.distcode,I=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;e:do{w<15&&(x+=_[l++]<<w,w+=8,x+=_[l++]<<w,w+=8),C=b[x&I];t:for(;;){if(x>>>=R=C>>>24,w-=R,(R=C>>>16&255)===0)H[u++]=65535&C;else{if(!(16&R)){if(!(64&R)){C=b[(65535&C)+(x&(1<<R)-1)];continue t}if(32&R){a.mode=12;break e}i.msg="invalid literal/length code",a.mode=30;break e}L=65535&C,(R&=15)&&(w<R&&(x+=_[l++]<<w,w+=8),L+=x&(1<<R)-1,x>>>=R,w-=R),w<15&&(x+=_[l++]<<w,w+=8,x+=_[l++]<<w,w+=8),C=E[x&S];r:for(;;){if(x>>>=R=C>>>24,w-=R,!(16&(R=C>>>16&255))){if(!(64&R)){C=E[(65535&C)+(x&(1<<R)-1)];continue r}i.msg="invalid distance code",a.mode=30;break e}if($=65535&C,w<(R&=15)&&(x+=_[l++]<<w,(w+=8)<R&&(x+=_[l++]<<w,w+=8)),f<($+=x&(1<<R)-1)){i.msg="invalid distance too far back",a.mode=30;break e}if(x>>>=R,w-=R,(R=u-d)<$){if(p<(R=$-R)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break e}if(U=y,(P=0)===g){if(P+=m-R,R<L){for(L-=R;H[u++]=y[P++],--R;);P=u-$,U=H}}else if(g<R){if(P+=m+g-R,(R-=g)<L){for(L-=R;H[u++]=y[P++],--R;);if(P=0,g<L){for(L-=R=g;H[u++]=y[P++],--R;);P=u-$,U=H}}}else if(P+=g-R,R<L){for(L-=R;H[u++]=y[P++],--R;);P=u-$,U=H}for(;2<L;)H[u++]=U[P++],H[u++]=U[P++],H[u++]=U[P++],L-=3;L&&(H[u++]=U[P++],1<L&&(H[u++]=U[P++]))}else{for(P=u-$;H[u++]=H[P++],H[u++]=H[P++],H[u++]=H[P++],2<(L-=3););L&&(H[u++]=H[P++],1<L&&(H[u++]=H[P++]))}break}}break}}while(l<c&&u<h);l-=L=w>>3,x&=(1<<(w-=L<<3))-1,i.next_in=l,i.next_out=u,i.avail_in=l<c?c-l+5:5-(l-c),i.avail_out=u<h?h-u+257:257-(u-h),a.hold=x,a.bits=w}},{}],49:[function(t,n,s){var i=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),u=1,d=2,h=0,f=-2,m=1,p=852,g=592;function y(P){return(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(P){var U;return P&&P.state?(U=P.state,P.total_in=P.total_out=U.total=0,P.msg="",U.wrap&&(P.adler=1&U.wrap),U.mode=m,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new i.Buf32(p),U.distcode=U.distdyn=new i.Buf32(g),U.sane=1,U.back=-1,h):f}function b(P){var U;return P&&P.state?((U=P.state).wsize=0,U.whave=0,U.wnext=0,w(P)):f}function E(P,U){var _,H;return P&&P.state?(H=P.state,U<0?(_=0,U=-U):(_=1+(U>>4),U<48&&(U&=15)),U&&(U<8||15<U)?f:(H.window!==null&&H.wbits!==U&&(H.window=null),H.wrap=_,H.wbits=U,b(P))):f}function I(P,U){var _,H;return P?(H=new x,(P.state=H).window=null,(_=E(P,U))!==h&&(P.state=null),_):f}var S,C,R=!0;function L(P){if(R){var U;for(S=new i.Buf32(512),C=new i.Buf32(32),U=0;U<144;)P.lens[U++]=8;for(;U<256;)P.lens[U++]=9;for(;U<280;)P.lens[U++]=7;for(;U<288;)P.lens[U++]=8;for(c(u,P.lens,0,288,S,0,P.work,{bits:9}),U=0;U<32;)P.lens[U++]=5;c(d,P.lens,0,32,C,0,P.work,{bits:5}),R=!1}P.lencode=S,P.lenbits=9,P.distcode=C,P.distbits=5}function $(P,U,_,H){var V,G=P.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new i.Buf8(G.wsize)),H>=G.wsize?(i.arraySet(G.window,U,_-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(H<(V=G.wsize-G.wnext)&&(V=H),i.arraySet(G.window,U,_-H,V,G.wnext),(H-=V)?(i.arraySet(G.window,U,_-H,H,0),G.wnext=H,G.whave=G.wsize):(G.wnext+=V,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=V))),0}s.inflateReset=b,s.inflateReset2=E,s.inflateResetKeep=w,s.inflateInit=function(P){return I(P,15)},s.inflateInit2=I,s.inflate=function(P,U){var _,H,V,G,j,F,Y,M,D,ee,Q,te,oe,ce,de,we,Le,Re,ft,Xe,k,z,B,N,O=0,W=new i.Buf8(4),J=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!P||!P.state||!P.output||!P.input&&P.avail_in!==0)return f;(_=P.state).mode===12&&(_.mode=13),j=P.next_out,V=P.output,Y=P.avail_out,G=P.next_in,H=P.input,F=P.avail_in,M=_.hold,D=_.bits,ee=F,Q=Y,z=h;e:for(;;)switch(_.mode){case m:if(_.wrap===0){_.mode=13;break}for(;D<16;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(2&_.wrap&&M===35615){W[_.check=0]=255&M,W[1]=M>>>8&255,_.check=a(_.check,W,2,0),D=M=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&M)<<8)+(M>>8))%31){P.msg="incorrect header check",_.mode=30;break}if((15&M)!=8){P.msg="unknown compression method",_.mode=30;break}if(D-=4,k=8+(15&(M>>>=4)),_.wbits===0)_.wbits=k;else if(k>_.wbits){P.msg="invalid window size",_.mode=30;break}_.dmax=1<<k,P.adler=_.check=1,_.mode=512&M?10:12,D=M=0;break;case 2:for(;D<16;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(_.flags=M,(255&_.flags)!=8){P.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){P.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=M>>8&1),512&_.flags&&(W[0]=255&M,W[1]=M>>>8&255,_.check=a(_.check,W,2,0)),D=M=0,_.mode=3;case 3:for(;D<32;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}_.head&&(_.head.time=M),512&_.flags&&(W[0]=255&M,W[1]=M>>>8&255,W[2]=M>>>16&255,W[3]=M>>>24&255,_.check=a(_.check,W,4,0)),D=M=0,_.mode=4;case 4:for(;D<16;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}_.head&&(_.head.xflags=255&M,_.head.os=M>>8),512&_.flags&&(W[0]=255&M,W[1]=M>>>8&255,_.check=a(_.check,W,2,0)),D=M=0,_.mode=5;case 5:if(1024&_.flags){for(;D<16;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}_.length=M,_.head&&(_.head.extra_len=M),512&_.flags&&(W[0]=255&M,W[1]=M>>>8&255,_.check=a(_.check,W,2,0)),D=M=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(F<(te=_.length)&&(te=F),te&&(_.head&&(k=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),i.arraySet(_.head.extra,H,G,te,k)),512&_.flags&&(_.check=a(_.check,H,te,G)),F-=te,G+=te,_.length-=te),_.length))break e;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(F===0)break e;for(te=0;k=H[G+te++],_.head&&k&&_.length<65536&&(_.head.name+=String.fromCharCode(k)),k&&te<F;);if(512&_.flags&&(_.check=a(_.check,H,te,G)),F-=te,G+=te,k)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(F===0)break e;for(te=0;k=H[G+te++],_.head&&k&&_.length<65536&&(_.head.comment+=String.fromCharCode(k)),k&&te<F;);if(512&_.flags&&(_.check=a(_.check,H,te,G)),F-=te,G+=te,k)break e}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;D<16;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(M!==(65535&_.check)){P.msg="header crc mismatch",_.mode=30;break}D=M=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),P.adler=_.check=0,_.mode=12;break;case 10:for(;D<32;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}P.adler=_.check=y(M),D=M=0,_.mode=11;case 11:if(_.havedict===0)return P.next_out=j,P.avail_out=Y,P.next_in=G,P.avail_in=F,_.hold=M,_.bits=D,2;P.adler=_.check=1,_.mode=12;case 12:if(U===5||U===6)break e;case 13:if(_.last){M>>>=7&D,D-=7&D,_.mode=27;break}for(;D<3;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}switch(_.last=1&M,D-=1,3&(M>>>=1)){case 0:_.mode=14;break;case 1:if(L(_),_.mode=20,U!==6)break;M>>>=2,D-=2;break e;case 2:_.mode=17;break;case 3:P.msg="invalid block type",_.mode=30}M>>>=2,D-=2;break;case 14:for(M>>>=7&D,D-=7&D;D<32;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if((65535&M)!=(M>>>16^65535)){P.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&M,D=M=0,_.mode=15,U===6)break e;case 15:_.mode=16;case 16:if(te=_.length){if(F<te&&(te=F),Y<te&&(te=Y),te===0)break e;i.arraySet(V,H,G,te,j),F-=te,G+=te,Y-=te,j+=te,_.length-=te;break}_.mode=12;break;case 17:for(;D<14;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(_.nlen=257+(31&M),M>>>=5,D-=5,_.ndist=1+(31&M),M>>>=5,D-=5,_.ncode=4+(15&M),M>>>=4,D-=4,286<_.nlen||30<_.ndist){P.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;D<3;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}_.lens[J[_.have++]]=7&M,M>>>=3,D-=3}for(;_.have<19;)_.lens[J[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,B={bits:_.lenbits},z=c(0,_.lens,0,19,_.lencode,0,_.work,B),_.lenbits=B.bits,z){P.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;we=(O=_.lencode[M&(1<<_.lenbits)-1])>>>16&255,Le=65535&O,!((de=O>>>24)<=D);){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(Le<16)M>>>=de,D-=de,_.lens[_.have++]=Le;else{if(Le===16){for(N=de+2;D<N;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(M>>>=de,D-=de,_.have===0){P.msg="invalid bit length repeat",_.mode=30;break}k=_.lens[_.have-1],te=3+(3&M),M>>>=2,D-=2}else if(Le===17){for(N=de+3;D<N;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}D-=de,k=0,te=3+(7&(M>>>=de)),M>>>=3,D-=3}else{for(N=de+7;D<N;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}D-=de,k=0,te=11+(127&(M>>>=de)),M>>>=7,D-=7}if(_.have+te>_.nlen+_.ndist){P.msg="invalid bit length repeat",_.mode=30;break}for(;te--;)_.lens[_.have++]=k}}if(_.mode===30)break;if(_.lens[256]===0){P.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,B={bits:_.lenbits},z=c(u,_.lens,0,_.nlen,_.lencode,0,_.work,B),_.lenbits=B.bits,z){P.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,B={bits:_.distbits},z=c(d,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,B),_.distbits=B.bits,z){P.msg="invalid distances set",_.mode=30;break}if(_.mode=20,U===6)break e;case 20:_.mode=21;case 21:if(6<=F&&258<=Y){P.next_out=j,P.avail_out=Y,P.next_in=G,P.avail_in=F,_.hold=M,_.bits=D,l(P,Q),j=P.next_out,V=P.output,Y=P.avail_out,G=P.next_in,H=P.input,F=P.avail_in,M=_.hold,D=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;we=(O=_.lencode[M&(1<<_.lenbits)-1])>>>16&255,Le=65535&O,!((de=O>>>24)<=D);){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(we&&!(240&we)){for(Re=de,ft=we,Xe=Le;we=(O=_.lencode[Xe+((M&(1<<Re+ft)-1)>>Re)])>>>16&255,Le=65535&O,!(Re+(de=O>>>24)<=D);){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}M>>>=Re,D-=Re,_.back+=Re}if(M>>>=de,D-=de,_.back+=de,_.length=Le,we===0){_.mode=26;break}if(32&we){_.back=-1,_.mode=12;break}if(64&we){P.msg="invalid literal/length code",_.mode=30;break}_.extra=15&we,_.mode=22;case 22:if(_.extra){for(N=_.extra;D<N;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}_.length+=M&(1<<_.extra)-1,M>>>=_.extra,D-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;we=(O=_.distcode[M&(1<<_.distbits)-1])>>>16&255,Le=65535&O,!((de=O>>>24)<=D);){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(!(240&we)){for(Re=de,ft=we,Xe=Le;we=(O=_.distcode[Xe+((M&(1<<Re+ft)-1)>>Re)])>>>16&255,Le=65535&O,!(Re+(de=O>>>24)<=D);){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}M>>>=Re,D-=Re,_.back+=Re}if(M>>>=de,D-=de,_.back+=de,64&we){P.msg="invalid distance code",_.mode=30;break}_.offset=Le,_.extra=15&we,_.mode=24;case 24:if(_.extra){for(N=_.extra;D<N;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}_.offset+=M&(1<<_.extra)-1,M>>>=_.extra,D-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){P.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(Y===0)break e;if(te=Q-Y,_.offset>te){if((te=_.offset-te)>_.whave&&_.sane){P.msg="invalid distance too far back",_.mode=30;break}oe=te>_.wnext?(te-=_.wnext,_.wsize-te):_.wnext-te,te>_.length&&(te=_.length),ce=_.window}else ce=V,oe=j-_.offset,te=_.length;for(Y<te&&(te=Y),Y-=te,_.length-=te;V[j++]=ce[oe++],--te;);_.length===0&&(_.mode=21);break;case 26:if(Y===0)break e;V[j++]=_.length,Y--,_.mode=21;break;case 27:if(_.wrap){for(;D<32;){if(F===0)break e;F--,M|=H[G++]<<D,D+=8}if(Q-=Y,P.total_out+=Q,_.total+=Q,Q&&(P.adler=_.check=_.flags?a(_.check,V,Q,j-Q):o(_.check,V,Q,j-Q)),Q=Y,(_.flags?M:y(M))!==_.check){P.msg="incorrect data check",_.mode=30;break}D=M=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;D<32;){if(F===0)break e;F--,M+=H[G++]<<D,D+=8}if(M!==(4294967295&_.total)){P.msg="incorrect length check",_.mode=30;break}D=M=0}_.mode=29;case 29:z=1;break e;case 30:z=-3;break e;case 31:return-4;case 32:default:return f}return P.next_out=j,P.avail_out=Y,P.next_in=G,P.avail_in=F,_.hold=M,_.bits=D,(_.wsize||Q!==P.avail_out&&_.mode<30&&(_.mode<27||U!==4))&&$(P,P.output,P.next_out,Q-P.avail_out)?(_.mode=31,-4):(ee-=P.avail_in,Q-=P.avail_out,P.total_in+=ee,P.total_out+=Q,_.total+=Q,_.wrap&&Q&&(P.adler=_.check=_.flags?a(_.check,V,Q,P.next_out-Q):o(_.check,V,Q,P.next_out-Q)),P.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(ee==0&&Q===0||U===4)&&z===h&&(z=-5),z)},s.inflateEnd=function(P){if(!P||!P.state)return f;var U=P.state;return U.window&&(U.window=null),P.state=null,h},s.inflateGetHeader=function(P,U){var _;return P&&P.state&&2&(_=P.state).wrap?((_.head=U).done=!1,h):f},s.inflateSetDictionary=function(P,U){var _,H=U.length;return P&&P.state?(_=P.state).wrap!==0&&_.mode!==11?f:_.mode===11&&o(1,U,H,0)!==_.check?-3:$(P,U,H,H)?(_.mode=31,-4):(_.havedict=1,h):f},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,n,s){var i=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,d,h,f,m,p,g,y){var x,w,b,E,I,S,C,R,L,$=y.bits,P=0,U=0,_=0,H=0,V=0,G=0,j=0,F=0,Y=0,M=0,D=null,ee=0,Q=new i.Buf16(16),te=new i.Buf16(16),oe=null,ce=0;for(P=0;P<=15;P++)Q[P]=0;for(U=0;U<f;U++)Q[d[h+U]]++;for(V=$,H=15;1<=H&&Q[H]===0;H--);if(H<V&&(V=H),H===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(_=1;_<H&&Q[_]===0;_++);for(V<_&&(V=_),P=F=1;P<=15;P++)if(F<<=1,(F-=Q[P])<0)return-1;if(0<F&&(u===0||H!==1))return-1;for(te[1]=0,P=1;P<15;P++)te[P+1]=te[P]+Q[P];for(U=0;U<f;U++)d[h+U]!==0&&(g[te[d[h+U]]++]=U);if(S=u===0?(D=oe=g,19):u===1?(D=o,ee-=257,oe=a,ce-=257,256):(D=l,oe=c,-1),P=_,I=p,j=U=M=0,b=-1,E=(Y=1<<(G=V))-1,u===1&&852<Y||u===2&&592<Y)return 1;for(;;){for(C=P-j,L=g[U]<S?(R=0,g[U]):g[U]>S?(R=oe[ce+g[U]],D[ee+g[U]]):(R=96,0),x=1<<P-j,_=w=1<<G;m[I+(M>>j)+(w-=x)]=C<<24|R<<16|L|0,w!==0;);for(x=1<<P-1;M&x;)x>>=1;if(x!==0?(M&=x-1,M+=x):M=0,U++,--Q[P]==0){if(P===H)break;P=d[h+g[U]]}if(V<P&&(M&E)!==b){for(j===0&&(j=V),I+=_,F=1<<(G=P-j);G+j<H&&!((F-=Q[G+j])<=0);)G++,F<<=1;if(Y+=1<<G,u===1&&852<Y||u===2&&592<Y)return 1;m[b=M&E]=V<<24|G<<16|I-p|0}}return M!==0&&(m[I+M]=P-j<<24|64<<16|0),y.bits=V,0}},{"../utils/common":41}],51:[function(t,n,s){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,n,s){var i=t("../utils/common"),o=0,a=1;function l(O){for(var W=O.length;0<=--W;)O[W]=0}var c=0,u=29,d=256,h=d+1+u,f=30,m=19,p=2*h+1,g=15,y=16,x=7,w=256,b=16,E=17,I=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(h+2));l($);var P=new Array(2*f);l(P);var U=new Array(512);l(U);var _=new Array(256);l(_);var H=new Array(u);l(H);var V,G,j,F=new Array(f);function Y(O,W,J,re,q){this.static_tree=O,this.extra_bits=W,this.extra_base=J,this.elems=re,this.max_length=q,this.has_stree=O&&O.length}function M(O,W){this.dyn_tree=O,this.max_code=0,this.stat_desc=W}function D(O){return O<256?U[O]:U[256+(O>>>7)]}function ee(O,W){O.pending_buf[O.pending++]=255&W,O.pending_buf[O.pending++]=W>>>8&255}function Q(O,W,J){O.bi_valid>y-J?(O.bi_buf|=W<<O.bi_valid&65535,ee(O,O.bi_buf),O.bi_buf=W>>y-O.bi_valid,O.bi_valid+=J-y):(O.bi_buf|=W<<O.bi_valid&65535,O.bi_valid+=J)}function te(O,W,J){Q(O,J[2*W],J[2*W+1])}function oe(O,W){for(var J=0;J|=1&O,O>>>=1,J<<=1,0<--W;);return J>>>1}function ce(O,W,J){var re,q,se=new Array(g+1),ae=0;for(re=1;re<=g;re++)se[re]=ae=ae+J[re-1]<<1;for(q=0;q<=W;q++){var ie=O[2*q+1];ie!==0&&(O[2*q]=oe(se[ie]++,ie))}}function de(O){var W;for(W=0;W<h;W++)O.dyn_ltree[2*W]=0;for(W=0;W<f;W++)O.dyn_dtree[2*W]=0;for(W=0;W<m;W++)O.bl_tree[2*W]=0;O.dyn_ltree[2*w]=1,O.opt_len=O.static_len=0,O.last_lit=O.matches=0}function we(O){8<O.bi_valid?ee(O,O.bi_buf):0<O.bi_valid&&(O.pending_buf[O.pending++]=O.bi_buf),O.bi_buf=0,O.bi_valid=0}function Le(O,W,J,re){var q=2*W,se=2*J;return O[q]<O[se]||O[q]===O[se]&&re[W]<=re[J]}function Re(O,W,J){for(var re=O.heap[J],q=J<<1;q<=O.heap_len&&(q<O.heap_len&&Le(W,O.heap[q+1],O.heap[q],O.depth)&&q++,!Le(W,re,O.heap[q],O.depth));)O.heap[J]=O.heap[q],J=q,q<<=1;O.heap[J]=re}function ft(O,W,J){var re,q,se,ae,ie=0;if(O.last_lit!==0)for(;re=O.pending_buf[O.d_buf+2*ie]<<8|O.pending_buf[O.d_buf+2*ie+1],q=O.pending_buf[O.l_buf+ie],ie++,re===0?te(O,q,W):(te(O,(se=_[q])+d+1,W),(ae=S[se])!==0&&Q(O,q-=H[se],ae),te(O,se=D(--re),J),(ae=C[se])!==0&&Q(O,re-=F[se],ae)),ie<O.last_lit;);te(O,w,W)}function Xe(O,W){var J,re,q,se=W.dyn_tree,ae=W.stat_desc.static_tree,ie=W.stat_desc.has_stree,he=W.stat_desc.elems,De=-1;for(O.heap_len=0,O.heap_max=p,J=0;J<he;J++)se[2*J]!==0?(O.heap[++O.heap_len]=De=J,O.depth[J]=0):se[2*J+1]=0;for(;O.heap_len<2;)se[2*(q=O.heap[++O.heap_len]=De<2?++De:0)]=1,O.depth[q]=0,O.opt_len--,ie&&(O.static_len-=ae[2*q+1]);for(W.max_code=De,J=O.heap_len>>1;1<=J;J--)Re(O,se,J);for(q=he;J=O.heap[1],O.heap[1]=O.heap[O.heap_len--],Re(O,se,1),re=O.heap[1],O.heap[--O.heap_max]=J,O.heap[--O.heap_max]=re,se[2*q]=se[2*J]+se[2*re],O.depth[q]=(O.depth[J]>=O.depth[re]?O.depth[J]:O.depth[re])+1,se[2*J+1]=se[2*re+1]=q,O.heap[1]=q++,Re(O,se,1),2<=O.heap_len;);O.heap[--O.heap_max]=O.heap[1],function(Ce,_t){var mr,Lt,hs,et,qr,no,Gt=_t.dyn_tree,vc=_t.max_code,Mh=_t.stat_desc.static_tree,xc=_t.stat_desc.has_stree,wc=_t.stat_desc.extra_bits,bc=_t.stat_desc.extra_base,Gn=_t.stat_desc.max_length,gr=0;for(et=0;et<=g;et++)Ce.bl_count[et]=0;for(Gt[2*Ce.heap[Ce.heap_max]+1]=0,mr=Ce.heap_max+1;mr<p;mr++)Gn<(et=Gt[2*Gt[2*(Lt=Ce.heap[mr])+1]+1]+1)&&(et=Gn,gr++),Gt[2*Lt+1]=et,vc<Lt||(Ce.bl_count[et]++,qr=0,bc<=Lt&&(qr=wc[Lt-bc]),no=Gt[2*Lt],Ce.opt_len+=no*(et+qr),xc&&(Ce.static_len+=no*(Mh[2*Lt+1]+qr)));if(gr!==0){do{for(et=Gn-1;Ce.bl_count[et]===0;)et--;Ce.bl_count[et]--,Ce.bl_count[et+1]+=2,Ce.bl_count[Gn]--,gr-=2}while(0<gr);for(et=Gn;et!==0;et--)for(Lt=Ce.bl_count[et];Lt!==0;)vc<(hs=Ce.heap[--mr])||(Gt[2*hs+1]!==et&&(Ce.opt_len+=(et-Gt[2*hs+1])*Gt[2*hs],Gt[2*hs+1]=et),Lt--)}}(O,W),ce(se,De,O.bl_count)}function k(O,W,J){var re,q,se=-1,ae=W[1],ie=0,he=7,De=4;for(ae===0&&(he=138,De=3),W[2*(J+1)+1]=65535,re=0;re<=J;re++)q=ae,ae=W[2*(re+1)+1],++ie<he&&q===ae||(ie<De?O.bl_tree[2*q]+=ie:q!==0?(q!==se&&O.bl_tree[2*q]++,O.bl_tree[2*b]++):ie<=10?O.bl_tree[2*E]++:O.bl_tree[2*I]++,se=q,De=(ie=0)===ae?(he=138,3):q===ae?(he=6,3):(he=7,4))}function z(O,W,J){var re,q,se=-1,ae=W[1],ie=0,he=7,De=4;for(ae===0&&(he=138,De=3),re=0;re<=J;re++)if(q=ae,ae=W[2*(re+1)+1],!(++ie<he&&q===ae)){if(ie<De)for(;te(O,q,O.bl_tree),--ie!=0;);else q!==0?(q!==se&&(te(O,q,O.bl_tree),ie--),te(O,b,O.bl_tree),Q(O,ie-3,2)):ie<=10?(te(O,E,O.bl_tree),Q(O,ie-3,3)):(te(O,I,O.bl_tree),Q(O,ie-11,7));se=q,De=(ie=0)===ae?(he=138,3):q===ae?(he=6,3):(he=7,4)}}l(F);var B=!1;function N(O,W,J,re){Q(O,(c<<1)+(re?1:0),3),function(q,se,ae,ie){we(q),ee(q,ae),ee(q,~ae),i.arraySet(q.pending_buf,q.window,se,ae,q.pending),q.pending+=ae}(O,W,J)}s._tr_init=function(O){B||(function(){var W,J,re,q,se,ae=new Array(g+1);for(q=re=0;q<u-1;q++)for(H[q]=re,W=0;W<1<<S[q];W++)_[re++]=q;for(_[re-1]=q,q=se=0;q<16;q++)for(F[q]=se,W=0;W<1<<C[q];W++)U[se++]=q;for(se>>=7;q<f;q++)for(F[q]=se<<7,W=0;W<1<<C[q]-7;W++)U[256+se++]=q;for(J=0;J<=g;J++)ae[J]=0;for(W=0;W<=143;)$[2*W+1]=8,W++,ae[8]++;for(;W<=255;)$[2*W+1]=9,W++,ae[9]++;for(;W<=279;)$[2*W+1]=7,W++,ae[7]++;for(;W<=287;)$[2*W+1]=8,W++,ae[8]++;for(ce($,h+1,ae),W=0;W<f;W++)P[2*W+1]=5,P[2*W]=oe(W,5);V=new Y($,S,d+1,h,g),G=new Y(P,C,0,f,g),j=new Y(new Array(0),R,0,m,x)}(),B=!0),O.l_desc=new M(O.dyn_ltree,V),O.d_desc=new M(O.dyn_dtree,G),O.bl_desc=new M(O.bl_tree,j),O.bi_buf=0,O.bi_valid=0,de(O)},s._tr_stored_block=N,s._tr_flush_block=function(O,W,J,re){var q,se,ae=0;0<O.level?(O.strm.data_type===2&&(O.strm.data_type=function(ie){var he,De=4093624447;for(he=0;he<=31;he++,De>>>=1)if(1&De&&ie.dyn_ltree[2*he]!==0)return o;if(ie.dyn_ltree[18]!==0||ie.dyn_ltree[20]!==0||ie.dyn_ltree[26]!==0)return a;for(he=32;he<d;he++)if(ie.dyn_ltree[2*he]!==0)return a;return o}(O)),Xe(O,O.l_desc),Xe(O,O.d_desc),ae=function(ie){var he;for(k(ie,ie.dyn_ltree,ie.l_desc.max_code),k(ie,ie.dyn_dtree,ie.d_desc.max_code),Xe(ie,ie.bl_desc),he=m-1;3<=he&&ie.bl_tree[2*L[he]+1]===0;he--);return ie.opt_len+=3*(he+1)+5+5+4,he}(O),q=O.opt_len+3+7>>>3,(se=O.static_len+3+7>>>3)<=q&&(q=se)):q=se=J+5,J+4<=q&&W!==-1?N(O,W,J,re):O.strategy===4||se===q?(Q(O,2+(re?1:0),3),ft(O,$,P)):(Q(O,4+(re?1:0),3),function(ie,he,De,Ce){var _t;for(Q(ie,he-257,5),Q(ie,De-1,5),Q(ie,Ce-4,4),_t=0;_t<Ce;_t++)Q(ie,ie.bl_tree[2*L[_t]+1],3);z(ie,ie.dyn_ltree,he-1),z(ie,ie.dyn_dtree,De-1)}(O,O.l_desc.max_code+1,O.d_desc.max_code+1,ae+1),ft(O,O.dyn_ltree,O.dyn_dtree)),de(O),re&&we(O)},s._tr_tally=function(O,W,J){return O.pending_buf[O.d_buf+2*O.last_lit]=W>>>8&255,O.pending_buf[O.d_buf+2*O.last_lit+1]=255&W,O.pending_buf[O.l_buf+O.last_lit]=255&J,O.last_lit++,W===0?O.dyn_ltree[2*J]++:(O.matches++,W--,O.dyn_ltree[2*(_[J]+d+1)]++,O.dyn_dtree[2*D(W)]++),O.last_lit===O.lit_bufsize-1},s._tr_align=function(O){Q(O,2,3),te(O,w,$),function(W){W.bi_valid===16?(ee(W,W.bi_buf),W.bi_buf=0,W.bi_valid=0):8<=W.bi_valid&&(W.pending_buf[W.pending++]=255&W.bi_buf,W.bi_buf>>=8,W.bi_valid-=8)}(O)}},{"../utils/common":41}],53:[function(t,n,s){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,n,s){(function(i){(function(o,a){if(!o.setImmediate){var l,c,u,d,h=1,f={},m=!1,p=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,l={}.toString.call(o.process)==="[object process]"?function(b){process.nextTick(function(){x(b)})}:function(){if(o.postMessage&&!o.importScripts){var b=!0,E=o.onmessage;return o.onmessage=function(){b=!1},o.postMessage("","*"),o.onmessage=E,b}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",w,!1):o.attachEvent("onmessage",w),function(b){o.postMessage(d+b,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(b){x(b.data)},function(b){u.port2.postMessage(b)}):p&&"onreadystatechange"in p.createElement("script")?(c=p.documentElement,function(b){var E=p.createElement("script");E.onreadystatechange=function(){x(b),E.onreadystatechange=null,c.removeChild(E),E=null},c.appendChild(E)}):function(b){setTimeout(x,0,b)},g.setImmediate=function(b){typeof b!="function"&&(b=new Function(""+b));for(var E=new Array(arguments.length-1),I=0;I<E.length;I++)E[I]=arguments[I+1];var S={callback:b,args:E};return f[h]=S,l(h),h++},g.clearImmediate=y}function y(b){delete f[b]}function x(b){if(m)setTimeout(x,0,b);else{var E=f[b];if(E){m=!0;try{(function(I){var S=I.callback,C=I.args;switch(C.length){case 0:S();break;case 1:S(C[0]);break;case 2:S(C[0],C[1]);break;case 3:S(C[0],C[1],C[2]);break;default:S.apply(a,C)}})(E)}finally{y(b),m=!1}}}}function w(b){b.source===o&&typeof b.data=="string"&&b.data.indexOf(d)===0&&x(+b.data.slice(d.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Ec<"u"?Ec:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(BA);var _B=BA.exports;const AB=cg(_B);async function kB(r,e,t){try{if(!t||t.length===0){const h=document.createElement("a");h.href=r,h.download=`${e}.mp4`,h.click();return}const n=new AB,s=h=>{let f=`WEBVTT

`;const m=h.replace(/\\n/g,`
`);return f+=m.replace(/(\d{2}:\d{2}:\d{2}),(\d{3})/g,"$1.$2"),f},i=t.map(async h=>{if(h.url)try{const f=`https://rxsgzadulpspurijnijl.supabase.co/functions/v1/video-proxy?url=${encodeURIComponent(h.url)}`,m=await fetch(f);if(m.ok){const p=await m.text();let g=p;h.url.toLowerCase().includes(".srt")&&(n.file(`${e}-${h.label}.srt`,p),g=s(p));const x=`${e}-${h.label}.vtt`;return n.file(x,g),!0}}catch(f){console.error(`Failed to fetch subtitle: ${h.label}`,f)}return!1}),o=await Promise.all(i),a=t.filter((h,f)=>o[f]),l=`
${e}

Video Download Link:
${r}

Subtitles included:
${a.map(h=>`- ${h.label} (${e}-${h.label}.vtt and .srt)`).join(`
`)}

HOW TO USE SUBTITLES:

For Offline Viewing:
1. Download the video from the link above
2. Save the video file (rename it to: ${e}.mp4)
3. Place ALL subtitle files (.vtt and .srt) in the SAME folder as the video
4. The subtitle file names MUST match the video name for auto-detection
5. For example:
   - Video: ${e}.mp4
   - Subtitle: ${e}-English.srt (rename to ${e}.srt for auto-load)

Most media players (VLC, MPC-HC, Windows Media Player, etc.) will automatically detect 
and load subtitles if they're in the same folder with matching names.

Manual Loading:
- Open your video player
- Go to Subtitle menu > Add Subtitle File
- Select the .srt or .vtt file you want

Recommended Players with Great Subtitle Support:
- VLC Media Player (Windows/Mac/Linux) - FREE
- MPC-HC (Windows) - FREE
- KMPlayer (Windows/Mac) - FREE
- PotPlayer (Windows) - FREE

Note: Subtitles are provided as separate files because burning them into the video 
would require re-encoding (which takes hours and reduces quality). Separate subtitle 
files give you more control and work perfectly with all modern video players.

Enjoy your movie!
`;n.file("README.txt",l);const c=await n.generateAsync({type:"blob"}),u=document.createElement("a");u.href=URL.createObjectURL(c),u.download=`${e}-subtitles.zip`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(u.href);const d=document.createElement("a");d.href=r,d.download=`${e}.mp4`,d.click()}catch(n){console.error("Error downloading video with subtitles:",n);const s=document.createElement("a");s.href=r,s.download=`${e}.mp4`,s.click()}}const zm=({className:r,size:e="md",withBackground:t=!1,fast:n=!0,showProgress:s=!1,mode:i="fraction"})=>{const[o,a]=T.useState(0),[l,c]=T.useState(()=>Math.floor(Math.random()*9e3)+1e3),[u,d]=T.useState(()=>Math.floor(Math.random()*5e4)+1e4);T.useEffect(()=>{if(!s||i!=="percent")return;const m=setInterval(()=>{a(p=>{if(p>=99)return 99;const g=Math.floor(Math.random()*8)+1;return Math.min(p+g,99)})},150);return()=>clearInterval(m)},[s,i]),T.useEffect(()=>{if(!s||i!=="infinite")return;const m=setInterval(()=>{c(p=>{const g=Math.floor(Math.random()*900)+10;let y=p+g;return y>999999&&(y=Math.floor(Math.random()*9e3)+1e3),y})},300);return()=>clearInterval(m)},[s,i]),T.useEffect(()=>{if(!s||i!=="fraction")return;const m=setInterval(()=>{d(p=>{const g=Math.floor(Math.random()*2e3)+800;let y=p+g;return y>=1e5&&(y=Math.floor(Math.random()*3e4)+5e3),y})},100);return()=>clearInterval(m)},[s,i]);const h={sm:"w-6 h-6 border-2",md:"w-12 h-12 border-4",lg:"w-16 h-16 border-4",xl:"w-24 h-24 border-[6px]"},f={sm:"text-[8px]",md:"text-[9px]",lg:"text-[10px]",xl:"text-[11px] font-semibold"};return v.jsx("div",{className:Te("flex items-center justify-center",t&&"bg-black/80 rounded-lg p-8",r),children:v.jsxs("div",{className:"relative",children:[v.jsx("div",{className:Te("rounded-full border-primary/20",h[e])}),v.jsx("div",{className:Te("absolute top-0 left-0 rounded-full border-primary border-t-transparent",n?"animate-[spin_0.3s_linear_infinite]":"animate-spin",h[e])}),s&&v.jsx("div",{className:"absolute inset-0 flex items-center justify-center px-1",children:v.jsx("span",{className:Te("text-white font-semibold leading-tight whitespace-nowrap",f[e]),children:i==="percent"?`${o}%`:i==="infinite"?l.toLocaleString():`${u.toLocaleString()}/100000`})})]})})};function IB(){const{id:r}=$_(),e=Vr(),[t,n]=T.useState(null),[s,i]=T.useState(null),[o,a]=T.useState(!1),[l,c]=T.useState(!0),[u,d]=T.useState(!0),h=T.useRef(null);T.useRef(null);const[f,m]=T.useState(!1),[p,g]=T.useState("stream"),[y,x]=T.useState(!1),[w,b]=T.useState(null),[E,I]=T.useState(!1),{data:S,isLoading:C,error:R}=Rr({queryKey:["movie",r],queryFn:()=>Ot.getMovieDetails(r),enabled:!!r,staleTime:5*60*1e3}),{data:L,isLoading:$}=Rr({queryKey:["sources",r],queryFn:()=>Ot.getMovieSources(r),enabled:!!r&&!!S,staleTime:5*60*1e3}),{data:P}=Rr({queryKey:["related",r,S==null?void 0:S.genre],queryFn:()=>Ot.getRelatedMovies(r,S==null?void 0:S.genre),enabled:!!r&&!!S,staleTime:5*60*1e3});T.useEffect(()=>{S&&h.current&&setTimeout(()=>{var D;(D=h.current)==null||D.scrollIntoView({behavior:"smooth",block:"center"})},500)},[S]);const U=T.useCallback(async(D,ee,Q,te)=>{if(!D){Xt.error("Stream URL not available");return}te&&(n(te),i("stream"));try{const ce={id:S==null?void 0:S.id,title:S==null?void 0:S.title,poster:S==null?void 0:S.poster,watchedAt:new Date().toISOString(),seasons:S!=null&&S.seasons?encodeURIComponent(JSON.stringify(S.seasons)):void 0,isSeries:(S==null?void 0:S.isSeries)||!1};await ot.addToWatchHistory(ce)}catch(ce){console.error("Failed to save to watch history:",ce)}const oe=Q&&Q.length>0&&Q[0].subtitles?Q[0].subtitles:S==null?void 0:S.subtitles;setTimeout(()=>{const ce=new URLSearchParams;ce.set("url",D),ce.set("title",ee),ce.set("movieId",r||""),ce.set("movieTitle",(S==null?void 0:S.title)||""),ce.set("poster",(S==null?void 0:S.poster)||""),S!=null&&S.seasons&&ce.set("seasons",encodeURIComponent(JSON.stringify(S.seasons))),Q&&ce.set("sources",encodeURIComponent(JSON.stringify(Q))),oe&&ce.set("subtitles",encodeURIComponent(JSON.stringify(oe))),e(`/player?${ce.toString()}`),n(null),i(null)},800)},[S,r,e]),_=T.useCallback((D,ee,Q,te)=>{if(!D){Xt.error("Download URL not available");return}const oe=te||(S==null?void 0:S.subtitles)||void 0;b({url:D,title:ee,subtitles:oe}),x(!0),Q&&(n(Q),i("download"))},[S==null?void 0:S.subtitles]),H=T.useCallback(()=>{w&&(kB(w.url,w.title,w.subtitles).finally(()=>{n(null),i(null)}),Xt.success(`Downloading ${w.title} with subtitles`),b(null))},[w]),V=T.useCallback(()=>{if(!w)return;const D=document.createElement("a");D.href=w.url,D.download=`${w.title}.mp4`,D.click(),Xt.success(`Downloading ${w.title}`),n(null),i(null),b(null)},[w]),G=T.useCallback(async(D,ee,Q,te)=>{try{n(`ep-${ee}-${Q}`),i("stream");const oe=await Ot.getEpisodeSources(D,ee,Q);if(oe.length===0){Xt.error("No sources available for this episode"),n(null),i(null);return}const ce=te&&oe.find(de=>de.quality===te)||oe[0];setTimeout(()=>{const de=new URLSearchParams;de.set("url",ce.stream_url||ce.download_url),de.set("title",`${S==null?void 0:S.title} S${ee}E${Q} - ${ce.quality}`),de.set("movieId",D),de.set("movieTitle",(S==null?void 0:S.title)||""),de.set("poster",(S==null?void 0:S.poster)||""),de.set("season",ee.toString()),de.set("episode",Q.toString()),S!=null&&S.seasons&&(de.set("seasons",encodeURIComponent(JSON.stringify(S.seasons))),de.set("sources",encodeURIComponent(JSON.stringify(oe))));const we=ce.subtitles||(S==null?void 0:S.subtitles);we&&de.set("subtitles",encodeURIComponent(JSON.stringify(we))),e(`/player?${de.toString()}`),n(null),i(null)},800)}catch(oe){console.error("Error fetching episode sources:",oe),Xt.error("Failed to load episode sources"),n(null),i(null)}},[S==null?void 0:S.title,S==null?void 0:S.seasons,S==null?void 0:S.subtitles,e]),j=T.useCallback(async(D,ee,Q,te)=>{try{n(`ep-${ee}-${Q}`),i("download");const oe=await Ot.getEpisodeSources(D,ee,Q);if(oe.length===0){Xt.error("No sources available for this episode"),n(null),i(null);return}const ce=te&&oe.find(we=>we.quality===te)||oe[0],de=ce.subtitles||(S==null?void 0:S.subtitles)||void 0;b({url:ce.download_url,title:`${S==null?void 0:S.title} S${ee}E${Q} - ${ce.quality}`,subtitles:de}),x(!0)}catch(oe){console.error("Error fetching episode sources:",oe),Xt.error("Failed to load episode sources"),n(null),i(null)}},[S==null?void 0:S.title,S==null?void 0:S.subtitles]),F=async()=>{const D=window.location.href;try{await navigator.clipboard.writeText(D),Xt.success("Link copied to clipboard!")}catch{const Q=document.createElement("textarea");Q.value=D,document.body.appendChild(Q),Q.select();try{document.execCommand("copy"),Xt.success("Link copied to clipboard!")}catch{Xt.error("Could not copy link")}document.body.removeChild(Q)}};if(R)return v.jsx(bB,{});if(C)return v.jsx("div",{className:"container mx-auto px-4 py-8",children:v.jsxs("div",{className:"grid md:grid-cols-[300px,1fr] gap-8",children:[v.jsx(In,{className:"aspect-[2/3] rounded-lg"}),v.jsxs("div",{className:"space-y-4",children:[v.jsx(In,{className:"h-12 w-3/4"}),v.jsx(In,{className:"h-6 w-1/2"}),v.jsx(In,{className:"h-32 w-full"}),v.jsx(In,{className:"h-10 w-48"})]})]})});if(!S)return v.jsx("div",{className:"container mx-auto px-4 py-16 text-center",children:v.jsx("p",{className:"text-muted-foreground",children:"Movie not found"})});const Y=S.poster||"/placeholder.svg",M=()=>{e("/")};return v.jsxs(v.Fragment,{children:[v.jsxs("div",{className:"container mx-auto px-4 py-8 pt-24 max-w-7xl overflow-x-hidden",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4 gap-2",children:[v.jsxs(pe,{variant:"ghost",onClick:M,className:"gap-2 flex-shrink-0",children:[v.jsx(Nl,{className:"h-4 w-4"}),v.jsx("span",{className:"hidden sm:inline",children:"Back"}),v.jsx("span",{className:"sm:hidden",children:"Back"})]}),v.jsxs(pe,{variant:"outline",onClick:F,className:"gap-2 flex-shrink-0",children:[v.jsx(tP,{className:"h-4 w-4"}),v.jsx("span",{className:"hidden sm:inline",children:"Share"})]})]}),v.jsxs("div",{className:"grid md:grid-cols-[250px,1fr] gap-6 overflow-x-hidden",children:[v.jsx("div",{className:"space-y-4 flex-shrink-0",children:v.jsx("img",{src:Y,alt:S.title,className:"w-full max-w-[250px] mx-auto rounded-lg shadow-lg",onError:D=>{const ee=D.target;ee.src="/placeholder.svg"}})}),v.jsxs("div",{className:"space-y-6 min-w-0 overflow-x-hidden",children:[v.jsxs("div",{className:"overflow-x-hidden",children:[v.jsx("h1",{className:"text-2xl sm:text-4xl font-bold mb-2 text-shadow-red break-words",children:S.title}),v.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[S.year&&v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(RT,{className:"h-4 w-4"}),v.jsx("span",{children:S.year})]}),S.duration&&v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(LT,{className:"h-4 w-4"}),v.jsx("span",{children:S.duration})]}),S.rating&&v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(ph,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),v.jsx("span",{children:S.rating})]})]}),S.genre&&S.genre.length>0&&v.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:S.genre.map(D=>v.jsx("span",{className:"px-3 py-1 bg-secondary rounded-full text-xs",children:D},D))})]}),(S.trailer||S.trailer_url)&&(()=>{var ee;let D=S.trailer_url;return typeof S.trailer=="string"?D=S.trailer:S.trailer&&typeof S.trailer=="object"&&((ee=S.trailer.videoAddress)!=null&&ee.url)&&(D=S.trailer.videoAddress.url),D?v.jsxs("div",{children:[v.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Trailer"}),v.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-black animate-fade-in",children:[u&&v.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-10",children:v.jsx(zm,{size:"xl",fast:!0,showProgress:!0,mode:"fraction"})}),v.jsx("video",{ref:h,"data-trailer":!0,src:D,className:"w-full h-full",playsInline:!0,controls:!0,preload:"auto",onPlay:()=>a(!0),onPause:()=>a(!1),onEnded:()=>a(!1),onLoadStart:()=>d(!0),onCanPlay:()=>d(!1),onLoadedData:()=>d(!1),children:"Your browser does not support the video tag."})]}),v.jsx("div",{className:"flex justify-center mt-4",children:v.jsxs(pe,{size:"lg",onClick:()=>{if(h.current)if(o)h.current.pause();else{const Q=h.current.play();Q!==void 0&&Q.catch(te=>{console.log("Play prevented:",te)})}},className:"gap-2 cinema-gradient hover:scale-105 active:scale-95 transition-all duration-200",children:[v.jsx(ri,{className:"h-5 w-5 transition-transform group-hover:scale-110"}),o?"Pause Trailer":"Play Trailer"]})})]}):null})(),(S.overview||S.description)&&v.jsxs("div",{children:[v.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Overview"}),v.jsx("p",{className:"text-muted-foreground leading-relaxed",children:E||(S.overview||S.description||"").length<=250?S.overview||S.description||"":`${(S.overview||S.description||"").slice(0,250)}...`}),(S.overview||S.description||"").length>250&&v.jsx(pe,{variant:"ghost",size:"sm",onClick:()=>I(!E),className:"mt-2 text-primary hover:text-primary/80",children:E?"See Less":"See More"})]}),(S.cast||S.director)&&v.jsxs("div",{className:"space-y-4",children:[S.director&&v.jsxs("div",{children:[v.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[v.jsx(Fu,{className:"h-5 w-5"}),"Director"]}),v.jsx("p",{className:"text-muted-foreground",children:S.director})]}),S.cast&&S.cast.length>0&&v.jsxs("div",{children:[v.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[v.jsx(Fu,{className:"h-5 w-5"}),"Cast"]}),v.jsxs(jn,{className:"w-full whitespace-nowrap",children:[v.jsx("div",{className:"flex gap-4 pb-4",children:S.cast.map((D,ee)=>v.jsxs("div",{className:"flex-shrink-0 w-32 space-y-2 group cursor-pointer",children:[v.jsx("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden bg-secondary/50",children:D.image?v.jsx("img",{src:D.image,alt:D.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110",onError:Q=>{const te=Q.target;te.style.display="none",te.parentElement.innerHTML=`
                                      <div class="w-full h-full flex items-center justify-center bg-secondary">
                                        <Users class="h-12 w-12 text-muted-foreground opacity-50" />
                                      </div>
                                    `}}):v.jsx("div",{className:"w-full h-full flex items-center justify-center bg-secondary",children:v.jsx(Fu,{className:"h-12 w-12 text-muted-foreground opacity-50"})})}),v.jsxs("div",{className:"space-y-1",children:[v.jsx("p",{className:"text-sm font-medium line-clamp-2 leading-tight",children:D.name}),D.character&&v.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:D.character})]})]},ee))}),v.jsx(zl,{orientation:"horizontal"})]})]})]}),S.isSeries&&S.seasons&&S.seasons.length>0?v.jsx($A,{seasons:S.seasons,onWatch:(D,ee)=>U(D,ee),onDownload:(D,ee)=>_(D,ee),movieTitle:S.title,movieId:S.id,onEpisodeWatch:G,onEpisodeDownload:j,loadingSourceId:t,loadingAction:s}):v.jsxs("div",{children:[v.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Watch & Download"}),$?v.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((D,ee)=>v.jsx(In,{className:"h-16 w-full"},ee))}):L&&L.length>0?v.jsx("div",{className:"space-y-3",children:v.jsxs("div",{className:"flex gap-3",children:[v.jsxs(pe,{onClick:()=>{g("stream"),m(!0)},className:"gap-2 flex-1 h-16 text-lg transition-all duration-300 hover:shadow-lg hover:shadow-primary/50 group",children:[v.jsx(ri,{className:"h-6 w-6 transition-transform group-hover:scale-110"}),"Stream"]}),v.jsxs(pe,{onClick:()=>{g("download"),m(!0)},variant:"secondary",className:"gap-2 flex-1 h-16 text-lg transition-all duration-300 hover:shadow-lg hover:shadow-secondary/50 group",children:[v.jsx(ti,{className:"h-6 w-6 transition-transform group-hover:scale-110"}),"Download"]})]})}):v.jsx("div",{className:"p-4 border border-muted rounded-lg",children:v.jsx("p",{className:"text-muted-foreground text-sm",children:"Download sources are being prepared. Please check back later or try the search feature to find alternative versions."})})]})]})]}),P&&P.length>0&&v.jsx("div",{className:"mt-12",children:v.jsxs("div",{className:"relative group",children:[v.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-shadow-red mb-4",children:"Related Movies & Series"}),v.jsx("div",{className:"md:hidden flex gap-3 overflow-x-auto scrollbar-hide scroll-smooth pb-4",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:P.map(D=>v.jsx("div",{className:"flex-shrink-0 w-[110px] sm:w-[130px]",children:v.jsx(Wl,{movie:D})},D.id))}),v.jsxs(jn,{className:"hidden md:block w-full",children:[v.jsx("div",{className:"flex gap-3 pb-4",children:P.map(D=>v.jsx("div",{className:"flex-shrink-0 w-[145px]",children:v.jsx(Wl,{movie:D})},D.id))}),v.jsx(zl,{orientation:"horizontal"})]})]})})]}),L&&L.length>0&&v.jsx(sy,{sources:L,isOpen:f,onClose:()=>m(!1),onSelect:D=>{p==="stream"?U(D.stream_url||D.download_url,D.quality,L):_(D.download_url,D.quality,D.id,D.subtitles)},mode:p,title:S==null?void 0:S.title}),v.jsx(TB,{isOpen:y,onClose:()=>{x(!1),b(null),n(null),i(null)},onDownloadWithSubtitles:H,onDownloadVideoOnly:V,title:w==null?void 0:w.title,hasSubtitles:!!(w!=null&&w.subtitles)&&w.subtitles.length>0})]})}const fe=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},RB=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=CB},CB=Number.MAX_SAFE_INTEGER||9007199254740991;let xe=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),Z=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r}({}),A=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r}({});var Ne={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},me={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class mo{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class LB{constructor(e,t,n,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new mo(e),this.fast_=new mo(t),this.defaultTTFB_=s,this.ttfb_=new mo(e)}update(e,t){const{slow_:n,fast_:s,ttfb_:i}=this;n.halfLife!==e&&(this.slow_=new mo(e,n.getEstimate(),n.getTotalWeight())),s.halfLife!==t&&(this.fast_=new mo(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new mo(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,s=e/1e3,i=n/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function PB(r,e,t){return(e=OB(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ke(){return Ke=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Ke.apply(null,arguments)}function hw(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function Ge(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?hw(Object(t),!0).forEach(function(n){PB(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):hw(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function DB(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function OB(r){var e=DB(r,"string");return typeof e=="symbol"?e:e+""}class Kr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=As,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const As=function(){},NB={trace:As,debug:As,log:As,warn:As,info:As,error:As};function Gm(){return Ke({},NB)}function MB(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):As}function fw(r,e,t){return e[r]?e[r].bind(e):MB(r,t)}const Hm=Gm();function FB(r,e,t){const n=Gm();if(typeof console=="object"&&r===!0||typeof r=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{n[i]=fw(i,r,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.13`)}catch{return Gm()}s.forEach(i=>{Hm[i]=fw(i,r)})}else Ke(Hm,n);return n}const He=Hm;function ii(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function jB(r){return typeof self<"u"&&r===self.ManagedMediaSource}function UA(r,e){const t=Object.keys(r),n=Object.keys(e),s=t.length,i=n.length;return!s||!i||s===i&&!t.some(o=>n.indexOf(o)===-1)}function Cr(r,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(r);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=r.length;let n,s,i,o="",a=0;for(;a<t;){if(n=r[a++],n===0&&e)return o;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(n);break;case 12:case 13:s=r[a++],o+=String.fromCharCode((n&31)<<6|s&63);break;case 14:s=r[a++],i=r[a++],o+=String.fromCharCode((n&15)<<12|(s&63)<<6|(i&63)<<0);break}}return o}function Zt(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function zA(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function $B(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ff={exports:{}},pw;function BB(){return pw||(pw=1,function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var h=a.parseURL(c);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=a.normalizePath(h.path),a.buildURLFromParts(h)):c;var f=a.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var m=s.exec(f.path);f.netLoc=m[1],f.path=m[2]}f.netLoc&&!f.path&&(f.path="/");var p={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(p.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)p.path=f.path,h.params||(p.params=f.params,h.query||(p.query=f.query));else{var g=f.path,y=g.substring(0,g.lastIndexOf("/")+1)+h.path;p.path=a.normalizePath(y)}return p.path===null&&(p.path=u.alwaysNormalize?a.normalizePath(h.path):h.path),a.buildURLFromParts(p)},parseURL:function(l){var c=n.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};r.exports=a})()}(Ff)),Ff.exports}var iy=BB();class oy{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ye={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class GA{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,zB(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let s;n.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(n[1]),this._byteRange=[s,parseInt(n[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ye.AUDIO]:null,[Ye.VIDEO]:null,[Ye.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new oy),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=iy.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ye.AUDIO]=null,e[Ye.VIDEO]=null,e[Ye.AUDIOVIDEO]=null}}function St(r){return r.sn!=="initSegment"}class jf extends GA{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(fe(e)&&fe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const s=this._decryptdata=t[n[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=fe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),s=n.length;if(s>1||s===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!fe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return St(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const s=t[e];s&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,s,i,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:n,startDTS:s,endDTS:i,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}}class UB extends GA{constructor(e,t,n,s,i){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function HA(r,e){const t=Object.getPrototypeOf(r);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||HA(t,e)}}function zB(r,e){const t=HA(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const mw=Math.pow(2,32)-1,GB=[].push,VA={video:1,audio:2,id3:3,text:4};function kt(r){return String.fromCharCode.apply(null,r)}function WA(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function Ee(r,e){const t=KA(r,e);return t<0?4294967296+t:t}function gw(r,e){let t=Ee(r,e);return t*=Math.pow(2,32),t+=Ee(r,e+4),t}function KA(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function HB(r){const e=r.byteLength;for(let t=0;t<e;){const n=Ee(r,t);if(n>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=n>1?t+n:e}return!1}function Pe(r,e){const t=[];if(!e.length)return t;const n=r.byteLength;for(let s=0;s<n;){const i=Ee(r,s),o=kt(r.subarray(s+4,s+8)),a=i>1?s+i:n;if(o===e[0])if(e.length===1)t.push(r.subarray(s+8,a));else{const l=Pe(r.subarray(s+8,a),e.slice(1));l.length&&GB.apply(t,l)}s=a}return t}function VB(r){const e=[],t=r[0];let n=8;const s=Ee(r,n);n+=4;let i=0,o=0;t===0?(i=Ee(r,n),o=Ee(r,n+4),n+=8):(i=gw(r,n),o=gw(r,n+8),n+=16),n+=2;let a=r.length+o;const l=WA(r,n);n+=2;for(let c=0;c<l;c++){let u=n;const d=Ee(r,u);u+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return He.warn("SIDX has hierarchical references (not supported)"),null;const m=Ee(r,u);u+=4,e.push({referenceSize:h,subsegmentDuration:m,info:{duration:m/s,start:a,end:a+h-1}}),a+=h,u+=4,n=u}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function qA(r){const e=[],t=Pe(r,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],o=Pe(i,["tkhd"])[0];if(o){let a=o[0];const l=Ee(o,a===0?12:20),c=Pe(i,["mdia","mdhd"])[0];if(c){a=c[0];const u=Ee(c,a===0?12:20),d=Pe(i,["mdia","hdlr"])[0];if(d){const h=kt(d.subarray(8,12)),f={soun:Ye.AUDIO,vide:Ye.VIDEO}[h],m=Pe(i,["mdia","minf","stbl","stsd"])[0],p=WB(m);f?(e[l]={timescale:u,type:f,stsd:p},e[f]=Ge({timescale:u,id:l},p)):e[l]={timescale:u,type:h,stsd:p}}}}}return Pe(r,["moov","mvex","trex"]).forEach(s=>{const i=Ee(s,4),o=e[i];o&&(o.default={duration:Ee(s,12),flags:Ee(s,20)})}),e}function WB(r){const e=r.subarray(8),t=e.subarray(86),n=kt(e.subarray(4,8));let s=n,i;const o=n==="enca"||n==="encv";if(o){const c=Pe(e,[n])[0].subarray(n==="enca"?28:78);Pe(c,["sinf"]).forEach(d=>{const h=Pe(d,["schm"])[0];if(h){const f=kt(h.subarray(4,8));if(f==="cbcs"||f==="cenc"){const m=Pe(d,["frma"])[0];m&&(s=kt(m))}}})}const a=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=Pe(t,["avcC"])[0];l&&l.length>3&&(s+="."+lu(l[1])+lu(l[2])+lu(l[3]),i=au(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=Pe(e,[n])[0],c=Pe(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=$f(c,u),u+=2;const d=c[u++];if(d&128&&(u+=2),d&64&&(u+=c[u++]),c[u++]!==4)break;u=$f(c,u);const h=c[u++];if(h===64)s+="."+lu(h);else break;if(u+=12,c[u++]!==5)break;u=$f(c,u);const f=c[u++];let m=(f&248)>>3;m===31&&(m+=1+((f&7)<<3)+((c[u]&224)>>5)),s+="."+m}break}case"hvc1":case"hev1":{const l=Pe(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],d=c&31,h=Ee(l,2),f=(c&32)>>5?"H":"L",m=l[12],p=l.subarray(6,12);s+="."+u+d,s+="."+KB(h).toString(16).toUpperCase(),s+="."+f+m;let g="";for(let y=p.length;y--;){const x=p[y];(x||g)&&(g="."+x.toString(16).toUpperCase()+g)}s+=g}i=au(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=au(s,t)||s;break}case"vp09":{const l=Pe(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],d=l[6]>>4&15;s+="."+Tn(c)+"."+Tn(u)+"."+Tn(d)}break}case"av01":{const l=Pe(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,f=(l[2]&32)>>5,m=c===2&&h?f?12:10:h?10:8,p=(l[2]&16)>>4,g=(l[2]&8)>>3,y=(l[2]&4)>>2,x=l[2]&3;s+="."+c+"."+Tn(u)+d+"."+Tn(m)+"."+p+"."+g+y+x+"."+Tn(1)+"."+Tn(1)+"."+Tn(1)+"."+0,i=au("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:i}}function au(r,e){const t=Pe(e,["dvvC"]),n=t.length?t[0]:Pe(e,["dvcC"])[0];if(n){const s=n[2]>>1&127,i=n[2]<<5&32|n[3]>>3&31;return r+"."+Tn(s)+"."+Tn(i)}}function KB(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function $f(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function lu(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Tn(r){return(r<10?"0":"")+r}function qB(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&YA(r,(n,s)=>{const i=n.subarray(8,24);i.some(o=>o!==0)||(He.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${Zt(i)} -> ${Zt(t)}`),n.set(t,8))})}function YB(r){const e=[];return YA(r,t=>e.push(t.subarray(8,24))),e}function YA(r,e){Pe(r,["moov","trak"]).forEach(n=>{const s=Pe(n,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let o=Pe(i,["enca"]);const a=o.length>0;a||(o=Pe(i,["encv"])),o.forEach(l=>{const c=a?l.subarray(28):l.subarray(78);Pe(c,["sinf"]).forEach(d=>{const h=QA(d);h&&e(h,a)})})})}function QA(r){const e=Pe(r,["schm"])[0];if(e){const t=kt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=Pe(r,["schi","tenc"])[0];if(n)return n}}}function QB(r,e,t){const n={},s=Pe(r,["moof","traf"]);for(let i=0;i<s.length;i++){const o=s[i],a=Pe(o,["tfhd"])[0],l=Ee(a,4),c=e[l];if(!c)continue;n[l]||(n[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=n[l],d=Pe(o,["tfdt"])[0];if(d){const w=d[0];let b=Ee(d,4);w===1&&(b===mw?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(b*=mw+1,b+=Ee(d,8))),fe(b)&&(!fe(u.start)||b<u.start)&&(u.start=b)}const h=c.default,f=Ee(a,0)|(h==null?void 0:h.flags);let m=(h==null?void 0:h.duration)||0;f&8&&(f&2?m=Ee(a,12):m=Ee(a,8));const p=Pe(o,["trun"]);let g=u.start||0,y=0,x=m;for(let w=0;w<p.length;w++){const b=p[w],E=Ee(b,4),I=u.sampleCount;u.sampleCount+=E;const S=b[3]&1,C=b[3]&4,R=b[2]&1,L=b[2]&2,$=b[2]&4,P=b[2]&8;let U=8,_=E;for(S&&(U+=4),C&&E&&(!(b[U+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=I),U+=4,R?(x=Ee(b,U),U+=4):x=m,L&&(U+=4),P&&(U+=4),g+=x,y+=x,_--);_--;)R?(x=Ee(b,U),U+=4):x=m,L&&(U+=4),$&&(b[U+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(_+1),u.keyFrameStart=g),U+=4),P&&(U+=4),g+=x,y+=x;!y&&m&&(y+=m*E)}u.duration+=y}if(!Object.keys(n).some(i=>n[i].duration)){let i=1/0,o=0;const a=Pe(r,["sidx"]);for(let l=0;l<a.length;l++){const c=VB(a[l]);if(c!=null&&c.references){i=Math.min(i,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((d,h)=>d+h.info.duration||0,0);o=Math.max(o,u+c.earliestPresentationTime/c.timescale)}}o&&fe(o)&&Object.keys(n).forEach(l=>{n[l].duration||(n[l].duration=o*n[l].timescale-n[l].start)})}return n}function XB(r){const e={valid:null,remainder:null},t=Pe(r,["moof"]);if(t.length<2)return e.remainder=r,e;const n=t[t.length-1];return e.valid=r.slice(0,n.byteOffset-8),e.remainder=r.slice(n.byteOffset-8),e}function Hr(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function yw(r,e){const t=[],n=e.samples,s=e.timescale,i=e.id;let o=!1;return Pe(n,["moof"]).map(l=>{const c=l.byteOffset-8;Pe(l,["traf"]).map(d=>{const h=Pe(d,["tfdt"]).map(f=>{const m=f[0];let p=Ee(f,4);return m===1&&(p*=Math.pow(2,32),p+=Ee(f,8)),p/s})[0];return h!==void 0&&(r=h),Pe(d,["tfhd"]).map(f=>{const m=Ee(f,4),p=Ee(f,0)&16777215,g=(p&1)!==0,y=(p&2)!==0,x=(p&8)!==0;let w=0;const b=(p&16)!==0;let E=0;const I=(p&32)!==0;let S=8;m===i&&(g&&(S+=8),y&&(S+=4),x&&(w=Ee(f,S),S+=4),b&&(E=Ee(f,S),S+=4),I&&(S+=4),e.type==="video"&&(o=Dh(e.codec)),Pe(d,["trun"]).map(C=>{const R=C[0],L=Ee(C,0)&16777215,$=(L&1)!==0;let P=0;const U=(L&4)!==0,_=(L&256)!==0;let H=0;const V=(L&512)!==0;let G=0;const j=(L&1024)!==0,F=(L&2048)!==0;let Y=0;const M=Ee(C,4);let D=8;$&&(P=Ee(C,D),D+=4),U&&(D+=4);let ee=P+c;for(let Q=0;Q<M;Q++){if(_?(H=Ee(C,D),D+=4):H=w,V?(G=Ee(C,D),D+=4):G=E,j&&(D+=4),F&&(R===0?Y=Ee(C,D):Y=KA(C,D),D+=4),e.type===Ye.VIDEO){let te=0;for(;te<G;){const oe=Ee(n,ee);if(ee+=4,JB(o,n[ee])){const ce=n.subarray(ee,ee+oe);ay(ce,o?2:1,r+Y/s,t)}ee+=oe,te+=oe+4}}r+=H/s}}))})})}),t}function Dh(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function JB(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function ay(r,e,t,n){const s=XA(r);let i=0;i+=e;let o=0,a=0,l=0;for(;i<s.length;){o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);const c=s.length-i;let u=i;if(a<c)i+=a;else if(a>c){He.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(s[u++]===181){const h=WA(s,u);if(u+=2,h===49){const f=Ee(s,u);if(u+=4,f===1195456820){const m=s[u++];if(m===3){const p=s[u++],g=31&p,y=64&p,x=y?2+g*3:0,w=new Uint8Array(x);if(y){w[0]=p;for(let b=1;b<x;b++)w[b]=s[u++]}n.push({type:m,payloadType:o,pts:t,bytes:w})}}}}}else if(o===5&&a>16){const d=[];for(let m=0;m<16;m++){const p=s[u++].toString(16);d.push(p.length==1?"0"+p:p),(m===3||m===5||m===7||m===9)&&d.push("-")}const h=a-16,f=new Uint8Array(h);for(let m=0;m<h;m++)f[m]=s[u++];n.push({payloadType:o,pts:t,uuid:d.join(""),userData:Cr(f),userDataBytes:f})}}}function XA(r){const e=r.byteLength,t=[];let n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;const s=e-t.length,i=new Uint8Array(s);let o=0;for(n=0;n<s;o++,n++)o===t[0]&&(o++,t.shift()),i[n]=r[o];return i}function ZB(r){const e=r[0];let t="",n="",s=0,i=0,o=0,a=0,l=0,c=0;if(e===0){for(;kt(r.subarray(c,c+1))!=="\0";)t+=kt(r.subarray(c,c+1)),c+=1;for(t+=kt(r.subarray(c,c+1)),c+=1;kt(r.subarray(c,c+1))!=="\0";)n+=kt(r.subarray(c,c+1)),c+=1;n+=kt(r.subarray(c,c+1)),c+=1,s=Ee(r,12),i=Ee(r,16),a=Ee(r,20),l=Ee(r,24),c=28}else if(e===1){c+=4,s=Ee(r,c),c+=4;const d=Ee(r,c);c+=4;const h=Ee(r,c);for(c+=4,o=2**32*d+h,RB(o)||(o=Number.MAX_SAFE_INTEGER,He.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=Ee(r,c),c+=4,l=Ee(r,c),c+=4;kt(r.subarray(c,c+1))!=="\0";)t+=kt(r.subarray(c,c+1)),c+=1;for(t+=kt(r.subarray(c,c+1)),c+=1;kt(r.subarray(c,c+1))!=="\0";)n+=kt(r.subarray(c,c+1)),c+=1;n+=kt(r.subarray(c,c+1)),c+=1}const u=r.subarray(c,r.byteLength);return{schemeIdUri:t,value:n,timeScale:s,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:u}}function eU(r,...e){const t=e.length;let n=8,s=t;for(;s--;)n+=e[s].byteLength;const i=new Uint8Array(n);for(i[0]=n>>24&255,i[1]=n>>16&255,i[2]=n>>8&255,i[3]=n&255,i.set(r,4),s=0,n=8;s<t;s++)i.set(e[s],n),n+=e[s].byteLength;return i}function tU(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,s;n=0,s=new Uint8Array;let i;n>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),eU([112,115,115,104],new Uint8Array([n,0,0,0]),r,i,s,o,t)}function rU(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let n=0;for(;n+32<t;){const s=new DataView(r,n),i=nU(s);e.push(i),n+=i.size}}return e}function nU(r){const e=r.getUint32(0),t=r.byteOffset,n=r.byteLength;if(n<e)return{offset:t,size:n};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const i=r.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=r.buffer,a=Zt(new Uint8Array(o,t+12,16));let l=null,c=null,u=0;if(i===0)u=28;else{const h=r.getUint32(28);if(!h||n<32+h*16)return{offset:t,size:e};l=[];for(let f=0;f<h;f++)l.push(new Uint8Array(o,t+32+f*16,16));u=32+h*16}if(!u)return{offset:t,size:e};const d=r.getUint32(u);return e-32<d?{offset:t,size:e}:(c=new Uint8Array(o,t+u+4,d),{version:i,systemId:a,kids:l,data:c,offset:t,size:e})}const JA=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ta={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ly(r,e){const t=Ta[e];return!!t&&!!t[r.slice(0,4)]}function Kl(r,e,t=!0){return!r.split(",").some(n=>!cy(n,e,t))}function cy(r,e,t=!0){var n;const s=ii(t);return(n=s==null?void 0:s.isTypeSupported(ql(r,e)))!=null?n:!1}function ql(r,e){return`${e}/mp4;codecs=${r}`}function vw(r){if(r){const e=r.substring(0,4);return Ta.video[e]}return 2}function Md(r){const e=JA();return r.split(",").reduce((t,n)=>{const i=e&&Dh(n)?9:Ta.video[n];return i?(i*2+t)/(t?3:2):(Ta.audio[n]+t)/(t?2:1)},0)}const Bf={};function sU(r,e=!0){if(Bf[r])return Bf[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let s=0;s<t.length;s++){var n;if(cy(t[s],"audio",e))return Bf[r]=t[s],t[s];if(t[s]==="mp3"&&(n=ii(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return r}const iU=/flac|opus|mp4a\.40\.34/i;function Fd(r,e=!0){return r.replace(iU,t=>sU(t.toLowerCase(),e))}function oU(r,e){const t=[];if(r){const n=r.split(",");for(let s=0;s<n.length;s++)ly(n[s],"video")||t.push(n[s])}return e&&t.push(e),t.join(",")}function Gu(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(xw(r,"audio")||xw(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let n=t.length;n--;)if(t[n].substring(0,4)===r.substring(0,4))return t[n]}return t[0]}}return e||r}function xw(r,e){return ly(r,e)&&cy(r,e)}function aU(r){const e=r.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function lU(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return r}function ww(r){const e=ii(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Vm(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const cU={supported:!0,powerEfficient:!0,smooth:!0},uU={supported:!1,smooth:!1,powerEfficient:!1},ZA={supported:!0,configurations:[],decodingInfoResults:[cU]};function ek(r,e){return{supported:!1,configurations:e,decodingInfoResults:[uU],error:r}}function dU(r,e,t,n,s,i){const o=r.videoCodec,a=r.audioCodec?r.audioGroups:null,l=i==null?void 0:i.audioCodec,c=i==null?void 0:i.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(a!=null&&a.length)try{a.length===1&&a[0]?d=e.groups[a[0]].channels:d=a.reduce((h,f)=>{if(f){const m=e.groups[f];if(!m)throw new Error(`Audio track group ${f} not found`);Object.keys(m.channels).forEach(p=>{h[p]=(h[p]||0)+m.channels[p]})}return h},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(h=>Dh(h))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(n,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(s,8e6))||!!d&&fe(u)&&Object.keys(d).some(h=>parseInt(h)>u)}function tk(r,e,t,n={}){const s=r.videoCodec;if(!s&&!r.audioCodec||!t)return Promise.resolve(ZA);const i=[],o=hU(r),a=o.length,l=fU(r,e,a>0),c=l.length;for(let u=a||1*c||1;u--;){const d={type:"media-source"};if(a&&(d.video=o[u%a]),c){d.audio=l[u%c];const h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}i.push(d)}if(s){const u=navigator.userAgent;if(s.split(",").some(d=>Dh(d))&&JA())return Promise.resolve(ek(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),i))}return Promise.all(i.map(u=>{const d=mU(u);return n[d]||(n[d]=t.decodingInfo(u))})).then(u=>({supported:!u.some(d=>!d.supported),configurations:i,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:i,decodingInfoResults:[],error:u}))}function hU(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),n=rk(r),s=r.width||640,i=r.height||480,o=r.frameRate||30,a=r.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:ql(lU(l),"video"),width:s,height:i,bitrate:n,framerate:o};return a!=="sdr"&&(c.transferFunction=a),c}):[]}function fU(r,e,t){var n;const s=(n=r.audioCodec)==null?void 0:n.split(","),i=rk(r);return s&&r.audioGroups?r.audioGroups.reduce((o,a)=>{var l;const c=a?(l=e.groups[a])==null?void 0:l.tracks:null;return c?c.reduce((u,d)=>{if(d.groupId===a){const h=parseFloat(d.channels||"");s.forEach(f=>{const m={contentType:ql(f,"audio"),bitrate:t?pU(f,i):i};h&&(m.channels=""+h),u.push(m)})}return u},o):o},[]):[]}function pU(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function rk(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function mU(r){let e="";const{audio:t,video:n}=r;if(n){const s=Vm(n.contentType);e+=`${s}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const s=Vm(t.contentType);e+=`${n?"_":""}${s}_c${t.channels}`}return e}const Wm=["NONE","TYPE-0","TYPE-1",null];function gU(r){return Wm.indexOf(r)>-1}const jd=["SDR","PQ","HLG"];function yU(r){return!!r&&jd.indexOf(r)>-1}var Hu={No:"",Yes:"YES",v2:"v2"};function bw(r){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=r,s=n<e/2;return e&&s?t?Hu.v2:Hu.Yes:Hu.No}class Sw{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Yl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Ew(this._audioGroups,e)}hasSubtitleGroup(e){return Ew(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Ew(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function vU(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function xU(r,e){let t=!1,n=[];if(r&&(t=r!=="SDR",n=[r]),e){n=e.allowedVideoRanges||jd.slice(0);const s=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&vU(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const wU=r=>{const e=new WeakSet;return(t,n)=>{if(r&&(n=r(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},Qe=(r,e)=>JSON.stringify(r,wU(e));function bU(r,e,t,n,s){const i=Object.keys(r),o=n==null?void 0:n.channels,a=n==null?void 0:n.audioCodec,l=s==null?void 0:s.videoCodec,c=o&&parseInt(o)===2;let u=!1,d=!1,h=1/0,f=1/0,m=1/0,p=1/0,g=0,y=[];const{preferHDR:x,allowedVideoRanges:w}=xU(e,s);for(let C=i.length;C--;){const R=r[i[C]];u||(u=R.channels[2]>0),h=Math.min(h,R.minHeight),f=Math.min(f,R.minFramerate),m=Math.min(m,R.minBitrate),w.filter($=>R.videoRanges[$]>0).length>0&&(d=!0)}h=fe(h)?h:0,f=fe(f)?f:0;const b=Math.max(1080,h),E=Math.max(30,f);m=fe(m)?m:t,t=Math.max(m,t),d||(e=void 0);const I=i.length>1;return{codecSet:i.reduce((C,R)=>{const L=r[R];if(R===C)return C;if(y=d?w.filter($=>L.videoRanges[$]>0):[],I){if(L.minBitrate>t)return bn(R,`min bitrate of ${L.minBitrate} > current estimate of ${t}`),C;if(!L.hasDefaultAudio)return bn(R,"no renditions with default or auto-select sound found"),C;if(a&&R.indexOf(a.substring(0,4))%5!==0)return bn(R,`audio codec preference "${a}" not found`),C;if(o&&!c){if(!L.channels[o])return bn(R,`no renditions with ${o} channel sound found (channels options: ${Object.keys(L.channels)})`),C}else if((!a||c)&&u&&L.channels[2]===0)return bn(R,"no renditions with stereo sound found"),C;if(L.minHeight>b)return bn(R,`min resolution of ${L.minHeight} > maximum of ${b}`),C;if(L.minFramerate>E)return bn(R,`min framerate of ${L.minFramerate} > maximum of ${E}`),C;if(!y.some($=>L.videoRanges[$]>0))return bn(R,`no variants with VIDEO-RANGE of ${Qe(y)} found`),C;if(l&&R.indexOf(l.substring(0,4))%5!==0)return bn(R,`video codec preference "${l}" not found`),C;if(L.maxScore<g)return bn(R,`max score of ${L.maxScore} < selected max of ${g}`),C}return C&&(Md(R)>=Md(C)||L.fragmentError>r[C].fragmentError)?C:(p=L.minIndex,g=L.maxScore,R)},void 0),videoRanges:y,preferHDR:x,minFramerate:f,minBitrate:m,minIndex:p}}function bn(r,e){He.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function nk(r){return r.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const s=t.channels||"2";return n.channels[s]=(n.channels[s]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function SU(r,e,t,n){return r.slice(t,n+1).reduce((s,i,o)=>{if(!i.codecSet)return s;const a=i.audioGroups;let l=s[i.codecSet];l||(s[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const c=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,a&&a.forEach(u=>{if(!u)return;const d=e.groups[u];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),s},{})}function Tw(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:i}=r;return{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:i}}function Pn(r,e,t){if("attrs"in r){const n=e.indexOf(r);if(n!==-1)return n}for(let n=0;n<e.length;n++){const s=e[n];if(Bi(r,s,t))return n}return-1}function Bi(r,e,t){const{groupId:n,name:s,lang:i,assocLang:o,default:a}=r,l=r.forced;return(n===void 0||e.groupId===n)&&(s===void 0||e.name===s)&&(i===void 0||EU(i,e.lang))&&(i===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in r)||TU(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function EU(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function TU(r,e=""){const t=r.split(","),n=e.split(",");return t.length===n.length&&!t.some(s=>n.indexOf(s)===-1)}function bi(r,e){const{audioCodec:t,channels:n}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function _U(r,e,t,n,s){const i=e[n],a=e.reduce((h,f,m)=>{const p=f.uri;return(h[p]||(h[p]=[])).push(m),h},{})[i.uri];a.length>1&&(n=Math.max.apply(Math,a));const l=i.videoRange,c=i.frameRate,u=i.codecSet.substring(0,4),d=_w(e,n,h=>{if(h.videoRange!==l||h.frameRate!==c||h.codecSet.substring(0,4)!==u)return!1;const f=h.audioGroups,m=t.filter(p=>!f||f.indexOf(p.groupId)!==-1);return Pn(r,m,s)>-1});return d>-1?d:_w(e,n,h=>{const f=h.audioGroups,m=t.filter(p=>!f||f.indexOf(p.groupId)!==-1);return Pn(r,m,s)>-1})}function _w(r,e,t){for(let n=e;n>-1;n--)if(t(r[n]))return n;for(let n=e+1;n<r.length;n++)if(t(r[n]))return n;return-1}function $d(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class AU extends Kr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:s,partCurrent:i,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!s||!l)return;const c=performance.now(),u=i?i.stats:s.stats,d=i?i.duration:s.duration,h=c-u.loading.start,f=o.minAutoLevel,m=s.level,p=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||m<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const g=p>-1&&p!==m,y=!!t||g;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const x=o.mainForwardBufferInfo;if(!y&&x===null)return;const w=this.bwEstimator.getEstimateTTFB(),b=Math.abs(l.playbackRate);if(h<=Math.max(w,1e3*(d/(b*2))))return;const E=x?x.len/b:0,I=u.loading.first?u.loading.first-u.loading.start:-1,S=u.loaded&&I>-1,C=this.getBwEstimate(),R=o.levels,L=R[m],$=Math.max(u.loaded,Math.round(d*(s.bitrate||L.averageBitrate)/8));let P=S?h-I:h;P<1&&S&&(P=Math.min(h,u.loaded*8/C));const U=S?u.loaded*1e3/P:0,_=w/1e3,H=U?($-u.loaded)/U:$*8/C+_;if(H<=E)return;const V=U?U*8:C,G=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,j=this.hls.config.abrBandWidthUpFactor;let F=Number.POSITIVE_INFINITY,Y;for(Y=m-1;Y>f;Y--){const Q=R[Y].maxBitrate,te=!R[Y].details||G;if(F=this.getTimeToLoadFrag(_,V,d*Q,te),F<Math.min(E,d+_))break}if(F>=H||F>d*10)return;S?this.bwEstimator.sample(h-Math.min(w,I),u.loaded):this.bwEstimator.sampleTTFB(h);const M=R[Y].maxBitrate;this.getBwEstimate()*j>M&&this.resetEstimator(M);const D=this.findBestLevel(M,f,Y,0,E,1,1);D>-1&&(Y=D),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${E.toFixed(3)} s
      Estimated load time for current fragment: ${H.toFixed(3)} s
      Estimated load time for down switch fragment: ${F.toFixed(3)} s
      TTFB estimate: ${I|0} ms
      Current BW estimate: ${fe(C)?C|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Y} @ ${M|0} bps`),o.nextLoadLevel=o.nextAutoLevel=Y,this.clearTimer();const ee=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===Y&&Y>0){const Q=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Y>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${Q.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,Y>f){let te=this.findBestLevel(this.hls.levels[f].bitrate,f,Y,0,Q,1,1);te===-1&&(te=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=te,this.resetEstimator(this.hls.levels[te].bitrate)}}};g||H>F*2?ee():this.timer=self.setInterval(ee,F*1e3),o.trigger(A.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new LB(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(A.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var s;this.fragCurrent=n,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Z.BUFFER_ADD_CODEC_ERROR:case Z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Z.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:s,partCurrent:i}=this;if(n&&s&&n.sn===s.sn&&n.level===s.level){const o=performance.now(),a=i?i.stats:n.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,n,s){const i=e+n/t,o=s?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const n=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;fe(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const s=n?n.stats:t.stats;if(t.type===me.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=n?n.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+s.loaded,l=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:n,id:t.type};this.onFragBuffered(A.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:n.stats;if(i.aborted||this.ignoreFragment(n))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==me.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(n,t,e,0,s,1,1);if(i>-1)return i;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=n&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:o}=n,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(c){const g=this.findBestLevel(l,o,s,c,0,u,d);if(g>=0)return this.rebufferNotice=-1,g}let h=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!c){const g=this.bitrateTestDelay;g&&(h=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-g,this.info(`bitrate test took ${Math.round(1e3*g)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),u=d=1)}const f=this.findBestLevel(l,o,s,c,h,u,d);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const m=n.levels[o],p=n.loadLevelObj;return p&&(m==null?void 0:m.bitrate)<p.bitrate?o:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,s,i,o,a){var l;const c=s+i,u=this.lastLoadedFragLevel,d=u===-1?this.hls.firstLevel:u,{fragCurrent:h,partCurrent:f}=this,{levels:m,allAudioTracks:p,loadLevel:g,config:y}=this.hls;if(m.length===1)return 0;const x=m[d],w=!!((l=this.hls.latestLevelDetails)!=null&&l.live),b=g===-1||u===-1;let E,I="SDR",S=(x==null?void 0:x.frameRate)||0;const{audioPreference:C,videoPreference:R}=y,L=this.audioTracksByGroup||(this.audioTracksByGroup=nk(p));let $=-1;if(b){if(this.firstSelection!==-1)return this.firstSelection;const V=this.codecTiers||(this.codecTiers=SU(m,L,t,n)),G=bU(V,I,e,C,R),{codecSet:j,videoRanges:F,minFramerate:Y,minBitrate:M,minIndex:D,preferHDR:ee}=G;$=D,E=j,I=ee?F[F.length-1]:F[0],S=Y,e=Math.max(e,M),this.log(`picked start tier ${Qe(G)}`)}else E=x==null?void 0:x.codecSet,I=x==null?void 0:x.videoRange;const P=f?f.duration:h?h.duration:0,U=this.bwEstimator.getEstimateTTFB()/1e3,_=[];for(let V=n;V>=t;V--){var H;const G=m[V],j=V>d;if(!G)continue;if(y.useMediaCapabilities&&!G.supportedResult&&!G.supportedPromise){const te=navigator.mediaCapabilities;typeof(te==null?void 0:te.decodingInfo)=="function"&&dU(G,L,I,S,e,C)?(G.supportedPromise=tk(G,L,te,this.supportedCache),G.supportedPromise.then(oe=>{if(!this.hls)return;G.supportedResult=oe;const ce=this.hls.levels,de=ce.indexOf(G);oe.error?this.warn(`MediaCapabilities decodingInfo error: "${oe.error}" for level ${de} ${Qe(oe)}`):oe.supported?oe.decodingInfoResults.some(we=>we.smooth===!1||we.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${de} not smooth or powerEfficient: ${Qe(oe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${de} ${Qe(oe)}`),de>-1&&ce.length>1&&(this.log(`Removing unsupported level ${de}`),this.hls.removeLevel(de),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(oe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${oe}`)})):G.supportedResult=ZA}if((E&&G.codecSet!==E||I&&G.videoRange!==I||j&&S>G.frameRate||!j&&S>0&&S<G.frameRate||(H=G.supportedResult)!=null&&(H=H.decodingInfoResults)!=null&&H.some(te=>te.smooth===!1))&&(!b||V!==$)){_.push(V);continue}const F=G.details,Y=(f?F==null?void 0:F.partTarget:F==null?void 0:F.averagetargetduration)||P;let M;j?M=a*e:M=o*e;const D=P&&s>=P*2&&i===0?G.averageBitrate:G.maxBitrate,ee=this.getTimeToLoadFrag(U,M,D*Y,F===void 0);if(M>=D&&(V===u||G.loadError===0&&G.fragmentError===0)&&(ee<=U||!fe(ee)||w&&!this.bitrateTestDelay||ee<c)){const te=this.forcedAutoLevel;return V!==g&&(te===-1||te!==g)&&(_.length&&this.trace(`Skipped level(s) ${_.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${m[_[0]].codecs}" ${m[_[0]].videoRange}; not compatible with "${E}" ${I}`),this.info(`switch candidate:${d}->${V} adjustedbw(${Math.round(M)})-bitrate=${Math.round(M-D)} ttfb:${U.toFixed(1)} avgDuration:${Y.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${ee.toFixed(1)} firstSelection:${b} codecSet:${G.codecSet} videoRange:${G.videoRange} hls.loadLevel:${g}`)),b&&(this.firstSelection=V),V}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const sk={search:function(r,e){let t=0,n=r.length-1,s=null,i=null;for(;t<=n;){s=(t+n)/2|0,i=r[s];const o=e(i);if(o>0)t=s+1;else if(o<0)n=s-1;else return i}return null}};function kU(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!fe(e))return null;const n=r[0].programDateTime;if(e<(n||0))return null;const s=r[r.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<r.length;++i){const o=r[i];if(RU(e,t,o))return o}return null}function Xi(r,e,t=0,n=0,s=.005){let i=null;if(r){i=e[1+r.sn-e[0].sn]||null;const a=r.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),i&&r.level!==i.level&&i.end<=r.end&&(i=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!r||r.level===i.level)&&Aw(t,n,i)===0||IU(i,r,Math.min(s,n))))return i;const o=sk.search(e,Aw.bind(null,t,n));return o&&(o!==r||!i)?o:i}function IU(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return r.start<=n}return!1}function Aw(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function RU(r,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function ik(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let n=r.fragments;const{fragmentHint:s}=r;s&&(n=n.concat(s));let i;return sk.search(n,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function Bd(r){switch(r.details){case Z.FRAG_LOAD_TIMEOUT:case Z.KEY_LOAD_TIMEOUT:case Z.LEVEL_LOAD_TIMEOUT:case Z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ok(r){return r.details.startsWith("key")}function ak(r){return ok(r)&&!!r.frag&&!r.frag.decryptdata}function kw(r,e){const t=Bd(e);return r.default[`${t?"timeout":"error"}Retry`]}function uy(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function Iw(r){return Ge(Ge({},r),{errorRetry:null,timeoutRetry:null})}function Ud(r,e,t,n){if(!r)return!1;const s=n==null?void 0:n.code,i=e<r.maxNumRetry&&(CU(s)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,n,i):i}function CU(r){return Km(r)||!!r&&(r<400||r>499)}function Km(r){return r===0&&navigator.onLine===!1}var Ft={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},xr={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class LU extends Kr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.ERROR,this.onError,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.ERROR,this.onError,this),e.off(A.ERROR,this.onErrorOut,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===me.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case Z.FRAG_LOAD_ERROR:case Z.FRAG_LOAD_TIMEOUT:case Z.KEY_LOAD_ERROR:case Z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Z.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=Qo();return}case Z.FRAG_GAP:case Z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ft.SendAlternateToPenaltyBox;return}case Z.LEVEL_EMPTY_ERROR:case Z.LEVEL_PARSING_ERROR:{var o;const l=t.parent===me.MAIN?t.level:s.loadLevel;t.details===Z.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case Z.LEVEL_LOAD_ERROR:case Z.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case Z.AUDIO_TRACK_LOAD_ERROR:case Z.AUDIO_TRACK_LOAD_TIMEOUT:case Z.SUBTITLE_LOAD_ERROR:case Z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=s.loadLevelObj;if(l&&(i.type===Ne.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===Ne.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Ft.SendAlternateToPenaltyBox,t.errorAction.flags=xr.MoveAllAlternatesMatchingHost;return}}return;case Z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Ft.SendAlternateToPenaltyBox,flags:xr.MoveAllAlternatesMatchingHDCP};return;case Z.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Z.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Z.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Ft.SendAlternateToPenaltyBox,flags:xr.MoveAllAlternatesMatchingKey};return;case Z.BUFFER_ADD_CODEC_ERROR:case Z.REMUX_ALLOC_ERROR:case Z.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:s.loadLevel)}return;case Z.INTERNAL_EXCEPTION:case Z.BUFFER_APPENDING_ERROR:case Z.BUFFER_FULL_ERROR:case Z.LEVEL_SWITCH_ERROR:case Z.BUFFER_STALLED_ERROR:case Z.BUFFER_SEEK_OVER_HOLE:case Z.BUFFER_NUDGE_ON_STALL:t.errorAction=Qo();return}t.type===xe.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Qo())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,s=kw(n.config.playlistLoadPolicy,e),i=this.playlistError++;if(Ud(s,i,Bd(e),e.response))return{action:Ft.RetryRequest,flags:xr.None,retryConfig:s,retryCount:i};const a=this.getLevelSwitchAction(e,t);return s&&(a.retryConfig=s,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),s=t.levels[n],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=kw(ok(e)?o:i,e),l=t.levels.reduce((u,d)=>u+d.fragmentError,0);if(s&&(e.details!==Z.FRAG_GAP&&s.fragmentError++,!ak(e)&&Ud(a,l,Bd(e),e.response)))return{action:Ft.RetryRequest,flags:xr.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,n);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const s=this.hls.levels[t];if(s){var i,o;const c=e.details;s.loadError++,c===Z.BUFFER_APPEND_ERROR&&s.fragmentError++;let u=-1;const{levels:d,loadLevel:h,minAutoLevel:f,maxAutoLevel:m}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const p=(i=e.frag)==null?void 0:i.type,y=(p===me.AUDIO&&c===Z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===Z.BUFFER_ADD_CODEC_ERROR||c===Z.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:I})=>s.audioCodec!==I),w=e.sourceBufferName==="video"&&(c===Z.BUFFER_ADD_CODEC_ERROR||c===Z.BUFFER_APPEND_ERROR)&&d.some(({codecSet:I,audioCodec:S})=>s.codecSet!==I&&s.audioCodec===S),{type:b,groupId:E}=(o=e.context)!=null?o:{};for(let I=d.length;I--;){const S=(I+h)%d.length;if(S!==h&&S>=f&&S<=m&&d[S].loadError===0){var a,l;const C=d[S];if(c===Z.FRAG_GAP&&p===me.MAIN&&e.frag){const R=d[S].details;if(R){const L=Xi(e.frag,R.fragments,e.frag.start);if(L!=null&&L.gap)continue}}else{if(b===Ne.AUDIO_TRACK&&C.hasAudioGroup(E)||b===Ne.SUBTITLE_TRACK&&C.hasSubtitleGroup(E))continue;if(p===me.AUDIO&&(a=s.audioGroups)!=null&&a.some(R=>C.hasAudioGroup(R))||p===me.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(R=>C.hasSubtitleGroup(R))||y&&s.audioCodec===C.audioCodec||w&&s.codecSet===C.codecSet||!y&&s.codecSet!==C.codecSet)continue}u=S;break}}if(u>-1&&n.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:Ft.SendAlternateToPenaltyBox,flags:xr.None,nextAutoLevel:u}}return{action:Ft.SendAlternateToPenaltyBox,flags:xr.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Ft.DoNothing:break;case Ft.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:s}=n,i=n.nextAutoLevel;switch(s){case xr.None:this.switchLevel(e,i);break;case xr.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],u=c==null?void 0:c.attrs["HDCP-LEVEL"];if(n.hdcpLevel=u,u==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){t.maxHdcpLevel=Wm[Wm.indexOf(u)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case xr.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels,u=c.length;for(let h=u;h--;)if(this.variantHasKey(c[h],l)){var o,a;this.log(`Banned key found in level ${h} (${c[h].bitrate}bps) or audio group "${(o=c[h].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${Zt(l.keyId||[])}`),c[h].fragmentError++,c[h].loadError++,this.log(`Removing level ${h} with key error (${e.error})`),this.hls.removeLevel(h)}const d=e.frag;if(this.hls.levels.length<u)n.resolved=!0;else if(d&&d.type!==me.MAIN){const h=d.decryptdata;h&&!l.matches(h)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Vm(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${i} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(i))}}}function Qo(r){const e={action:Ft.DoNothing,flags:xr.None};return r&&(e.resolved=!0),e}var Rt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class PU{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let s=n.length;s--;){const i=n[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:s}=this,i=Object.keys(s);for(let o=i.length;o--;){const a=s[i[o]];if((a==null?void 0:a.body.type)===t&&(!n||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,n,s,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===n&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const d=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,s=go(n),i=this.fragments[s];if(!i||i.buffered&&n.gap)return;const o=!n.relurl;Object.keys(t).forEach(a=>{const l=n.elementaryStreams[a];if(!l)return;const c=t[a],u=o||l.partial===!0;i.range[a]=this.getBufferedTimes(n,e.part,u,c)}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,(i.body.endList=n.endList||i.body.endList)&&(this.endListFragments[i.body.type]=i),cu(i)||this.removeParts(n.sn-1,n.type)):this.removeFragment(i.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Rw(n,s=>s.fragment.sn>=e))}fragBuffered(e,t){const n=go(e);let s=this.fragments[n];!s&&t&&(s=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,n,s){const i={time:[],partial:n},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<s.length;u++){const d=s.start(u)-this.bufferPadding,h=s.end(u)+this.bufferPadding;if(c>=d&&l<=h){i.time.push({startPTS:Math.max(o,s.start(u)),endPTS:Math.min(a,s.end(u))});break}else if(o<h&&a>d){const f=Math.max(o,s.start(u)),m=Math.min(a,s.end(u));m>f&&(i.partial=!0,i.time.push({startPTS:f,endPTS:m}))}else if(a<=d)break}return i}getPartialFragment(e){let t=null,n,s,i,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&cu(u)&&(s=u.body.start-a,i=u.body.end+a,e>=s&&e<=i&&(n=Math.min(e-s,i-e),o<=n&&(t=u.body,o=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||cu(t))}getState(e){const t=go(e),n=this.fragments[t];return n?n.buffered?cu(n)?Rt.PARTIAL:Rt.OK:Rt.APPENDING:Rt.NOT_LOADED}isTimeBuffered(e,t,n){let s,i;for(let o=0;o<n.length;o++){if(s=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,s=t.part?null:t,i=go(n);this.fragments[i]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:s,timeRanges:i,type:o}=t;if(n.sn==="initSegment")return;const a=n.type;if(s){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(s)}this.timeRanges=i;const l=i[o];this.detectEvictedFragments(o,l,a,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=go(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let s=n.length;s--;){const i=t[n[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==n||s&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=go(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const s=e.sn;this.activePartLists[e.type]=Rw(n,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function cu(r){var e,t,n;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(n=r.range.audiovideo)!=null&&n.partial)}function go(r){return`${r.type}_${r.level}_${r.sn}`}function Rw(r,e){return r.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var oi={cbc:0,ctr:1};class DU{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case oi.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case oi.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function OU(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class NU{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let s=0;s<4;s++)n[s]=t.getUint32(s*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,s=n[0],i=n[1],o=n[2],a=n[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],h=l[3],f=new Uint32Array(256);let m=0,p=0,g=0;for(g=0;g<256;g++)g<128?f[g]=g<<1:f[g]=g<<1^283;for(g=0;g<256;g++){let y=p^p<<1^p<<2^p<<3^p<<4;y=y>>>8^y&255^99,e[m]=y,t[y]=m;const x=f[m],w=f[x],b=f[w];let E=f[y]*257^y*16843008;s[m]=E<<24|E>>>8,i[m]=E<<16|E>>>16,o[m]=E<<8|E>>>24,a[m]=E,E=b*16843009^w*65537^x*257^m*16843008,c[y]=E<<24|E>>>8,u[y]=E<<16|E>>>16,d[y]=E<<8|E>>>24,h[y]=E,m?(m=x^f[f[f[b^x]]],p^=f[f[p]]):m=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,s=0;for(;s<t.length&&n;)n=t[s]===this.key[s],s++;if(n)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),d=this.sBox,h=this.rcon,f=this.invSubMix,m=f[0],p=f[1],g=f[2],y=f[3];let x,w;for(a=0;a<o;a++){if(a<i){x=c[a]=t[a];continue}w=x,a%i===0?(w=w<<8|w>>>24,w=d[w>>>24]<<24|d[w>>>16&255]<<16|d[w>>>8&255]<<8|d[w&255],w^=h[a/i|0]<<24):i>6&&a%i===4&&(w=d[w>>>24]<<24|d[w>>>16&255]<<16|d[w>>>8&255]<<8|d[w&255]),c[a]=x=(c[a-i]^w)>>>0}for(l=0;l<o;l++)a=o-l,l&3?w=c[a]:w=c[a-4],l<4||a<=4?u[l]=w:u[l]=m[d[w>>>24]]^p[d[w>>>16&255]]^g[d[w>>>8&255]]^y[d[w&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const s=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],d=a[3],h=this.uint8ArrayToUint32Array_(n);let f=h[0],m=h[1],p=h[2],g=h[3];const y=new Int32Array(e),x=new Int32Array(y.length);let w,b,E,I,S,C,R,L,$,P,U,_,H,V;const G=this.networkToHostOrderSwap;for(;t<y.length;){for($=G(y[t]),P=G(y[t+1]),U=G(y[t+2]),_=G(y[t+3]),S=$^i[0],C=_^i[1],R=U^i[2],L=P^i[3],H=4,V=1;V<s;V++)w=l[S>>>24]^c[C>>16&255]^u[R>>8&255]^d[L&255]^i[H],b=l[C>>>24]^c[R>>16&255]^u[L>>8&255]^d[S&255]^i[H+1],E=l[R>>>24]^c[L>>16&255]^u[S>>8&255]^d[C&255]^i[H+2],I=l[L>>>24]^c[S>>16&255]^u[C>>8&255]^d[R&255]^i[H+3],S=w,C=b,R=E,L=I,H=H+4;w=o[S>>>24]<<24^o[C>>16&255]<<16^o[R>>8&255]<<8^o[L&255]^i[H],b=o[C>>>24]<<24^o[R>>16&255]<<16^o[L>>8&255]<<8^o[S&255]^i[H+1],E=o[R>>>24]<<24^o[L>>16&255]<<16^o[S>>8&255]<<8^o[C&255]^i[H+2],I=o[L>>>24]<<24^o[S>>16&255]<<16^o[C>>8&255]<<8^o[R&255]^i[H+3],x[t]=G(w^f),x[t+1]=G(I^m),x[t+2]=G(E^p),x[t+3]=G(b^g),f=$,m=P,p=U,g=_,t=t+4}return x.buffer}}class MU{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=FU(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function FU(r){switch(r){case oi.cbc:return"AES-CBC";case oi.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const jU=16;class dy{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?OU(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,s){return this.useSoftware?new Promise((i,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,n,s);const l=this.flush();l?i(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,s)}softwareDecrypt(e,t,n,s){const{currentIV:i,currentResult:o,remainderData:a}=this;if(s!==oi.cbc||t.byteLength!==16)return He.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Hr(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(n=i);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new NU),c.expandKey(t);const u=o;return this.currentResult=c.decrypt(l.buffer,0,n),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,n,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,s));this.key=t,this.fastAesKey=new MU(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new DU(this.subtle,new Uint8Array(n),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(He.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,n,s)))}onWebCryptoError(e,t,n,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%jU;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(He.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Cw=Math.pow(2,17);class $U{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Xn({type:xe.NETWORK_ERROR,details:Z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(Pw(e));return}else e.gap=!1;const c=this.loader=i?new i(s):new o(s),u=Lw(e);e.loader=c;const d=Iw(s.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Cw};e.stats=c.stats;const f={onSuccess:(m,p,g,y)=>{this.resetLoader(e,c);let x=m.data;g.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(x.slice(0,16)),x=x.slice(16)),a({frag:e,part:null,payload:x,networkDetails:y})},onError:(m,p,g,y)=>{this.resetLoader(e,c),l(new Xn({type:xe.NETWORK_ERROR,details:Z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ge({url:n,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:g,stats:y}))},onAbort:(m,p,g)=>{this.resetLoader(e,c),l(new Xn({type:xe.NETWORK_ERROR,details:Z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:g,stats:m}))},onTimeout:(m,p,g)=>{this.resetLoader(e,c),l(new Xn({type:xe.NETWORK_ERROR,details:Z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:g,stats:m}))}};t&&(f.onProgress=(m,p,g,y)=>t({frag:e,part:null,payload:g,networkDetails:y})),c.load(u,h,f)})}loadPart(e,t,n){this.abort();const s=this.config,i=s.fLoader,o=s.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Pw(e,t));return}const c=this.loader=i?new i(s):new o(s),u=Lw(e,t);e.loader=c;const d=Iw(s.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Cw};t.stats=c.stats,c.load(u,h,{onSuccess:(f,m,p,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:f.data,networkDetails:g};n(y),a(y)},onError:(f,m,p,g)=>{this.resetLoader(e,c),l(new Xn({type:xe.NETWORK_ERROR,details:Z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ge({url:u.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:p,stats:g}))},onAbort:(f,m,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Xn({type:xe.NETWORK_ERROR,details:Z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:f}))},onTimeout:(f,m,p)=>{this.resetLoader(e,c),l(new Xn({type:xe.NETWORK_ERROR,details:Z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:f}))}})})}updateStatsFromPart(e,t){const n=e.stats,s=t.stats,i=s.total;if(n.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/i),l),d=(l-c)*Math.round(n.loaded/c);n.total=n.loaded+d}else n.total=Math.max(n.loaded,n.total);const o=n.loading,a=s.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Lw(r,e=null){const t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(fe(s)&&fe(i)){var o;let a=s,l=i;if(r.sn==="initSegment"&&BU((o=r.decryptdata)==null?void 0:o.method)){const c=i-s;c%16&&(l=i+(16-c%16)),s!==0&&(n.resetIV=!0,a=s-16)}n.rangeStart=a,n.rangeEnd=l}return n}function Pw(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:xe.MEDIA_ERROR,details:Z.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new Xn(n)}function BU(r){return r==="AES-128"||r==="AES-256"}class Xn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class lk extends Kr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class hy{constructor(e,t,n,s=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=uu(),this.buffering={audio:uu(),video:uu(),audiovideo:uu()},this.level=e,this.sn=t,this.id=n,this.size=s,this.part=i,this.partial=o}}function uu(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Dw={length:0,start:()=>0,end:()=>0};class _e{static isBuffered(e,t){if(e){const n=_e.getBuffered(e);for(let s=n.length;s--;)if(t>=n.start(s)&&t<=n.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=_e.getBuffered(e);return _e.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const s=_e.bufferedRanges(e);if(s.length)return _e.bufferedInfo(s,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((u,d)=>u.start-d.start||d.end-u.end);let s=-1,i=[];if(n)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(s=u);const d=i.length;if(d){const h=i[d-1].end;e[u].start-h<n?e[u].end>h&&(i[d-1].end=e[u].end):i.push(e[u])}else i.push(e[u])}else i=e;let o=0,a,l=t,c=t;for(let u=0;u<i.length;u++){const d=i[u].start,h=i[u].end;if(s===-1&&t>=d&&t<=h&&(s=u),t+n>=d&&t<h)l=d,c=h,o=c-t;else if(t+n<d){a=d;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Dw}catch(t){return He.log("failed to get media.buffered",t),Dw}}}const ck=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ow(r){return ck.test(r)}function qm(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(ck,n=>{const s=n.substring(2,n.length-1),i=t==null?void 0:t[s];return i===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),n):i})}return e}function Nw(r,e,t){let n=r.variableList;n||(r.variableList=n={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))i=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,i=e.VALUE;s in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):n[s]=i||""}function UU(r,e,t){const n=e.IMPORT;if(t&&n in t){let s=r.variableList;s||(r.variableList=s={}),s[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const zU=/^(\d+)x(\d+)$/,Mw=/(.+?)=(".*?"|.*?)(?:,|$)/g;class at{constructor(e,t){typeof e=="string"&&(e=at.parseAttrList(e,t)),Ke(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)n[s]=parseInt(t.slice(s*2,s*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=zU.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const s={},i='"';for(Mw.lastIndex=0;(n=Mw.exec(e))!==null;){const o=n[1].trim();let a=n[2];const l=a.indexOf(i)===0&&a.lastIndexOf(i)===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))a=qm(t,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":He.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=a}return s}}const GU="com.apple.hls.interstitial";function HU(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function VU(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class uk{constructor(e,t,n=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:n,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){He.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Ke(new at({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);fe(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(He.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(fe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===GU}get isValid(){return!!this.id&&!this._badValueForSameId&&fe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const WU=10;class KU{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?fe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||WU}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function zd(r,e){return r.length===e.length?!r.some((t,n)=>t!==e[n]):!1}function Fw(r,e){return!r&&!e?!0:!r||!e?!1:zd(r,e)}function Xo(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function fy(r){switch(r){case"AES-128":case"AES-256":return oi.cbc;case"AES-256-CTR":return oi.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function py(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function Ym(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function qU(r){const e=Ym(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function dk(r){const e=function(n,s,i){const o=n[s];n[s]=n[i],n[i]=o};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function hk(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),s=n[n.length-1].split(",");if(s.length===2){const i=s[0]==="base64",o=s[1];i?(n.splice(-1,1),t=py(o)):t=qU(o)}}return t}const Gd=typeof self<"u"?self:void 0;var ut={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},$t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Vu(r){switch(r){case $t.FAIRPLAY:return ut.FAIRPLAY;case $t.PLAYREADY:return ut.PLAYREADY;case $t.WIDEVINE:return ut.WIDEVINE;case $t.CLEARKEY:return ut.CLEARKEY}}function Uf(r){switch(r){case ut.FAIRPLAY:return $t.FAIRPLAY;case ut.PLAYREADY:return $t.PLAYREADY;case ut.WIDEVINE:return $t.WIDEVINE;case ut.CLEARKEY:return $t.CLEARKEY}}function el(r){const{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[ut.FAIRPLAY,ut.WIDEVINE,ut.PLAYREADY,ut.CLEARKEY].filter(s=>!!e[s]):[];return!n[ut.WIDEVINE]&&t&&n.push(ut.WIDEVINE),n}const fk=function(r){return Gd!=null&&(r=Gd.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function YU(r,e,t,n){let s;switch(r){case ut.FAIRPLAY:s=["cenc","sinf"];break;case ut.WIDEVINE:case ut.PLAYREADY:s=["cenc"];break;case ut.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return QU(s,e,t,n)}function QU(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function XU(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function pk(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=py(a).subarray(0,16);return dk(l),l}}return null}let du={};class Ui{static clearKeyUriToKeyIdMap(){du={}}static setKeyIdForUri(e,t){du[e]=t}constructor(e,t,n,s=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Xo(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(zA(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&zd(e.keyFormatVersions,this.keyFormatVersions)&&Fw(e.iv,this.iv)&&Fw(e.keyId,this.keyId)}isSupported(){if(this.method){if(Xo(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case $t.FAIRPLAY:case $t.WIDEVINE:case $t.PLAYREADY:case $t.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Xo(this.method)){let i=this.iv;return i||(typeof e!="number"&&(He.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=ZU(e)),new Ui(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=du[this.uri];if(i&&!zd(this.keyId,i)&&Ui.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=hk(this.uri);if(n)switch(this.keyFormat){case $t.WIDEVINE:if(this.pssh=n,!this.keyId){const i=rU(n.buffer);if(i.length){var s;const o=i[0];this.keyId=(s=o.kids)!=null&&s.length?o.kids[0]:null}}this.keyId||(this.keyId=jw(t));break;case $t.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=tU(i,null,n),this.keyId=pk(n);break}default:{let i=n.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=JU(t),i||(i=jw(t),i||(i=du[this.uri])),i&&(this.keyId=i,Ui.setKeyIdForUri(this.uri,i))}return this}}function JU(r){const e=r==null?void 0:r[$t.WIDEVINE];return e?e.keyId:null}function jw(r){const e=r==null?void 0:r[$t.PLAYREADY];if(e){const t=hk(e.uri);if(t)return pk(t)}return null}function ZU(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const $w=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Bw=/#EXT-X-MEDIA:(.*)/g,e3=/^#EXT(?:INF|-X-TARGETDURATION):/m,zf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),t3=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Dn{static findGroup(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(s.id===t)return s}}static resolve(e,t){return iy.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return e3.test(e)}static parseMasterPlaylist(e,t){const n=Ow(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},i=[];if($w.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let o;for(;(o=$w.exec(e))!=null;)if(o[1]){var a;const c=new at(o[1],s),u=qm(s,o[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Dn.resolve(u,t)},h=c.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),Gw(c.CODECS,d);const f=c["SUPPLEMENTAL-CODECS"];f&&(d.supplemental={},Gw(f,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||i.push(d),s.levels.push(d)}else if(o[3]){const c=o[3],u=o[4];switch(c){case"SESSION-DATA":{const d=new at(u,s),h=d["DATA-ID"];h&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[h]=d);break}case"SESSION-KEY":{const d=Uw(u,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):He.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const d=new at(u,s);Nw(s,d,t)}break}case"CONTENT-STEERING":{const d=new at(u,s);s.contentSteering={uri:Dn.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=zw(u);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,n){let s;const i={},o=n.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Bw.lastIndex=0;(s=Bw.exec(e))!==null;){const c=new at(s[1],n),u=c.TYPE;if(u){const d=a[u],h=i[u]||[];i[u]=h;const f=c.LANGUAGE,m=c["ASSOC-LANGUAGE"],p=c.CHANNELS,g=c.CHARACTERISTICS,y=c["INSTREAM-ID"],x={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||f||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:f,url:c.URI?Dn.resolve(c.URI,t):""};if(m&&(x.assocLang=m),p&&(x.channels=p),g&&(x.characteristics=g),y&&(x.instreamId=y),d!=null&&d.length){const w=Dn.findGroup(d,x.groupId)||d[0];Hw(x,w,"audioCodec"),Hw(x,w,"textCodec")}h.push(x)}}return i}static parseLevelPlaylist(e,t,n,s,i,o){var a;const l={url:t},c=new KU(t),u=c.fragments,d=[];let h=null,f=0,m=0,p=0,g=0,y=0,x=null,w=new jf(s,l),b,E,I,S=-1,C=!1,R=null,L;if(zf.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Ow(e),((a=zf.exec(e))==null?void 0:a[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(b=zf.exec(e))!==null;){C&&(C=!1,w=new jf(s,l),w.playlistOffset=p,w.setStart(p),w.sn=f,w.cc=g,y&&(w.bitrate=y),w.level=n,h&&(w.initSegment=h,h.rawProgramDateTime&&(w.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),R&&(w.setByteRange(R),R=null)));const _=b[1];if(_){w.duration=parseFloat(_);const H=(" "+b[2]).slice(1);w.title=H||null,w.tagList.push(H?["INF",_,H]:["INF",_])}else if(b[3]){if(fe(w.duration)){w.playlistOffset=p,w.setStart(p),I&&Ww(w,I,c),w.sn=f,w.level=n,w.cc=g,u.push(w);const H=(" "+b[3]).slice(1);w.relurl=qm(c,H),Qm(w,x,d),x=w,p+=w.duration,f++,m=0,C=!0}}else{if(b=b[0].match(t3),!b){He.warn("No matches on slow regex match for level playlist!");continue}for(E=1;E<b.length&&b[E]===void 0;E++);const H=(" "+b[E]).slice(1),V=(" "+b[E+1]).slice(1),G=b[E+2]?(" "+b[E+2]).slice(1):null;switch(H){case"BYTERANGE":x?w.setByteRange(V,x):w.setByteRange(V);break;case"PROGRAM-DATE-TIME":w.rawProgramDateTime=V,w.tagList.push(["PROGRAM-DATE-TIME",V]),S===-1&&(S=u.length);break;case"PLAYLIST-TYPE":c.type&&Wn(c,H,b),c.type=V.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?Wn(c,H,b):u.length>0&&Kw(c,H,b),f=c.startSN=parseInt(V);break;case"SKIP":{c.skippedSegments&&Wn(c,H,b);const j=new at(V,c),F=j.decimalInteger("SKIPPED-SEGMENTS");if(fe(F)){c.skippedSegments+=F;for(let M=F;M--;)u.push(null);f+=F}const Y=j.enumeratedString("RECENTLY-REMOVED-DATERANGES");Y&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(Y.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&Wn(c,H,b),c.targetduration=Math.max(parseInt(V),1);break;case"VERSION":c.version!==null&&Wn(c,H,b),c.version=parseInt(V);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||Wn(c,H,b),c.live=!1;break;case"#":(V||G)&&w.tagList.push(G?[V,G]:[V]);break;case"DISCONTINUITY":g++,w.tagList.push(["DIS"]);break;case"GAP":w.gap=!0,w.tagList.push([H]);break;case"BITRATE":w.tagList.push([H,V]),y=parseInt(V)*1e3,fe(y)?w.bitrate=y:y=0;break;case"DATERANGE":{const j=new at(V,c),F=new uk(j,c.dateRanges[j.ID],c.dateRangeTagCount);c.dateRangeTagCount++,F.isValid||c.skippedSegments?c.dateRanges[F.id]=F:He.warn(`Ignoring invalid DATERANGE tag: "${V}"`),w.tagList.push(["EXT-X-DATERANGE",V]);break}case"DEFINE":{{const j=new at(V,c);"IMPORT"in j?UU(c,j,o):Nw(c,j,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?Wn(c,H,b):u.length>0&&Kw(c,H,b),c.startCC=g=parseInt(V);break;case"KEY":{const j=Uw(V,t,c);if(j.isSupported()){if(j.method==="NONE"){I=void 0;break}I||(I={});const F=I[j.keyFormat];F!=null&&F.matches(j)||(F&&(I=Ke({},I)),I[j.keyFormat]=j)}else He.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${V}"`);break}case"START":c.startTimeOffset=zw(V);break;case"MAP":{const j=new at(V,c);if(w.duration){const F=new jf(s,l);Vw(F,j,n,I),h=F,w.initSegment=h,h.rawProgramDateTime&&!w.rawProgramDateTime&&(w.rawProgramDateTime=h.rawProgramDateTime)}else{const F=w.byteRangeEndOffset;if(F){const Y=w.byteRangeStartOffset;R=`${F-Y}@${Y}`}else R=null;Vw(w,j,n,I),h=w,C=!0}h.cc=g;break}case"SERVER-CONTROL":{L&&Wn(c,H,b),L=new at(V),c.canBlockReload=L.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=L.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&L.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=L.optionalFloat("PART-HOLD-BACK",0),c.holdBack=L.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&Wn(c,H,b);const j=new at(V);c.partTarget=j.decimalFloatingPoint("PART-TARGET");break}case"PART":{let j=c.partList;j||(j=c.partList=[]);const F=m>0?j[j.length-1]:void 0,Y=m++,M=new at(V,c),D=new UB(M,w,l,Y,F);j.push(D),w.duration+=D.duration;break}case"PRELOAD-HINT":{const j=new at(V,c);c.preloadHint=j;break}case"RENDITION-REPORT":{const j=new at(V,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(j);break}default:He.warn(`line parsed but not handled: ${b}`);break}}}x&&!x.relurl?(u.pop(),p-=x.duration,c.partList&&(c.fragmentHint=x)):c.partList&&(Qm(w,x,d),w.cc=g,c.fragmentHint=w,I&&Ww(w,I,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const $=u.length,P=u[0],U=u[$-1];if(p+=c.skippedSegments*c.targetduration,p>0&&$&&U){c.averagetargetduration=p/$;const _=U.sn;c.endSN=_!=="initSegment"?_:0,c.live||(U.endList=!0),S>0&&(n3(u,S),P&&d.unshift(P))}return c.fragmentHint&&(p+=c.fragmentHint.duration),c.totalduration=p,d.length&&c.dateRangeTagCount&&P&&mk(d,c),c.endCC=g,c}}function mk(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];r.push(a),t++}else return;const n=r[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let a=i.length;a--;){const l=e.dateRanges[i[a]],c=l.startDate.getTime();l.tagAnchor=n.ref;for(let u=t;u--;){var o;if(((o=r[u])==null?void 0:o.sn)<e.startSN)break;const d=r3(e,c,r,u,s);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function r3(r,e,t,n,s){const i=t[n];if(i){const a=i.programDateTime;if(e>=a||n===0){var o;const l=(((o=t[n+1])==null?void 0:o.start)||s)-i.start;if(e<=a+l*1e3){const c=t[n].sn-r.startSN;if(c<0)return-1;const u=r.fragments;if(u.length>t.length){const h=(t[n+1]||u[u.length-1]).sn-r.startSN;for(let f=h;f>c;f--){const m=u[f].programDateTime;if(e>=m&&e<m+u[f].duration*1e3)return f}}return c}}}return-1}function Uw(r,e,t){var n,s;const i=new at(r,t),o=(n=i.METHOD)!=null?n:"",a=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,u=(s=i.KEYFORMAT)!=null?s:"identity";a&&i.IV&&!l&&He.error(`Invalid IV: ${i.IV}`);const d=a?Dn.resolve(a,e):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Ui(o,d,u,h,l,i.KEYID)}function zw(r){const t=new at(r).decimalFloatingPoint("TIME-OFFSET");return fe(t)?t:null}function Gw(r,e){let t=(r||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const s=t.filter(i=>ly(i,n));s.length&&(e[`${n}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function Hw(r,e,t){const n=e[t];n&&(r[t]=n)}function n3(r,e){let t=r[e];for(let n=e;n--;){const s=r[n];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Qm(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function Vw(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function Ww(r,e,t){r.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&n.push(r)}function Wn(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Kw(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Gf(r,e){const t=e.startPTS;if(fe(t)){let n=0,s;e.sn>r.sn?(n=t-r.start,s=r):(n=r.start-t,s=e),s.duration!==n&&s.setDuration(n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function gk(r,e,t,n,s,i,o){n-t<=0&&(o.warn("Fragment should have a positive duration",e),n=t+e.duration,i=s+e.duration);let l=t,c=n;const u=e.startPTS,d=e.endPTS;if(fe(u)){const y=Math.abs(u-t);r&&y>r.totalduration?o.warn(`media timestamps and playlist times differ by ${y}s for level ${e.level} ${r.url}`):fe(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,l=Math.max(t,u),t=Math.min(t,u),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,c=Math.min(n,d),n=Math.max(n,d),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=n,e.minEndPTS=c,e.endDTS=i;const f=e.sn;if(!r||f<r.startSN||f>r.endSN)return 0;let m;const p=f-r.startSN,g=r.fragments;for(g[p]=e,m=p;m>0;m--)Gf(g[m],g[m-1]);for(m=p;m<g.length-1;m++)Gf(g[m],g[m+1]);return r.fragmentHint&&Gf(g[g.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,h}function s3(r,e,t){if(r===e)return;let n=null;const s=r.fragments;for(let u=s.length-1;u>=0;u--){const d=s[u].initSegment;if(d){n=d;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let i;a3(r,e,(u,d,h,f)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==u.cc){const m=u.cc-d.cc;for(let p=h;p<f.length;p++)f[p].cc+=m;e.endCC=f[f.length-1].cc}fe(u.startPTS)&&fe(u.endPTS)&&(d.setStart(d.startPTS=u.startPTS),d.startDTS=u.startDTS,d.maxStartPTS=u.maxStartPTS,d.endPTS=u.endPTS,d.endDTS=u.endDTS,d.minEndPTS=u.minEndPTS,d.setDuration(u.endPTS-u.startPTS),d.duration&&(i=d),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(d.elementaryStreams=u.elementaryStreams),d.loader=u.loader,u.hasStats&&(d.stats=u.stats),u.initSegment&&(d.initSegment=u.initSegment,n=u.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(n&&a.forEach(u=>{var d;u&&(!u.initSegment||u.initSegment.relurl===((d=n)==null?void 0:d.relurl))&&(u.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=i3(r.dateRanges,e,t));const u=r.fragments.filter(d=>d.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<a.length;d++)a[d].programDateTime===null&&Qm(a[d],a[d-1],u);mk(u,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const u=xk(r,e.startSN-1);e.startCC=(l=u==null?void 0:u.cc)!=null?l:o[0].cc}o3(r.partList,e.partList,(u,d)=>{d.elementaryStreams=u.elementaryStreams,d.stats=u.stats}),i?gk(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):yk(r,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function i3(r,e,t){const{dateRanges:n,recentlyRemovedDateranges:s}=e,i=Ke({},r);s&&s.forEach(l=>{delete i[l]});const a=Object.keys(i).length;return a?(Object.keys(n).forEach(l=>{const c=i[l],u=new uk(n[l].attr,c);u.isValid?(i[l]=u,c||(u.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Qe(n[l].attr)}"`)}),i):n}function o3(r,e,t){if(r&&e){let n=0;for(let s=0,i=r.length;s<=i;s++){const o=r[s],a=e[s+n];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):n--}}}function a3(r,e,t){const n=e.skippedSegments,s=Math.max(r.startSN,e.startSN)-e.startSN,i=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,o=e.startSN-r.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let c=s;c<=i;c++){const u=l[o+c];let d=a[c];if(n&&!d&&u&&(d=e.fragments[c]=u),u&&d){t(u,d,c,a);const h=u.relurl,f=d.relurl;if(h&&l3(h,f)){e.playlistParsingError=qw(`media sequence mismatch ${d.sn}:`,r,e,u,d);return}else if(u.cc!==d.cc){e.playlistParsingError=qw(`discontinuity sequence mismatch (${u.cc}!=${d.cc})`,r,e,u,d);return}}}}function qw(r,e,t,n,s){return new Error(`${r} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function yk(r,e,t=!0){const n=e.startSN+e.skippedSegments-r.startSN,s=r.fragments,i=n>=0;let o=0;if(i&&n<s.length)o=s[n].start;else if(i&&e.startSN===r.endSN+1)o=r.fragmentEnd;else if(i&&t)o=r.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=r.fragmentStart;else return;Xm(e,o)}function Xm(r,e){if(e){const t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function vk(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const n=r.fragments;if(n.length&&t*4>e){const i=n[n.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function xk(r,e,t){if(!r)return null;let n=r.fragments[e-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===e)?n:e<r.startSN&&t&&t.sn===e?t:null}function Yw(r,e,t){return r?wk(r.partList,e,t):null}function wk(r,e,t){if(r)for(let n=r.length;n--;){const s=r[n];if(s.index===t&&s.fragment.sn===e)return s}return null}function bk(r){r.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function l3(r,e){return r!==e&&e?Qw(r)!==Qw(e):!1}function Qw(r){return r.replace(/\?[^?]*$/,"")}function pl(r,e){for(let n=0,s=r.length;n<s;n++){var t;if(((t=r[n])==null?void 0:t.cc)===e)return r[n]}return null}function c3(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function Xw(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function Sk(r,e){const t=e.fragments;for(let n=0,s=t.length;n<s;n++)Xw(t[n],r);e.fragmentHint&&Xw(e.fragmentHint,r),e.alignedSliding=!0}function u3(r,e){r&&(Ek(e,r),e.alignedSliding||Hd(e,r),!e.alignedSliding&&!e.skippedSegments&&yk(r,e,!1))}function Ek(r,e){if(!c3(e,r))return;const t=Math.min(e.endCC,r.endCC),n=pl(e.fragments,t),s=pl(r.fragments,t);if(!n||!s)return;He.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=n.start-s.start;Sk(i,r)}function Hd(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let s,i;const o=Math.min(e.endCC,r.endCC);e.startCC<o&&r.startCC<o&&(s=pl(n,o),i=pl(t,o)),(!s||!i)&&(s=n[Math.floor(n.length/2)],i=pl(t,s.cc)||t[Math.floor(t.length/2)]);const a=s.programDateTime,l=i.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(i.start-s.start);Sk(c,r)}function er(r,e,t){dr(r,e,t),r.addEventListener(e,t)}function dr(r,e,t){r.removeEventListener(e,t)}const d3={toString:function(r){let e="";const t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},ne={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class my extends lk{constructor(e,t,n,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ne.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:u}=this,d=l?l.currentTime:0,h=_e.bufferInfo(c||l,d,o.maxBufferHole),f=!h.len;if(this.log(`Media seeking to ${fe(d)?d.toFixed(3):d}, state: ${u}, ${f?"out of":"in"} buffer`),this.state===ne.ENDED)this.resetLoadingState();else if(a){const m=o.maxFragLookUpTolerance,p=a.start-m,g=a.start+a.duration+m;if(f||g<h.start||p>h.end){const y=d>g;(d<p||y)&&(y&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const m=this.lastCurrentTime;if(d>m&&(this.lastCurrentTime=d),!this.loadingParts){const p=Math.max(h.end,d),g=this.shouldLoadParts(this.getLevelDetails(),p);g&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=g)}}this.hls.hasEnoughToStart||(this.log(`Setting ${f?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,f&&(this.startPosition=d)),f&&this.state===ne.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new $U(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new dy(e.config)}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ne.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ne.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,s=this.config.timelineOffset||0;if(n<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=_e.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return _e.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;er(n,"seeking",this.onMediaSeeking),er(n,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===ne.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),dr(s,"seeking",this.onMediaSeeking),dr(s,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ne.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const s=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,n,s).then(i=>{if(!i)return;const o=this.state,a=i.frag;if(this.fragContextChanged(a)){(o===ne.FRAG_LOADING||!this.fragCurrent&&o===ne.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=ne.IDLE);return}"payload"in i&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(A.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===Rt.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Rt.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:n};this.hls.trigger(A.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:s}=this,{frag:i,payload:o}=n,a=i.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&Xo(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,fy(a.method)).catch(c=>{throw s.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:i}),c}).then(c=>{const u=self.performance.now();return s.trigger(A.FRAG_DECRYPTED,{frag:i,payload:c,stats:{tstart:l,tdecrypt:u}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==ne.STOPPED&&(this.state=ne.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,s;const i=e.tracks;if(i&&!t.encrypted&&((n=i.audio)!=null&&n.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(A.ERROR,{type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?d3.toString(_e.getBuffered(n)):"(detached)"})`),St(e)){var s;if(e.type!==me.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=ne.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=ne.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:s,partsLoaded:i}=e,o=!i||i.length===0||i.some(l=>!l),a=new hy(n.level,n.sn,n.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,s){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ne.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(A.KEY_LOADED,h),this.state===ne.KEY_LOADING&&(this.state=ne.IDLE),h}),this.hls.trigger(A.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(St(e)&&(!l||e.sn!==l.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=h)}if(n=Math.max(e.start,n||0),this.loadingParts&&St(e)){const h=o.partList;if(h&&s){n>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const f=this.getNextPart(h,e,n);if(f>-1){const m=h[f];e=this.fragCurrent=m.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${m.index} (${f}/${h.length-1}) of ${this.fragInfo(e,!1,m)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=m.start+m.duration,this.state=ne.FRAG_LOADING;let p;return a?p=a.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(e,m,t,s)).catch(g=>this.handleFragLoadError(g)):p=this.doFragPartsLoad(e,m,t,s).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(A.FRAG_LOADING,{frag:e,part:m,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(h,n))return Promise.resolve(null)}}if(St(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(h=>h.loaded).map(h=>`[${h.start}-${h.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),fe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ne.FRAG_LOADING;const u=this.config.progressive;let d;return u&&a?d=a.then(h=>!h||this.fragContextChanged(h.frag)?null:this.fragmentLoader.load(e,s)).catch(h=>this.handleFragLoadError(h)):d=Promise.all([this.fragmentLoader.load(e,u?s:void 0),a]).then(([h])=>(!u&&s&&s(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(A.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,n,s){return new Promise((i,o)=>{var a;const l=[],c=(a=n.details)==null?void 0:a.partList,u=d=>{this.fragmentLoader.loadPart(e,d,s).then(h=>{l[d.index]=h;const f=h.part;this.hls.trigger(A.FRAG_LOADED,h);const m=Yw(n.details,e.sn,d.index+1)||wk(c,e.sn,d.index+1);if(m)u(m);else return i({frag:e,part:f,partsLoaded:l})}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===xe.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(A.ERROR,t)}else this.hls.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ne.PARSING){!this.fragCurrent&&this.state!==ne.STOPPED&&this.state!==ne.ERROR&&(this.state=ne.IDLE);return}const{frag:n,part:s,level:i}=t,o=self.performance.now();n.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const i=e.partList[0];if(i.fragment.type===me.SUBTITLE)return!1;const o=i.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:s,sn:i,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const a=t[s],l=a.details,c=o>-1?Yw(l,i,o):null,u=c?c.fragment:xk(l,i,n);return u?(n&&n!==u&&(u.stats=n.stats),{frag:u,part:c,level:a}):null}bufferFragmentData(e,t,n,s,i){if(this.state!==ne.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=Hr(o,a)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,d={type:e.type,frag:t,part:n,chunkMeta:s,offset:u,parent:t.type,data:l};if(this.hls.trigger(A.BUFFER_APPENDING,d),e.dropped&&e.independent&&!n){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!_e.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,s=_e.bufferInfo(t,n,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),a=Math.max(Math.min(e.start-o,s.end-o),n+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var n;const s=this.getLoadPosition();if(!fe(s))return null;const o=this.lastCurrentTime>s||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,n,s){const i=_e.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,n);if(o&&(i.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(i.nextStart,o.end)-t,s);return _e.bufferInfo(e,t,a)}}return i}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,s=Math.max(Math.min(e-t,n.maxBufferLength),t),i=Math.max(e-t*3,n.maxMaxBufferLength/2,s);return i>=s?(n.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=me.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,s=n.length;if(!s)return null;const{config:i}=this,o=n[0].start,a=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,f=this.hls.liveSyncPosition,m=l?(h!==-1&&h>=o?h:f)||l.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${f} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=o&&(l=n[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const d=l.sn-t.startSN;u=this.filterReplacedPrimary(n[d+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Rt.OK||n===Rt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,s,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&n.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,s,0);if(a!==null&&n.len+a.len>=i){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Jw(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Jw(this.config)&&e.type!==me.SUBTITLE){const n=this.hls.interstitialsManager,s=n==null?void 0:n.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=n==null?void 0:n.playerQueue;if(i)for(let o=i.length;o--;){const a=i[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let s=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,s>-1&&n<c.start)break;const u=c.loaded;u?s=-1:(i||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),s=a),i=u}return s}loadedEndOfParts(e,t){let n;for(let s=e.length;s--;){if(n=e[s],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let s=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),s=kU(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];n.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=ik(e,n.cc,n.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,n){const{config:s}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=n;const{fragmentHint:l}=n,{maxFragLookUpTolerance:c}=s,u=n.partList,d=!!(this.loadingParts&&u!=null&&u.length&&l);d&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let h;if(e<t){var f;const p=e<this.lastCurrentTime||e>t-c||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:c;h=Xi(i,o,e,p)}else h=o[o.length-1];if(h){const m=h.sn-n.startSN,p=this.fragmentTracker.getState(h);if((p===Rt.OK||p===Rt.PARTIAL&&h.gap)&&(i=h),i&&h.sn===i.sn&&(!d||u[0].fragment.sn>h.sn||!n.live)&&h.level===i.level){const y=o[m+1];h.sn<a&&this.fragmentTracker.getState(y)!==Rt.OK?h=y:h=null}}return h}alignPlaylists(e,t,n){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,a=e.alignedSliding&&fe(i);if(o||!a&&!i){u3(n,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const s=this.timelineOffset;if(n===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&fe(o)?(n=t+o,o<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+s}this.nextLoadPosition=n+s}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&St(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ne.FRAG_LOADING_WAITING_RETRY)&&(this.state=ne.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===Z.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const a=t.errorAction;if(!a){this.state=ne.ERROR;return}const{action:l,flags:c,retryCount:u=0,retryConfig:d}=a,h=!!d,f=h&&l===Ft.RetryRequest,m=h&&!a.resolved&&c===xr.MoveAllAlternatesMatchingHost,p=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!f&&m&&St(s)&&!s.endList&&p&&!ak(t))this.resetFragmentErrors(e),this.treatAsGap(s),a.resolved=!0;else if((f||m)&&u<d.maxNumRetry){var g;const y=Km((g=t.response)==null?void 0:g.code),x=uy(d,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+x,this.state=ne.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,y){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${u+1}/${d.maxNumRetry} in ${x}ms`)}else if(d)if(this.resetFragmentErrors(e),u<d.maxNumRetry)!o&&l!==Ft.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===Ft.SendAlternateToPenaltyBox?this.state=ne.WAITING_LEVEL:this.state=ne.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!Km(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ne.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ne.PARSING||this.state===ne.PARSED){const t=e.frag,n=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,n),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===me.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ne.STOPPED&&(this.state=ne.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const s=_e.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,n),this.state===ne.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ne.STOPPED&&(this.state=ne.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,s){const i=n.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const h=s?0:gk(i,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(A.LEVEL_PTS_UPDATED,{details:i,level:n,drift:h,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var a;if(n.fragmentError===0&&this.treatAsGap(e,n),((a=this.transmuxer)==null?void 0:a.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ne.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(A.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===me.MAIN?"level":"track"}fragInfo(e,t=!0,n){var s,i;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((s=t&&!n?e.startPTS:(n||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!n?e.endPTS:(n||e).end)!=null?i:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Jw(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class Tk{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=h3(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function h3(r,e){const t=new Uint8Array(e);let n=0;for(let s=0;s<r.length;s++){const i=r[s];t.set(i,n),n+=i.length}return t}var Hf={exports:{}},Zw;function f3(){return Zw||(Zw=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||l,h),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],f]:l._events[m].push(f):(l._events[m]=f,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,m=new Array(f);h<f;h++)m[h]=d[h].fn;return m},a.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,u,d,h,f,m){var p=t?t+c:c;if(!this._events[p])return!1;var g=this._events[p],y=arguments.length,x,w;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,h),!0;case 5:return g.fn.call(g.context,u,d,h,f),!0;case 6:return g.fn.call(g.context,u,d,h,f,m),!0}for(w=1,x=new Array(y-1);w<y;w++)x[w-1]=arguments[w];g.fn.apply(g.context,x)}else{var b=g.length,E;for(w=0;w<b;w++)switch(g[w].once&&this.removeListener(c,g[w].fn,void 0,!0),y){case 1:g[w].fn.call(g[w].context);break;case 2:g[w].fn.call(g[w].context,u);break;case 3:g[w].fn.call(g[w].context,u,d);break;case 4:g[w].fn.call(g[w].context,u,d,h);break;default:if(!x)for(E=1,x=new Array(y-1);E<y;E++)x[E-1]=arguments[E];g[w].fn.apply(g[w].context,x)}}return!0},a.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},a.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},a.prototype.removeListener=function(c,u,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!u)return o(this,f),this;var m=this._events[f];if(m.fn)m.fn===u&&(!h||m.once)&&(!d||m.context===d)&&o(this,f);else{for(var p=0,g=[],y=m.length;p<y;p++)(m[p].fn!==u||h&&!m[p].once||d&&m[p].context!==d)&&g.push(m[p]);g.length?this._events[f]=g.length===1?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a}(Hf)),Hf.exports}var p3=f3(),gy=$B(p3);const Ql="1.6.13",_a={};function m3(){return typeof __HLS_WORKER_BUNDLE__=="function"}function g3(){const r=_a[Ql];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return _a[Ql]=s,s}function y3(r){const e=_a[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return _a[r]=s,s}function v3(r){const e=_a[r||Ql];if(e&&e.clientCount--===1){const{worker:n,objectURL:s}=e;delete _a[r||Ql],s&&self.URL.revokeObjectURL(s),n.terminate()}}function _k(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function yy(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function Oh(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Xl(r,e){const t=e;let n=0;for(;yy(r,e);){n+=10;const s=Oh(r,e+6);n+=s,_k(r,e+10)&&(n+=10),e+=n}if(n>0)return r.subarray(t,t+n)}function x3(r,e,t,n){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const f=new Error(`invalid ADTS sampling index:${o}`);r.emit(A.ERROR,A.ERROR,{type:xe.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const a=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,c="mp4a.40."+a,u=s[o];let d=o;(a===5||a===29)&&(d-=3);const h=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return He.log(`manifest codec:${n}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${a} sampling index:${o})`),{config:h,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:n}}function Ak(r,e){return r[e]===255&&(r[e+1]&246)===240}function kk(r,e){return r[e+1]&1?7:9}function vy(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function w3(r,e){return e+5<r.length}function Vd(r,e){return e+1<r.length&&Ak(r,e)}function b3(r,e){return w3(r,e)&&Ak(r,e)&&vy(r,e)<=r.length-e}function S3(r,e){if(Vd(r,e)){const t=kk(r,e);if(e+t>=r.length)return!1;const n=vy(r,e);if(n<=t)return!1;const s=e+n;return s===r.length||Vd(r,s)}return!1}function Ik(r,e,t,n,s){if(!r.samplerate){const i=x3(e,t,n,s);if(!i)return;Ke(r,i)}}function Rk(r){return 1024*9e4/r}function E3(r,e){const t=kk(r,e);if(e+t<=r.length){const n=vy(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function Ck(r,e,t,n,s){const i=Rk(r.samplerate),o=n+s*i,a=E3(e,t);let l;if(a){const{frameLength:d,headerLength:h}=a,f=h+d,m=Math.max(0,t+f-e.length);m?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);const p={unit:l,pts:o};return m||r.samples.push(p),{sample:p,length:f,missing:m}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function T3(r,e){return yy(r,e)&&Oh(r,e+6)+10<=r.length-e}function _3(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function Vf(r,e=0,t=1/0){return A3(r,e,t,Uint8Array)}function A3(r,e,t,n){const s=k3(r);let i=1;"BYTES_PER_ELEMENT"in n&&(i=n.BYTES_PER_ELEMENT);const o=I3(r)?r.byteOffset:0,a=(o+r.byteLength)/i,l=(o+e)/i,c=Math.floor(Math.max(0,Math.min(l,a))),u=Math.floor(Math.min(c+Math.max(t,0),a));return new n(s,c,u-c)}function k3(r){return r instanceof ArrayBuffer?r:r.buffer}function I3(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function R3(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=r.data.subarray(1).indexOf(0);if(n===-1)return;const s=Cr(Vf(r.data,1,n)),i=r.data[2+n],o=r.data.subarray(3+n).indexOf(0);if(o===-1)return;const a=Cr(Vf(r.data,3+n,o));let l;return s==="-->"?l=Cr(Vf(r.data,4+n+o)):l=_3(r.data.subarray(4+n+o)),e.mimeType=s,e.pictureType=i,e.description=a,e.data=l,e}function C3(r){if(r.size<2)return;const e=Cr(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function L3(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const n=Cr(r.data.subarray(t),!0);t+=n.length+1;const s=Cr(r.data.subarray(t));return{key:r.type,info:n,data:s}}const e=Cr(r.data.subarray(1));return{key:r.type,info:"",data:e}}function P3(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const n=Cr(r.data.subarray(t),!0);t+=n.length+1;const s=Cr(r.data.subarray(t));return{key:r.type,info:n,data:s}}const e=Cr(r.data);return{key:r.type,info:"",data:e}}function D3(r){return r.type==="PRIV"?C3(r):r.type[0]==="W"?P3(r):r.type==="APIC"?R3(r):L3(r)}function O3(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=Oh(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}}const hu=10,N3=10;function Lk(r){let e=0;const t=[];for(;yy(r,e);){const n=Oh(r,e+6);r[e+5]>>6&1&&(e+=hu),e+=hu;const s=e+n;for(;e+N3<s;){const i=O3(r.subarray(e)),o=D3(i);o&&t.push(o),e+=i.size+hu}_k(r,e)&&(e+=hu)}return t}function Pk(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function M3(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function xy(r){const e=Lk(r);for(let t=0;t<e.length;t++){const n=e[t];if(Pk(n))return M3(n)}}let Er=function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r}({});function Rn(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class wy{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Hr(this.cachedData,e),this.cachedData=null);let n=Xl(e,0),s=n?n.length:0,i;const o=this._audioTrack,a=this._id3Track,l=n?xy(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&fe(l))&&(this.basePTS=F3(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Er.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const u=this.appendFrame(o,e,s);u?(this.frameIndex++,this.lastPTS=u.sample.pts,s+=u.length,i=s):s=c}else T3(e,s)?(n=Xl(e,s),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Er.audioId3,duration:Number.POSITIVE_INFINITY}),s+=n.length,i=s):s++;if(s===c&&i!==c){const u=e.slice(i);this.cachedData?this.cachedData=Hr(this.cachedData,u):this.cachedData=u}}return{audioTrack:o,videoTrack:Rn(),id3Track:a,textTrack:Rn()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Rn(),id3Track:this._id3Track,textTrack:Rn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const F3=(r,e,t)=>{if(fe(r))return r*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let fu=null;const j3=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],$3=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],B3=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],U3=[0,1,1,4];function Dk(r,e,t,n,s){if(t+24>e.length)return;const i=Ok(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,a=n+s*o,l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return r.config=[],r.channelCount=i.channelCount,r.samplerate=i.sampleRate,r.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function Ok(r,e){const t=r[e+1]>>3&3,n=r[e+1]>>1&3,s=r[e+2]>>4&15,i=r[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const o=r[e+2]>>1&1,a=r[e+3]>>6,l=t===3?3-n:n===3?3:4,c=j3[l*14+s-1]*1e3,d=$3[(t===3?0:t===2?1:2)*3+i],h=a===3?1:2,f=B3[t][n],m=U3[n],p=f*8*m,g=Math.floor(f*c/d+o)*m;if(fu===null){const w=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);fu=w?parseInt(w[1]):0}return!!fu&&fu<=87&&n===2&&c>=224e3&&a===0&&(r[e+3]=r[e+3]|128),{sampleRate:d,channelCount:h,frameLength:g,samplesPerFrame:p}}}function by(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function Nk(r,e){return e+1<r.length&&by(r,e)}function z3(r,e){return by(r,e)&&4<=r.length-e}function Mk(r,e){if(e+1<r.length&&by(r,e)){const n=Ok(r,e);let s=4;n!=null&&n.frameLength&&(s=n.frameLength);const i=e+s;return i===r.length||Nk(r,i)}return!1}class G3 extends wy{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Xl(e,0);let s=(n==null?void 0:n.length)||0;if(Mk(e,s))return!1;for(let i=e.length;s<i;s++)if(S3(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return b3(e,t)}appendFrame(e,t,n){Ik(e,this.observer,t,n,e.manifestCodec);const s=Ck(e,t,n,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Fk=(r,e)=>{let t=0,n=5;e+=n;const s=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=r[e];const a=Math.min(n,8),l=8-a;i[0]=4278190080>>>24+l<<l,s[0]=(o[0]&i[0])>>l,t=t?t<<a|s[0]:s[0],e+=1,n-=a}return t};class H3 extends wy{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const s=jk(e,t,n,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Xl(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&xy(t)!==void 0&&Fk(e,n)<16}}function jk(r,e,t,n,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+u>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const f=(e[t+6]<<8|e[t+7])>>12-h&1,p=[2,1,2,3,3,4,4,5][d]+f,g=e[t+5]>>3,y=e[t+5]&7,x=new Uint8Array([i<<6|g<<1|y>>2,(y&3)<<6|d<<3|f<<2|l>>4,l<<4&224]),w=1536/a*9e4,b=n+s*w,E=e.subarray(t,t+u);return r.config=x,r.channelCount=p,r.samplerate=a,r.samples.push({unit:E,pts:b}),u}class V3 extends wy{resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Xl(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&xy(t)!==void 0&&Fk(e,n)<=16)return!1;for(let s=e.length;n<s;n++)if(Mk(e,n))return He.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return z3(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return Dk(e,t,n,this.basePTS,this.frameIndex)}}const W3=/\/emsg[-/]ID3/i;class K3{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,s){const i=this.videoTrack=Rn("video",1),o=this.audioTrack=Rn("audio",1),a=this.txtTrack=Rn("text",1);if(this.id3Track=Rn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=qA(e);if(l.video){const{id:c,timescale:u,codec:d,supplemental:h}=l.video;i.id=c,i.timescale=a.timescale=u,i.codec=d,i.supplemental=h}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;o.id=c,o.timescale=u,o.codec=d}a.id=VA.text,i.sampleDuration=0,i.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return HB(e)}demux(e,t){this.timeOffset=t;let n=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Hr(this.remainderData,e));const a=XB(n);this.remainderData=a.remainder,s.samples=a.valid||new Uint8Array}else s.samples=n;const o=this.extractID3Track(s,t);return i.samples=yw(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return n.samples=yw(e,t),{videoTrack:t,audioTrack:Rn(),id3Track:s,textTrack:Rn()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const s=Pe(e.samples,["emsg"]);s&&s.forEach(i=>{const o=ZB(i);if(W3.test(o.schemeIdUri)){const a=eb(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;n.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Er.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=eb(o,t);n.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Er.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function eb(r,e){return fe(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class q3{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new dy(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,oi.cbc)}decryptAacSample(e,t,n){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)n.set(e.subarray(i,i+16),s);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(n.subarray(s,s+16),i);return e}decryptAvcSample(e,t,n,s,i){const o=XA(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,s)}).catch(s)}decryptAvcSamples(e,t,n,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(n>=i.length);n++){const o=i[n];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,n,s,o),!this.decrypter.isSync()))return}}}}class $k{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,s;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const i=n.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,s=n.length;if(s){const i=n[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const s=t.byteLength;let i=e.naluState||0;const o=i,a=[];let l=0,c,u,d,h=-1,f=0;for(i===-1&&(h=0,f=this.getNALuType(t,0),i=0,l=1);l<s;){if(c=t[l++],!i){i=c?0:1;continue}if(i===1){i=c?0:2;continue}if(!c)i=3;else if(c===1){if(u=l-i-1,h>=0){const m={data:t.subarray(h,u),type:f};a.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(o&&l<=4-o&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-o)),u>0&&(m.data=Hr(m.data,t.subarray(0,u)),m.state=0))}l<s?(d=this.getNALuType(t,l),h=l,f=d,i=0):i=-1}else i=0}if(h>=0&&i>=0){const m={data:t.subarray(h,s),type:f,state:i};a.push(m)}if(a.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=Hr(m.data,t))}return e.naluState=i,a}}class ml{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(n,n+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&He.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Y3 extends $k{parsePES(e,t,n,s){const i=this.parseNALu(e,n.data,s);let o=this.VideoSample,a,l=!1;n.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(c=>{var u,d;switch(c.type){case 1:{let p=!1;a=!0;const g=c.data;if(l&&g.length>4){const y=this.readSliceType(g);(y===2||y===4||y===7||y===9)&&(p=!0)}if(p){var h;(h=o)!=null&&h.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.frame=!0,o.key=p;break}case 5:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,ay(c.data,1,n.pts,t.samples);break}case 7:{var f,m;a=!0,l=!0;const p=c.data,g=this.readSPS(p);if(!e.sps||e.width!==g.width||e.height!==g.height||((f=e.pixelRatio)==null?void 0:f[0])!==g.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==g.pixelRatio[1]){e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.sps=[p];const y=p.subarray(1,4);let x="avc1.";for(let w=0;w<3;w++){let b=y[w].toString(16);b.length<2&&(b="0"+b),x+=b}e.codec=x}break}case 8:a=!0,e.pps=[c.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new ml(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,s=8,i;for(let o=0;o<e;o++)s!==0&&(i=t.readEG(),s=(n+i+256)%256),n=s===0?n:s}readSPS(e){const t=new ml(e);let n=0,s=0,i=0,o=0,a,l,c;const u=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),f=t.readBoolean.bind(t),m=t.skipBits.bind(t),p=t.skipEG.bind(t),g=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);u();const x=u();if(d(5),m(3),u(),g(),x===100||x===110||x===122||x===244||x===44||x===83||x===86||x===118||x===128){const C=h();if(C===3&&m(1),g(),g(),m(1),f())for(l=C!==3?8:12,c=0;c<l;c++)f()&&(c<6?y(16,t):y(64,t))}g();const w=h();if(w===0)h();else if(w===1)for(m(1),p(),p(),a=h(),c=0;c<a;c++)p();g(),m(1);const b=h(),E=h(),I=d(1);I===0&&m(1),m(1),f()&&(n=h(),s=h(),i=h(),o=h());let S=[1,1];if(f()&&f())switch(u()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:{S=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((b+1)*16-n*2-s*2),height:(2-I)*(E+1)*16-(I?2:4)*(i+o),pixelRatio:S}}}class Q3 extends $k{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,s){const i=this.parseNALu(e,n.data,s);let o=this.VideoSample,a,l=!1;n.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(c=>{var u,d;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var h;(h=o)!=null&&h.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(u=o)!=null&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,ay(c.data,2,n.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ke(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(c.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in f.params)e.params[m]=f.params[m]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(c.data);for(const m in f)e.params[m]=f[m]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:a=!1;break}o&&a&&o.units.push(c)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[n]=e[s],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new ml(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:s}}readSPS(e){const t=new ml(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),m=t.readUByte(),p=t.readUByte(),g=t.readUByte(),y=t.readUByte(),x=[],w=[];for(let B=0;B<n;B++)x.push(t.readBoolean()),w.push(t.readBoolean());if(n>0)for(let B=n;B<8;B++)t.readBits(2);for(let B=0;B<n;B++)x[B]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),w[B]&&t.readUByte();t.readUEG();const b=t.readUEG();b==3&&t.skipBits(1);const E=t.readUEG(),I=t.readUEG(),S=t.readBoolean();let C=0,R=0,L=0,$=0;S&&(C+=t.readUEG(),R+=t.readUEG(),L+=t.readUEG(),$+=t.readUEG());const P=t.readUEG(),U=t.readUEG(),_=t.readUEG(),H=t.readBoolean();for(let B=H?0:n;B<=n;B++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let N=0;N<4;N++)for(let O=0;O<(N===3?2:6);O++)if(!t.readBoolean())t.readUEG();else{const J=Math.min(64,1<<4+(N<<1));N>1&&t.readEG();for(let re=0;re<J;re++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const j=t.readUEG();let F=0;for(let B=0;B<j;B++){let N=!1;if(B!==0&&(N=t.readBoolean()),N){B===j&&t.readUEG(),t.readBoolean(),t.readUEG();let O=0;for(let W=0;W<=F;W++){const J=t.readBoolean();let re=!1;J||(re=t.readBoolean()),(J||re)&&O++}F=O}else{const O=t.readUEG(),W=t.readUEG();F=O+W;for(let J=0;J<O;J++)t.readUEG(),t.readBoolean();for(let J=0;J<W;J++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const B=t.readUEG();for(let N=0;N<B;N++){for(let O=0;O<_+4;O++)t.readBits(1);t.readBits(1)}}let M=0,D=1,ee=1,Q=!0,te=1,oe=0;t.readBoolean(),t.readBoolean();let ce=!1;if(t.readBoolean()){if(t.readBoolean()){const q=t.readUByte(),se=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ae=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];q>0&&q<16?(D=se[q-1],ee=ae[q-1]):q===255&&(D=t.readBits(16),ee=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ce=t.readBoolean(),ce&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(te=t.readBits(32),oe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const ae=t.readBoolean(),ie=t.readBoolean();let he=!1;(ae||ie)&&(he=t.readBoolean(),he&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),he&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let De=0;De<=n;De++){Q=t.readBoolean();const Ce=Q||t.readBoolean();let _t=!1;Ce?t.readEG():_t=t.readBoolean();const mr=_t?1:t.readUEG()+1;if(ae)for(let Lt=0;Lt<mr;Lt++)t.readUEG(),t.readUEG(),he&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ie)for(let Lt=0;Lt<mr;Lt++)t.readUEG(),t.readUEG(),he&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),M=t.readUEG())}let we=E,Le=I;if(S){let B=1,N=1;b===1?B=N=2:b==2&&(B=2),we=E-B*R-B*C,Le=I-N*$-N*L}const Re=s?["A","B","C"][s]:"",ft=a<<24|l<<16|c<<8|u;let Xe=0;for(let B=0;B<32;B++)Xe=(Xe|(ft>>B&1)<<31-B)>>>0;let k=Xe.toString(16);return o===1&&k==="2"&&(k="6"),{codecString:`hvc1.${Re}${o}.${k}.${i?"H":"L"}${y}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[a,l,c,u],general_constraint_indicator_flags:[d,h,f,m,p,g],general_level_idc:y,bit_depth:P+8,bit_depth_luma_minus8:P,bit_depth_chroma_minus8:U,min_spatial_segmentation_idc:M,chroma_format_idc:b,frame_rate:{fixed:Q,fps:oe/te}},width:we,height:Le,pixelRatio:[D,ee]}}readPPS(e){const t=new ml(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let o=1;return i&&s?o=0:i?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Pt=188;class ks{constructor(e,t,n,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=s,this.videoParser=null}static probe(e,t){const n=ks.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(Pt*5,t-Pt)+1,s=0;for(;s<n;){let i=!1,o=-1,a=0;for(let l=s;l<t;l+=Pt)if(e[l]===71&&(t-l===Pt||e[l+Pt]===71)){if(a++,o===-1&&(o=l,o!==0&&(n=Math.min(o+Pt*99,e.length-Pt)+1)),i||(i=Jm(e,l)===0),i&&a>1&&(o===0&&a>2||l+Pt>n))return o}else{if(a)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:VA[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ks.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=ks.createTrack("audio",s),this._id3Track=ks.createTrack("id3"),this._txtTrack=ks.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,s=!1){n||(this.sampleAes=null);let i;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,d=o.pesData,h=a.pid,f=l.pid,m=a.pesData,p=l.pesData,g=null,y=this.pmtParsed,x=this._pmtId,w=e.length;if(this.remainderData&&(e=Hr(this.remainderData,e),w=e.length,this.remainderData=null),w<Pt&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const b=Math.max(0,ks.syncOffset(e));w-=(w-b)%Pt,w<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,w,e.buffer.byteLength-w));let E=0;for(let S=b;S<w;S+=Pt)if(e[S]===71){const C=!!(e[S+1]&64),R=Jm(e,S),L=(e[S+3]&48)>>4;let $;if(L>1){if($=S+5+e[S+4],$===S+Pt)continue}else $=S+4;switch(R){case u:C&&(d&&(i=yo(d,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,i,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray($,S+Pt)),d.size+=S+Pt-$);break;case h:if(C){if(m&&(i=yo(m,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i);break}m={data:[],size:0}}m&&(m.data.push(e.subarray($,S+Pt)),m.size+=S+Pt-$);break;case f:C&&(p&&(i=yo(p,this.logger))&&this.parseID3PES(l,i),p={data:[],size:0}),p&&(p.data.push(e.subarray($,S+Pt)),p.size+=S+Pt-$);break;case 0:C&&($+=e[$]+1),x=this._pmtId=X3(e,$);break;case x:{C&&($+=e[$]+1);const P=J3(e,$,this.typeSupported,n,this.observer,this.logger);u=P.videoPid,u>0&&(o.pid=u,o.segmentCodec=P.segmentVideoCodec),h=P.audioPid,h>0&&(a.pid=h,a.segmentCodec=P.segmentAudioCodec),f=P.id3Pid,f>0&&(l.pid=f),g!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${S} after unknown PID '${g}'. Backtracking to sync byte @${b} to parse all TS packets.`),g=null,S=b-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=R;break}}else E++;E>0&&Zm(this.observer,new Error(`Found ${E} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=m,l.pesData=p;const I={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return s&&this.extractRemainingSamples(I),I}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:s,textTrack:i}=e,o=n.pesData,a=t.pesData,l=s.pesData;let c;if(o&&(c=yo(o,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,i,c,!0),n.pesData=null)):n.pesData=o,a&&(c=yo(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=yo(l,this.logger))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,n){const s=this.demux(e,n,!0,!this.config.progressive),i=this.sampleAes=new q3(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new Y3:e==="hevc"&&(this.videoParser=new Q3))}decrypt(e,t){return new Promise(n=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{n(e)}):n(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,h=s.sample.unit.byteLength;if(d===-1)i=Hr(s.sample.unit,i);else{const f=h-d;s.sample.unit.set(i.subarray(0,d),f),e.samples.push(s.sample),n=s.missing}}let o,a;for(o=n,a=i.length;o<a-1&&!Vd(i,o);o++);if(o!==n){let d;const h=o<a-1;if(h?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",Zm(this.observer,new Error(d),h,this.logger),!h)return}Ik(e,this.observer,i,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=Rk(e.samplerate);l=s.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;o<a;)if(u=Ck(e,i,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;o<a-1&&!Vd(i,o);o++);}parseMPEGPES(e,t){const n=t.data,s=n.length;let i=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(Nk(n,o)){const l=Dk(e,n,o,a,i);if(l)o+=l.length,i++;else break}else o++}parseAC3PES(e,t){{const n=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=n.length;let o=0,a=0,l;for(;a<i&&(l=jk(e,n,a,s,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=Ke({},t,{type:this._videoTrack?Er.emsg:Er.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Jm(r,e){return((r[e+1]&31)<<8)+r[e+2]}function X3(r,e){return(r[e+10]&31)<<8|r[e+11]}function J3(r,e,t,n,s,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(r[e+1]&15)<<8|r[e+2],l=e+3+a-4,c=(r[e+10]&15)<<8|r[e+11];for(e+=12+c;e<l;){const u=Jm(r,e),d=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!n){Wf("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=u);break;case 21:o.id3Pid===-1&&(o.id3Pid=u);break;case 219:if(!n){Wf("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="mp3");break;case 193:if(!n){Wf("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=u,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let h=e+5,f=d;for(;f>2;){switch(r[h]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=u,o.segmentAudioCodec="ac3");break}const p=r[h+1]+2;h+=p,f-=p}}break;case 194:case 135:return Zm(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=u,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return o}function Zm(r,e,t,n){n.warn(`parsing error: ${e.message}`),r.emit(A.ERROR,A.ERROR,{type:xe.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Wf(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function yo(r,e){let t=0,n,s,i,o,a;const l=r.data;if(!r||r.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Hr(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(s=(n[4]<<8)+n[5],s&&s>r.size-6)return null;const u=n[7];u&192&&(o=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,u&64?(a=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),i=n[8];let d=i+9;if(r.size<=d)return null;r.size-=d;const h=new Uint8Array(r.size);for(let f=0,m=l.length;f<m;f++){n=l[f];let p=n.byteLength;if(d)if(d>p){d-=p;continue}else n=n.subarray(d),p-=d,d=0;h.set(n,t),t+=p}return s&&(s-=i+3),{data:h,pts:o,dts:a,len:s}}return null}class Z3{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const xs=Math.pow(2,32)-1;class X{static init(){X.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in X.types)X.types.hasOwnProperty(e)&&(X.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);X.HDLR_TYPES={video:t,audio:n};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);X.STTS=X.STSC=X.STCO=i,X.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),X.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),X.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),X.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);X.FTYP=X.box(X.types.ftyp,o,l,o,a),X.DINF=X.box(X.types.dinf,X.box(X.types.dref,s))}static box(e,...t){let n=8,s=t.length;const i=s;for(;s--;)n+=t[s].byteLength;const o=new Uint8Array(n);for(o[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=n&255,o.set(e,4),s=0,n=8;s<i;s++)o.set(t[s],n),n+=t[s].byteLength;return o}static hdlr(e){return X.box(X.types.hdlr,X.HDLR_TYPES[e])}static mdat(e){return X.box(X.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(xs+1)),s=Math.floor(t%(xs+1));return X.box(X.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return X.box(X.types.mdia,X.mdhd(e.timescale||0,e.duration||0),X.hdlr(e.type),X.minf(e))}static mfhd(e){return X.box(X.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?X.box(X.types.minf,X.box(X.types.smhd,X.SMHD),X.DINF,X.stbl(e)):X.box(X.types.minf,X.box(X.types.vmhd,X.VMHD),X.DINF,X.stbl(e))}static moof(e,t,n){return X.box(X.types.moof,X.mfhd(e),X.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=X.trak(e[t]);return X.box.apply(null,[X.types.moov,X.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(X.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=X.trex(e[t]);return X.box.apply(null,[X.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(xs+1)),s=Math.floor(t%(xs+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return X.box(X.types.mvhd,i)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,n[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return X.box(X.types.sdtp,n)}static stbl(e){return X.box(X.types.stbl,X.stsd(e),X.box(X.types.stts,X.STTS),X.box(X.types.stsc,X.STSC),X.box(X.types.stsz,X.STSZ),X.box(X.types.stco,X.STCO))}static avc1(e){let t=[],n=[],s,i,o;for(s=0;s<e.sps.length;s++)i=e.sps[s],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],o=i.byteLength,n.push(o>>>8&255),n.push(o&255),n=n.concat(Array.prototype.slice.call(i));const a=X.box(X.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return X.box(X.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,X.box(X.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),X.box(X.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return X.box(X.types.mp4a,X.audioStsd(e),X.box(X.types.esds,X.esds(e)))}static mp3(e){return X.box(X.types[".mp3"],X.audioStsd(e))}static ac3(e){return X.box(X.types["ac-3"],X.audioStsd(e),X.box(X.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return X.box(X.types.stsd,X.STSD,X.mp4a(e));if(t==="ac3"&&e.config)return X.box(X.types.stsd,X.STSD,X.ac3(e));if(t==="mp3"&&e.codec==="mp3")return X.box(X.types.stsd,X.STSD,X.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return X.box(X.types.stsd,X.STSD,X.avc1(e));if(t==="hevc"&&e.vps)return X.box(X.types.stsd,X.STSD,X.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,o=Math.floor(n/(xs+1)),a=Math.floor(n%(xs+1));return X.box(X.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const n=X.sdtp(e),s=e.id,i=Math.floor(t/(xs+1)),o=Math.floor(t%(xs+1));return X.box(X.types.traf,X.box(X.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),X.box(X.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),X.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,X.box(X.types.trak,X.tkhd(e),X.mdia(e))}static trex(e){const t=e.id;return X.box(X.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],s=n.length,i=12+16*s,o=new Uint8Array(i);let a,l,c,u,d,h;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<s;a++)l=n[a],c=l.duration,u=l.size,d=l.flags,h=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*a);return X.box(X.types.trun,o)}static initSegment(e){X.types||X.init();const t=X.moov(e);return Hr(X.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let o=i.length;for(let m=0;m<n.length;m+=1){o+=3;for(let p=0;p<n[m].length;p+=1)o+=2+n[m][p].length}const a=new Uint8Array(o);a.set(i,0),o=i.length;const l=n.length-1;for(let m=0;m<n.length;m+=1){a.set(new Uint8Array([32+m|(m===l?128:0),0,n[m].length]),o),o+=3;for(let p=0;p<n[m].length;p+=1)a.set(new Uint8Array([n[m][p].length>>8,n[m][p].length&255]),o),o+=2,a.set(n[m][p],o),o+=n[m][p].length}const c=X.box(X.types.hvcC,a),u=e.width,d=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return X.box(X.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,X.box(X.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),X.box(X.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}}X.types=void 0;X.HDLR_TYPES=void 0;X.STTS=void 0;X.STSC=void 0;X.STCO=void 0;X.STSZ=void 0;X.VMHD=void 0;X.SMHD=void 0;X.STSD=void 0;X.FTYP=void 0;X.DINF=void 0;const Bk=9e4;function Sy(r,e,t=1,n=!1){const s=r*e*t;return n?Math.round(s):s}function e4(r,e,t=1,n=!1){return Sy(r,e,1/t,n)}function Ka(r,e=!1){return Sy(r,1e3,1/Bk,e)}function t4(r,e=1){return Sy(r,Bk,1/e)}function tb(r){const{baseTime:e,timescale:t,trackId:n}=r;return`${e/t} (${e}/${t}) trackId: ${n}`}const r4=10*1e3,n4=1024,s4=1152,i4=1536;let vo=null,Kf=null;function rb(r,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class Wu extends Kr{constructor(e,t,n,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,vo===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);vo=o?parseInt(o[1]):0}if(Kf===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Kf=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&tb(t)} > ${e&&tb(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,s=e.reduce((i,o)=>{let a=o.pts,l=a-i;return l<-4294967296&&(t=!0,a=wr(a,n),l=a-i),l>0?i:a},n);return t&&this.debug("PTS rollover detected"),s}remux(e,t,n,s,i,o,a,l){let c,u,d,h,f,m,p=i,g=i;const y=e.pid>-1,x=t.pid>-1,w=t.samples.length,b=e.samples.length>0,E=a&&w>0||w>1;if((!y||b)&&(!x||E)||this.ISGenerated||a){if(this.ISGenerated){var S,C,R,L;const _=this.videoTrackConfig;(_&&(t.width!==_.width||t.height!==_.height||((S=t.pixelRatio)==null?void 0:S[0])!==((C=_.pixelRatio)==null?void 0:C[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((L=_.pixelRatio)==null?void 0:L[1]))||!_&&E||this.nextAudioTs===null&&b)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,o));const $=this.isVideoContiguous;let P=-1,U;if(E&&(P=o4(t.samples),!$&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,P>0){this.warn(`Dropped ${P} out of ${w} video samples due to a missing keyframe`);const _=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(P),t.dropped+=P,g+=(t.samples[0].pts-_)/t.inputTimeScale,U=g}else P===-1&&(this.warn(`No keyframe found out of ${w} video samples`),m=!1);if(this.ISGenerated){if(b&&E){const _=this.getVideoStartPts(t.samples),V=(wr(e.samples[0].pts,_)-_)/t.inputTimeScale;p+=Math.max(0,V),g+=Math.max(0,-V)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,o)),u=this.remuxAudio(e,p,this.isAudioContiguous,o,x||E||l===me.AUDIO?g:void 0),E){const _=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,o)),c=this.remuxVideo(t,g,$,_)}}else E&&(c=this.remuxVideo(t,g,$,0));c&&(c.firstKeyFrame=P,c.independent=P!==-1,c.firstKeyFramePTS=U)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(f=Uk(n,i,this._initPTS,this._initDTS)),s.samples.length&&(h=zk(s,i,this._initPTS))),{audio:u,video:c,initSegment:d,independent:m,text:h,id3:f}}computeInitPts(e,t,n,s){const i=Math.round(n*t);let o=wr(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${s}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,n,s){const i=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let u=!c||s,d="audio/mp4",h,f,m,p=-1;if(u&&(h=f=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):X.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(p=e.id,m=e.inputTimeScale,!c||m!==c.timescale?h=f=this.computeInitPts(i[0].pts,m,n,"audio"):u=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:X.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(p=t.id,m=t.inputTimeScale,!c||m!==c.timescale){const g=this.getVideoStartPts(o),y=wr(o[0].dts,g),x=this.computeInitPts(y,m,n,"video"),w=this.computeInitPts(g,m,n,"video");f=Math.min(f,x),h=Math.min(h,w)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${n} ${h/m} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${h/m} (${h}/${m}) trackId: ${p}`),this._initPTS={baseTime:h,timescale:m,trackId:p},this._initDTS={baseTime:f,timescale:m,trackId:p}):h=m=void 0,{tracks:l,initPTS:h,timescale:m,trackId:p}}remuxVideo(e,t,n,s){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS,u=c.baseTime*i/c.timescale;let d=this.nextVideoTs,h=8,f=this.videoSampleDuration,m,p,g=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,x=!1;if(!n||d===null){const M=u+t*i,D=o[0].pts-wr(o[0].dts,o[0].pts);vo&&d!==null&&Math.abs(M-D-(d+u))<15e3?n=!0:d=M-D-u}const w=d+u;for(let M=0;M<l;M++){const D=o[M];D.pts=wr(D.pts,w),D.dts=wr(D.dts,w),D.dts<o[M>0?M-1:M].dts&&(x=!0)}x&&o.sort(function(M,D){const ee=M.dts-D.dts,Q=M.pts-D.pts;return ee||Q}),m=o[0].dts,p=o[o.length-1].dts;const b=p-m,E=b?Math.round(b/(l-1)):f||e.inputTimeScale/30;if(n){const M=m-w,D=M>E,ee=M<-1;if((D||ee)&&(D?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ka(M,!0)} ms (${M}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ka(-M,!0)} ms (${M}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ee||w>=o[0].pts||vo)){m=w;const Q=o[0].pts-M;if(D)o[0].dts=m,o[0].pts=Q;else{let te=!0;for(let oe=0;oe<o.length&&!(o[oe].dts>Q&&te);oe++){const ce=o[oe].pts;if(o[oe].dts-=M,o[oe].pts-=M,oe<o.length-1){const de=o[oe+1].pts,we=o[oe].pts,Le=de<=we,Re=de<=ce;te=Le==Re}}}this.log(`Video: Initial PTS/DTS adjusted: ${Ka(Q,!0)}/${Ka(m,!0)}, delta: ${Ka(M,!0)} ms`)}}m=Math.max(0,m);let I=0,S=0,C=m;for(let M=0;M<l;M++){const D=o[M],ee=D.units,Q=ee.length;let te=0;for(let oe=0;oe<Q;oe++)te+=ee[oe].data.length;S+=te,I+=Q,D.length=te,D.dts<C?(D.dts=C,C+=E/4|0||1):C=D.dts,g=Math.min(D.pts,g),y=Math.max(D.pts,y)}p=o[l-1].dts;const R=S+4*I+8;let L;try{L=new Uint8Array(R)}catch(M){this.observer.emit(A.ERROR,A.ERROR,{type:xe.MUX_ERROR,details:Z.REMUX_ALLOC_ERROR,fatal:!1,error:M,bytes:R,reason:`fail allocating video mdat ${R}`});return}const $=new DataView(L.buffer);$.setUint32(0,R),L.set(X.types.mdat,4);let P=!1,U=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,V=Number.NEGATIVE_INFINITY;for(let M=0;M<l;M++){const D=o[M],ee=D.units;let Q=0;for(let ce=0,de=ee.length;ce<de;ce++){const we=ee[ce],Le=we.data,Re=we.data.byteLength;$.setUint32(h,Re),h+=4,L.set(Le,h),h+=Re,Q+=4+Re}let te;if(M<l-1)f=o[M+1].dts-D.dts,te=o[M+1].pts-D.pts;else{const ce=this.config,de=M>0?D.dts-o[M-1].dts:E;if(te=M>0?D.pts-o[M-1].pts:E,ce.stretchShortVideoTrack&&this.nextAudioTs!==null){const we=Math.floor(ce.maxBufferHole*i),Le=(s?g+s*i:this.nextAudioTs+u)-D.pts;Le>we?(f=Le-de,f<0?f=de:P=!0,this.log(`It is approximately ${Le/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=de}else f=de}const oe=Math.round(D.pts-D.dts);U=Math.min(U,f),H=Math.max(H,f),_=Math.min(_,te),V=Math.max(V,te),a.push(rb(D.key,f,Q,oe))}if(a.length){if(vo){if(vo<70){const M=a[0].flags;M.dependsOn=2,M.isNonSync=0}}else if(Kf&&V-_<H-U&&E/H<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let M=m;for(let D=0,ee=a.length;D<ee;D++){const Q=M+a[D].duration,te=M+a[D].cts;if(D<ee-1){const oe=Q+a[D+1].cts;a[D].duration=oe-te}else a[D].duration=D?a[D-1].duration:E;a[D].cts=0,M=Q}}}f=P||!f?E:f;const G=p+f;this.nextVideoTs=d=G-u,this.videoSampleDuration=f,this.isVideoContiguous=!0;const Y={data1:X.moof(e.sequenceNumber++,m,Ke(e,{samples:a})),data2:L,startPTS:(g-u)/i,endPTS:(y+f-u)/i,startDTS:(m-u)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Y}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return s4;case"ac3":return i4;default:return n4}}remuxAudio(e,t,n,s,i){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),u=c*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],m=i!==void 0;let p=e.samples,g=h?0:8,y=this.nextAudioTs||-1;const x=d.baseTime*o/d.timescale,w=x+t*o;if(this.isAudioContiguous=n=n||p.length&&y>0&&(s&&Math.abs(w-(y+x))<9e3||Math.abs(wr(p[0].pts,w)-(y+x))<20*u),p.forEach(function(V){V.pts=wr(V.pts,w)}),!n||y<0){const V=p.length;if(p=p.filter(G=>G.pts>=0),V!==p.length&&this.warn(`Removed ${p.length-V} of ${V} samples (initPTS ${x} / ${o})`),!p.length)return;i===0?y=0:s&&!m?y=Math.max(0,w-x):y=p[0].pts-x}if(e.segmentCodec==="aac"){const V=this.config.maxAudioFramesDrift;for(let G=0,j=y+x;G<p.length;G++){const F=p[G],Y=F.pts,M=Y-j,D=Math.abs(1e3*M/o);if(M<=-V*u&&m)G===0&&(this.warn(`Audio frame @ ${(Y/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*M/o)} ms.`),this.nextAudioTs=y=Y-x,j=Y);else if(M>=V*u&&D<r4&&m){let ee=Math.round(M/u);for(j=Y-ee*u;j<0&&ee&&u;)ee--,j+=u;G===0&&(this.nextAudioTs=y=j-x),this.warn(`Injecting ${ee} audio frames @ ${((j-x)/o).toFixed(3)}s due to ${Math.round(1e3*M/o)} ms gap.`);for(let Q=0;Q<ee;Q++){let te=Z3.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);te||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),te=F.unit.subarray()),p.splice(G,0,{unit:te,pts:j}),j+=u,G++}}F.pts=j,j+=u}}let b=null,E=null,I,S=0,C=p.length;for(;C--;)S+=p[C].unit.byteLength;for(let V=0,G=p.length;V<G;V++){const j=p[V],F=j.unit;let Y=j.pts;if(E!==null){const D=f[V-1];D.duration=Math.round((Y-E)/l)}else if(n&&e.segmentCodec==="aac"&&(Y=y+x),b=Y,S>0){S+=g;try{I=new Uint8Array(S)}catch(D){this.observer.emit(A.ERROR,A.ERROR,{type:xe.MUX_ERROR,details:Z.REMUX_ALLOC_ERROR,fatal:!1,error:D,bytes:S,reason:`fail allocating audio mdat ${S}`});return}h||(new DataView(I.buffer).setUint32(0,S),I.set(X.types.mdat,4))}else return;I.set(F,g);const M=F.byteLength;g+=M,f.push(rb(!0,c,M,0)),E=Y}const R=f.length;if(!R)return;const L=f[f.length-1];y=E-x,this.nextAudioTs=y+l*L.duration;const $=h?new Uint8Array(0):X.moof(e.sequenceNumber++,b/l,Ke({},e,{samples:f}));e.samples=[];const P=(b-x)/o,U=y/o,H={data1:$,data2:I,startPTS:P,endPTS:U,startDTS:P,endDTS:U,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,H}}function wr(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function o4(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function Uk(r,e,t,n){const s=r.samples.length;if(!s)return;const i=r.inputTimeScale;for(let a=0;a<s;a++){const l=r.samples[a];l.pts=wr(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=wr(l.dts-n.baseTime*i/n.timescale,e*i)/i}const o=r.samples;return r.samples=[],{samples:o}}function zk(r,e,t){const n=r.samples.length;if(!n)return;const s=r.inputTimeScale;for(let o=0;o<n;o++){const a=r.samples[o];a.pts=wr(a.pts-t.baseTime*s/t.timescale,e*s)/s}r.samples.sort((o,a)=>o.pts-a.pts);const i=r.samples;return r.samples=[],{samples:i}}class a4 extends Kr{constructor(e,t,n,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,s){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=qA(e);if(t)qB(e,t);else{const l=i||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(n=nb(i,Ye.AUDIO,this)),o&&(s=nb(o,Ye.VIDEO,this));const a={};i&&o?a.audiovideo={container:"video/mp4",codec:n+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?a.audio={container:"audio/mp4",codec:n,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,s,i,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};fe(u)||(u=this.lastEndTime=i||0);const h=t.samples;if(!h.length)return d;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let m=this.initData;if((a=m)!=null&&a.length||(this.generateInitSegment(h),m=this.initData),!((l=m)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const p=QB(h,m,this),g=m.audio?p[m.audio.id]:null,y=m.video?p[m.video.id]:null,x=pu(y,1/0),w=pu(g,1/0),b=pu(y,0,!0),E=pu(g,0,!0);let I=i,S=0;const C=g&&(!y||!c&&w<x||c&&c.trackId===m.audio.id),R=C?g:y;if(R){const j=R.timescale,F=R.start-i*j,Y=C?m.audio.id:m.video.id;I=R.start/j,S=C?E-w:b-x,(o||!c)&&(l4(c,I,i,S)||j!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${F/j} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${I-i} (${F}/${j}) trackId: ${Y}`),c=null,f.initPTS=F,f.timescale=j,f.trackId=Y)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);c?(f.initPTS=c.baseTime,f.timescale=c.timescale,f.trackId=c.trackId):((!f.timescale||f.trackId===void 0||f.initPTS===void 0)&&(this.warn("Could not set initPTS"),f.initPTS=I,f.timescale=1,f.trackId=-1),this.initPTS=c={baseTime:f.initPTS,timescale:f.timescale,trackId:f.trackId});const L=I-c.baseTime/c.timescale,$=L+S;S>0?this.lastEndTime=$:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const P=!!m.audio,U=!!m.video;let _="";P&&(_+="audio"),U&&(_+="video");const H=(m.audio?m.audio.encrypted:!1)||(m.video?m.video.encrypted:!1),V={data1:h,startPTS:L,startDTS:L,endPTS:$,endDTS:$,type:_,hasAudio:P,hasVideo:U,nb:1,dropped:0,encrypted:H};d.audio=P&&!U?V:void 0,d.video=U?V:void 0;const G=y==null?void 0:y.sampleCount;if(G){const j=y.keyFrameIndex,F=j!==-1;V.nb=G,V.dropped=j===0||this.isVideoContiguous?0:F?j:G,V.independent=F,V.firstKeyFrame=j,F&&y.keyFrameStart&&(V.firstKeyFramePTS=(y.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(d.independent=F),this.isVideoContiguous||(this.isVideoContiguous=F),V.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${j}/${G} dropped: ${V.dropped} start: ${V.firstKeyFramePTS||"NA"}`)}return d.initSegment=f,d.id3=Uk(n,i,c,c),s.samples.length&&(d.text=zk(s,i,c)),d}}function pu(r,e,t=!1){return(r==null?void 0:r.start)!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function l4(r,e,t,n){if(r===null)return!0;const s=Math.max(n,1),i=e-r.baseTime/r.timescale;return Math.abs(i-t)>s}function nb(r,e,t){const n=r.codec;return n&&n.length>4?n:e===Ye.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?Fd(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Jn;try{Jn=self.performance.now.bind(self.performance)}catch{Jn=Date.now}const Ku=[{demux:K3,remux:a4},{demux:ks,remux:Wu},{demux:G3,remux:Wu},{demux:V3,remux:Wu}];Ku.splice(2,0,{demux:H3,remux:Wu});class sb{constructor(e,t,n,s,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,s){const i=n.transmuxing;i.executeStart=Jn();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:m}=s||a,{audioCodec:p,videoCodec:g,defaultInitPts:y,duration:x,initSegmentData:w}=l,b=c4(o,t);if(b&&Xo(b.method)){const C=this.getDecrypter(),R=fy(b.method);if(C.isSync()){let L=C.softwareDecrypt(o,b.key.buffer,b.iv.buffer,R);if(n.part>-1){const P=C.flush();L=P&&P.buffer}if(!L)return i.executeEnd=Jn(),qf(n);o=new Uint8Array(L)}else return this.asyncResult=!0,this.decryptionPromise=C.webCryptoDecrypt(o,b.key.buffer,b.iv.buffer,R).then(L=>{const $=this.push(L,null,n);return this.decryptionPromise=null,$}),this.decryptionPromise}const E=this.needsProbing(u,d);if(E){const C=this.configureTransmuxer(o);if(C)return this.logger.warn(`[transmuxer] ${C.message}`),this.observer.emit(A.ERROR,A.ERROR,{type:xe.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message}),i.executeEnd=Jn(),qf(n)}(u||d||m||E)&&this.resetInitSegment(w,p,g,x,t),(u||m||E)&&this.resetInitialTimestamp(y),c||this.resetContiguity();const I=this.transmux(o,b,f,h,n);this.asyncResult=Jl(I);const S=this.currentTransmuxState;return S.contiguous=!0,S.discontinuity=!1,S.trackSwitch=!1,i.executeEnd=Jn(),I}flush(e){const t=e.transmuxing;t.executeStart=Jn();const{decrypter:n,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:a}=s;if(n){const d=n.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=Jn();const d=[qf(e)];return this.asyncResult?Promise.resolve(d):d}const u=l.flush(a);return Jl(u)?(this.asyncResult=!0,u.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,u,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,n){const{audioTrack:s,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===me.MAIN?"level":"track"} ${n.level}`);const u=this.remuxer.remux(s,i,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=Jn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,s,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,n,s),a.resetInitSegment(e,t,n,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,s,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,n,s,i):o=this.transmuxUnencrypted(e,n,s,i),o}transmuxUnencrypted(e,t,n,s){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,n,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,n,s,i){return this.demuxer.demuxSampleAes(e,t,n).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,n,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:s}=this;let i;for(let d=0,h=Ku.length;d<h;d++){var o;if((o=Ku[d].demux)!=null&&o.probe(e,this.logger)){i=Ku[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=i.remux,u=i.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(n,t,s,this.logger)),(!a||!(a instanceof u))&&(this.demuxer=new u(n,t,s,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new dy(this.config)),e}}function c4(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const qf=r=>({remuxResult:{},chunkMeta:r});function Jl(r){return"then"in r&&r.then instanceof Function}class u4{constructor(e,t,n,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=s,this.defaultInitPts=i||null}}class d4{constructor(e,t,n,s,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=o}}let ib=0;class Gk{constructor(e,t,n,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ib++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=n,this.onFlush=s;const o=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===A.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new gy,this.observer.on(A.FRAG_DECRYPTED,o),this.observer.on(A.ERROR,o);const a=ww(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||m3()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=y3(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=g3());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:Qe(i)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new sb(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new sb(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ib++;const t=this.hls.config,n=ww(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:Qe(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),v3(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,s,i,o,a,l,c,u){var d,h;c.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:m}=this,p=o?o.start:i.start,g=i.decryptdata,y=this.frag,x=!(y&&i.cc===y.cc),w=!(y&&c.level===y.level),b=y?c.sn-y.sn:-1,E=this.part?c.part-this.part.index:-1,I=b===0&&c.id>1&&c.id===(y==null?void 0:y.stats.chunkCount),S=!w&&(b===1||b===0&&(E===1||I&&E<=0)),C=self.performance.now();(w||b||i.stats.parsing.start===0)&&(i.stats.parsing.start=C),o&&(E||!S)&&(o.stats.parsing.start=C);const R=!(y&&((d=i.initSegment)==null?void 0:d.url)===((h=y.initSegment)==null?void 0:h.url)),L=new d4(x,S,l,w,p,R);if(!S||x||R){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===me.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${x}
        trackSwitch: ${w}
        contiguous: ${S}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${R}`);const $=new u4(n,s,t,a,u);this.configureTransmuxer($)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:g,chunkMeta:c,state:L},e instanceof ArrayBuffer?[e]:[]);else if(m){const $=m.push(e,g,c,L);Jl($)?$.then(P=>{this.handleTransmuxComplete(P)}).catch(P=>{this.transmuxerError(P,c,"transmuxer-interface push error")}):this.handleTransmuxComplete($)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const s=n.flush(e);Jl(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const ob=100;class h4 extends my{constructor(e,t,n){super(e,t,n,"audio-stream-controller",me.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:i,trackId:o}){if(n===me.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:s,timescale:i,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${s/i} (${s}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===ne.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===ne.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const s=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const i=(s||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=ik(o,i,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===ne.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ne.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(ob),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=ne.IDLE):this.state=ne.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ne.IDLE:this.doTickIdle();break;case ne.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(s))break;this.state=ne.WAITING_INIT_PTS}break}case ne.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ne.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:s,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ne.FRAG_LOADING;const a=s.flush().buffer,l={frag:t,part:n,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=ne.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:s,trackId:i}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(n!=null&&n[i]))return;const a=n[i],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=ne.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Ye.AUDIO,me.AUDIO));const u=this.getFwdBufferInfo(c,me.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(A.BUFFER_EOS,{type:"audio"}),this.state=ne.ENDED;return}const d=u.len,h=t.maxBufferLength,f=l.fragments,m=f[0].start,p=this.getLoadPosition(),g=this.flushing?p:u.end;if(this.switchingTrack&&s){const w=p;l.PTSKnown&&w<m&&(u.end>m||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=m+.05)}if(d>=h&&!this.switchingTrack&&g<f[f.length-1].start)return;let y=this.getNextFragment(g,l);if(y&&this.isLoopLoading(y,g)&&(y=this.getNextFragmentLoopLoading(y,l,u,me.MAIN,h)),!y){this.bufferFlushed=!0;return}let x=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&x&&St(y)&&!y.endList&&(!l.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(x)===Rt.OK&&(this.mainFragLoading=x=null),x&&St(x))){if(y.start>x.end){const b=this.fragmentTracker.getFragAtPos(g,me.MAIN);b&&b.end>x.end&&(x=b,this.mainFragLoading={frag:b,targetBufferTime:null})}if(y.start>x.end)return}this.loadFragment(y,a,g)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Yl(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ne.STOPPED&&(this.setInterval(ob),this.state=ne.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(A.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:s}=this,{details:i,id:o,groupId:a,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const c=this.mainDetails;if(!c||i.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==ne.STOPPED&&(this.state=ne.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const u=s[o];let d=0;if(i.live||(n=u.details)!=null&&n.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(u.details){var h;d=this.alignPlaylists(i,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}i.alignedSliding||(Ek(i,c),i.alignedSliding||Hd(i,c),d=i.fragmentStart)}u.details=i,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(A.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===ne.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=ne.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const d=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Gk(this.hls,me.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[n.cc],m=(t=n.initSegment)==null?void 0:t.data;if(f!==void 0){const g=s?s.index:-1,y=g!==-1,x=new hy(n.level,n.sn,n.stats.chunkCount,i.byteLength,g,y);h.push(i,m,d,"",n,s,u.totalduration,!1,x,f)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:p}=this.waitingData=this.waitingData||{frag:n,part:s,cache:new Tk,complete:!1};p.push(new Uint8Array(i)),this.state!==ne.STOPPED&&(this.state=ne.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===me.MAIN&&St(t.frag)&&(this.mainFragLoading=t,this.state===ne.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:s}=t;if(n.type!==me.AUDIO){!this.audioOnly&&n.type===me.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(St(n)){this.fragPrevious=n;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(A.AUDIO_TRACK_SWITCHED,Ge({},i)))}this.fragBufferedComplete(n,s),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=ne.ERROR;return}switch(t.details){case Z.FRAG_GAP:case Z.FRAG_PARSING_ERROR:case Z.FRAG_DECRYPT_ERROR:case Z.FRAG_LOAD_ERROR:case Z.FRAG_LOAD_TIMEOUT:case Z.KEY_LOAD_ERROR:case Z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.AUDIO,t);break;case Z.AUDIO_TRACK_LOAD_ERROR:case Z.AUDIO_TRACK_LOAD_TIMEOUT:case Z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ne.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Ne.AUDIO_TRACK&&(this.state=ne.IDLE);break;case Z.BUFFER_ADD_CODEC_ERROR:case Z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ye.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ye.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ne.ENDED&&(this.state=ne.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,me.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:s}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{details:d}=u,{audio:h,text:f,id3:m,initSegment:p}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=ne.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const g=l.initSegment||l;if(this.unhandledEncryptionError(p,l))return;this._bufferInitSegment(u,p.tracks,g,o),s.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:n,tracks:p.tracks})}if(h){const{startPTS:g,endPTS:y,startDTS:x,endDTS:w}=h;c&&(c.elementaryStreams[Ye.AUDIO]={startPTS:g,endPTS:y,startDTS:x,endDTS:w}),l.setElementaryStreamInfo(Ye.AUDIO,g,y,x,w),this.bufferFragmentData(h,l,c,o)}if(m!=null&&(t=m.samples)!=null&&t.length){const g=Ke({id:n,frag:l,details:d},m);s.trigger(A.FRAG_PARSING_METADATA,g)}if(f){const g=Ke({id:n,frag:l,details:d},f);s.trigger(A.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,t,n,s){if(this.state!==ne.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=me.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(A.BUFFER_CODECS,t);const a=i.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:n,part:null,chunkMeta:s,parent:n.type,data:a};this.hls.trigger(A.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===Rt.NOT_LOADED||s===Rt.PARTIAL){var i;if(!St(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ne.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Hd(t.details,o)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:s,characteristics:i,audioCodec:o,channels:a}=this.bufferedTrack;Bi({name:t,lang:n,assocLang:s,characteristics:i,audioCodec:o,channels:a},e,bi)||($d(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(A.AUDIO_TRACK_SWITCHED,Ge({},e))}}class Ey extends Kr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let o=0;o<s.length;o++){const a=s[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){i=o;break}else l===e.substring(0,l.length)&&(i=o)}if(i!==-1){const o=s[i],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=n&&bw(n);return new Sw(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:s,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;s.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const u=Math.max(l||0,0);s.appliedTimelineOffset=u,s.fragments.forEach(d=>{d.setStart(d.playlistOffset+u)})}if(s.live||n!=null&&n.live){const u="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(n),n&&s.fragments.length>0){s3(n,s,this);const x=s.playlistParsingError;if(x){this.warn(x);const w=this.hls;if(!w.config.ignorePlaylistParsingErrors){var c;const{networkDetails:b}=t;w.trigger(A.ERROR,{type:xe.NETWORK_ERROR,details:Z.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:x,reason:x.message,level:t.level||void 0,parent:(c=s.fragments[0])==null?void 0:c.type,networkDetails:b,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,f=(s.edge-h)*1e3,m=vk(s,f);if(s.requestScheduled+m<o?s.requestScheduled=o:s.requestScheduled+=m,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let p,g,y;if(s.canBlockReload&&s.endSN&&s.advanced){const x=this.hls.config.lowLatencyMode,w=s.lastPartSn,b=s.endSN,E=s.lastPartIndex,I=E!==-1,S=w===b;I?S?(g=b+1,y=x?0:E):(g=w,y=x?E+1:s.maxPartIndex):g=b+1;const C=s.age,R=C+s.ageHeader;let L=Math.min(R-s.partTarget,s.targetduration*1.5);if(L>0){if(R>s.targetduration*3)this.log(`Playlist last advanced ${C.toFixed(2)}s ago. Omitting segment and part directives.`),g=void 0,y=void 0;else if(n!=null&&n.tuneInGoal&&R-s.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${L} with playlist age: ${s.age}`),L=0;else{const $=Math.floor(L/s.targetduration);if(g+=$,y!==void 0){const P=Math.round(L%s.targetduration/s.partTarget);y+=P}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${C.toFixed(2)}s goal: ${L} skip sn ${$} to part ${y}`)}s.tuneInGoal=L}if(p=this.getDeliveryDirectives(s,t.deliveryDirectives,g,y),x||!S){s.requestScheduled=o,this.loadingPlaylist(u,p);return}}else(s.canBlockReload||s.canSkipUntil)&&(p=this.getDeliveryDirectives(s,t.deliveryDirectives,g,y));p&&g!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(m-a*2,m/2)),this.scheduleLoading(u,p,s)}else this.clearTimer()}scheduleLoading(e,t,n){const s=n||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=s.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const a=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,n,s){let i=bw(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,s=t.part,i=Hu.No),new Sw(n,s,i)}checkRetry(e){const t=e.details,n=Bd(e),s=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=s||{},l=!!s&&!!a&&(i===Ft.RetryRequest||!s.resolved&&i===Ft.SendAlternateToPenaltyBox);if(l){var c;if(o>=a.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=uy(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function Hk(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Zl(r[t].attrs,e[t].attrs))return!1;return!0}function Zl(r,e,t){const n=r["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>r[s]!==e[s])}function eg(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class f4 extends Ey{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:s,details:i}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==s){this.warn(`Audio track with id:${n} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${n} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!n||n.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,f)=>{h.id=f});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!i&&l){const h=Pn(l,a,bi);if(h>-1)i=a[h];else{const f=Pn(l,this.tracks);i=this.tracks[f]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(A.AUDIO_TRACKS_UPDATED,u);const d=this.trackId;if(c!==-1&&d===-1)this.setAudioTrack(c);else if(a.length&&d===-1){var o;const h=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(h.message),this.hls.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ne.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const s=this.currentTrack;if(s&&Bi(e,s,bi))return s;const i=Pn(e,this.tracksInGroup,bi);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=_U(e,t.levels,n,o,bi);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Pn(e,n);if(o>-1)return n[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===n&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(A.AUDIO_TRACK_SWITCHING,Ge({},s)),i))return;const o=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Bi(e,s,bi)))return n}if(e){const{name:n,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(Bi({name:n,lang:s,assocLang:i,characteristics:o,audioCodec:a,channels:l},u,bi))return c}for(let c=0;c<t.length;c++){const u=t[c];if(Zl(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(Zl(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&$d(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(A.AUDIO_TRACK_LOADING,{url:i,id:n,groupId:s,deliveryDirectives:t||null,track:e})}}class p4{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var n;if(s.onError(i),this.queues===null||this.tracks===null)return;const o=(n=this.tracks[e])==null?void 0:n.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],s=n==null?void 0:n.buffer;return s?`SourceBuffer${s.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const ab=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Vk="HlsJsTrackRemovedError";class m4 extends Error{constructor(e){super(e),this.name=Vk}}class g4 extends Kr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:s,mediaSource:i}=this;n&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(A.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:s}=this;n!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=jB(ii(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_APPENDING,this.onBufferAppending,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.BUFFER_EOS,this.onBufferEos,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.FRAG_PARSED,this.onFragParsed,this),e.on(A.FRAG_CHANGED,this.onFragChanged,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_APPENDING,this.onBufferAppending,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_EOS,this.onBufferEos,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.FRAG_PARSED,this.onFragParsed,this),e.off(A.FRAG_CHANGED,this.onFragChanged,this),e.off(A.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?Ke(n,s.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(n[o]=Ke({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const s=ii(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),i)this._objectUrl=n.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{n.removeAttribute("src");const l=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||l&&o instanceof l,lb(n),y4(n,a),n.load()}catch{n.src=a}else n.src=a}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,s=t.tracks,i=s?Object.keys(s):null,o=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Qe(n,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${Qe(s,(l,c)=>l==="initSegment"?void 0:c)}}`),!UA(s,n)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(n)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(A.MEDIA_DETACHING,{}),this.onMediaAttaching(A.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,i.forEach(l=>{const c=l,u=s[c];if(u){const d=u.buffer;if(d){const h=this.fragmentTracker,f=u.id;if(h.hasFragments(f)||h.hasParts(f)){const g=_e.getBuffered(d);h.detectEvictedFragments(c,g,f,null,!0)}const m=Yf(c),p=[c,d];this.sourceBuffers[m]=p,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=i.readyState==="open";try{const l=i.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),i.removeSourceBuffer(l[c]);a&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),n||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&lb(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(A.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Yf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new p4(this.tracks)}onBufferCodecs(e,t){var n;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&i.some(l=>!s[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var c,u;const d=t[l],{id:h,codec:f,levelCodec:m,container:p,metadata:g,supplemental:y}=d;let x=s[l];const w=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[l],b=w!=null&&w.buffer?w:x,E=(b==null?void 0:b.pendingCodec)||(b==null?void 0:b.codec),I=b==null?void 0:b.levelCodec;x||(x=s[l]={buffer:void 0,listeners:[],codec:f,supplemental:y,container:p,levelCodec:m,metadata:g,id:h});const S=Gu(E,I),C=S==null?void 0:S.replace(ab,"$1");let R=Gu(f,m);const L=(u=R)==null?void 0:u.replace(ab,"$1");R&&S&&C!==L&&(l.slice(0,5)==="audio"&&(R=Fd(R,this.appendSource)),this.log(`switching codec ${E} to ${R}`),R!==(x.pendingCodec||x.codec)&&(x.pendingCodec=R),x.container=p,this.appendChangeType(l,p,R))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const s=`${t};codecs=${n}`,i={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),a.changeType(s),o.codec=n,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,s=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,me.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&_e.isBuffered(l.buffer,s)||((a=this.fragmentTracker.getAppendedFrag(s,me.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:s,type:i,parent:o,frag:a,part:l,chunkMeta:c,offset:u}=t,d=c.buffering[i],{sn:h,cc:f}=a,m=self.performance.now();d.start=m;const p=a.stats.buffering,g=l?l.stats.buffering:null;p.start===0&&(p.start=m),g&&g.start===0&&(g.start=m);const y=n.audio;let x=!1;i==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(x=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const w=n.video,b=w==null?void 0:w.buffer;if(b&&h!=="initSegment"){const S=l||a,C=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(w.ending||w.ended)){const L=S.start+S.duration*.05,$=b.buffered,P=this.currentOp("video");!$.length&&!P?this.blockAudio(S):!P&&!_e.isBuffered(b,L)&&this.lastVideoAppendEnd<L&&this.blockAudio(S)}else if(i==="video"){const R=S.end;if(C){const L=C.frag.start;(R>L||R<this.lastVideoAppendEnd||_e.isBuffered(b,L))&&this.unblockAudio()}this.lastVideoAppendEnd=R}}const E=(l||a).start,I={label:`append-${i}`,execute:()=>{var S;d.executeStart=self.performance.now();const C=(S=this.tracks[i])==null?void 0:S.buffer;C&&(x?this.updateTimestampOffset(C,E,.1,i,h,f):u!==void 0&&fe(u)&&this.updateTimestampOffset(C,u,1e-6,i,h,f)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const S=self.performance.now();d.executeEnd=d.end=S,p.first===0&&(p.first=S),g&&g.first===0&&(g.first=S);const C={};this.sourceBuffers.forEach(([R,L])=>{R&&(C[R]=_e.getBuffered(L))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(A.BUFFER_APPENDED,{type:i,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:C})},onError:S=>{var C;const R={type:xe.MEDIA_ERROR,parent:a.type,details:Z.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:l,chunkMeta:c,error:S,err:S,fatal:!1},L=(C=this.media)==null?void 0:C.error;if(S.code===DOMException.QUOTA_EXCEEDED_ERR||S.name=="QuotaExceededError"||"quota"in S)R.details=Z.BUFFER_FULL_ERROR;else if(S.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!L)R.errorAction=Qo(!0);else if(S.name===Vk&&this.sourceBufferCount===0)R.errorAction=Qo(!0);else{const $=++this.appendErrors[i];this.warn(`Failed ${$}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${L||"no media error"})`),($>=this.hls.config.appendErrorMaxRetry||L)&&(R.fatal=!0)}this.hls.trigger(A.ERROR,R)}};this.log(`queuing "${i}" append sn: ${h}${l?" p: "+l.index:""} of ${a.type===me.MAIN?"level":"track"} ${a.level} cc: ${f}`),this.append(I,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(A.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:n,startOffset:s,endOffset:i}=t;n?this.append(this.getFlushOp(n,s,i),n):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,i),o)})}onFragParsed(e,t){const{frag:n,part:s}=t,i=[],o=s?s.elementaryStreams:n.elementaryStreams;o[Ye.AUDIOVIDEO]?i.push("audiovideo"):(o[Ye.AUDIO]&&i.push("audio"),o[Ye.VIDEO]&&i.push("video"));const a=()=>{const l=self.performance.now();n.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const c=s?s.stats:n.stats;this.hls.trigger(A.FRAG_BUFFERED,{frag:n,part:s,stats:c,id:n.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(a,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(A.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(A.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Z.BUFFER_APPEND_ERROR&&t.frag){var n;const s=(n=t.errorAction)==null?void 0:n.nextAutoLevel;fe(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const s=e.config,i=n.currentTime,o=t.levelTargetDuration,a=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(fe(a)&&a>=0){const c=Math.max(a,o),u=Math.floor(i/o)*o-c;this.flushBackBuffer(i,o,u)}const l=s.frontBufferFlushThreshold;if(fe(l)&&l>0){const c=Math.max(s.maxBufferLength,l),u=Math.max(c,o),d=Math.floor(i/o)*o+u;this.flushFrontBuffer(i,o,d)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([s,i])=>{if(i){const a=_e.getBuffered(i);if(a.length>0&&n>a.start(0)){var o;this.hls.trigger(A.BACK_BUFFER_REACHED,{bufferEnd:n});const l=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(A.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:s})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=_e.getBuffered(i),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(n>l||e>=l&&e<=c)return;this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,s);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return fe(i)?{duration:i}:null;const o=this.media.duration,a=fe(n.duration)?n.duration:0;return s>a&&s>o||!fe(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:n}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(fe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${n}.`),s.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Qe(n)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const s=this.tracks[t];e[t]={buffer:n,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(A.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${Qe(a)}`);try{const u=n.addSourceBuffer(c),d=Yf(o),h=[o,u];t[d]=h,a.buffer=u}catch(u){var s;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:o,mimeType:c,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let s=e.codec;n&&(t==="video"||t==="audiovideo")&&Kl(n,"video")&&(s=oU(s,n));const i=Gu(s,e.levelCodec);return i?t.slice(0,5)==="audio"?Fd(i,this.appendSource):i:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(A.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${s}`,t),this.hls.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,n,s,i,o){const a=t-e.timestampOffset;Math.abs(a)>=n&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:s,mediaSource:i}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!s||!i||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=fe(s.duration)?s.duration:1/0,c=fe(i.duration)?i.duration:1/0,u=Math.max(0,t),d=Math.min(n,l,c);d>u&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${u},${d}] from the ${e} SourceBuffer`),a.remove(u,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],s=n==null?void 0:n.buffer;if(!s)throw new m4(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const s=(n=this.tracks[t])==null?void 0:n.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const o=n.bind(this,e);s.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(s=>{n.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function lb(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function y4(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function Yf(r){return r==="audio"?1:0}class Ty{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&fe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,Ty.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const s=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let i=e.length-1;const o=Math.max(t,n);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&s(l,e[a+1])){i=a;break}}return i}}const v4={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},sr=v4,x4={HLS:"h"},w4=x4;class $n{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof $n?n:new $n(n))),this.value=e,this.params=t}}const b4="Dict";function S4(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function E4(r,e,t,n){return new Error(`failed to ${r} "${S4(e)}" as ${t}`,{cause:n})}function Bn(r,e,t){return E4("serialize",r,e,t)}class Wk{constructor(e){this.description=e}}const cb="Bare Item",T4="Boolean";function _4(r){if(typeof r!="boolean")throw Bn(r,T4);return r?"?1":"?0"}function A4(r){return btoa(String.fromCharCode(...r))}const k4="Byte Sequence";function I4(r){if(ArrayBuffer.isView(r)===!1)throw Bn(r,k4);return`:${A4(r)}:`}const R4="Integer";function C4(r){return r<-999999999999999||999999999999999<r}function Kk(r){if(C4(r))throw Bn(r,R4);return r.toString()}function L4(r){return`@${Kk(r.getTime()/1e3)}`}function qk(r,e){if(r<0)return-qk(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const s=Math.floor(r*t);return(s%2===0?s:s+1)/t}else return Math.round(r*t)/t}const P4="Decimal";function D4(r){const e=qk(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Bn(r,P4);const t=e.toString();return t.includes(".")?t:`${t}.0`}const O4="String",N4=/[\x00-\x1f\x7f]+/;function M4(r){if(N4.test(r))throw Bn(r,O4);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function F4(r){return r.description||r.toString().slice(7,-1)}const j4="Token";function ub(r){const e=F4(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Bn(e,j4);return e}function tg(r){switch(typeof r){case"number":if(!fe(r))throw Bn(r,cb);return Number.isInteger(r)?Kk(r):D4(r);case"string":return M4(r);case"symbol":return ub(r);case"boolean":return _4(r);case"object":if(r instanceof Date)return L4(r);if(r instanceof Uint8Array)return I4(r);if(r instanceof Wk)return ub(r);default:throw Bn(r,cb)}}const $4="Key";function rg(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw Bn(r,$4);return r}function _y(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${rg(e)}`:`;${rg(e)}=${tg(t)}`).join("")}function Yk(r){return r instanceof $n?`${tg(r.value)}${_y(r.params)}`:tg(r)}function B4(r){return`(${r.value.map(Yk).join(" ")})${_y(r.params)}`}function U4(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw Bn(r,b4);const t=r instanceof Map?r.entries():Object.entries(r),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof $n||(i=new $n(i));let o=rg(s);return i.value===!0?o+=_y(i.params):(o+="=",Array.isArray(i.value)?o+=B4(i):o+=Yk(i)),o}).join(`,${n}`)}function Qk(r,e){return U4(r,e)}const Sn="CMCD-Object",mt="CMCD-Request",gi="CMCD-Session",ws="CMCD-Status",z4={br:Sn,ab:Sn,d:Sn,ot:Sn,tb:Sn,tpb:Sn,lb:Sn,tab:Sn,lab:Sn,url:Sn,pb:mt,bl:mt,tbl:mt,dl:mt,ltc:mt,mtp:mt,nor:mt,nrr:mt,rc:mt,sn:mt,sta:mt,su:mt,ttfb:mt,ttfbb:mt,ttlb:mt,cmsdd:mt,cmsds:mt,smrt:mt,df:mt,cs:mt,ts:mt,cid:gi,pr:gi,sf:gi,sid:gi,st:gi,v:gi,msd:gi,bs:ws,bsd:ws,cdn:ws,rtp:ws,bg:ws,pt:ws,ec:ws,e:ws},G4={REQUEST:mt};function H4(r){return Object.keys(r).reduce((e,t)=>{var n;return(n=r[t])===null||n===void 0||n.forEach(s=>e[s]=t),e},{})}function V4(r,e){const t={};if(!r)return t;const n=Object.keys(r),s=e?H4(e):{};return n.reduce((i,o)=>{var a;const l=z4[o]||s[o]||G4.REQUEST,c=(a=i[l])!==null&&a!==void 0?a:i[l]={};return c[o]=r[o],i},t)}function W4(r){return["ot","sf","st","e","sta"].includes(r)}function K4(r){return typeof r=="number"?fe(r):r!=null&&r!==""&&r!==!1}const Xk="event";function q4(r,e){const t=new URL(r),n=new URL(e);if(t.origin!==n.origin)return r;const s=t.pathname.split("/").slice(1),i=n.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const qu=r=>Math.round(r),ng=(r,e)=>Array.isArray(r)?r.map(t=>ng(t,e)):r instanceof $n&&typeof r.value=="string"?new $n(ng(r.value,e),r.params):(e.baseUrl&&(r=q4(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),mu=r=>qu(r/100)*100,Y4=(r,e)=>{let t=r;return e.version>=2&&(r instanceof $n&&typeof r.value=="string"?t=new $n([r]):typeof r=="string"&&(t=[r])),ng(t,e)},Q4={br:qu,d:qu,bl:mu,dl:mu,mtp:mu,nor:Y4,rtp:mu,tb:qu},Jk="request",Zk="response",Ay=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],X4=["e"],J4=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Nh(r){return J4.test(r)}function Z4(r){return Ay.includes(r)||X4.includes(r)||Nh(r)}const eI=["d","dl","nor","ot","rtp","su"];function e5(r){return Ay.includes(r)||eI.includes(r)||Nh(r)}const t5=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function r5(r){return Ay.includes(r)||eI.includes(r)||t5.includes(r)||Nh(r)}const n5=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function s5(r){return n5.includes(r)||Nh(r)}const i5={[Zk]:r5,[Xk]:Z4,[Jk]:e5};function tI(r,e={}){const t={};if(r==null||typeof r!="object")return t;const n=e.version||r.v||1,s=e.reportingMode||Jk,i=n===1?s5:i5[s];let o=Object.keys(r).filter(i);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=s===Zk||s===Xk;l&&!o.includes("ts")&&o.push("ts"),n>1&&!o.includes("v")&&o.push("v");const c=Ke({},Q4,e.formatters),u={version:n,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(d=>{let h=r[d];const f=c[d];if(typeof f=="function"&&(h=f(h,u)),d==="v"){if(n===1)return;h=n}d=="pr"&&h===1||(l&&d==="ts"&&!fe(h)&&(h=Date.now()),K4(h)&&(W4(d)&&typeof h=="string"&&(h=new Wk(h)),t[d]=h))}),t}function o5(r,e={}){const t={};if(!r)return t;const n=tI(r,e),s=V4(n,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((i,[o,a])=>{const l=Qk(a,{whitespace:!1});return l&&(i[o]=l),i},t)}function a5(r,e,t){return Ke(r,o5(e,t))}const l5="CMCD";function c5(r,e={}){return r?Qk(tI(r,e),{whitespace:!1}):""}function u5(r,e={}){if(!r)return"";const t=c5(r,e);return encodeURIComponent(t)}function d5(r,e={}){if(!r)return"";const t=u5(r,e);return`${l5}=${t}`}const db=/CMCD=[^&#]+/;function h5(r,e,t){const n=d5(e,t);if(!n)return r;if(db.test(r))return r.replace(db,n);const s=r.includes("?")?"&":"?";return`${r}${s}${n}`}class f5{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:sr.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:o}=s,a=this.hls.levels[i.level],l=this.getObjectType(i),c={d:(o||i).duration*1e3,ot:l};(l===sr.VIDEO||l===sr.AUDIO||l==sr.MUXED)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=o?this.getNextPart(o):this.getNextFrag(i);u!=null&&u.url&&u.url!==i.url&&(c.nor=u.url),this.apply(s,c)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHED,this.onMediaDetached,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHED,this.onMediaDetached,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,s;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:w4.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ke(t,this.createData());const n=t.ot===sr.INIT||t.ot===sr.VIDEO||t.ot===sr.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,a)=>(s.includes(a)&&(o[a]=t[a]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),a5(e.headers,t,i)):e.url=h5(e.url,t,i)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const s=e.sn-n.startSN;return n.fragments[s+1]}}getNextPart(e){var t;const{index:n,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=s;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.index===n&&l.fragment.sn===o)return i[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return sr.TIMED_TEXT;if(e.sn==="initSegment")return sr.INIT;if(t==="audio")return sr.AUDIO;if(t==="main")return this.hls.audioTracks.length?sr.VIDEO:sr.MUXED}getTopBandwidth(e){let t=0,n;const s=this.hls;if(e===sr.AUDIO)n=s.audioTracks;else{const i=s.maxAutoLevel,o=i>-1?i+1:s.levels.length;n=s.levels.slice(0,o)}return n.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===sr.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:_e.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new n(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new n(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}}const p5=3e5;class m5 extends Kr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===Ft.SendAlternateToPenaltyBox&&n.flags===xr.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&s?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==o),t.details===Z.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${Qe(i)} penalized: ${Qe(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,s=performance.now();Object.keys(n).forEach(i=>{s-n[i]>p5&&delete n[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in n)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,bk(t),this.hls.trigger(A.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,n){const s=this.getLevelsForPathway(n).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===Ne.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===Ne.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},s={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const d=new at(u.attrs);d["PATHWAY-ID"]=o;const h=d.AUDIO&&`${d.AUDIO}_clone_${o}`,f=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;h&&(n[d.AUDIO]=h,d.AUDIO=h),f&&(s[d.SUBTITLES]=f,d.SUBTITLES=f);const m=rI(u.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),p=new Yl({attrs:d,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:m,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let g=1;g<u.audioGroups.length;g++)p.addGroupId("audio",`${u.audioGroups[g]}_clone_${o}`);if(u.subtitleGroups)for(let g=1;g<u.subtitleGroups.length;g++)p.addGroupId("text",`${u.subtitleGroups[g]}_clone_${o}`);return p});t.push(...c),hb(this.audioTracks,n,l,o),hb(this.subtitleTracks,s,l,o)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+u)}const i={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,d,h,f)=>{this.log(`Loaded steering manifest: "${s}"`);const m=u.data;if((m==null?void 0:m.VERSION)!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":y}=m;if(p)try{this.uri=new self.URL(p,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||h.url),g&&this.clonePathways(g);const x={steeringManifest:m,url:s.toString()};this.hls.trigger(A.STEERING_MANIFEST_LOADED,x),y&&this.updatePathwayPriority(y)},onError:(u,d,h,f)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let m=this.timeToLoad*1e3;if(u.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const g=p.getResponseHeader("Retry-After");g&&(m=parseFloat(g)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,m)},onTimeout:(u,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const s=(n=this.hls)==null?void 0:n.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function hb(r,e,t,n){r&&Object.keys(e).forEach(s=>{const i=r.filter(o=>o.groupId===s).map(o=>{const a=Ke({},o);return a.details=void 0,a.attrs=new at(a.attrs),a.url=a.attrs.URI=rI(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[s],a.attrs["PATHWAY-ID"]=n,a});r.push(...i)})}function rI(r,e,t,n){const{HOST:s,PARAMS:i,[t]:o}=n;let a;e&&(a=o==null?void 0:o[e],a&&(r=a));const l=new self.URL(r);return s&&!a&&(l.host=s),i&&Object.keys(i).sort().forEach(c=>{c&&l.searchParams.set(c,i[c])}),l.href}class Jo extends Kr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Jo.CDMCleanupPromise?[Jo.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:s}=t,i=`"${t.type}" event: init data type: "${n}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=el(this.config));const a=o.map(Uf).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=Vu(o);if(n!=="sinf"||a!==ut.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${a}`);return}let l;try{const f=kt(new Uint8Array(s)),m=py(JSON.parse(f).sinf),p=QA(m);if(!p)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(p.subarray(8,24))}catch(f){this.warn(`${i} Failed to parse sinf: ${f}`);return}const c=Zt(l),{keyIdToKeySessionPromise:u,mediaKeySessions:d}=this;let h=u[c];for(let f=0;f<d.length;f++){const m=d[f],p=m.decryptdata;if(!p.keyId)continue;const g=Zt(p.keyId);if(zd(l,p.keyId)||p.uri.replace(/-/g,"").indexOf(c)!==-1){if(h=u[g],!h)continue;if(p.pssh)break;delete u[g],p.pssh=new Uint8Array(s),p.keyId=l,h=u[c]=h.then(()=>this.generateRequestWithPreferredKeySession(m,n,s,"encrypted-event-key-match")),h.catch(y=>this.handleError(y));break}}h||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(A.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(A.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===ut.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(o,a,l)=>!!o&&l.indexOf(o)===a,s=t.map(o=>o.audioCodec).filter(n),i=t.map(o=>o.videoCodec).filter(n);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,s,i).then(d=>o({keySystem:u,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof yr?a(d):a(new yr({type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${n}`;return fk===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return n(e,t)}getMediaKeysPromise(e,t,n){var s;const i=YU(e,t,n,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(s=o)==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Qe(i)}`),a=this.requestMediaKeySystemAccess(e,i);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=c.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(f=>f?this.setMediaKeysServerCertificate(h,e,f):h)));return d.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),d})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Zt(e.keyId||[])} keyUri: ${e.uri}`);const s=n.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),s=gu(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(n,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${Zt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Uf(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=Uf(s);i?t(i):n(new Error(`Unable to find format for key-system "${s}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=el(this.config),n=e.map(Vu).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const s=g5(e,t[n]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,n=gu(t),s=this.bannedKeyIds[n];if(s||this.getKeyStatus(t)==="internal-error"){const a=fb(s||"internal-error",t);return this.handleError(a,e.frag),Promise.reject(a)}const i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[n];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,u,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[n]=a,a}return o.catch(a=>{if(a instanceof yr){const l=Ge({},a.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const c=new yr(l,a.message);this.handleError(c,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof yr){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${Zt(n.keyId||[])})`:""}`),this.hls.trigger(A.ERROR,e.data)}else this.error(e.message),this.hls.trigger(A.ERROR,{type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=gu(e),n=this.keyIdToKeySessionPromise[t];if(!n){const s=Vu(e.keyFormat),i=s?[s]:el(this.config);return this.attemptKeySystemAccess(i)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=el(this.config)),e.length===0)throw new yr({type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Qe({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(n).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>n.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,n,s){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const m=o.call(this.hls,t,n,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,n=m.initData?m.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(m){if(this.warn(m.message),this.hls&&this.hls.config.debug)throw m}if(n===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const a=gu(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${a} URI: ${l} (init data type: ${t} length: ${n.byteLength})`);const c=new gy,u=e._onmessage=m=>{const p=e.mediaKeysSession;if(!p){c.emit("error",new Error("invalid state"));return}const{messageType:g,message:y}=m;this.log(`"${g}" message event for session "${p.sessionId}" message size: ${y.byteLength}`),g==="license-request"||g==="license-renewal"?this.renewLicense(e,y).catch(x=>{c.eventNames().length?c.emit("error",x):this.handleError(x)}):g==="license-release"?e.keySystem===ut.FAIRPLAY&&this.updateKeySession(e,Ym("acknowledged")).then(()=>this.removeSession(e)).catch(x=>this.handleError(x)):this.warn(`unhandled media key message type "${g}"`)},d=(m,p)=>{p.keyStatus=m;let g;m.startsWith("usable")?c.emit("resolved"):m==="internal-error"||m==="output-restricted"||m==="output-downscaled"?g=fb(m,p.decryptdata):m==="expired"?g=new Error(`key expired (keyId: ${a})`):m==="released"?g=new Error("key released"):m==="status-pending"||this.warn(`unhandled key status change "${m}" (keyId: ${a})`),g&&(c.eventNames().length?c.emit("error",g):this.handleError(g))},h=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const g=this.getKeyStatuses(e);if(!Object.keys(g).some(b=>g[b]!=="status-pending"))return;if(g[a]==="expired"){this.log(`Expired key ${Qe(g)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let x=g[a];if(x)d(x,e);else{var w;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(w=e.keyStatusTimeouts)[a]||(w[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const E=this.getKeyStatus(e.decryptdata);if(E&&E!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${E} from other session.`),d(E,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),x="internal-error",d(x,e)},1e3)),this.log(`No status for keyId ${a} (${Qe(g)}).`)}};er(e.mediaKeysSession,"message",u),er(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((m,p)=>{c.on("error",p),c.on("resolved",m)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(m=>{throw new yr({type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_NO_SESSION,error:m,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>f).catch(m=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw m}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,s)=>{if(typeof s=="string"&&typeof n=="object"){const a=s;s=n,n=a}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);e.keySystem===ut.PLAYREADY&&i.length===16&&dk(i);const o=Zt(i);n==="internal-error"&&(this.bannedKeyIds[o]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,s=new n(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,m,p)=>{o(h.data)},onError:(h,f,m,p)=>{a(new yr({type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:Ge({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${i}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,m)=>{a(new yr({type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(h,f,m)=>{a(new Error("aborted"))}};s.load(l,u,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((s,i)=>{e.setServerCertificate(n).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),s(e)}).catch(o=>{i(new yr({type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(s=>{throw new yr({type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(n,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let u;for(let d=0,h=i.length;d<h;d++){var o,a;u=i[d];const f=(o=u.querySelector("name"))==null?void 0:o.textContent,m=(a=u.querySelector("value"))==null?void 0:a.textContent;f&&m&&e.setRequestHeader(f,m)}}const l=s.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Ym(atob(c))}setupLicenseXHR(e,t,n,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,n,s)}).catch(o=>{if(!n.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,n,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(u){this.error(u)}s(l)}else{const l=n.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)i(new yr({type:xe.KEY_SYSTEM_ERROR,details:Z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==ut.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,er(n,"encrypted",this.onMediaEncrypted),er(n,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(dr(e,"encrypted",this.onMediaEncrypted),dr(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ui.clearKeyUriToKeyIdMap();const s=n.length;Jo.CDMCleanupPromise=Promise.all(n.map(i=>this.removeSession(i)).concat((t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(i=>{this.log(`Could not clear media keys: ${i}`),this.hls&&this.hls.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${i}`)})}))||Promise.resolve())).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}`),this.hls&&this.hls.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${i}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Zt((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(c=>self.clearTimeout(o[c]));const{drmSystemOptions:a}=this.config;return(XU(a)?new Promise((c,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(u)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}Jo.CDMCleanupPromise=void 0;function gu(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return Zt(r.keyId)}function g5(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class yr extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function fb(r,e){const t=r==="output-restricted",n=t?Z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Z.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new yr({type:xe.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class y5{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,o=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/i,c=this.hls;if(c.trigger(A.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:n}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(A.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function nI(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function sI(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){He.debug(`[texttrack-utils]: ${n}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,r.addCue(s)}catch(s){He.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(r.mode=t)}function $o(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let n=r.cues.length;n--;)e&&r.cues[n].removeEventListener("enter",e),r.removeCue(r.cues[n]);t==="disabled"&&(r.mode=t)}function sg(r,e,t,n){const s=r.mode;if(s==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const i=x5(r.cues,e,t);for(let o=0;o<i.length;o++)(!n||n(i[o]))&&r.removeCue(i[o])}s==="disabled"&&(r.mode=s)}function v5(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let n=0,s=t,i;for(;n<=s;)if(i=Math.floor((s+n)/2),e<r[i].startTime)s=i-1;else if(e>r[i].startTime&&n<t)n=i+1;else return i;return r[n].startTime-e<e-r[s].startTime?n:s}function x5(r,e,t){const n=[],s=v5(r,e);if(s>-1)for(let i=s,o=r.length;i<o;i++){const a=r[i];if(a.startTime>=e&&a.endTime<=t)n.push(a);else if(a.startTime>t)return n}return n}function Yu(r){const e=[];for(let t=0;t<r.length;t++){const n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}class w5 extends Ey{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=Yu(this.media.textTracks);for(let i=0;i<n.length;i++)if(n[i].mode==="hidden")t=n[i];else if(n[i].mode==="showing"){t=n[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Yu(n.textTracks).forEach(o=>{$o(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:s,details:i}=t,o=this.tracksInGroup[n];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${n} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${n} "${o.name}" lang:${o.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!n||n.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,d)=>{u.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!i&&a){this.selectDefaultTrack=!1;const u=Pn(a,o);if(u>-1)i=o[u];else{const d=Pn(a,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(A.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(n&&!i.default||!n&&!e)&&(!e||Bi(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(Zl(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(Zl(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(eg(s,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ne.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Bi(e,n))return n;const s=Pn(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(n)return null;{const i=Pn(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(A.SUBTITLE_TRACK_LOADING,{url:i,id:n,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Yu(e.textTracks),n=this.currentTrack;let s;if(n&&(s=t.filter(i=>eg(n,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!fe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===n&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=s;this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const d=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(d)}}function b5(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function gl(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const Zo=.025;let Wd=function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r}({});function S5(r,e,t){return`${r.identifier}-${t+1}-${gl(e)}`}class E5{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Qf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Qf(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=fe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Qf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Zo))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Wd.Range:Wd.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return T5(this)}}function Qf(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<Zo)?e.start:e.start+e.duration}function iI(r,e,t){const n=new self.URL(r,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function Xf(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function T5(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function To(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class _5{constructor(e,t,n,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(A.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=n,this.assetItem=s;const o=()=>{this.hasDetails=!0};i.once(A.LEVEL_LOADED,o),i.once(A.AUDIO_TRACK_LOADED,o),i.once(A.SUBTITLE_TRACK_LOADED,o),i.on(A.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(A.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,i.trigger(A.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=iI(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=_e.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=_e.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,n){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,n){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${To(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const pb=.033;class A5 extends Kr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(i=s[n])!=null&&i.event;){var i;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let s=0;s<n.length;s++){let i=n[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let s=e;s<=t&&n[s];s++){const i=n[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var n;if(((n=t[s].event)==null?void 0:n.identifier)===e)return s}return-1}findAssetIndex(e,t){const n=e.assetList,s=n.length;if(s>1)for(let i=0;i<s;i++){const o=n[i];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,s=n[n.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:s}=n,i=this.events,o=this.parseDateRanges(s,{url:n.url},t),a=Object.keys(s),l=i?i.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,u)=>{const d=c.cue.pre,h=c.cue.post,f=u.cue.pre,m=u.cue.post;if(d&&!f)return-1;if(f&&!d||h&&!m)return 1;if(m&&!h)return-1;if(!d&&!f&&!h&&!m){const p=c.startTime,g=u.startTime;if(p!==g)return p-g}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],n=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(s,e);(n||t.length||(i==null?void 0:i.length)!==o.length||o.some((l,c)=>Math.abs(l.playout.start-i[c].playout.start)>.005||Math.abs(l.playout.end-i[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,n){const s=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const a=i[o],l=e[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new E5(l,t),this.eventMap[a]=c,n===!1&&(c.appendInPlace=n)),s.push(c)}}return s}parseSchedule(e,t){const n=[],s=t.main.details,i=s.live?1/0:s.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,d)=>{const h=u.cue.pre,f=u.cue.post,m=e[d-1]||null,p=u.appendInPlace,g=f?i:u.startOffset,y=u.duration,x=u.timelineOccupancy===Wd.Range?y:0,w=u.resumptionOffset,b=(m==null?void 0:m.startTime)===g,E=g+u.cumulativeDuration;let I=p?E+y:g+w;if(h||!f&&g<=0){const C=c;c+=x,u.timelineStart=E;const R=o;o+=y,n.push({event:u,start:E,end:I,playout:{start:R,end:o},integrated:{start:C,end:c}})}else if(g<=i){if(!b){const L=g-l;if(L>pb){const $=l,P=c;c+=L;const U=o;o+=L;const _={previousEvent:e[d-1]||null,nextEvent:u,start:$,end:$+L,playout:{start:U,end:o},integrated:{start:P,end:c}};n.push(_)}else L>0&&m&&(m.cumulativeDuration+=L,n[n.length-1].end=g)}f&&(I=E),u.timelineStart=E;const C=c;c+=x;const R=o;o+=y,n.push({event:u,start:E,end:I,playout:{start:R,end:o},integrated:{start:C,end:c}})}else return;const S=u.resumeTime;f||S>i?l=i:l=S}),l<i){var a;const u=l,d=c,h=i-l;c+=h;const f=o;o+=h,n.push({previousEvent:((a=n[n.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:u+h,playout:{start:f,end:o},integrated:{start:d,end:c}})}this.setDurations(i,o,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,s=n.live?1/0:n.edge;let i=0,o=-1;e.forEach((a,l)=>{const c=a.cue.pre,u=a.cue.post,d=c?0:u?s:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=i:(i=0,o=d),!u&&a.snapOptions.in&&(a.resumeAnchor=Xi(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<pb&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const f=fe(a.resumeOffset)?a.resumeOffset:a.duration;i+=f})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(n-s)>Zo?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(n>=l)return this.log(`"${e.identifier}" resumption ${n} past ${o} playlist end ${l}`),!1;const c=Xi(null,a.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const u=o==="audio"?.175:0;return Math.abs(c.start-n)<Zo+u||Math.abs(c.end-n)<Zo+u?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,s=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+n;a.startOffset=n,a.timelineStart=l,s||(s=a.duration===null),i||(i=!!a.error);const c=a.error?0:a.duration||0;n+=c}s&&!i?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function en(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class k5{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let s;try{s=iI(n,this.hls.sessionId,e.baseUrl)}catch(h){const f=this.assignAssetListError(e,Z.ASSET_LIST_LOAD_ERROR,h,n);this.hls.trigger(A.ERROR,f);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,a=new o(i),l={responseType:"json",url:s.href},c=i.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,m,p)=>{const g=h.data,y=g==null?void 0:g.ASSETS;if(!Array.isArray(y)){const x=this.assignAssetListError(e,Z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,f,p);this.hls.trigger(A.ERROR,x);return}e.assetListResponse=g,this.hls.trigger(A.ASSET_LIST_LOADED,{event:e,assetListResponse:g,networkDetails:p})},onError:(h,f,m,p)=>{const g=this.assignAssetListError(e,Z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${f.url})`),f.url,p,m);this.hls.trigger(A.ERROR,g)},onTimeout:(h,f,m)=>{const p=this.assignAssetListError(e,Z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,h,m);this.hls.trigger(A.ERROR,p)}};return a.load(l,u,d),this.hls.trigger(A.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,n,s,i,o){return e.error=n,{type:xe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:n,networkDetails:o,stats:i}}}function mb(r){r==null||r.play().catch(()=>{})}function yu(r,e){return`[${r}] Advancing timeline position to ${e}`}class I5 extends Kr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const s=n-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=n,this.bufferedPos=n;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(n,n-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&n<a.start||n>=a.end){var l;const f=this.findItemIndex(a);let m=this.schedule.findItemIndexAtTime(n);if(m===-1&&(m=f+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${n} (resolving from ${f} to ${m})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&m>f){const p=this.schedule.findJumpRestrictedIndex(f+1,m);if(p>f){this.setSchedulePosition(p);return}}this.setSchedulePosition(m);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const f=a.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,f))}return}const u=c.timelineStart,d=c.duration||0;if(o&&n<u||n>=u+d){var h;(h=a.event)!=null&&h.appendInPlace&&(this.clearInterstitial(a.event,a),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(n>=s.end){this.timelinePos=s.end;const a=this.findItemIndex(s);this.setSchedulePosition(a+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);n>=o&&this.setScheduleToAssetAtTime(n,i)},this.onScheduleUpdate=(n,s)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,a=i.events||[],l=i.items||[],c=i.durations,u=n.map(p=>p.identifier),d=!!(a.length||u.length);(d||s)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(p=>en(p))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let h=null,f=null;o&&(h=this.updateItem(o,this.timelinePos),this.itemsMatch(o,h)?this.playingItem=h:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m&&(f=this.updateItem(m,this.bufferedPos),this.itemsMatch(m,f)?this.bufferingItem=f:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))),n.forEach(p=>{p.assetList.forEach(g=>{this.clearAssetPlayer(g.identifier,null)})}),this.playerQueue.forEach(p=>{if(p.interstitial.appendInPlace){const g=p.assetItem.timelineStart,y=p.timelineOffset-g;if(y)try{p.timelineOffset=g}catch(x){Math.abs(y)>Zo&&this.warn(`${x} ("${p.assetId}" ${p.timelineOffset}->${g})`)}}}),d||s){if(this.hls.trigger(A.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(o)&&u.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(h,o),m&&f!==h&&this.trimInPlace(f,m),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new k5(e),this.schedule=new A5(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(A.MEDIA_ENDED,this.onMediaEnded,this),e.on(A.ERROR,this.onError,this),e.on(A.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(A.MEDIA_ENDED,this.onMediaEnded,this),e.off(A.ERROR,this.onError,this),e.off(A.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){dr(e,"play",this.onPlay),dr(e,"pause",this.onPause),dr(e,"seeking",this.onSeeking),dr(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;er(n,"seeking",this.onSeeking),er(n,"timeupdate",this.onTimeupdate),er(n,"play",this.onPlay),er(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(n);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(this.media=null,!n&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=d=>d&&e.getAssetPlayer(d.identifier),s=(d,h,f,m,p)=>{if(d){let g=d[h].start;const y=d.event;if(y){if(h==="playout"||y.timelineOccupancy!==Wd.Point){const x=n(f);(x==null?void 0:x.interstitial)===y&&(g+=x.assetItem.startOffset+x[p])}}else{const x=m==="bufferedPos"?o():e[m];g+=x-d.start}return g}return 0},i=(d,h)=>{var f;if(d!==0&&h!=="primary"&&(f=e.schedule)!=null&&f.length){var m;const p=e.schedule.findItemIndexAtTime(d),g=(m=e.schedule.items)==null?void 0:m[p];if(g){const y=g[h].start-g.start;return d+y}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var h,f;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:((f=e.schedule)==null?void 0:f.durations[d])||0},l=(d,h)=>{var f,m;const p=e.effectivePlayingItem;if(p!=null&&(f=p.event)!=null&&f.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${h}"`);const g=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(d,h),x=(m=e.schedule.items)==null?void 0:m[y],w=e.getBufferingPlayer(),b=w==null?void 0:w.interstitial,E=b==null?void 0:b.appendInPlace,I=g&&e.itemsMatch(g,x);if(g&&(E||I)){const S=n(e.playingAsset),C=(S==null?void 0:S.media)||e.primaryMedia;if(C){const R=h==="primary"?C.currentTime:s(g,h,e.playingAsset,"timelinePos","currentTime"),L=d-R,$=(E?R:C.currentTime)+L;if($>=0&&(!S||E||$<=S.duration)){C.currentTime=$;return}}}if(x){let S=d;if(h!=="primary"){const R=x[h].start,L=d-R;S=x.start+L}const C=!e.isInterstitial(x);if((!e.isInterstitial(g)||g.event.appendInPlace)&&(C||x.event.appendInPlace)){const R=e.media||(E?w==null?void 0:w.media:null);R&&(R.currentTime=S)}else if(g){const R=e.findItemIndex(g);if(y>R){const $=e.schedule.findJumpRestrictedIndex(R+1,y);if($>R){e.setSchedulePosition($);return}}let L=0;if(C)e.timelinePos=S,e.checkBuffer();else{const $=x.event.assetList,P=d-(x[h]||x).start;for(let U=$.length;U--;){const _=$[U];if(_.duration&&P>=_.startOffset&&P<_.startOffset+_.duration){L=U;break}}}e.setSchedulePosition(y,L)}}},c=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},u={get bufferedEnd(){const d=t(),h=e.bufferingItem;if(h&&h===d){var f;return s(h,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-h.playout.start||((f=e.bufferingAsset)==null?void 0:f.startOffset)||0}return 0},get currentTime(){const d=c(),h=e.effectivePlayingItem;return h&&h===d?s(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=c(),f=e.effectivePlayingItem;f&&f===h&&l(d+f.playout.start,"playout")},get duration(){const d=c();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=c())==null?void 0:d.event.assetList;return h?h.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var d;const h=(d=c())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const f=e.findItemIndex(d);if(h.appendInPlace){const m=d.playout.start+d.event.duration;l(m+.001,"playout")}else e.advanceAfterAssetEnded(h,f,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!fe(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,s=e.media;if(n&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Qe(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var n,s;if(e.media===t)return;let i=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let u;if(o.media)l&&(i=o.transferMedia(),this.detachedData=i),u="Primary";else if(c){const m=this.getBufferingPlayer();m?(i=m.transferMedia(),u=`${m}`):u="detached MediaSource"}else u="detached media";if(!i){if(c)i=this.detachedData,this.log(`using detachedData: MediaSource ${Qe(i)}`);else if(!this.detachedData||o.media===t){const m=this.playerQueue;m.length>1&&m.forEach(p=>{if(a&&p.interstitial.appendInPlace!==l){const g=p.interstitial;this.clearInterstitial(p.interstitial,null),g.appendInPlace=!1,g.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${g}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",h=d&&i?i:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const f=this.schedule;if(h===i&&f){const m=a&&e.assetId===f.assetIdAtEnd;h.overrides={duration:f.duration,endOfStream:!a||m,cueRemoval:!a}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,s=this.effectivePlayingItem;if(n===-1){const i=this.hls.startPosition;if(this.log(yu("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const n=e.event,s=n.findAssetIndex(t),i=Xf(n,s);if(!n.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,n){const s=Xf(e,n);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,a=i.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(yu("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const s=t.parentIdentifier,i=n.getEvent(s);if(i){const o=n.findEventIndex(s),a=n.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,a-1)}}setSchedulePosition(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&en(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const u=o.event,d=this.playingAsset,h=d==null?void 0:d.identifier,f=h?this.getAssetPlayer(h):null;if(f&&h&&(!this.eventItemsMatch(o,i)||t!==void 0&&h!==u.assetList[t].identifier)){var l;const m=u.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${m+1}/${u.assetList.length} ${To(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(A.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:m,event:u,schedule:s.slice(0),scheduleIndex:e,player:f}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(h,i),f.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&f.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${en(o)}`),u.hasPlayed=!0,this.hls.trigger(A.INTERSTITIAL_ENDED,{event:u,schedule:s.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const m=(c=this.schedule)==null?void 0:c.items;if(i&&m){const p=this.findItemIndex(i);this.advanceSchedule(p,m,t,o,a)}return}}this.advanceSchedule(e,s,t,o,a)}advanceSchedule(e,t,n,s,i){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const d=u.interstitial,h=o.findEventIndex(d.identifier);(h<e||h>e+1)&&this.clearInterstitial(d,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(n===void 0){n=o.findAssetIndex(u,this.timelinePos);const m=Xf(u,n-1);if(u.isAssetPastPlayoutLimit(m)||u.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(u,e,n);return}n=m}const d=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let h=this.preloadAssets(u,n);if(this.eventItemsMatch(a,d||s)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${en(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(A.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const f=u.assetList[n];if(!f){this.advanceAfterAssetEnded(u,e,n||0);return}if(h||(h=this.getAssetPlayer(f.identifier)),h===null||h.destroyed){const m=u.assetList.length;this.warn(`asset ${n+1}/${m} player destroyed ${u}`),h=this.createAssetPlayer(u,f,n),h.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(f))return;this.startAssetPlayer(h,n,t,e,l),this.shouldPlay&&mb(h.media)}else a?(this.resumePrimary(a,e,s),this.shouldPlay&&mb(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${en(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(yu("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!n)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${en(e)}`),this.hls.trigger(A.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(n<s.fragmentStart||n>s.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:_e.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(yu("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((n=s.mainForwardBufferInfo)==null?void 0:n.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(A.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(A.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const s=Ge(Ge({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Ge(Ge({},this.altSelection),{},{audio:n});return}const i=Ge(Ge({},s),{},{audio:n});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Ge(Ge({},this.altSelection),{},{subtitles:n});return}const i=Ge(Ge({},s),{},{subtitles:n});this.mediaSelection=i}onAudioTrackSwitching(e,t){const n=Tw(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=Tw(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var n;const o=this.schedule.findEventIndex(i.identifier),a=(n=this.schedule.items)==null?void 0:n[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const n=e.end+.25,s=_e.bufferInfo(this.primaryMedia,n,0);(s.end>n||(s.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${en(e)} (was ${en(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const s=_e.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,n,e)}updateBufferedPos(e,t,n){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(i),d=Math.min(u+1,t.length-1),h=t[d];if((l===-1&&i&&e>=i.end||(c=h.event)!=null&&c.appendInPlace&&e+.01>=h.start)&&(l=d),this.isInterstitial(i)){const f=i.event;if(d-a>1&&f.appendInPlace===!1||f.assetList.length===0&&f.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>a)this.bufferedToItem(h);else{const f=this.primaryDetails;this.primaryLive&&f&&e>f.edge-f.targetduration&&h.start<f.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else n&&o&&!this.itemsMatch(o,i)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:s,events:i}=n;if(!s||!i)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${en(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,d)=>{const h=this.getAssetPlayer(u.identifier);h&&(d===c&&h.loadSource(),h.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(A.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,s=n.assetList.length===0&&!n.assetListLoader,i=n.cue.once;if(s||!i){const o=this.preloadAssets(n,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const n=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,o=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var a;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(a=h.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const h=u-l;h>0&&(c=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:s} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,l,e.duration,n);const d=this.assetListLoader.loadAssetList(e,c);d&&(e.assetListLoader=d)}else if(!o&&s){for(let c=t;c<s;c++){const u=e.assetList[c],d=this.getAssetPlayerQueueIndex(u.identifier);(d===-1||this.playerQueue[d].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,s,i,o){const a={parentIdentifier:e.identifier,identifier:S5(e,o,t),duration:i,startOffset:n,timelineStart:s,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,n){const s=this.hls,i=s.userConfig;let o=i.videoPreference;const a=s.loadLevelObj||s.levels[s.currentLevel];(o||a)&&(o=Ke({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=s.audioTracks[s.audioTrack],c=s.subtitleTracks[s.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const b=this.timelinePos-t.timelineStart;if(b>1){const E=t.duration;E&&b<E&&(u=b)}}const d=t.identifier,h=Ge(Ge({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||i.audioPreference,subtitlePreference:c||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const f=h.cmcd;f!=null&&f.sessionId&&f.contentId&&(h.cmcd=Ke({},f,{contentId:gl(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const m=new _5(this.HlsPlayerClass,h,e,t);this.playerQueue.push(m),e.assetList[n]=t;let p=!0;const g=b=>{if(b.live){var E;const C=new Error(`Interstitials MUST be VOD assets ${e}`),R={fatal:!0,type:xe.OTHER_ERROR,details:Z.INTERSTITIAL_ASSET_ITEM_ERROR,error:C},L=((E=this.schedule)==null?void 0:E.findEventIndex(e.identifier))||-1;this.handleAssetItemError(R,e,L,n,C.message);return}const I=b.edge-b.fragmentStart,S=t.duration;(p||S===null||I>S)&&(p=!1,this.log(`Interstitial asset "${d}" duration change ${S} > ${I}`),t.duration=I,this.updateSchedule())};m.on(A.LEVEL_UPDATED,(b,{details:E})=>g(E)),m.on(A.LEVEL_PTS_UPDATED,(b,{details:E})=>g(E)),m.on(A.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const y=(b,E)=>{const I=this.getAssetPlayer(d);if(I&&E.tracks){I.off(A.BUFFER_CODECS,y),I.tracks=E.tracks;const S=this.primaryMedia;this.bufferingAsset===I.assetItem&&S&&!I.media&&this.bufferAssetPlayer(I,S)}};m.on(A.BUFFER_CODECS,y);const x=()=>{var b;const E=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${E}`),!E||!this.schedule)return;const I=this.schedule.findEventIndex(e.identifier),S=(b=this.schedule.items)==null?void 0:b[I];this.isInterstitial(S)&&this.advanceAssetBuffering(S,t)};m.on(A.BUFFERED_TO_END,x);const w=b=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const I=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,I,b)};return m.once(A.MEDIA_ENDED,w(n)),m.once(A.PLAYOUT_LIMIT_REACHED,w(1/0)),m.on(A.ERROR,(b,E)=>{if(!this.schedule)return;const I=this.getAssetPlayer(d);if(E.details===Z.BUFFER_STALLED_ERROR){if(I!=null&&I.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(E,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${E.error} ${e}`)}),m.on(A.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const E=new Error(`Asset player destroyed unexpectedly ${d}`),I={fatal:!0,type:xe.OTHER_ERROR,details:Z.INTERSTITIAL_ASSET_ITEM_ERROR,error:E};this.handleAssetItemError(I,e,this.schedule.findEventIndex(e.identifier),n,E.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${To(t)}`),this.hls.trigger(A.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:m}),m}clearInterstitial(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const s=this.playerQueue[n];this.log(`clear ${s} toSegment: ${t&&en(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(n,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,s,i){const{interstitial:o,assetItem:a,assetId:l}=e,c=o.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,n[s]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${To(a)}`),this.hls.trigger(A.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:n.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var n,s;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,a=this.schedule.findEventIndex(i.identifier),l=(n=this.schedule.items)==null?void 0:n[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const u=i.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const d=(c==null?void 0:c.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(u&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!UA(d,e.tracks)){const h=new Error(`Asset ${To(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),f={fatal:!0,type:xe.OTHER_ERROR,details:Z.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},m=i.findAssetIndex(o);this.handleAssetItemError(f,i,a,m,h.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const s=n.currentTime,i=t.findAssetIndex(e,s),o=e.assetList[i];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||s-o.timelineStart,c=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${a} ${e} (media.currentTime: ${s})`),l&&(c/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,s,i){if(e.details===Z.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&To(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,u=this.schedule.items,d=Ke({},e,{fatal:!1,errorAction:Qo(!0),asset:o,assetListIndex:s,event:t,schedule:u,scheduleIndex:n,player:c});if(this.hls.trigger(A.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,f=this.bufferingAsset,m=new Error(i);if(o&&(this.clearAssetPlayer(a,null),o.error=m),!t.assetList.some(p=>!p.error))t.error=m;else for(let p=s;p<t.assetList.length;p++)this.resetAssetPlayer(t.assetList[p].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===a?this.advanceAfterAssetEnded(t,n,s):f&&f.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,f)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${en(n)} error: ${e.error}`);let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);const i=this.updateItem(n,s);if(this.itemsMatch(n,i)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const o=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,t){var n,s;const i=t.event,o=i.identifier,a=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(o)))return;const l=i.timelineStart,c=i.duration;let u=0;a.forEach((p,g)=>{const y=parseFloat(p.DURATION);this.createAsset(i,g,u,l+u,y,p.URI),u+=y}),i.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${i}`);const d=this.waitingItem,h=(d==null?void 0:d.event.identifier)===o;this.updateSchedule();const f=(s=this.bufferingItem)==null?void 0:s.event;if(h){var m;const p=this.schedule.findEventIndex(o),g=(m=this.schedule.items)==null?void 0:m[p];if(g){if(!this.playingItem&&this.timelinePos>g.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==p){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(g)}this.setSchedulePosition(p)}else if((f==null?void 0:f.identifier)===o){const p=i.assetList[0];if(p){const g=this.getAssetPlayer(p.identifier);if(f.appendInPlace){const y=this.primaryMedia;g&&y&&this.bufferAssetPlayer(g,y)}else g&&g.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Z.ASSET_LIST_PARSING_ERROR:case Z.ASSET_LIST_LOAD_ERROR:case Z.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case Z.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const gb=500;class R5 extends my{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",me.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ne.IDLE,this.setInterval(gb),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:s}=t;if(this.fragContextChanged(n)||(St(n)&&(this.fragPrevious=n),this.state=ne.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=n.start;for(let c=0;c<i.length;c++)if(a>=i[c].start&&a<=i[c].end){o=i[c];break}const l=n.start+n.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:s}=t;if(n===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=i){o.shift();continue}else if(o[a].start<i)o[a].start=i;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(n,i,me.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===me.SUBTITLE&&(t.details===Z.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ne.STOPPED&&(this.state=ne.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Hk(this.levels,t)){this.levels=t.map(n=>new Yl(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const s=new Yl(n);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,me.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==ne.STOPPED&&this.setInterval(gb)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:s,levels:i}=this,{details:o,id:a}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=i[a];if(a>=i.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(n=l.details)!=null&&n.live){if(o.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const h=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(Hd(o,d),c=o.fragmentStart):h&&(c=h.start,Xm(o,c));else{var u;c=this.alignPlaylists(o,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&h&&(c=h.start,Xm(o,c))}d&&!this.startFragRequested&&this.setStartPosition(d,c)}l.details=o,this.levelLastLoaded=l,a===s&&(this.hls.trigger(A.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===ne.IDLE&&(Xi(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&s!=null&&s.key&&s.iv&&Xo(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer,fy(s.method)).catch(a=>{throw i.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(A.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=ne.IDLE})}}doTick(){if(!this.media){this.state=ne.IDLE;return}if(this.state===ne.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:s}=this,i=this.getLoadPosition(),o=_e.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:a,len:l}=o,c=n.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const d=c.fragments,h=d.length,f=c.edge;let m=null;const p=this.fragPrevious;if(a<f){const x=s.maxFragLookUpTolerance,w=a>f-x?0:x;m=Xi(p,d,Math.max(d[0].start,a),w),!m&&p&&p.start<d[0].start&&(m=d[0])}else m=d[h-1];if(m=this.filterReplacedPrimary(m,n.details),!m)return;const g=m.sn-c.startSN,y=d[g-1];if(y&&y.cc===m.cc&&this.fragmentTracker.getState(y)===Rt.NOT_LOADED&&(m=y),this.fragmentTracker.getState(m)===Rt.NOT_LOADED){const x=this.mapToInitFragWhenRequired(m);x&&this.loadFragment(x,n,a)}}}loadFragment(e,t,n){St(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new C5(this.tracksBuffered[this.currentTrackId]||[])}}class C5{constructor(e){this.buffered=void 0;const t=(n,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const L5={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},oI=r=>String.fromCharCode(L5[r]||r),nn=15,Kn=100,P5={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},D5={17:2,18:4,21:6,22:8,23:10,19:13,20:15},O5={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},N5={25:2,26:4,29:6,30:8,31:10,27:13,28:15},M5=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class F5{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;He.log(`${this.time} [${e}] ${n}`)}}}const yi=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class aI{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const s=t[n];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class j5{constructor(){this.uchar=" ",this.penState=new aI}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class $5{constructor(e){this.chars=[],this.pos=0,this.currPenState=new aI,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Kn;t++)this.chars.push(new j5);this.logger=e}equals(e){for(let t=0;t<Kn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Kn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Kn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Kn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Kn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=oI(e);if(this.pos>=Kn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Kn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Kn;n++){const s=this.chars[n].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Jf{constructor(e){this.rows=[],this.currRow=nn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<nn;t++)this.rows.push(new $5(e));this.logger=e}reset(){for(let e=0;e<nn;e++)this.rows[e].clear();this.currRow=nn-1}equals(e){let t=!0;for(let n=0;n<nn;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<nn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<nn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Qe(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<nn;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[i+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);n.setCursor(e.indent),e.color=n.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Qe(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",s=-1;for(let i=0;i<nn;i++){const o=this.rows[i].getTextString();o&&(s=i+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class yb{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Jf(n),this.nonDisplayedMemory=new Jf(n),this.lastOutputScreen=new Jf(n),this.currRollUpRow=this.displayedMemory.rows[nn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[nn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[n]}this.logger.log(2,"MIDROW: "+Qe(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class vb{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=U5(),this.logger=void 0;const s=this.logger=new F5;this.channels=[null,new yb(e,t,s),new yb(e+1,n,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const s=t[n]&127,i=t[n+1]&127;let o=!1,a=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+yi([t[n],t[n+1]])+"] -> ("+yi([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(B5(s,i,l)){vu(null,null,l),this.logger.log(3,()=>"Repeated command ("+yi([s,i])+") is dropped");continue}vu(s,i,this.cmdHistory),o=this.parseCmd(s,i),o||(o=this.parseMidrow(s,i)),o||(o=this.parsePAC(s,i)),o||(o=this.parseBackgroundAttributes(s,i))}else vu(null,null,l);if(!o&&(a=this.parseChars(s,i),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+yi([s,i])+" orig: "+yi([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(n||s))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[n];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+yi([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?n=o===1?P5[e]:O5[e]:n=o===1?D5[e]:N5[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(n,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let n;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,s.underline=(n&1)===1,n<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((n-16)/2)*4,s}parseChars(e,t){let n,s=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+oI(o)+"' in channel "+n),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+yi(s).join(",")),s}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(n||s))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=M5[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}vu(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function vu(r,e,t){t.a=r,t.b=e}function B5(r,e,t){return t.a===r&&t.b===e}function U5(){return{a:null,b:null}}var ky=function(){if(Gd!=null&&Gd.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function n(a){return t(r,a)}function s(a){return t(e,a)}function i(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)a[d]=u[d]}return a}function o(a,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let h="",f=!1,m=a,p=l,g=c,y=null,x="",w=!0,b="auto",E="start",I=50,S="middle",C=50,R="middle";Object.defineProperty(u,"id",i({},d,{get:function(){return h},set:function(L){h=""+L}})),Object.defineProperty(u,"pauseOnExit",i({},d,{get:function(){return f},set:function(L){f=!!L}})),Object.defineProperty(u,"startTime",i({},d,{get:function(){return m},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");m=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",i({},d,{get:function(){return p},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");p=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",i({},d,{get:function(){return g},set:function(L){g=""+L,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",i({},d,{get:function(){return y},set:function(L){y=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",i({},d,{get:function(){return x},set:function(L){const $=n(L);if($===!1)throw new SyntaxError("An invalid or illegal string was specified.");x=$,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",i({},d,{get:function(){return w},set:function(L){w=!!L,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",i({},d,{get:function(){return b},set:function(L){if(typeof L!="number"&&L!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");b=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",i({},d,{get:function(){return E},set:function(L){const $=s(L);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");E=$,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",i({},d,{get:function(){return I},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");I=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",i({},d,{get:function(){return S},set:function(L){const $=s(L);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");S=$,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",i({},d,{get:function(){return C},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");C=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",i({},d,{get:function(){return R},set:function(L){const $=s(L);if(!$)throw new SyntaxError("An invalid or illegal string was specified.");R=$,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class z5{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function lI(r){function e(n,s,i,o){return(n|0)*3600+(s|0)*60+(i|0)+parseFloat(o||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class G5{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let s=0;s<n.length;++s)if(t===n[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function cI(r,e,t,n){const s=n?r.split(n):[r];for(const i in s){if(typeof s[i]!="string")continue;const o=s[i].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const ig=new ky(0,0,""),xu=ig.align==="middle"?"middle":"center";function H5(r,e,t){const n=r;function s(){const a=lI(r);if(a===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),a}function i(a,l){const c=new G5;cI(a,function(h,f){let m;switch(h){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===f){c.set(h,t[p].region);break}break;case"vertical":c.alt(h,f,["rl","lr"]);break;case"line":m=f.split(","),c.integer(h,m[0]),c.percent(h,m[0])&&c.set("snapToLines",!1),c.alt(h,m[0],["auto"]),m.length===2&&c.alt("lineAlign",m[1],["start",xu,"end"]);break;case"position":m=f.split(","),c.percent(h,m[0]),m.length===2&&c.alt("positionAlign",m[1],["start",xu,"end","line-left","line-right","auto"]);break;case"size":c.percent(h,f);break;case"align":c.alt(h,f,["start",xu,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&ig.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",xu);let d=c.get("position","auto");d==="auto"&&ig.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){r=r.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),o(),e.endTime=s(),o(),i(r,e)}function uI(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class V5{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new z5,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let i=t.buffer,o=0;for(i=uI(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const a=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),a}function s(i){cI(i,function(o,a){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=n();const a=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=n(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new ky(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{H5(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=i.indexOf("-->")!==-1;if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const W5=/\r\n|\n\r|\n|\r/g,Zf=function(e,t,n=0){return e.slice(n,n+t.length)===t},K5=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!fe(t)||!fe(n)||!fe(s)||!fe(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*s,t+=60*60*1e3*i,t};function Iy(r,e,t){return gl(r.toString())+gl(e.toString())+gl(t)}const q5=function(e,t,n){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=n};function Y5(r,e,t,n,s,i,o){const a=new V5,l=Cr(new Uint8Array(r)).trim().replace(W5,`
`).split(`
`),c=[],u=e?t4(e.baseTime,e.timescale):0;let d="00:00.000",h=0,f=0,m,p=!0;a.oncue=function(g){const y=t[n];let x=t.ccOffset;const w=(h-u)/9e4;if(y!=null&&y.new&&(f!==void 0?x=t.ccOffset=y.start:q5(t,n,w)),w){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}x=w-t.presentationOffset}const b=g.endTime-g.startTime,E=wr((g.startTime+x-f)*9e4,s*9e4)/9e4;g.startTime=Math.max(E,0),g.endTime=Math.max(E+b,0);const I=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(I)),g.id||(g.id=Iy(g.startTime,g.endTime,I)),g.endTime>0&&c.push(g)},a.onparsingerror=function(g){m=g},a.onflush=function(){if(m){o(m);return}i(c)},l.forEach(g=>{if(p)if(Zf(g,"X-TIMESTAMP-MAP=")){p=!1,g.slice(16).split(",").forEach(y=>{Zf(y,"LOCAL:")?d=y.slice(6):Zf(y,"MPEGTS:")&&(h=parseInt(y.slice(7)))});try{f=K5(d)/1e3}catch(y){m=y}return}else g===""&&(p=!1);a.parse(g+`
`)}),a.flush()}const ep="stpp.ttml.im1t",dI=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,hI=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Q5={left:"start",center:"center",right:"end",start:"start",end:"end"};function xb(r,e,t,n){const s=Pe(new Uint8Array(r),["mdat"]);if(s.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(a=>Cr(a)),o=e4(e.baseTime,1,e.timescale);try{i.forEach(a=>t(X5(a,o)))}catch(a){n(a)}}function X5(r,e){const s=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((d,h)=>(d[h]=s.getAttribute(`ttp:${h}`)||i[h],d),{}),a=s.getAttribute("xml:space")!=="preserve",l=wb(tp(s,"styling","style")),c=wb(tp(s,"layout","region")),u=tp(s,"body","[begin]");return[].map.call(u,d=>{const h=fI(d,a);if(!h||!d.hasAttribute("begin"))return null;const f=np(d.getAttribute("begin"),o),m=np(d.getAttribute("dur"),o);let p=np(d.getAttribute("end"),o);if(f===null)throw bb(d);if(p===null){if(m===null)throw bb(d);p=f+m}const g=new ky(f-e,p-e,h);g.id=Iy(g.startTime,g.endTime,g.text);const y=c[d.getAttribute("region")],x=l[d.getAttribute("style")],w=J5(y,x,l),{textAlign:b}=w;if(b){const E=Q5[b];E&&(g.lineAlign=E),g.align=b}return Ke(g,w),g}).filter(d=>d!==null)}function tp(r,e,t){const n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function wb(r){return r.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function fI(r,e){return[].slice.call(r.childNodes).reduce((t,n,s)=>{var i;return n.nodeName==="br"&&s?t+`
`:(i=n.childNodes)!=null&&i.length?fI(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function J5(r,e,t){const n="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),i.reduce((a,l)=>{const c=rp(e,n,l)||rp(r,n,l)||rp(s,n,l);return c&&(a[l]=c),a},{})}function rp(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function bb(r){return new Error(`Could not parse ttml timestamp ${r}`)}function np(r,e){if(!r)return null;let t=lI(r);return t===null&&(dI.test(r)?t=Z5(r,e):hI.test(r)&&(t=e8(r,e))),t}function Z5(r,e){const t=dI.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function e8(r,e){const t=hI.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class wu{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class t8{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Eb(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new wu(this,"textTrack1"),t=new wu(this,"textTrack2"),n=new wu(this,"textTrack3"),s=new wu(this,"textTrack4");this.cea608Parser1=new vb(1,e,t),this.cea608Parser2=new vb(3,n,s)}addCues(e,t,n,s,i){let o=!1;for(let a=i.length;a--;){const l=i[a],c=r8(l[0],l[1],t,n);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],n),o=!0,c/(n-t)>.5))return}if(o||i.push([t,n]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,n,s)}else{const a=this.Cues.newCue(null,t,n,s);this.hls.trigger(A.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:i,trackId:o}){const{unparsedVttFrags:a}=this;n===me.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(A.FRAG_LOADED,l):this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let s=0;s<n.textTracks.length;s++){const i=n.textTracks[s];if(Sb(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:s}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(i,o);if(a)n[e]=a,$o(n[e]),nI(n[e],s);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,s={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,n){const s=this.media;if(s)return s.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{$o(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Eb(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)$o(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],s=n.some(i=>i.textCodec===ep);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Hk(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const o=this.media,a=o?Yu(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let d=null;for(let h=0;h<a.length;h++)if(a[h]&&Sb(a[h],l)){d=a[h],a[h]=null;break}d&&(u=d)}if(u)$o(u);else{const d=pI(l);u=this.createTextTrack(d,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!s)return;const i=`textTrack${s[1]}`,o=this.captionsProperties[i];o&&(o.label=n.name,n.lang&&(o.languageCode=n.lang),o.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===me.MAIN){var n,s;const{cea608Parser1:i,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,u=(n=(s=t.part)==null?void 0:s.index)!=null?n:-1;i&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:n,payload:s}=t;if(n.type===me.SUBTITLE)if(s.byteLength){const i=n.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const a=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),a&&a.textCodec===ep?this._parseIMSC1(n,s):this._parseVTTs(t)}}else this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;xb(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),n.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{n.logger.log(`Failed to parse IMSC1: ${s}`),n.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:n,payload:s}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[n.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=n.initSegment)!=null&&t.data?Hr(n.initSegment.data,new Uint8Array(s)).buffer:s;Y5(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,u=>{this._appendCues(u,n.level),l.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},u=>{const d=u.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(n,s),l.logger.log(`Failed to parse VTT cue: ${u}`),!(d&&a>n.cc)&&l.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:u})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||xb(t,this.initPTS[e.cc],()=>{n.textCodec=ep,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>sI(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;n.trigger(A.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===me.SUBTITLE&&this.onFragLoaded(A.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:s}=t;if(!(n.type===me.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let i=0;i<s.length;i++){const o=s[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(s[i].pts,a[0]),this.cea608Parser2.addData(s[i].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:s,type:i}){const{media:o}=this;if(!(!o||o.currentTime<n)){if(!i||i==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>sg(a[l],t,n))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>sg(a[l],t,s))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let s=2;for(let i=0;i<n;i++){const o=e[s++],a=127&e[s++],l=127&e[s++];if(a===0&&l===0)continue;if((4&o)!==0){const u=3&o;(u===0||u===1)&&(t[u].push(a),t[u].push(l))}}return t}}function pI(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function Sb(r,e){return!!r&&r.kind===pI(e)&&eg(e,r)}function r8(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function Eb(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const n8=/\s/,s8={newCue(r,e,t,n){const s=[];let i,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<n.rows.length;h++)if(i=n.rows[h],a=!0,l=0,c="",!i.isEmpty()){var d;for(let p=0;p<i.chars.length;p++)n8.test(i.chars[p].uchar)&&a?l++:(c+=i.chars[p].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const f=uI(c.trim()),m=Iy(e,t,f);r!=null&&(d=r.cues)!=null&&d.getCueById(m)||(o=new u(e,t,f),o.id=m,o.line=h+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(o))}return r&&s.length&&(s.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),s.forEach(h=>sI(r,h))),s}};function i8(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const o8=/(\d+)-(\d+)\/(\d+)/;class Tb{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||u8,this.controller=new self.AbortController,this.stats=new oy}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=a8(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&fe(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Jl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const f=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},c-(f-s.loading.start)),!d.ok){const{status:p,statusText:g}=d;throw new d8(g||"fetch, bad network response",p,d)}s.loading.first=f,s.total=c8(d.headers)||s.total;const m=(h=this.callbacks)==null?void 0:h.onProgress;return m&&fe(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,m):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,f;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const p=d[a];p&&(s.loaded=s.total=p);const g={url:m.url,data:d,code:m.status},y=(h=this.callbacks)==null?void 0:h.onProgress;y&&!fe(t.highWaterMark)&&y(s,e,d,m),(f=this.callbacks)==null||f.onSuccess(g,s,e,m)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const f=d&&d.code||0,m=d?d.message:null;(h=this.callbacks)==null||h.onError({code:f,text:m},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,s=0,i){const o=new Tk,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&i(t,n,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<s||o.dataLength?(o.push(u),o.dataLength>=s&&i(t,n,o.flush().buffer,e)):i(t,n,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function a8(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ke({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function l8(r){const e=o8.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function c8(r){const e=r.get("Content-Range");if(e){const n=l8(e);if(fe(n))return n}const t=r.get("Content-Length");if(t)return parseInt(t)}function u8(r,e){return new self.Request(r.url,e)}class d8 extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const h8=/^age:\s*[\d.]+\s*$/im;class mI{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new oy,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return i(n,t.url)}).catch(o=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),i(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:n.status,text:o.message},t,n,s)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=n.loadPolicy;if(s)for(const a in s)e.setRequestHeader(a,s[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=i&&fe(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!n.aborted&&s>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const m=u??t.response;if(m!=null){var o,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const p=t.responseType==="arraybuffer"?m.byteLength:m.length;n.loaded=n.total=p,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const g=(o=this.callbacks)==null?void 0:o.onProgress;g&&g(n,e,m,t);const y={url:t.responseURL,data:m,code:c};(a=this.callbacks)==null||a.onSuccess(y,n,e,t);return}}const d=i.loadPolicy.errorRetry,h=n.retry,f={url:e.url,data:void 0,code:c};if(Ud(d,h,!1,f))this.retry(d);else{var l;He.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Ud(e,t,!0))this.retry(e);else{var n;He.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=uy(e,n.retry),n.retry++,He.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&h8.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const f8={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},p8=Ge(Ge({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:mI,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AU,bufferController:g4,capLevelController:Ty,errorController:LU,fpsController:y5,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:fk,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:f8},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},m8()),{},{subtitleStreamController:R5,subtitleTrackController:w5,timelineController:t8,audioStreamController:h4,audioTrackController:f4,emeController:Jo,cmcdController:f5,contentSteeringController:m5,interstitialsController:I5});function m8(){return{cueHandler:s8,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function g8(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=og(r),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,c=[];i.forEach(u=>{const d=`${o}Loading${u}`,h=e[d];if(h!==void 0&&l){c.push(d);const f=n[a].default;switch(e[a]={default:f},u){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${Qe(e[a])}`)}),Ge(Ge({},n),e)}function og(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(og):Object.keys(r).reduce((e,t)=>(e[t]=og(r[t]),e),{}):r}function y8(r,e){const t=r.loader;t!==Tb&&t!==mI?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):i8()&&(r.loader=Tb,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Qu=2,v8=.1,x8=.05,w8=100;class b8 extends lk{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(w8),this.mediaSource=t.mediaSource;const n=this.media=t.media;er(n,"playing",this.onMediaPlaying),er(n,"waiting",this.onMediaWaiting),er(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(dr(n,"playing",this.onMediaPlaying),dr(n,"waiting",this.onMediaWaiting),dr(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,s;const i=(n=this.hls)==null?void 0:n.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,u=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1}));return}if(!_e.getBuffered(o).length){this.nudgeRetry=0;return}const d=_e.bufferInfo(o,e,0),h=d.nextStart||0,f=this.fragmentTracker;if(a&&f&&this.hls){const I=_b(this.hls.inFlightFragments,e),S=d.len>Qu,C=!h||I||h-e>Qu&&!f.getPartialFragment(e);if(S||C)return;this.moved=!1}const m=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&f){if(!(d.len>0)&&!h)return;const S=Math.max(h,d.start||0)-e,R=!!(m!=null&&m.live)?m.targetduration*2:Qu,L=bu(e,f);if(S>0&&(S<=R||L)){o.paused||this._trySkipBufferHole(L);return}}const p=i.detectStallWithCurrentTimeMs,g=self.performance.now(),y=this.waiting;let x=this.stalled;if(x===null)if(y>0&&g-y<p)x=this.stalled=y;else{this.stalled=g;return}const w=g-x;if(!a&&(w>=p||y)&&this.hls){var b;if(((b=this.mediaSource)==null?void 0:b.readyState)==="ended"&&!(m!=null&&m.live)&&Math.abs(e-((m==null?void 0:m.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const E=_e.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(E,w,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(A.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&s&&s.length>1&&e>s.end(0)){const i=_e.bufferedInfo(_e.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=_e.timeRangesToArray(s),a=_e.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=_e.bufferedInfo(o,e,0).bufferedIndex,c=o[a].end,u=o[a+1].start;if((l===-1||l>a)&&u-c<1&&e-c<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let h=bu(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);const f=_e.bufferInfo(this.media,e,0);this.hls.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t,n){var s,i;const{fragmentTracker:o,media:a}=this,l=(s=this.hls)==null?void 0:s.config;if(!a||!o||!l)return;const c=(i=this.hls)==null?void 0:i.latestLevelDetails,u=bu(n,o);if((u||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,n);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-n<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,s=e.nextStart;if(n&&s){const i=n.getFragAtPos(t,me.MAIN),o=n.getFragAtPos(s,me.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:s,stalled:i}=this;if(!s&&i!==null&&n&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${Qe(e)})`);this.warn(o.message),t.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!n||!i)return 0;const o=s.currentTime,a=_e.bufferInfo(s,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const u=a.len<=i.maxBufferHole,d=a.len>0&&a.len<1&&s.readyState<3,h=l-o;if(h>0&&(u||d)){if(h>i.maxBufferHole){let m=!1;if(o===0){const p=n.getAppendedFrag(0,me.MAIN);p&&l<p.end&&(m=!0)}if(!m&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||_b(this.hls.inFlightFragments,l))return 0;let g=!1,y=e.end;for(;y<l;){const x=bu(y,n);if(x)y+=x.duration;else{g=!0;break}}if(g)return 0}}const f=Math.max(l+x8,o+v8);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${f}`),this.moved=!0,s.currentTime=f,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${f}`),p={type:xe.MEDIA_ERROR,details:Z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?p.part=e:p.frag=e),this.hls.trigger(A.ERROR,p)}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!n||!i)return 0;const o=n.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const a=o+(s+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),n.currentTime=a,t.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function _b(r,e){const t=Ab(r.main);if(t&&t.start<=e)return t;const n=Ab(r.audio);return n&&n.start<=e?n:null}function Ab(r){if(!r)return null;switch(r.state){case ne.IDLE:case ne.STOPPED:case ne.ENDED:case ne.ERROR:return null}return r.frag}function bu(r,e){return e.getAppendedFrag(r,me.MAIN)||e.getPartialFragment(r)}const S8=.25;function ag(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function sp(r,e,t,n,s){let i=new r(e,t,"");try{i.value=n,s&&(i.type=s)}catch{i=new r(e,t,Qe(s?Ge({type:s},n):n))}return i}const Su=(()=>{const r=ag();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class E8{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(A.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&$o(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return nI(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:s}=this.hls.config;if(!n&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=ag();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Er.emsg&&!n||!s)continue;const c=Lk(i[a].data),u=i[a].pts;let d=u+i[a].duration;d>Su&&(d=Su),d-u<=0&&(d=u+S8);for(let f=0;f<c.length;f++){const m=c[f];if(!Pk(m)){this.updateId3CueEnds(u,l);const p=sp(o,u,d,m,l);p&&this.id3Track.addCue(p)}}}}updateId3CueEnds(e,t){var n;const s=(n=this.id3Track)==null?void 0:n.cues;if(s)for(let i=s.length;i--;){const o=s[i];o.type===t&&o.startTime<e&&o.endTime===Su&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:s}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let c;s==="audio"?c=u=>u.type===Er.audioId3&&l:s==="video"?c=u=>u.type===Er.emsg&&a:c=u=>u.type===Er.audioId3&&l||u.type===Er.emsg&&a,sg(i,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const a=ag();if(n&&s&&!o){const{fragmentStart:p,fragmentEnd:g}=e;let y=this.assetCue;y?(y.startTime=p,y.endTime=g):a&&(y=this.assetCue=sp(a,p,g,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),y&&(y.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(y),y.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let d=this.dateRangeCuesAppended;if(l&&t){var h;if((h=l.cues)!=null&&h.length){const p=Object.keys(d).filter(g=>!u.includes(g));for(let g=p.length;g--;){var f;const y=p[g],x=(f=d[y])==null?void 0:f.cues;delete d[y],x&&Object.keys(x).forEach(w=>{const b=x[w];if(b){b.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(b)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const m=e.fragments[e.fragments.length-1];if(!(u.length===0||!fe(m==null?void 0:m.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let p=0;p<u.length;p++){const g=u[p],y=c[g],x=y.startTime,w=d[g],b=(w==null?void 0:w.cues)||{};let E=(w==null?void 0:w.durationKnown)||!1,I=Su;const{duration:S,endDate:C}=y;if(C&&S!==null)I=x+S,E=!0;else if(y.endOnNext&&!E){const L=u.reduce(($,P)=>{if(P!==y.id){const U=c[P];if(U.class===y.class&&U.startDate>y.startDate&&(!$||y.startDate<$.startDate))return U}return $},null);L&&(I=L.startTime,E=!0)}const R=Object.keys(y.attr);for(let L=0;L<R.length;L++){const $=R[L];if(!HU($))continue;const P=b[$];if(P)E&&!(w!=null&&w.durationKnown)?P.endTime=I:Math.abs(P.startTime-x)>.01&&(P.startTime=x,P.endTime=I);else if(a){let U=y.attr[$];VU($)&&(U=zA(U));const H=sp(a,x,I,{key:$,data:U},Er.dateRange);H&&(H.id=g,this.id3Track.addCue(H),b[$]=H,o&&($==="X-ASSET-LIST"||$==="X-ASSET-URL")&&H.addEventListener("enter",this.onEventCueEnter))}}d[g]={cues:b,dateRange:y,durationKnown:E}}}}}class T8{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!n.live)return;const a=this.targetLatency;if(a===null)return;const l=s-a,c=Math.min(this.maxLatency,a+n.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,f=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&n||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=i!==void 0?i:o*s);const u=s;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const s=n.edge,i=e-t-this.edgeStalled,o=s-n.totalduration,a=s-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(o,i),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,s;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class _8 extends Ey{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,s=[],i={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(u=>{const d=u.attrs;let{audioCodec:h,videoCodec:f}=u;h&&(u.audioCodec=h=Fd(h,n)||void 0),f&&(f=u.videoCodec=aU(f));const{width:m,height:p,unknownCodecs:g}=u,y=(g==null?void 0:g.length)||0;if(a||(a=!!(m&&p)),l||(l=!!f),c||(c=!!h),y||h&&!this.isAudioSupported(h)||f&&!this.isVideoSupported(f)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:x,"FRAME-RATE":w,"HDCP-LEVEL":b,"PATHWAY-ID":E,RESOLUTION:I,"VIDEO-RANGE":S}=d,R=`${`${E||"."}-`}${u.bitrate}-${I}-${w}-${x}-${S}-${b}`;if(i[R])if(i[R].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const L=o[R]+=1;u.attrs["PATHWAY-ID"]=new Array(L+1).join(".");const $=this.createLevel(u);i[R]=$,s.push($)}else i[R].addGroupId("audio",d.AUDIO),i[R].addGroupId("text",d.SUBTITLES);else{const L=this.createLevel(u);i[R]=L,o[R]=1,s.push(L)}}),this.filterAndSortMediaOptions(s,t,a,l,c)}createLevel(e){const t=new Yl(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(s.message),t.supportedResult=ek(s,[])}return t}isAudioSupported(e){return Kl(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Kl(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,s,i){var o;let a=[],l=[],c=e;const u=((o=t.stats)==null?void 0:o.parsing)||{};if((n||s)&&i&&(c=c.filter(({videoCodec:x,videoRange:w,width:b,height:E})=>(!!x||!!(b&&E))&&yU(w))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let x="no level with compatible codecs found in manifest",w=x;t.levels.length&&(w=`one or more CODECS in variant not supported: ${Qe(t.levels.map(E=>E.attrs.CODECS).filter((E,I,S)=>S.indexOf(E)===I))}`,this.warn(w),x+=` (${w})`);const b=new Error(x);this.hls.trigger(A.ERROR,{type:xe.MEDIA_ERROR,details:Z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:b,reason:w})}}),u.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(x=>!x.audioCodec||this.isAudioSupported(x.audioCodec)),kb(a)),t.subtitles&&(l=t.subtitles,kb(l));const d=c.slice(0);c.sort((x,w)=>{if(x.attrs["HDCP-LEVEL"]!==w.attrs["HDCP-LEVEL"])return(x.attrs["HDCP-LEVEL"]||"")>(w.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&x.height!==w.height)return x.height-w.height;if(x.frameRate!==w.frameRate)return x.frameRate-w.frameRate;if(x.videoRange!==w.videoRange)return jd.indexOf(x.videoRange)-jd.indexOf(w.videoRange);if(x.videoCodec!==w.videoCodec){const b=vw(x.videoCodec),E=vw(w.videoCodec);if(b!==E)return E-b}if(x.uri===w.uri&&x.codecSet!==w.codecSet){const b=Md(x.codecSet),E=Md(w.codecSet);if(b!==E)return E-b}return x.averageBitrate!==w.averageBitrate?x.averageBitrate-w.averageBitrate:0});let h=d[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==d.length)){for(let x=0;x<d.length;x++)if(d[x].pathwayId===c[0].pathwayId){h=d[x];break}}this._levels=c;for(let x=0;x<c.length;x++)if(c[x]===h){var f;this._firstLevel=x;const w=h.bitrate,b=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${w}`),((f=this.hls.userConfig)==null?void 0:f.abrEwmaDefaultEstimate)===void 0){const E=Math.min(w,this.hls.config.abrEwmaDefaultEstimateMax);E>b&&b===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=E)}break}const m=i&&!s,p=this.hls.config,g=!!(p.audioStreamController&&p.audioTrackController),y={levels:c,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:g&&!m&&a.some(x=>!!x.url)};u.end=performance.now(),this.hls.trigger(A.MANIFEST_PARSED,y)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,n===e&&s&&i===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${n}${i?" with Pathway "+i:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(A.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,s==null?void 0:s.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===Ne.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===me.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(i=>!!n[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var n;const{level:s,details:i}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${s}`),(a=t.deliveryDirectives)!=null&&a.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(n=t.deliveryDirectives)!=null&&n.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${n}`),this.hls.trigger(A.LEVEL_LOADING,{url:n,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(a=>a.level=-1)),!1));bk(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=n.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(A.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(A.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function kb(r){const e={};r.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function gI(){return self.SourceBuffer||self.WebKitSourceBuffer}function yI(){if(!ii())return!1;const e=gI();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function A8(){if(!yI())return!1;const r=ii();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(ql(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(ql(e,"audio"))))}function k8(){var r;const e=gI();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const I8=100;class R8 extends my{constructor(e,t,n){super(e,t,n,"stream-controller",me.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!fe(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(s,i,me.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:s}=this;if(this.stopLoad(),this.setInterval(I8),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=ne.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ne.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ne.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&(!s.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(s))break;this.state=ne.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ne.IDLE;break}break}case ne.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ne.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[i]))return;const o=n[i],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const p={};this.altAudio===2&&(p.type="video"),this.hls.trigger(A.BUFFER_EOS,p),this.state=ne.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const c=o.details;if(!c||this.state===ne.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=ne.WAITING_LEVEL,this.startFragRequested=!1;return}const u=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(u>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:a.end;let f=this.getNextFragment(h,c);if(this.couldBacktrack&&!this.fragPrevious&&f&&St(f)&&this.fragmentTracker.getState(f)!==Rt.OK){var m;const g=((m=this.backtrackFragment)!=null?m:f).sn-c.startSN,y=c.fragments[g-1];y&&f.cc===y.cc&&(f=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const g=this.audioOnly&&!this.altAudio?Ye.AUDIO:Ye.VIDEO,y=(g===Ye.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,g,me.MAIN)}f=this.getNextFragmentLoopLoading(f,c,a,me.MAIN,d)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,o,h))}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);s===Rt.NOT_LOADED||s===Rt.PARTIAL?St(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,me.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<i.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:n=0}else n=0;const o=this.getBufferedFrag(t.currentTime+n);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,u=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ne.KEY_LOADING:case ne.FRAG_LOADING:case ne.FRAG_LOADING_WAITING_RETRY:case ne.PARSING:case ne.PARSED:this.state=ne.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;er(n,"playing",this.onMediaPlaying),er(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(dr(n,"playing",this.onMediaPlaying),dr(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(A.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,s=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(n=n||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&s&&!k8(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==ne.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=ne.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:s,startFragRequested:i}=this,o=t.level,a=t.details,l=a.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===ne.FRAG_LOADING||this.state===ne.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let d=0;if(a.live||(n=c.details)!=null&&n.live){var h;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(c.details=a,this.levelLastLoaded=c,i||this.setStartPosition(a,d),this.hls.trigger(A.LEVEL_UPDATED,{details:a,level:o}),this.state===ne.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=ne.IDLE}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=i>=o-t.maxFragLookUpTolerance&&i<=a;if(s!==null&&n.duration>s&&(i<s||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&n.readyState<4||i<a-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),n.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const d=_e.bufferInfo(n,s,0);if(!((c=d.buffered)!=null&&c.length)){n.currentTime=s;return}if(d.start<=i){n.currentTime=s;return}const{nextStart:f}=_e.bufferedInfo(d.buffered,i,0);f&&(n.currentTime=f)}else n.currentTime=s}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const a=o[n.level];if(!a){this.warn(`Level ${n.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=a.videoCodec,u=l.PTSKnown||!l.live,d=(t=n.initSegment)==null?void 0:t.data,h=this._getAudioCodec(a),f=this.transmuxer=this.transmuxer||new Gk(this.hls,me.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=s?s.index:-1,p=m!==-1,g=new hy(n.level,n.sn,n.stats.chunkCount,i.byteLength,m,p),y=this.initPTS[n.cc];f.push(i,d,h,c,n,s,l.totalduration,u,g,y)}onAudioTrackSwitching(e,t){const n=this.hls,s=this.altAudio===2;if($d(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),n.once(A.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(A.AUDIO_TRACK_SWITCHED,t)}),n.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(A.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=$d(t.url,this.hls);if(n){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let s,i,o=!1;for(const a in n){const l=n[a];if(l.id==="main"){if(i=a,s=l,a==="video"){const c=n[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:s}=t,i=n.type===me.MAIN;if(i){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ne.PARSED&&(this.state=ne.IDLE);return}const a=s?s.stats:n.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),St(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,s)}const o=this.media;o&&(!this._hasEnoughToStart&&_e.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=ne.ERROR;return}switch(t.details){case Z.FRAG_GAP:case Z.FRAG_PARSING_ERROR:case Z.FRAG_DECRYPT_ERROR:case Z.FRAG_LOAD_ERROR:case Z.FRAG_LOAD_TIMEOUT:case Z.KEY_LOAD_ERROR:case Z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.MAIN,t);break;case Z.LEVEL_LOAD_ERROR:case Z.LEVEL_LOAD_TIMEOUT:case Z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ne.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Ne.LEVEL&&(this.state=ne.IDLE);break;case Z.BUFFER_ADD_CODEC_ERROR:case Z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ne.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ye.AUDIO||!this.altAudio){const n=(t===Ye.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,me.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&n&&(n+=s);const i=this.getLevelDetails(),o=_e.getBuffered(e),a=o.length?o.start(0):0,l=a-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),n+=l,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${a}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:s}=this,i=n==null?void 0:n.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=ne.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(A.FRAG_LOADED,n),i.bitrateTest=!1}).catch(n=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:s,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:a,part:l,level:c}=o,{video:u,text:d,id3:h,initSegment:f}=s,{details:m}=c,p=this.altAudio?void 0:s.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=ne.PARSING,f){const g=f.tracks;if(g){const b=a.initSegment||a;if(this.unhandledEncryptionError(f,a))return;this._bufferInitSegment(c,g,b,i),n.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:t,tracks:g})}const y=f.initPTS,x=f.timescale,w=this.initPTS[a.cc];if(fe(y)&&(!w||w.baseTime!==y||w.timescale!==x)){const b=f.trackId;this.initPTS[a.cc]={baseTime:y,timescale:x,trackId:b},n.trigger(A.INIT_PTS_FOUND,{frag:a,id:t,initPTS:y,timescale:x,trackId:b})}}if(u&&m){p&&u.type==="audiovideo"&&this.logMuxedErr(a);const g=m.fragments[a.sn-1-m.startSN],y=a.sn===m.startSN,x=!g||a.cc>g.cc;if(s.independent!==!1){const{startPTS:w,endPTS:b,startDTS:E,endDTS:I}=u;if(l)l.elementaryStreams[u.type]={startPTS:w,endPTS:b,startDTS:E,endDTS:I};else if(u.firstKeyFrame&&u.independent&&i.id===1&&!x&&(this.couldBacktrack=!0),u.dropped&&u.independent){const S=this.getMainFwdBufferInfo(),C=(S?S.end:this.getLoadPosition())+this.config.maxBufferHole,R=u.firstKeyFramePTS?u.firstKeyFramePTS:w;if(!y&&C<R-this.config.maxBufferHole&&!x){this.backtrack(a);return}else x&&(a.gap=!0);a.setElementaryStreamInfo(u.type,a.start,b,a.start,I,!0)}else y&&w-(m.appliedTimelineOffset||0)>Qu&&(a.gap=!0);a.setElementaryStreamInfo(u.type,w,b,E,I),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,l,i,y||x)}else if(y||x)a.gap=!0;else{this.backtrack(a);return}}if(p){const{startPTS:g,endPTS:y,startDTS:x,endDTS:w}=p;l&&(l.elementaryStreams[Ye.AUDIO]={startPTS:g,endPTS:y,startDTS:x,endDTS:w}),a.setElementaryStreamInfo(Ye.AUDIO,g,y,x,w),this.bufferFragmentData(p,a,l,i)}if(m&&h!=null&&h.samples.length){const g={id:t,frag:a,details:m,samples:h.samples};n.trigger(A.FRAG_PARSING_METADATA,g)}if(m&&d){const g={id:t,frag:a,details:m,samples:d.samples};n.trigger(A.FRAG_PARSING_USERDATA,g)}}logMuxedErr(e){this.warn(`${St(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,s){if(this.state!==ne.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:i,video:o,audiovideo:a}=t;if(i){const c=e.audioCodec;let u=Gu(i.codec,c);u==="mp4a"&&(u="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const h=i.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),i.levelCodec=u,i.id=me.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=me.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(A.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const d=t[c].initSegment;d!=null&&d.byteLength&&this.hls.trigger(A.BUFFER_APPENDING,{type:c,data:d,frag:n,part:null,chunkMeta:s,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,me.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ne.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(_e.isBuffered(e,n)?t=this.getAppendedFrag(n):_e.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(A.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(A.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return fe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(fe(t)){const n=this.getLevelDetails(),s=this.currentFrag||(n?Xi(null,n.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const o=i+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class C8 extends Kr{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[n].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Z.KEY_LOAD_ERROR,n,s,i){return new Xn({type:xe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:n,networkDetails:s})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const o=t[s];if(e.cc<=o.cc&&(!St(e)||!St(o)||e.sn<o.sn)||!n&&s==i-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=Vu(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const s=el(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Z.KEY_LOAD_ERROR,c))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,Z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=ip(i);let l=this.keyIdToKeyInfo[a];if((n=l)!=null&&n.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(s=l)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:d}=u;return i.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${i.keyId?" keyId: "+Zt(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,Z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const o=YB(t.initSegment.data);if(o.length){const a=o[0];a.some(l=>l!==0)&&(this.log(`Using keyId found in init segment ${Zt(a)}`),e.decryptdata.keyId=a,Ui.setKeyIdForUri(e.decryptdata.uri,a))}}const i=this.emeController.loadKey(n);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,n))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,s=n.loader,i=new s(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,m,p)=>{const{frag:g,keyInfo:y}=m,x=ip(y.decryptdata);if(!g.decryptdata||y!==this.keyIdToKeyInfo[x])return a(this.createKeyLoadError(g,Z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));y.decryptdata.key=g.decryptdata.key=new Uint8Array(h.data),g.keyLoader=null,y.loader=null,o({frag:g,keyInfo:y})},onError:(h,f,m,p)=>{this.resetLoader(f),a(this.createKeyLoadError(t,Z.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),m,Ge({url:l.url,data:void 0},h)))},onTimeout:(h,f,m)=>{this.resetLoader(f),a(this.createKeyLoadError(t,Z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(h,f,m)=>{this.resetLoader(f),a(this.createKeyLoadError(t,Z.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};i.load(l,u,d)})}resetLoader(e){const{frag:t,keyInfo:n,url:s}=e,i=n.loader;t.keyLoader===i&&(t.keyLoader=null,n.loader=null);const o=ip(n.decryptdata)||s;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function ip(r){if(r.keyFormat!==$t.FAIRPLAY){const e=r.keyId;if(e)return Zt(e)}return r.uri}function Ib(r){const{type:e}=r;switch(e){case Ne.AUDIO_TRACK:return me.AUDIO;case Ne.SUBTITLE_TRACK:return me.SUBTITLE;default:return me.MAIN}}function op(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class L8{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,s=t.loader,i=n||s,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ne.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:s,pathwayId:i,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:n,level:s,pathwayId:i,responseType:"text",type:Ne.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:n,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:Ne.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:s,url:i,deliveryDirectives:o,track:a}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:Ne.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const n=this.loaders[Ne.LEVEL];if(n){const s=n.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(n.abort(),delete this.loaders[Ne.LEVEL])}}load(e){var t;const n=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=this.hls.logger,u=s.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===Ne.MANIFEST?i=n.manifestLoadPolicy.default:i=Ke({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),fe((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Ne.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Ne.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Ne.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const h=Math.max(u*3,d*.8)*1e3;i=Ke({},i,{maxTimeToFirstByteMs:Math.min(h,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,u,d,h)=>{const f=this.getInternalLoader(d);this.resetInternalLoader(d.type);const m=c.data;u.parsing.start=performance.now(),Dn.isMediaPlaylist(m)||d.type!==Ne.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,d,h||null,f):this.handleMasterPlaylist(c,u,d,h)},onError:(c,u,d,h)=>{this.handleNetworkError(u,d,!1,c,h)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}};s.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,s){const i=this.hls,o=e.data,a=op(e,n),l=Dn.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,l.playlistParsingError,s,t);return}const{contentSteering:c,levels:u,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:m}=l;this.variableList=m,u.forEach(x=>{const{unknownCodecs:w}=x;if(w){const{preferManagedMediaSource:b}=this.hls.config;let{audioCodec:E,videoCodec:I}=x;for(let S=w.length;S--;){const C=w[S];Kl(C,"audio",b)?(x.audioCodec=E=E?`${E},${C}`:C,Ta.audio[E.substring(0,4)]=2,w.splice(S,1)):Kl(C,"video",b)&&(x.videoCodec=I=I?`${I},${C}`:C,Ta.video[I.substring(0,4)]=2,w.splice(S,1))}}});const{AUDIO:p=[],SUBTITLES:g,"CLOSED-CAPTIONS":y}=Dn.parseMasterPlaylistMedia(o,a,l);p.length&&!p.some(w=>!w.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new at({}),bitrate:0,url:""})),i.trigger(A.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:g,captions:y,contentSteering:c,url:a,stats:t,networkDetails:s,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:m})}handleTrackOrLevelPlaylist(e,t,n,s,i){const o=this.hls,{id:a,level:l,type:c}=n,u=op(e,n),d=fe(l)?l:fe(a)?a:0,h=Ib(n),f=Dn.parseLevelPlaylist(e.data,u,d,h,0,this.variableList);if(c===Ne.MANIFEST){const m={attrs:new at({}),bitrate:0,details:f,name:"",url:u};f.requestScheduled=t.loading.start+vk(f,0),o.trigger(A.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:u,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=f,this.handlePlaylistLoaded(f,e,t,n,s,i)}handleManifestParsingError(e,t,n,s,i){this.hls.trigger(A.ERROR,{type:xe.NETWORK_ERROR,details:Z.MANIFEST_PARSING_ERROR,fatal:t.type===Ne.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,n=!1,s,i){let o=`A network ${n?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Ne.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Ne.AUDIO_TRACK||e.type===Ne.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=Z.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case Ne.MANIFEST:l=n?Z.MANIFEST_LOAD_TIMEOUT:Z.MANIFEST_LOAD_ERROR,c=!0;break;case Ne.LEVEL:l=n?Z.LEVEL_LOAD_TIMEOUT:Z.LEVEL_LOAD_ERROR,c=!1;break;case Ne.AUDIO_TRACK:l=n?Z.AUDIO_TRACK_LOAD_TIMEOUT:Z.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Ne.SUBTITLE_TRACK:l=n?Z.SUBTITLE_TRACK_LOAD_TIMEOUT:Z.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const d={type:xe.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:i};if(s){const h=(t==null?void 0:t.url)||e.url;d.response=Ge({url:h,data:void 0},s)}this.hls.trigger(A.ERROR,d)}handlePlaylistLoaded(e,t,n,s,i,o){const a=this.hls,{type:l,level:c,levelOrTrack:u,id:d,groupId:h,deliveryDirectives:f}=s,m=op(t,s),p=Ib(s);let g=typeof s.level=="number"&&p===me.MAIN?c:void 0;const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(`${y} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(A.ERROR,{type:xe.NETWORK_ERROR,details:Z.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:y,reason:y.message,response:t,context:s,level:g,parent:p,networkDetails:i,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const x=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(A.ERROR,{type:xe.NETWORK_ERROR,details:Z.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:x,reason:x.message,response:t,context:s,level:g,parent:p,networkDetails:i,stats:n});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Ne.MANIFEST:case Ne.LEVEL:if(g){if(!u)g=0;else if(u!==a.levels[g]){const x=a.levels.indexOf(u);x>-1&&(g=x)}}a.trigger(A.LEVEL_LOADED,{details:e,levelInfo:u||a.levels[0],level:g||0,id:d||0,stats:n,networkDetails:i,deliveryDirectives:f,withoutMultiVariant:l===Ne.MANIFEST});break;case Ne.AUDIO_TRACK:a.trigger(A.AUDIO_TRACK_LOADED,{details:e,track:u,id:d||0,groupId:h||"",stats:n,networkDetails:i,deliveryDirectives:f});break;case Ne.SUBTITLE_TRACK:a.trigger(A.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:d||0,groupId:h||"",stats:n,networkDetails:i,deliveryDirectives:f});break}}}class $r{static get version(){return Ql}static isMSESupported(){return yI()}static isSupported(){return A8()}static getMediaSource(){return ii()}static get Events(){return A}static get MetadataSchema(){return Er}static get ErrorTypes(){return xe}static get ErrorDetails(){return Z}static get DefaultConfig(){return $r.defaultConfig?$r.defaultConfig:p8}static set DefaultConfig(e){$r.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new gy,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=FB(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=g8($r.DefaultConfig,e,t);this.userConfig=e,n.progressive&&y8(n,t);const{abrController:s,bufferController:i,capLevelController:o,errorController:a,fpsController:l}=n,c=new a(this),u=this.abrController=new s(this),d=new PU(this),h=n.interstitialsController,f=h?this.interstitialsController=new h(this,$r):null,m=this.bufferController=new i(this,d),p=this.capLevelController=new o(this),g=new l(this),y=new L8(this),x=n.contentSteeringController,w=x?new x(this):null,b=this.levelController=new _8(this,w),E=new E8(this),I=new C8(this.config,this.logger),S=this.streamController=new R8(this,d,I),C=this.gapController=new b8(this,d);p.setStreamController(S),g.setStreamController(S);const R=[y,b,S];f&&R.splice(1,0,f),w&&R.splice(1,0,w),this.networkControllers=R;const L=[u,m,C,p,g,E,d];this.audioTrackController=this.createController(n.audioTrackController,R);const $=n.audioStreamController;$&&R.push(this.audioStreamController=new $(this,d,I)),this.subtitleTrackController=this.createController(n.subtitleTrackController,R);const P=n.subtitleStreamController;P&&R.push(this.subtititleStreamController=new P(this,d,I)),this.createController(n.timelineController,L),I.emeController=this.emeController=this.createController(n.emeController,L),this.cmcdController=this.createController(n.cmcdController,L),this.latencyController=this.createController(T8,L),this.coreComponents=L,R.push(c);const U=c.onErrorOut;typeof U=="function"&&this.on(A.ERROR,U,c),this.on(A.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,s){this._emitter.off(e,t,n,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const s=e===A.ERROR;this.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.INTERNAL_EXCEPTION,fatal:s,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(A.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(A.ERROR,{type:xe.OTHER_ERROR,details:Z.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,s=t?e:{media:n};this._media=n,this.trigger(A.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(A.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(A.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,s=this._url=iy.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&n&&(n!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(A.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[me.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[me.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[me.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=b5()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){gU(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let s=0;s<n;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,n)for(let i=s;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=n)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=nk(t);return tk(e,n,navigator.mediaCapabilities)}}$r.defaultConfig=void 0;const P8=({subtitles:r,currentSubtitle:e,onSubtitleChange:t,isOpen:n,onClose:s})=>v.jsx(Ph,{open:n,onOpenChange:s,children:v.jsxs(mc,{className:"sm:max-w-md",children:[v.jsx(gc,{children:v.jsxs(yc,{className:"flex items-center gap-2",children:[v.jsx(CT,{className:"h-5 w-5"}),"Select Subtitles"]})}),v.jsx(jn,{className:"max-h-[400px] pr-4",children:v.jsxs("div",{className:"space-y-2",children:[v.jsxs(pe,{variant:e===null?"default":"outline",className:"w-full justify-start",onClick:()=>{t(null),s()},children:[v.jsx(ui,{className:"h-4 w-4 mr-2"}),"Off"]}),r.map(i=>v.jsx(pe,{variant:e===i.language?"default":"outline",className:Te("w-full justify-start",e===i.language&&"ring-2 ring-primary"),onClick:()=>{t(i.language),s()},children:i.label},i.language))]})})]})}),D8=({onClick:r,hasSubtitles:e,isActive:t})=>e?v.jsxs(pe,{size:"sm",variant:t?"default":"outline",onClick:r,className:"gap-2",children:[v.jsx(CT,{className:"h-4 w-4"}),v.jsx("span",{className:"hidden sm:inline",children:"Subtitles"})]}):null,O8=({availableLanguages:r,currentLanguage:e,onLanguageChange:t,isOpen:n,onClose:s})=>v.jsx(Ph,{open:n,onOpenChange:s,children:v.jsxs(mc,{className:"sm:max-w-md",children:[v.jsx(gc,{children:v.jsxs(yc,{className:"flex items-center gap-2",children:[v.jsx(Sd,{className:"h-5 w-5"}),"Turn On AI DJ"]})}),v.jsx(jn,{className:"max-h-[400px] pr-4",children:v.jsxs("div",{className:"space-y-2",children:[v.jsxs(pe,{variant:e==="original"?"default":"outline",className:Te("w-full justify-start gap-3",e==="original"&&"ring-2 ring-primary"),onClick:()=>{t("original"),s()},children:[v.jsx(m0,{className:"h-4 w-4"}),v.jsx("span",{className:"flex-1 text-left",children:"Original Audio"})]}),r.filter(i=>i.available).map(i=>v.jsxs(pe,{variant:e===i.code?"default":"outline",className:Te("w-full justify-start gap-3",e===i.code&&"ring-2 ring-primary"),onClick:()=>{t(i.code),s()},children:[v.jsx("span",{className:"text-2xl",children:i.flag}),v.jsx(Sd,{className:"h-4 w-4"}),v.jsx("span",{className:"flex-1 text-left",children:i.label})]},i.code))]})})]})}),N8=({onClick:r,currentLanguage:e})=>{const n=(()=>{switch(e){case"en":return{icon:"",label:"English DJ"};case"sw":return{icon:"",label:"Swahili DJ"};default:return{icon:v.jsx(oP,{className:"h-4 w-4"}),label:"DJ Off"}}})();return v.jsxs(pe,{size:"sm",variant:e!=="original"?"default":"outline",onClick:r,className:"gap-2",children:[typeof n.icon=="string"?v.jsx("span",{className:"text-base",children:n.icon}):n.icon,v.jsx("span",{className:"hidden sm:inline",children:n.label})]})};class M8{constructor(e,t){pt(this,"video");pt(this,"currentCue",null);pt(this,"isSpeaking",!1);pt(this,"utterance",null);pt(this,"settings");pt(this,"activeTrack",null);pt(this,"cueChangeHandler",null);pt(this,"videoEventHandlers",new Map);pt(this,"voicesLoaded",!1);pt(this,"audioBufferQueue",[]);pt(this,"speakerVoices",new Map);pt(this,"lookaheadInterval",null);pt(this,"LOOKAHEAD_TIME",5);pt(this,"checkUpcomingCues",()=>{if(!this.activeTrack||this.settings.language==="original"||!this.video)return;const e=this.video.currentTime,t=e+this.LOOKAHEAD_TIME,n=this.activeTrack.cues;if(n)for(let s=0;s<n.length;s++){const i=n[s];if(i.startTime>e&&i.startTime<=t){const o=i.text;if(o&&this.isDialogue(o)){const a=this.settings.language==="en"?"en":"sw";this.prepareUpcomingSpeech(i,a)}}}});pt(this,"onCueChange",()=>{if(!this.activeTrack||this.settings.language==="original")return;const e=this.activeTrack.activeCues;if(e&&e.length>0){const t=e[0];if(t!==this.currentCue){this.currentCue=t;const n=t.text;if(console.log(" New subtitle cue:",n),this.isDialogue(n)){console.log(" Processing as dialogue");const s=this.settings.language==="en"?"en":"sw";if(this.isSpeaking){console.log(" Waiting for current speech to complete...");const i=setInterval(()=>{this.isSpeaking||(clearInterval(i),this.speakText(n,s,t.startTime))},100)}else this.speakText(n,s,t.startTime)}else console.log(" Skipped: Not dialogue"),this.isSpeaking||(this.video.volume=1)}}else this.isSpeaking||(this.video.volume=1),this.currentCue=null});this.video=e,this.settings=t,this.loadVoices()}loadVoices(){return new Promise(e=>{const t=speechSynthesis.getVoices();t.length>0?(this.voicesLoaded=!0,console.log("Voices already loaded:",t.length),e()):speechSynthesis.addEventListener("voiceschanged",()=>{this.voicesLoaded=!0,console.log("Voices loaded:",speechSynthesis.getVoices().length),e()},{once:!0})})}extractSpeakerAndText(e){let t=e.match(/^\[([^\]]+)\]\s*(.+)/);if(t)return{speaker:t[1].trim().toLowerCase(),dialogue:t[2].trim()};if(t=e.match(/^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)\s*:\s*(.+)/),t)return{speaker:t[1].trim().toLowerCase(),dialogue:t[2].trim()};if(t=e.match(/^\(([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)\)\s*(.+)/),t){const n=t[1].toLowerCase();if(!["softly","hardly","crying","shouting","whispering","laughing","singing","screaming"].includes(n))return{speaker:n,dialogue:t[2].trim()}}return{speaker:null,dialogue:e}}isDialogue(e){const t=e.trim();if(/[\[\]\(\)"]/.test(t))return console.log(' Filtered (contains [], (), or "):',t),!1;if([/^.*$/,/^+$/,/^\s*$/,//,/\bmusic\b/i,/\bsinging\b/i,/\bsong\b/i].some(i=>i.test(t)))return console.log(" Filtered non-dialogue:",t),!1;const s=t.trim();return s.length<5?(console.log(" Too short:",s),!1):(console.log(" Valid dialogue:",s.substring(0,40)),!0)}detectEmotion(e){const t=e.toLowerCase();return/(exclaim|yell|shout|scream|angry|furious)/i.test(t)||/!{2,}/.test(e)?{emotion:"angry",rate:1.5,pitch:1.05}:/(whisper|softly|quietly|murmur)/i.test(t)?{emotion:"soft",rate:1.2,pitch:.95}:/(happy|joy|excit|laugh|cheer)/i.test(t)?{emotion:"happy",rate:1.4,pitch:1.02}:/(sad|cry|sorrow|depress|tearful)/i.test(t)?{emotion:"sad",rate:1.2,pitch:.9}:/(afraid|scare|terrif|panic|fear)/i.test(t)?{emotion:"scared",rate:1.6,pitch:1.1}:/(calm|peace|relax|sooth)/i.test(t)?{emotion:"calm",rate:1.3,pitch:.98}:{emotion:"neutral",rate:1.4,pitch:1}}cleanSubtitleText(e){return e.replace(/\\n/g," ").replace(/\n/g," ").replace(/\r/g,"").replace(/<[^>]*>/g,"").replace(/+/g,"").replace(/\s+/g," ").trim()}detectGenderFromName(e){const t=["mary","sarah","emily","jennifer","lisa","karen","nancy","betty","helen","dorothy","sandra","ashley","donna","carol","michelle","laura","amy","melissa","deborah","stephanie","rebecca","sharon","cynthia","anna","ruth","kathleen","diane","julie","joyce","virginia","alice","jean","doris","kathryn","gloria","teresa","sara","janice","marie","madison","sophia","olivia","emma","ava","isabella","mia","charlotte","harper","evelyn","abigail"],n=["walter","john","michael","david","james","robert","william","richard","joseph","thomas","charles","daniel","matthew","anthony","mark","donald","steven","paul","andrew","joshua","kenneth","kevin","brian","george","edward","ronald","timothy","jason","jeffrey","ryan","jacob","gary","nicholas","eric","jonathan","stephen","larry","justin","scott","brandon","benjamin","samuel","raymond","gregory","frank","alexander","patrick","jack","dennis","jerry"],s=e.toLowerCase();return t.includes(s)?"female":n.includes(s)?"male":null}getVoiceForSpeaker(e,t){const n=speechSynthesis.getVoices(),i={en:["en-US","en-GB","en"],sw:["sw-KE","sw-TZ","sw"]}[e]||[e];if(t&&this.speakerVoices.has(t))return this.speakerVoices.get(t).voice;let o=this.settings.voiceGender;if(t){const a=this.detectGenderFromName(t);a&&(o=a)}for(const a of i){const l=n.filter(d=>d.lang.startsWith(a)),c=Array.from(this.speakerVoices.values()).map(d=>d.voice.name);let u=null;if(o==="female"?u=l.find(d=>!c.includes(d.name)&&(d.name.toLowerCase().includes("female")||d.name.toLowerCase().includes("woman")||d.name.toLowerCase().includes("samantha")||d.name.toLowerCase().includes("victoria")||d.name.toLowerCase().includes("karen")||d.name.toLowerCase().includes("moira")||d.name.toLowerCase().includes("zira")))||l.find(d=>d.name.toLowerCase().includes("female")||d.name.toLowerCase().includes("woman")):u=l.find(d=>!c.includes(d.name)&&(d.name.toLowerCase().includes("male")||d.name.toLowerCase().includes("man")||d.name.toLowerCase().includes("daniel")||d.name.toLowerCase().includes("alex")||d.name.toLowerCase().includes("david")||d.name.toLowerCase().includes("mark")||d.name.toLowerCase().includes("james")))||l.find(d=>d.name.toLowerCase().includes("male")||d.name.toLowerCase().includes("man")),!u&&l.length>0&&(u=l.find(d=>!c.includes(d.name))||l[0]),u)return t&&(this.speakerVoices.set(t,{voice:u,gender:o}),console.log(` Assigned ${u.name} to ${t}`)),u}return null}prepareUpcomingSpeech(e,t){const n=e.text;if(!n||!this.isDialogue(n))return null;const{speaker:s,dialogue:i}=this.extractSpeakerAndText(n),o=this.cleanSubtitleText(n);if(!o)return null;const a=new SpeechSynthesisUtterance(o),l=this.getVoiceForSpeaker(t,s);l?(a.voice=l,a.lang=l.lang):a.lang=t==="sw"?"sw-KE":"en-US";const c=this.detectEmotion(n);return a.rate=c.rate,a.pitch=c.pitch,a.volume=1,console.log(` Prepared speech for "${o.substring(0,30)}..." (${c.emotion}) at ${e.startTime}s`),a}async speakText(e,t,n){if(!e)return;if(this.voicesLoaded||await this.loadVoices(),this.isSpeaking){console.log(" Already speaking, waiting...");return}const{speaker:s,dialogue:i}=this.extractSpeakerAndText(e),o=this.cleanSubtitleText(e);if(!o||o.length<3){console.log(" Skipping empty or too short text");return}console.log(" AI Voice Speaking:",o,s?`(${s})`:""),this.isSpeaking=!0,this.utterance=new SpeechSynthesisUtterance(o);const a=this.getVoiceForSpeaker(t,s);a?(this.utterance.voice=a,this.utterance.lang=a.lang,console.log(" Voice:",a.name,s?`for ${s}`:"")):this.utterance.lang=t==="sw"?"sw-KE":"en-US";const l=this.detectEmotion(e);this.utterance.rate=l.rate,this.utterance.pitch=l.pitch,this.utterance.volume=1,console.log(` Speaking: "${o}" (${l.emotion}, rate: ${l.rate})`),this.utterance.onstart=()=>{this.video.volume=.15,console.log(" Speech started")},this.utterance.onend=()=>{console.log(" Speech completed fully"),this.isSpeaking=!1,this.utterance=null,this.video.volume=1},this.utterance.onerror=c=>{console.error(" Speech error:",c),this.isSpeaking=!1,this.utterance=null,this.video.volume=1},speechSynthesis.speak(this.utterance)}stopSpeaking(){(this.isSpeaking||this.utterance)&&(speechSynthesis.cancel(),this.isSpeaking=!1,this.utterance=null)}updateSettings(e){this.settings={...this.settings,...e},this.settings.language==="original"&&this.disable()}async enable(e){console.log(" Enabling AI dubbing with 5s lookahead for:",e),this.settings.language=e;const t=Array.from(this.video.textTracks),n=t.find(a=>e==="en"?a.language.toLowerCase().startsWith("en"):e==="sw"?a.language.toLowerCase().startsWith("sw"):!1);if(!n)return console.error(` No ${e} subtitle track found`),!1;console.log(" Found subtitle track:",n.label),t.forEach(a=>a.mode="disabled"),n.mode="showing",this.activeTrack=n,this.cueChangeHandler=this.onCueChange.bind(this),this.activeTrack.addEventListener("cuechange",this.cueChangeHandler),this.lookaheadInterval=window.setInterval(this.checkUpcomingCues,500);const s=()=>{this.stopSpeaking(),this.lookaheadInterval&&(clearInterval(this.lookaheadInterval),this.lookaheadInterval=null)},i=()=>{var a,l;if(this.lookaheadInterval||(this.lookaheadInterval=window.setInterval(this.checkUpcomingCues,500)),(l=(a=this.activeTrack)==null?void 0:a.activeCues)!=null&&l[0]){const c=this.activeTrack.activeCues[0];if(c.text&&this.isDialogue(c.text)){const u=this.settings.language==="en"?"en":"sw";this.speakText(c.text,u)}}},o=()=>{this.stopSpeaking(),this.currentCue=null,this.speakerVoices.clear()};return this.video.addEventListener("pause",s),this.video.addEventListener("play",i),this.video.addEventListener("seeking",o),this.videoEventHandlers.set("pause",s),this.videoEventHandlers.set("play",i),this.videoEventHandlers.set("seeking",o),await this.loadVoices(),this.onCueChange(),console.log(" AI dubbing enabled with emotion detection and character voices"),!0}disable(){console.log(" Disabling AI dubbing"),this.video.volume=1,this.settings.language="original",this.stopSpeaking(),this.lookaheadInterval&&(clearInterval(this.lookaheadInterval),this.lookaheadInterval=null),this.activeTrack&&this.cueChangeHandler&&this.activeTrack.removeEventListener("cuechange",this.cueChangeHandler),this.videoEventHandlers.forEach((e,t)=>{this.video.removeEventListener(t,e)}),this.videoEventHandlers.clear(),this.activeTrack=null,this.currentCue=null,this.cueChangeHandler=null,this.speakerVoices.clear(),this.audioBufferQueue=[]}destroy(){this.disable()}}const Rb=async(r,e,t,n,s,i,o,a,l)=>{try{await ot.saveVideoProgress(r,{url:e,time:t,duration:n,season:s,episode:i,subtitles:a,sources:l});const c=await ot.getWatchHistory(),u=c.findIndex(d=>d.id===r);u!==-1&&(c[u]={...c[u],seasons:o,subtitles:a,sources:l,isSeries:!!s&&!!i},await ot.saveWatchHistory(c))}catch(c){console.error("Failed to save progress:",c)}},F8=async r=>{try{return await ot.getVideoProgress(r)}catch(e){return console.error("Failed to get progress:",e),null}};function j8(){const r=Vr(),[e]=H_(),t=T.useRef(null),n=T.useRef(null),s=T.useRef(null),[i,o]=T.useState(!1),[a,l]=T.useState(""),[c,u]=T.useState(!1),[d,h]=T.useState(!0),[f,m]=T.useState(!1),[p,g]=T.useState(null),[y,x]=T.useState(!1),[w,b]=T.useState(!1),[E,I]=T.useState([]),[S,C]=T.useState(!1),[R,L]=T.useState("original"),$=T.useRef(null),P=e.get("url")||"",U=e.get("title")||"",_=e.get("movieId")||"",H=e.get("movieTitle")||"",V=e.get("season")||"",G=e.get("episode")||"",j=e.get("seasons"),F=e.get("sources"),Y=e.get("subtitles"),M=e.get("resumeTime"),D=j?JSON.parse(decodeURIComponent(j)):null,ee=F?JSON.parse(decodeURIComponent(F)):null;T.useEffect(()=>{if(Y)try{const B=JSON.parse(decodeURIComponent(Y)).map(N=>({...N,url:N.url||Ot.getSubtitleUrl(_,N.language,V?parseInt(V):void 0,G?parseInt(G):void 0)}));console.log("Loaded subtitles from params:",B),I(B)}catch(z){console.error("Error parsing subtitles:",z),I([])}else I([])},[Y,_,V,G]);const{data:Q}=Rr({queryKey:["movie",_],queryFn:()=>Ot.getMovieDetails(_),enabled:!!_,staleTime:5*60*1e3}),{data:te}=Rr({queryKey:["related",_,Q==null?void 0:Q.genre],queryFn:()=>Ot.getRelatedMovies(_,Q==null?void 0:Q.genre),enabled:!!_&&!!Q,staleTime:5*60*1e3,select:z=>{const B=!!V&&!!G;return z?z.filter(N=>{const O=N.isSeries;return!!(B&&O||!B&&!O)}):[]}}),oe=()=>{r(_?`/movie/${_}`:"/")};T.useEffect(()=>{n.current&&setTimeout(()=>{var z;(z=n.current)==null||z.scrollIntoView({behavior:"smooth",block:"start"})},100)},[]),T.useEffect(()=>{const z=P?`https://rxsgzadulpspurijnijl.supabase.co/functions/v1/video-proxy?url=${encodeURIComponent(P)}`:"";l(z),h(!0),m(!1)},[P]),T.useEffect(()=>{const z=t.current;if(z){if(h(!0),!a||!a.includes(".m3u8")){s.current&&(s.current.destroy(),s.current=null);return}if(z.canPlayType("application/vnd.apple.mpegURL"))z.src=a;else if($r.isSupported()){s.current&&(s.current.destroy(),s.current=null);const B=new $r({enableWorker:!0,maxBufferLength:30,maxMaxBufferLength:60,backBufferLength:90,liveDurationInfinity:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:3,levelLoadingTimeOut:1e4,fragLoadingTimeOut:2e4,startLevel:-1,capLevelToPlayerSize:!1});s.current=B,B.attachMedia(z),B.on($r.Events.MEDIA_ATTACHED,()=>{B.loadSource(a)}),B.on($r.Events.MANIFEST_PARSED,()=>{h(!1),m(!0),z.paused&&z.play().catch(N=>console.error("Auto-play failed:",N))}),B.on($r.Events.ERROR,(N,O)=>{console.error("HLS error:",O),O.fatal&&h(!1)})}return()=>{s.current&&(s.current.destroy(),s.current=null)}}},[a]),T.useEffect(()=>{const z=t.current;if(!z)return;const B=()=>h(!0),N=()=>{h(!1)},O=()=>h(!1),W=()=>{console.log("Metadata loaded, duration:",z.duration,"seekable:",z.seekable.length>0),z.seekable.length>0&&console.log("Seekable range:",z.seekable.start(0),"to",z.seekable.end(0)),m(!0),h(!1)},J=()=>{console.log("Data loaded, enabling seeking"),m(!0)},re=()=>{z.seekable.length>0&&!f&&(console.log("Progress event - video is now seekable"),m(!0))},q=se=>{console.error("Video error event:",se),h(!1)};return z.addEventListener("waiting",B),z.addEventListener("canplay",N),z.addEventListener("playing",O),z.addEventListener("loadedmetadata",W),z.addEventListener("loadeddata",J),z.addEventListener("progress",re),z.addEventListener("error",q),()=>{z.removeEventListener("waiting",B),z.removeEventListener("canplay",N),z.removeEventListener("playing",O),z.removeEventListener("loadedmetadata",W),z.removeEventListener("loadeddata",J),z.removeEventListener("progress",re),z.removeEventListener("error",q)}},[a]),T.useEffect(()=>{if(t.current&&a&&!i&&_){const z=t.current;if(E&&E.length>0?(console.log("Loading subtitle tracks for video:",E),(async()=>{for(;z.firstChild;)z.removeChild(z.firstChild);const B=J=>`WEBVTT

`+J.replace(/\\n/g,`
`).replace(/(\d{2}:\d{2}:\d{2}),(\d{3})/g,"$1.$2");await Promise.all(E.map(async(J,re)=>{const q=document.createElement("track");q.kind="subtitles",q.label=J.label,q.srclang=J.language;try{if(J.url){const se=`https://rxsgzadulpspurijnijl.supabase.co/functions/v1/video-proxy?url=${encodeURIComponent(J.url)}`,ae=await fetch(se);if(!ae.ok)throw new Error("Failed to fetch subtitle");const ie=await ae.text(),De=(J.url||"").toLowerCase().includes(".srt")?B(ie):ie,Ce=new Blob([De],{type:"text/vtt"}),_t=URL.createObjectURL(Ce);q.src=_t,console.log(`Loaded subtitle: ${J.label}`)}}catch(se){console.error("Subtitle load failed:",J.label,se),J.url&&(q.src=J.url)}((J.language||"").toLowerCase().startsWith("en")||re===0&&p===null)&&(q.default=!0),q.addEventListener("load",()=>{const se=Array.from(z.textTracks).find(ae=>ae.language===J.language);if(se&&se.cues)try{for(let ae=0;ae<se.cues.length;ae++){const ie=se.cues[ae];ie&&"line"in ie&&(ie.line=-3,ie.align="center",ie.position=50,ie.size=100,ie.snapToLines=!0)}}catch{}se&&(J.language||"").toLowerCase().startsWith("en")&&(Array.from(z.textTracks).forEach(ae=>ae.mode="disabled"),se.mode="showing",g(J.language),console.log("English subtitle activated"))}),z.appendChild(q)}));const N=()=>Array.from(z.textTracks).forEach(J=>J.mode="disabled"),O=J=>{if(J&&J.cues)try{for(let re=0;re<J.cues.length;re++){const q=J.cues[re];q&&"line"in q&&(q.line=-3,q.align="center",q.position=50,q.size=100,q.snapToLines=!0)}}catch{}},W=()=>{if(z.textTracks.length===0){console.log("No subtitle tracks available");return}N();const J=Array.from(z.textTracks).find(re=>(re.language||"").toLowerCase().startsWith("en"))||z.textTracks[0];J&&(J.mode="showing",O(J),g(J.language),console.log("Subtitle track enabled:",J.label,"(Language:",J.language+")"))};setTimeout(W,200),setTimeout(W,600),setTimeout(W,1200),z.addEventListener("loadedmetadata",W,{once:!0}),z.addEventListener("canplay",W,{once:!0}),z.addEventListener("play",W,{once:!0})})()):console.log("No subtitles available for this video"),M){const B=parseFloat(M);if(B>5){const N=()=>{z.readyState>=2&&(console.log("Seeking to resume time:",B),z.currentTime=B,z.play().catch(O=>console.error("Auto-play failed:",O)))};z.readyState>=2?N():(z.addEventListener("loadeddata",N,{once:!0}),z.addEventListener("canplay",N,{once:!0})),o(!0)}}else(async()=>{const B=await F8(_),N=V&&G&&(B==null?void 0:B.season)===V&&(B==null?void 0:B.episode)===G,O=!V&&!G&&!(B!=null&&B.season)&&!(B!=null&&B.episode);if(B&&B.time>5&&B.time<B.duration-10&&(N||O)){const W=()=>{z.readyState>=2&&(console.log("Seeking to saved time:",B.time),z.currentTime=B.time)};z.readyState>=2?W():(z.addEventListener("loadeddata",W,{once:!0}),z.addEventListener("canplay",W,{once:!0}))}o(!0)})()}},[a,i,_,V,G,M,E,p]),T.useEffect(()=>{const z=t.current;if(!z||!a||!_)return;const B=()=>{Rb(_,a,z.currentTime,z.duration,V,G,j,Y,F);const O=JSON.parse(localStorage.getItem("watch_history")||"[]"),W=O.findIndex(re=>re.id===_),J={id:_,title:H||U,poster:e.get("poster")||"",watchedAt:new Date().toISOString(),seasons:j||"",subtitles:Y||"",sources:F||"",isSeries:!!V&&!!G,url:a};W!==-1&&O.splice(W,1),O.unshift(J),localStorage.setItem("watch_history",JSON.stringify(O.slice(0,50)))},N=setInterval(B,5e3);return z.addEventListener("pause",B),z.addEventListener("ended",B),()=>{clearInterval(N),z.removeEventListener("pause",B),z.removeEventListener("ended",B),B()}},[a,_,V,G,H,U,e]),T.useEffect(()=>{o(!1),m(!1)},[a]);const ce=D&&D.length>0,de=async()=>await ot.getSetting("selectedVideoQuality",""),we=async z=>{await ot.saveSetting("selectedVideoQuality",z)},Le=async(z,B,N,O)=>{u(!0);try{t.current&&(t.current.pause(),t.current.currentTime=0);const W=await Ot.getEpisodeSources(z,B,N);if(W.length>0){const J=await de();let re=W[0];if(J){const ie=W.find(he=>he.quality===J);ie&&(re=ie)}const q=re.stream_url||re.download_url,se=q?`https://rxsgzadulpspurijnijl.supabase.co/functions/v1/video-proxy?url=${encodeURIComponent(q)}`:"";if(t.current){for(;t.current.firstChild;)t.current.removeChild(t.current.firstChild);Array.from(t.current.textTracks).forEach(ie=>{ie.mode="disabled"})}$.current&&($.current.disable(),L("original")),g(null),I([]),l(se),o(!1);const ae=new URLSearchParams(e);ae.set("url",q),ae.set("title",`${H} S${B}E${N}`),ae.set("season",B.toString()),ae.set("episode",N.toString()),W&&ae.set("sources",encodeURIComponent(JSON.stringify(W))),re.subtitles&&re.subtitles.length>0?ae.set("subtitles",encodeURIComponent(JSON.stringify(re.subtitles))):ae.delete("subtitles"),r(`/player?${ae.toString()}`,{replace:!0})}else Ki({title:"Error",description:"No video sources available for this episode",variant:"destructive"})}catch(W){console.error("Error loading episode:",W),Ki({title:"Error",description:"Failed to load episode. Please try again.",variant:"destructive"})}finally{u(!1)}},Re=async(z,B,N,O)=>{console.log("Download episode:",{movieId:z,season:B,episode:N,quality:O})},ft=async(z,B)=>{var se,ae;const N=((se=t.current)==null?void 0:se.currentTime)||0,O=((ae=t.current)==null?void 0:ae.duration)||0,W=p,J=t.current;if(!J)return;await we(B),J.pause(),J.currentTime=0,s.current&&(s.current.destroy(),s.current=null),_&&Rb(_,z,N,O,V,G,j,Y,F),h(!0),m(!1);const re=z?`https://rxsgzadulpspurijnijl.supabase.co/functions/v1/video-proxy?url=${encodeURIComponent(z)}`:"";l(re);const q=new URLSearchParams(e);if(q.set("url",z),r(`/player?${q.toString()}`,{replace:!0}),o(!1),N>0){const ie=()=>{J.readyState>=2&&J.duration>0&&(console.log("Quality changed, seeking to:",N),J.currentTime=N,J.play().catch(he=>console.error("Auto-play after quality change failed:",he)),o(!0),W&&g(W))};J.addEventListener("loadedmetadata",ie,{once:!0}),J.addEventListener("canplay",ie,{once:!0})}},Xe=z=>{g(z);const B=t.current;if(B&&(Array.from(B.textTracks).forEach(N=>{N.mode="disabled"}),z)){const N=Array.from(B.textTracks).find(O=>O.language===z);if(N){N.mode="showing";const O=B.currentTime;B.currentTime=O+.001}}};T.useEffect(()=>{if(t.current&&E&&E.length>0){const z={language:"original",voiceGender:"male",useOpenAI:!1};return $.current=new M8(t.current,z),()=>{var B;(B=$.current)==null||B.destroy(),$.current=null}}},[E,a]);const k=z=>{if(console.log("Switching dubbing language to:",z),!$.current||!t.current){console.error("Voice dubbing controller not initialized");return}if(z==="original")$.current.disable(),L("original");else{if(!(E==null?void 0:E.some(O=>z==="en"?O.language.toLowerCase().startsWith("en"):z==="sw"?O.language.toLowerCase().startsWith("sw"):!1)))return;$.current.enable(z)&&L(z)}};return P?v.jsxs("div",{className:"min-h-screen bg-black",children:[v.jsx("div",{className:"sticky top-0 z-50 bg-black/95 backdrop-blur border-b border-white/10",children:v.jsx("div",{className:"container mx-auto px-3 py-2",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs(pe,{variant:"ghost",size:"sm",onClick:oe,className:"h-8 gap-1 text-white hover:text-white/80",children:[v.jsx(Nl,{className:"h-3 w-3"}),"Back"]}),v.jsxs("div",{className:"flex items-center gap-2",children:[E&&E.length>0&&v.jsxs(v.Fragment,{children:[v.jsx(N8,{onClick:()=>C(!0),currentLanguage:R}),v.jsx(D8,{onClick:()=>x(!0),hasSubtitles:!0,isActive:p!==null})]}),ee&&ee.length>1&&v.jsx(pe,{size:"sm",variant:"outline",onClick:()=>b(!0),children:"Quality"})]}),v.jsx(pe,{variant:"ghost",size:"sm",onClick:oe,className:"h-8 w-8 p-0 text-white hover:text-white/80",children:v.jsx(ui,{className:"h-4 w-4"})})]})})}),v.jsxs("div",{className:"container mx-auto px-3 py-3 sm:px-4 sm:py-4",children:[v.jsxs("div",{className:"grid lg:grid-cols-[1.5fr,1fr] gap-3",children:[v.jsxs("div",{className:"space-y-2",ref:n,children:[v.jsxs("div",{className:"aspect-video w-full relative",children:[c&&v.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-20 rounded-lg",children:v.jsx(zm,{size:"xl",fast:!0,showProgress:!0,mode:"infinite"})}),d&&!c&&v.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-20 rounded-lg",children:v.jsx(zm,{size:"xl",fast:!0,showProgress:!0,mode:"infinite"})}),v.jsx("video",{ref:t,src:a.includes(".m3u8")?void 0:a,controls:!0,controlsList:"nodownload",autoPlay:!0,preload:"metadata",playsInline:!0,crossOrigin:"anonymous",className:"w-full h-full rounded-lg",onSeeking:()=>console.log("Seeking..."),onSeeked:()=>console.log("Seeked"),children:"Your browser does not support the video tag."}),v.jsx("style",{children:`
                video::cue {
                  background: transparent !important;
                  color: white !important;
                  font-size: clamp(14px, 2.2vw, 22px) !important;
                  font-weight: 700 !important;
                  text-shadow:
                    -1px -1px 2px rgba(0,0,0,0.9),
                    1px -1px 2px rgba(0,0,0,0.9),
                    -1px 1px 2px rgba(0,0,0,0.9),
                    1px 1px 2px rgba(0,0,0,0.9),
                    0 0 4px rgba(0,0,0,0.9) !important;
                  line-height: 1.5 !important;
                }
              `})]}),v.jsx("h1",{className:"text-white text-lg font-semibold px-2",children:U}),ee&&ee.length>0&&v.jsxs("div",{className:"bg-white/5 rounded-lg p-2 border border-white/20",children:[v.jsx("h3",{className:"text-white text-xs font-medium mb-2",children:"Quality"}),v.jsx("div",{className:"flex flex-wrap gap-1.5",children:ee.map((z,B)=>v.jsx(pe,{onClick:()=>ft(z.stream_url||z.download_url,z.quality),variant:a===(z.stream_url||z.download_url)?"default":"outline",size:"sm",className:"text-white h-7 text-xs px-2",children:z.quality},B))})]})]}),v.jsx("div",{className:"space-y-3",children:ce?v.jsx(jn,{className:"h-[400px] lg:h-[500px] rounded-lg border border-white/20 bg-white/5 p-2",children:v.jsx($A,{seasons:D,onWatch:()=>{},onDownload:()=>{},movieTitle:H,movieId:_,onEpisodeWatch:Le,onEpisodeDownload:Re,currentSeason:V?parseInt(V):void 0,currentEpisode:G?parseInt(G):void 0})}):v.jsxs("div",{className:"space-y-3 p-3 rounded-lg border border-white/20 bg-white/5",children:[v.jsx("h3",{className:"text-white text-sm font-semibold mb-2",children:"Join Our Community"}),v.jsxs(pe,{onClick:()=>window.open("https://whatsapp.com/channel/0029VaZuGSxEawdxZK9CzM0Y","_blank"),className:"w-full gap-2 bg-green-600 hover:bg-green-700 text-white h-16",size:"sm",children:[v.jsx(Kv,{className:"h-5 w-5"}),v.jsxs("div",{className:"text-left flex-1",children:[v.jsx("div",{className:"font-bold text-sm",children:"Bwm xmd"}),v.jsx("div",{className:"text-xs opacity-90",children:"WhatsApp Channel"})]})]}),v.jsxs(pe,{onClick:()=>window.open("https://whatsapp.com/channel/0029Vb3hlgX5kg7G0nFggl0Y","_blank"),className:"w-full gap-2 bg-green-600 hover:bg-green-700 text-white h-16",size:"sm",children:[v.jsx(Kv,{className:"h-5 w-5"}),v.jsxs("div",{className:"text-left flex-1",children:[v.jsx("div",{className:"font-bold text-sm",children:"Gifted Tech"}),v.jsx("div",{className:"text-xs opacity-90",children:"WhatsApp Channel"})]})]}),v.jsx("h3",{className:"text-white text-sm font-semibold mb-2 mt-4",children:"Visit Our Websites"}),v.jsxs(pe,{onClick:()=>window.open("https://giftedtech.co.ke","_blank"),className:"w-full gap-2 bg-blue-600 hover:bg-blue-700 text-white h-16",size:"sm",children:[v.jsx(Wv,{className:"h-5 w-5"}),v.jsxs("div",{className:"text-left flex-1",children:[v.jsx("div",{className:"font-bold text-sm",children:"Gifted Tech"}),v.jsx("div",{className:"text-xs opacity-90",children:"Website"})]})]}),v.jsxs(pe,{onClick:()=>window.open("https://bwmxmd.online","_blank"),className:"w-full gap-2 bg-blue-600 hover:bg-blue-700 text-white h-16",size:"sm",children:[v.jsx(Wv,{className:"h-5 w-5"}),v.jsxs("div",{className:"text-left flex-1",children:[v.jsx("div",{className:"font-bold text-sm",children:"Bwm xmd"}),v.jsx("div",{className:"text-xs opacity-90",children:"Website"})]})]})]})})]}),te&&te.length>0&&v.jsxs("div",{className:"mt-6 pb-6",children:[v.jsx("h3",{className:"text-white text-lg font-semibold mb-4",children:"Similar Videos"}),v.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:te.map(z=>v.jsx(Wl,{movie:z},z.id))})]})]}),E&&E.length>0&&v.jsx(O8,{availableLanguages:[{code:"en",label:"English DJ",flag:"",available:E.some(z=>z.language.toLowerCase().startsWith("en"))},{code:"sw",label:"Swahili DJ",flag:"",available:E.some(z=>z.language.toLowerCase().startsWith("sw"))}],currentLanguage:R,onLanguageChange:k,isOpen:S,onClose:()=>C(!1)}),E&&E.length>0&&v.jsx(P8,{subtitles:E,currentSubtitle:p,isOpen:y,onClose:()=>x(!1),onSubtitleChange:Xe}),ee&&ee.length>0&&v.jsx(sy,{sources:ee,isOpen:w,onClose:()=>b(!1),onSelect:z=>ft(z.stream_url||z.download_url,z.quality),mode:"stream"})]}):v.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:v.jsxs("div",{className:"text-center",children:[v.jsx("p",{className:"text-white mb-4",children:"No video URL provided"}),v.jsxs(pe,{onClick:oe,className:"gap-2",children:[v.jsx(Nl,{className:"h-4 w-4"}),"Go Back"]})]})})}function $8(){return Vr(),T.useEffect(()=>{window.location.href="https://install.bwmxmd.online"},[]),v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-primary/5 flex items-center justify-center p-4",children:v.jsxs("div",{className:"max-w-2xl w-full text-center",children:[v.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-primary/20 to-primary/10 rounded-3xl mb-6 shadow-lg",children:v.jsx("img",{src:"https://url.bwmxmd.online/Adams.botkcfni.png",alt:"BWMGIFT",className:"w-20 h-20 object-contain"})}),v.jsx("h1",{className:"text-4xl font-black mb-3",children:v.jsx("span",{className:"bg-gradient-to-r from-primary via-orange-500 to-yellow-500 bg-clip-text text-transparent",children:"BWMGIFT"})}),v.jsx("p",{className:"text-xl text-muted-foreground mb-4",children:"Redirecting to install page..."}),v.jsx("div",{className:"animate-pulse",children:v.jsxs("p",{className:"text-sm text-muted-foreground",children:["If you are not redirected automatically,",v.jsx("a",{href:"https://install.bwmxmd.online",className:"text-primary underline ml-1",children:"click here"})]})})]})})}function B8(){var o;const{name:r}=$_(),e=Vr(),t=decodeURIComponent(r||"");T.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[t]);const{data:n,isLoading:s}=Rr({queryKey:["homepage"],queryFn:Ot.getHomepage,staleTime:5*60*1e3}),i=(o=n==null?void 0:n.categories)==null?void 0:o.find(a=>a.name===t);return v.jsxs("div",{className:"container mx-auto px-4 py-8 pt-24",children:[v.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[v.jsxs(pe,{variant:"ghost",onClick:()=>e("/"),className:"gap-2",children:[v.jsx(Nl,{className:"h-4 w-4"}),"Back"]}),v.jsx("h1",{className:"text-3xl font-bold",children:t})]}),s?v.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:18}).map((a,l)=>v.jsx(In,{className:"aspect-[2/3] rounded-lg"},l))}):i&&i.movies.length>0?v.jsx(ry,{movies:i.movies}):v.jsx("p",{className:"text-center text-muted-foreground py-16",children:"No movies found in this category"})]})}const U8=()=>{const r=Da();return T.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),v.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:v.jsxs("div",{className:"text-center",children:[v.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),v.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),v.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},vI=T.forwardRef(({className:r,...e},t)=>v.jsx("div",{className:"relative w-full overflow-auto",children:v.jsx("table",{ref:t,className:Te("w-full caption-bottom text-sm",r),...e})}));vI.displayName="Table";const xI=T.forwardRef(({className:r,...e},t)=>v.jsx("thead",{ref:t,className:Te("[&_tr]:border-b",r),...e}));xI.displayName="TableHeader";const wI=T.forwardRef(({className:r,...e},t)=>v.jsx("tbody",{ref:t,className:Te("[&_tr:last-child]:border-0",r),...e}));wI.displayName="TableBody";const z8=T.forwardRef(({className:r,...e},t)=>v.jsx("tfoot",{ref:t,className:Te("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...e}));z8.displayName="TableFooter";const lg=T.forwardRef(({className:r,...e},t)=>v.jsx("tr",{ref:t,className:Te("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",r),...e}));lg.displayName="TableRow";const _o=T.forwardRef(({className:r,...e},t)=>v.jsx("th",{ref:t,className:Te("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...e}));_o.displayName="TableHead";const Ao=T.forwardRef(({className:r,...e},t)=>v.jsx("td",{ref:t,className:Te("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...e}));Ao.displayName="TableCell";const G8=T.forwardRef(({className:r,...e},t)=>v.jsx("caption",{ref:t,className:Te("mt-4 text-sm text-muted-foreground",r),...e}));G8.displayName="TableCaption";const H8=()=>{const[r,e]=T.useState(!1),[t,n]=T.useState(""),[s,i]=T.useState([]),[o,a]=T.useState(0),[l,c]=T.useState(0),[u,d]=T.useState(0),h=Vr(),{toast:f}=eT(),m=()=>{t==="2233"?(e(!0),sessionStorage.setItem("admin_auth","true"),f({title:"Login successful",description:"Welcome to the admin dashboard"})):f({title:"Invalid password",description:"Please try again",variant:"destructive"})},p=g=>{const y=new Date,x=new Date(y.getFullYear(),y.getMonth(),y.getDate()),w=new Date(y.getTime()-7*24*60*60*1e3),b=new Date(y.getFullYear(),y.getMonth(),1),E=new Set,I=new Set,S=new Set;g.forEach(C=>{const R=new Date(C.first_visit_at),L=new Date(C.last_visit_at);(L>=x||R>=x)&&E.add(C.ip_address),(L>=w||R>=w)&&I.add(C.ip_address),(L>=b||R>=b)&&S.add(C.ip_address)}),a(E.size),c(I.size),d(S.size)};return T.useEffect(()=>{sessionStorage.getItem("admin_auth")==="true"&&e(!0)},[]),T.useEffect(()=>{if(!r)return;const g=async()=>{const{data:x,error:w}=await zu.from("user_visits").select("*").order("last_visit_at",{ascending:!1});if(w){console.error("Error fetching visits:",w),f({title:"Error fetching data",description:w.message,variant:"destructive"});return}x&&(i(x),p(x))};g();const y=zu.channel("user_visits_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_visits"},()=>{g()}).subscribe();return()=>{zu.removeChannel(y)}},[r,f]),r?v.jsx("div",{className:"min-h-screen bg-background p-4 md:p-8",children:v.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),v.jsx(pe,{variant:"outline",onClick:()=>{sessionStorage.removeItem("admin_auth"),h("/")},children:"Logout"})]}),v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[v.jsxs(Ti,{children:[v.jsxs(bo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[v.jsx(So,{className:"text-sm font-medium",children:"Today's Users"}),v.jsx(RT,{className:"h-4 w-4 text-muted-foreground"})]}),v.jsxs(Eo,{children:[v.jsx("div",{className:"text-2xl font-bold",children:o}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Unique visitors today"})]})]}),v.jsxs(Ti,{children:[v.jsxs(bo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[v.jsx(So,{className:"text-sm font-medium",children:"Weekly Users"}),v.jsx(nP,{className:"h-4 w-4 text-muted-foreground"})]}),v.jsxs(Eo,{children:[v.jsx("div",{className:"text-2xl font-bold",children:l}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 7 days"})]})]}),v.jsxs(Ti,{children:[v.jsxs(bo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[v.jsx(So,{className:"text-sm font-medium",children:"Monthly Users"}),v.jsx(Fu,{className:"h-4 w-4 text-muted-foreground"})]}),v.jsxs(Eo,{children:[v.jsx("div",{className:"text-2xl font-bold",children:u}),v.jsx("p",{className:"text-xs text-muted-foreground",children:"This month"})]})]})]}),v.jsxs(Ti,{children:[v.jsxs(bo,{children:[v.jsx(So,{children:"User Activity"}),v.jsx(Um,{children:"Detailed view of all user visits (updates in real-time)"})]}),v.jsx(Eo,{className:"p-0",children:v.jsx(jn,{className:"h-[600px]",children:v.jsx("div",{className:"overflow-x-auto",children:v.jsxs(vI,{children:[v.jsx(xI,{children:v.jsxs(lg,{children:[v.jsx(_o,{className:"w-[70px] text-[11px] sm:text-sm",children:"IP"}),v.jsx(_o,{className:"w-[50px] text-center text-[11px] sm:text-sm",children:v.jsx(eP,{className:"h-3 w-3 sm:h-4 sm:w-4 mx-auto"})}),v.jsx(_o,{className:"w-[85px] text-[11px] sm:text-sm",children:"First"}),v.jsx(_o,{className:"w-[85px] text-[11px] sm:text-sm",children:"Last"}),v.jsx(_o,{className:"w-[50px] text-[11px] sm:text-sm",children:"Device"})]})}),v.jsx(wI,{children:s.map(g=>{const y=/Mobile|Android|iPhone|iPad|iPod/i.test(g.user_agent);return v.jsxs(lg,{children:[v.jsx(Ao,{className:"font-mono text-[9px] sm:text-sm p-2",children:g.ip_address}),v.jsx(Ao,{className:"text-center p-2",children:v.jsx("span",{className:"inline-flex items-center justify-center rounded-full bg-primary/10 px-1.5 sm:px-3 py-0.5 text-[9px] sm:text-sm font-semibold text-primary",children:g.visit_count})}),v.jsxs(Ao,{className:"text-[9px] sm:text-sm p-2",children:[v.jsx("div",{children:new Date(g.first_visit_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),v.jsx("div",{className:"text-muted-foreground",children:new Date(g.first_visit_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),v.jsxs(Ao,{className:"text-[9px] sm:text-sm p-2",children:[v.jsx("div",{children:new Date(g.last_visit_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),v.jsx("div",{className:"text-muted-foreground",children:new Date(g.last_visit_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),v.jsx(Ao,{className:"text-[9px] sm:text-sm p-2",title:g.user_agent,children:y?"":""})]},g.id)})})]})})})})]})]})}):v.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:v.jsxs(Ti,{className:"w-full max-w-md",children:[v.jsxs(bo,{children:[v.jsx(So,{children:"Admin Login"}),v.jsx(Um,{children:"Enter password to access dashboard"})]}),v.jsx(Eo,{children:v.jsxs("div",{className:"space-y-4",children:[v.jsx(ny,{type:"password",placeholder:"Enter password",value:t,onChange:g=>n(g.target.value),onKeyPress:g=>g.key==="Enter"&&m()}),v.jsxs("div",{className:"flex gap-2",children:[v.jsx(pe,{onClick:m,className:"flex-1",children:"Login"}),v.jsx(pe,{variant:"outline",onClick:()=>h("/"),className:"flex-1",children:"Back to Home"})]})]})})]})})},V8=()=>{const[r,e]=T.useState(null),[t,n]=T.useState(!1);T.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)return;const a=l=>{l.preventDefault(),e(l),n(!0)};return window.addEventListener("beforeinstallprompt",a),()=>window.removeEventListener("beforeinstallprompt",a)},[]);const s=async()=>{if(!r)return;r.prompt();const{outcome:o}=await r.userChoice;o==="accepted"&&console.log("User accepted the install prompt"),e(null),n(!1)},i=()=>{n(!1)};return t?v.jsx("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm z-50 animate-in slide-in-from-bottom duration-300",children:v.jsx("div",{className:"bg-gradient-to-br from-background via-background to-primary/10 border border-primary/30 rounded-lg shadow-2xl p-4 backdrop-blur-xl",children:v.jsxs("div",{className:"flex items-start gap-3",children:[v.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-gradient-to-br from-primary/20 to-primary/10 rounded-lg flex items-center justify-center",children:v.jsx("img",{src:"https://url.bwmxmd.online/Adams.botkcfni.png",alt:"BWMGIFT",className:"w-10 h-10 object-contain"})}),v.jsxs("div",{className:"flex-1",children:[v.jsx("h3",{className:"font-bold text-sm mb-1",children:"Install BWMGIFT"}),v.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Install our app for faster access and offline viewing"}),v.jsxs("div",{className:"flex gap-2",children:[v.jsxs(pe,{size:"sm",onClick:s,className:"bg-primary hover:bg-primary/90",children:[v.jsx(ti,{className:"h-3 w-3 mr-1"}),"Install"]}),v.jsx(pe,{size:"sm",variant:"ghost",onClick:i,children:"Not now"})]})]}),v.jsx("button",{onClick:i,className:"flex-shrink-0 text-muted-foreground hover:text-foreground transition-colors",children:v.jsx(ui,{className:"h-4 w-4"})})]})})}):null},W8=()=>v.jsx("div",{className:"fixed inset-0 z-[9999] bg-background/95 backdrop-blur-sm flex items-center justify-center p-4",children:v.jsxs("div",{className:"text-center space-y-6 max-w-md animate-fade-in",children:[v.jsxs("div",{className:"relative mx-auto w-24 h-24",children:[v.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 animate-pulse"}),v.jsx("div",{className:"absolute inset-2 rounded-full bg-background flex items-center justify-center",children:v.jsx(aP,{className:"w-12 h-12 text-primary"})})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"You're Offline"}),v.jsx("p",{className:"text-muted-foreground",children:"No internet connection detected. Please check your network and try again."})]}),v.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[v.jsx("div",{className:"w-2 h-2 rounded-full bg-destructive animate-pulse"}),v.jsx("span",{children:"Waiting for connection..."})]})]})}),K8=()=>{const[r,e]=T.useState(navigator.onLine);return T.useEffect(()=>{const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t),window.addEventListener("offline",n),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}},[]),r},q8=new kN({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),Y8=()=>{const r=K8();return v.jsx(Q2,{children:v.jsx(PN,{client:q8,children:v.jsx(lN,{children:v.jsxs(T.Suspense,{fallback:v.jsx(X2,{}),children:[v.jsx(GP,{}),v.jsx(bD,{}),v.jsx(V8,{}),!r&&v.jsx(W8,{}),v.jsx(V2,{children:v.jsxs(F2,{children:[v.jsxs(tn,{element:v.jsx(jF,{}),children:[v.jsx(tn,{path:"/",element:v.jsx(yB,{})}),v.jsx(tn,{path:"/trending",element:v.jsx(vB,{})}),v.jsx(tn,{path:"/search",element:v.jsx(wB,{})}),v.jsx(tn,{path:"/movie/:id",element:v.jsx(IB,{})}),v.jsx(tn,{path:"/category/:name",element:v.jsx(B8,{})})]}),v.jsx(tn,{path:"/player",element:v.jsx(j8,{})}),v.jsx(tn,{path:"/install",element:v.jsx($8,{})}),v.jsx(tn,{path:"/admin",element:v.jsx(H8,{})}),v.jsx(tn,{path:"*",element:v.jsx(U8,{})})]})})]})})})})};ZE(document.getElementById("root")).render(v.jsx(Y8,{}));
